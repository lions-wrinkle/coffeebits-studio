"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[271,998,468,298],{6998:(t,e,a)=>{a.r(e),a.d(e,{BasePage:()=>s});class s{constructor(t,e,a,s){this.walletConnect=t,this.algodClient=a,this.algoIndexer=s,this.holdings=e}}},1271:(t,e,a)=>{a.r(e),a.d(e,{Home:()=>i});var s=a(6998),n=a(5298);class i extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n        \x3c!--<h1>Welcome to the Studio</h1>--\x3e\n        <div class="text-center">\n        <img src="assets/logo-studio.png" width="160" alt="The Studio" class="mb-4">\n        <p id="info-message"></p>\n        </div>\n        <div class="springboard d-flex flex-column flex-md-row w-100">\n\n            <div class="flex-fill springboard-item springboard-main-item mb-3 me-md-2">\n                <a href="?grinder" class="d-block" style="background-image: url(\'assets/springbord-grinder.png\'); background-color: #d39e27;" data-page-link="grinder">\n                    <h3>Grinder</h3>\n                    <p>Use Caffeine Cards to evolve your Bathers</p>\n                </a>\n            </div>\n\n            <div class="flex-fill d-flex flex-column">\n                <div class="flex-fill springboard-item mb-3 ms-md-2">\n                    <a href="?cards" class="d-block"\n                        style="background-image: url(\'assets/springboard-cards.png\'); background-color: #bb5f00;" data-page-link="cards">\n                        <h3>Caffeine<br>Cards</h3>\n                        <p>Browse all cards</p>\n                    </a>\n                </div>\n                <div class="flex-fill springboard-item mb-3 ms-md-2">\n                    <a href="?good-morning" class="d-block"\n                        style="background-image: url(\'assets/springboard-gm.png\'); background-color: #12c1b1;" data-page-link="good-morning">\n                        <h3>Good Morning!</h3>\n                        <p>Generate GM GIFs featuring your Bathers</p>\n                    </a>\n                </div>\n\n            </div>\n        ';try{this.loadPacks()}catch(t){console.error(t)}}async loadPacks(){const t=await(0,n.loadPacks)(this.holdings);t&&t.claimablePacks.length>0&&(this.ui.querySelector("#info-message").innerHTML=`<a href="?packs" data-page-link="packs">You have ${t.claimablePacks.length} Caffeine Cards to claim!</a>`,window.enableNavigationLinks())}}},5298:(t,e,a)=>{a.r(e),a.d(e,{Packs:()=>l,loadPacks:()=>c});var s=a(6998),n=a(7304),i=a(4050),o=a(4393);const r="https://api.atomixwap.xyz";async function c(t){let e=await fetch(`${r}/caffeine-card-pack/get-all`);if(200===e.status){let a=await e.json();const s=t.bathers.nfts.map((t=>t.assetId));let n=[];for(const t of a.packs)s.includes(t[0])&&n.push(t);return{claimablePacks:n,escrowAddress:a.escrowAddress}}throw new Error(`Can't load packs. Error ${e.status}`)}class l extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Caffeine Cards Packs</h1>\n    <p id="packs-status" class="dark-text text-center">Loading packs...</p>\n    ',this.claimablePacks,this.escrowAddress,this.fetchPacks()}sleep(t){return new Promise((e=>setTimeout(e,t)))}async fetchPacks(){const t=this.ui.querySelector("#packs-status");try{const e=await c(this.holdings);if(this.claimablePacks=e.claimablePacks,this.escrowAddress=e.escrowAddress,this.claimablePacks.length>0){let e="";this.claimablePacks.length>1&&(e="s"),t.textContent=`${this.claimablePacks.length} pack${e} to claim!`}else t.innerHTML='<img src="assets/pack0-0.png" style="width: 240px; opacity: 0.2;" class="mb-3"><br>\n        No pack to open.<br>\n        Make sure Bathers are not listed on marketplaces to see your packs.<br><br>\n        A Caffeine Card is given for every Bather bought in the <a href="https://instantshuffle.com/shuffle/yUSbzq61ZvqTIsSvLycS" target="_blank">Instant Shuffle.</a>\n        ';const a=document.createElement("div");a.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5 justify-content-center",this.ui.append(a);for(const t of this.claimablePacks){const e=document.createElement("div");e.className="col text-center ps-3 pe-3",a.append(e);const s=document.createElement("canvas");s.className="w-100 mb-0";const n=new d(s,t[1],this.algoIndexer);e.append(s),await n.load().then((()=>{const a=document.createElement("div");a.className="dark-text mt-0 pt-0 mb-2 hidden-pack-name",a.style.opacity="0",a.style["max-height"]="0",a.textContent=n.nft.name,e.append(a);const s=document.createElement("button");s.className="open-pack-button",s.textContent="Open",s.dataset.batherId=t[0],s.dataset.caffeineCardId=t[1],s.addEventListener("click",this.openPack.bind(this,n,a),!1),e.append(s)})).catch((t=>{console.log(t)})),this.sleep(300)}}catch(e){console.error(e),t.textContent=e.message}}disableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button soft-disabled",e.disabled=!0)}))}enableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button",e.disabled=!1)}))}async openPack(t,e,a){const s=a.currentTarget;this.disableAllButtons(s);const n=s.dataset.batherId,o=s.dataset.caffeineCardId;try{s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',s.disabled=!0;let a=await this.algodClient.getTransactionParams().do(),c=[i.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.walletConnect.walletAddress,amount:0,assetIndex:parseInt(o),suggestedParams:a}),i.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.escrowAddress,to:this.walletConnect.walletAddress,amount:1,assetIndex:parseInt(o),suggestedParams:a})];i.assignGroupID(c);const l=await this.walletConnect.signTransactions(c),d={batherId:n,txn:btoa(String.fromCharCode.apply(null,l[0])),suggestedParams:a};s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n      Opening...',s.disabled=!0;const h=await fetch(r+"/caffeine-card-pack/claim/",{method:"POST",body:JSON.stringify(d),headers:{Accept:"application/json","Content-Type":"application/json"}});if(200!==h.status){let t;try{t=await h.json()}catch(t){}throw t&&t.error?new Error(t.error):new Error(`Error ${h.status}`)}s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">\n        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n      </svg>\n        Opened',s.disabled=!0,s.dataset.opened=!0,t.animate(),e.style.opacity="1",e.style["max-height"]="500px",this.enableAllButtons(s)}catch(t){console.error(t),alert(t.message),s.textContent="Open",s.disabled=!1,this.enableAllButtons(s)}}}class d{constructor(t,e,a){this.caffeineCardId=e,this.algoIndexer=a,this.width=660,this.height=960,this.imageWidth=960,this.numAnimationImage=4,this.canvas=t,this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.context.translate(-(this.imageWidth-this.width)/2,0),this.nft,this.cardImage,this.cardMask,this.animationImages}async load(){await this.loadAllImage()}static loadImage(t){return new Promise(((e,a)=>{const s=new Image;s.onload=()=>{e(s)},s.onerror=a,s.src=t}))}async loadAllImage(){this.animationImages=[];const t=this.caffeineCardId%4,e=await d.loadImage(`assets/pack${t}-0.png`);this.animationImages.push(e),this.drawPack(),this.cardMask=await d.loadImage("assets/card-mask.png");const a=await this.algoIndexer.lookupAssetByID(this.caffeineCardId).do();this.nft=new n.Sm(this.caffeineCardId,a.asset),await this.nft.load(this.algoIndexer);try{this.cardImage=await d.loadImage(this.nft.imageUrl)}catch(t){console.log("Error loading image from primary, trying secondary");try{this.cardImage=await d.loadImage(this.nft.imageUrlAlternate)}catch(t){this.cardImage=await d.loadImage("assets/empty-card.png")}}for(let e=1;e<=this.numAnimationImage;e++){const a=await d.loadImage(`assets/pack${t}-${e}.png`);this.animationImages.push(a)}}async drawPack(){this.context.drawImage(this.animationImages[0],0,0,this.imageWidth,this.height)}static easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}async animate(){let t=.15,e=1;const a=setInterval((()=>{if(this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[e],0,0,this.imageWidth,this.height),e===this.numAnimationImage){clearInterval(a),o.sparkles(this.canvas),t=.05;const e=.8;let s=0;const n=setInterval((()=>{const a=d.easeInOutQuad(s/e)*this.height;this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[this.numAnimationImage],0,a,this.imageWidth,this.height),s+=t,s>=e&&clearInterval(n)}),1e3*t)}e++}),1e3*t)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q25KLEtBQUtpSCxRQUFReUIsVUFBVTFJLEtBQUtxSCxVQUFXLEVBQUcsRUFBR3JILEtBQUsrRyxXQUFZL0csS0FBSzhHLFFBRW5FOUcsS0FBS2lILFFBQVFrQyx5QkFBMkIsY0FHeENuSixLQUFLaUgsUUFBUXlCLFVBQVUxSSxLQUFLdUgsZ0JBQWdCd0IsR0FBZSxFQUFHLEVBQUcvSSxLQUFLK0csV0FBWS9HLEtBQUs4RyxRQUVuRmlDLElBQWlCL0ksS0FBS2dILGtCQUFrQixDQUUxQ29DLGNBQWNKLEdBRWQsV0FBZWhKLEtBQUs0RyxRQUdwQmtDLEVBQWdCLElBQ2hCLE1BQU1PLEVBQW9CLEdBQzFCLElBQUlDLEVBQWMsRUFFbEIsTUFBTUMsRUFBY04sYUFBWSxLQUU5QixNQUFNTyxFQUFVckcsRUFBcUJzRyxjQUFjSCxFQUFZRCxHQUFtQnJKLEtBQUs4RyxPQUd2RjlHLEtBQUtpSCxRQUFRaUMsVUFBVSxFQUFHLEVBQUdsSixLQUFLK0csV0FBWS9HLEtBQUs4RyxRQUduRDlHLEtBQUtpSCxRQUFReUIsVUFBVTFJLEtBQUtzSCxTQUFVLEVBQUcsRUFBR3RILEtBQUsrRyxXQUFZL0csS0FBSzhHLFFBRWxFOUcsS0FBS2lILFFBQVFrQyx5QkFBMkIsWUFHeENuSixLQUFLaUgsUUFBUXlCLFVBQVUxSSxLQUFLcUgsVUFBVyxFQUFHLEVBQUdySCxLQUFLK0csV0FBWS9HLEtBQUs4RyxRQUVuRTlHLEtBQUtpSCxRQUFRa0MseUJBQTJCLGNBR3hDbkosS0FBS2lILFFBQVF5QixVQUFVMUksS0FBS3VILGdCQUFnQnZILEtBQUtnSCxtQkFBb0IsRUFBR3dDLEVBQVN4SixLQUFLK0csV0FBWS9HLEtBQUs4RyxRQUV2R3dDLEdBQWVSLEVBRVhRLEdBQWVELEdBQ2pCRCxjQUFjRyxFQUloQixHQUVlLElBQWRULEVBRUwsQ0FFQUMsR0FBYyxHQUVDLElBQWRELEVBSUwsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9iYXNlLmpzIiwid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9ob21lLmpzIiwid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9wYWNrcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBjbGFzcyBCYXNlUGFnZSB7XG5cbiAgICBjb25zdHJ1Y3Rvcih3YWxsZXRDb25uZWN0LCBob2xkaW5ncywgYWxnb2RDbGllbnQsIGFsZ29JbmRleGVyKXtcblxuICAgICAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50ID0gYWxnb2RDbGllbnQ7XG4gICAgICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcbiAgICAgICAgdGhpcy5ob2xkaW5ncyA9IGhvbGRpbmdzO1xuXG4gICAgICAgIFxuXG4gICAgfVxuXG59IiwiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBsb2FkUGFja3MgfSBmcm9tIFwiLi9wYWNrcy5qc1wiO1xuXG5cbmV4cG9ydCBjbGFzcyBIb21lIGV4dGVuZHMgQmFzZVBhZ2Uge1xuXG4gICAgY29uc3RydWN0b3IoKXtcblxuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy51aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICAgICAgPCEtLTxoMT5XZWxjb21lIHRvIHRoZSBTdHVkaW88L2gxPi0tPlxuICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXJcIj5cbiAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvbG9nby1zdHVkaW8ucG5nXCIgd2lkdGg9XCIxNjBcIiBhbHQ9XCJUaGUgU3R1ZGlvXCIgY2xhc3M9XCJtYi00XCI+XG4gICAgICAgIDxwIGlkPVwiaW5mby1tZXNzYWdlXCI+PC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNwcmluZ2JvYXJkIGQtZmxleCBmbGV4LWNvbHVtbiBmbGV4LW1kLXJvdyB3LTEwMFwiPlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIHNwcmluZ2JvYXJkLWl0ZW0gc3ByaW5nYm9hcmQtbWFpbi1pdGVtIG1iLTMgbWUtbWQtMlwiPlxuICAgICAgICAgICAgICAgIDxhIGhyZWY9XCI/Z3JpbmRlclwiIGNsYXNzPVwiZC1ibG9ja1wiIHN0eWxlPVwiYmFja2dyb3VuZC1pbWFnZTogdXJsKCdhc3NldHMvc3ByaW5nYm9yZC1ncmluZGVyLnBuZycpOyBiYWNrZ3JvdW5kLWNvbG9yOiAjZDM5ZTI3O1wiIGRhdGEtcGFnZS1saW5rPVwiZ3JpbmRlclwiPlxuICAgICAgICAgICAgICAgICAgICA8aDM+R3JpbmRlcjwvaDM+XG4gICAgICAgICAgICAgICAgICAgIDxwPlVzZSBDYWZmZWluZSBDYXJkcyB0byBldm9sdmUgeW91ciBCYXRoZXJzPC9wPlxuICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIGQtZmxleCBmbGV4LWNvbHVtblwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4LWZpbGwgc3ByaW5nYm9hcmQtaXRlbSBtYi0zIG1zLW1kLTJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cIj9jYXJkc1wiIGNsYXNzPVwiZC1ibG9ja1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnYXNzZXRzL3NwcmluZ2JvYXJkLWNhcmRzLnBuZycpOyBiYWNrZ3JvdW5kLWNvbG9yOiAjYmI1ZjAwO1wiIGRhdGEtcGFnZS1saW5rPVwiY2FyZHNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMz5DYWZmZWluZTxicj5DYXJkczwvaDM+XG4gICAgICAgICAgICAgICAgICAgICAgICA8cD5Ccm93c2UgYWxsIGNhcmRzPC9wPlxuICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZsZXgtZmlsbCBzcHJpbmdib2FyZC1pdGVtIG1iLTMgbXMtbWQtMlwiPlxuICAgICAgICAgICAgICAgICAgICA8YSBocmVmPVwiP2dvb2QtbW9ybmluZ1wiIGNsYXNzPVwiZC1ibG9ja1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnYXNzZXRzL3NwcmluZ2JvYXJkLWdtLnBuZycpOyBiYWNrZ3JvdW5kLWNvbG9yOiAjMTJjMWIxO1wiIGRhdGEtcGFnZS1saW5rPVwiZ29vZC1tb3JuaW5nXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aDM+R29vZCBNb3JuaW5nITwvaDM+XG4gICAgICAgICAgICAgICAgICAgICAgICA8cD5HZW5lcmF0ZSBHTSBHSUZzIGZlYXR1cmluZyB5b3VyIEJhdGhlcnM8L3A+XG4gICAgICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIGA7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMubG9hZFBhY2tzKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycil7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycilcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG5cbiAgICBhc3luYyBsb2FkUGFja3MoKXtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsb2FkUGFja3ModGhpcy5ob2xkaW5ncyk7XG5cbiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuY2xhaW1hYmxlUGFja3MubGVuZ3RoID4gMCl7XG5cbiAgICAgICAgICAgIGNvbnN0IGluZm9NZXNzYWdlU3BhbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcignI2luZm8tbWVzc2FnZScpO1xuICAgICAgICAgICAgaW5mb01lc3NhZ2VTcGFuLmlubmVySFRNTCA9IGA8YSBocmVmPVwiP3BhY2tzXCIgZGF0YS1wYWdlLWxpbms9XCJwYWNrc1wiPllvdSBoYXZlICR7cmVzdWx0LmNsYWltYWJsZVBhY2tzLmxlbmd0aH0gQ2FmZmVpbmUgQ2FyZHMgdG8gY2xhaW0hPC9hPmA7XG5cbiAgICAgICAgICAgIHdpbmRvdy5lbmFibGVOYXZpZ2F0aW9uTGlua3MoKTtcbiAgICAgICAgfVxuICAgICAgICBcblxuICAgIH1cblxufSIsImltcG9ydCB7IEJhc2VQYWdlIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IHsgTkZUQ29sbGVjdGlvbiB9IGZyb20gXCJhbGdvLW5mdC11dGlsc1wiO1xuaW1wb3J0IGFsZ29zZGsgZnJvbSAnYWxnb3Nkayc7XG5pbXBvcnQgeyBORlQgfSBmcm9tIFwiYWxnby1uZnQtdXRpbHNcIjtcbmltcG9ydCBwYXJ0eSBmcm9tIFwicGFydHktanNcIjtcblxuY29uc3QgUEFDS1NfQVBJX1VSTCA9IFwiaHR0cHM6Ly9hcGkuYXRvbWl4d2FwLnh5elwiO1xuLy9jb25zdCBQQUNLU19BUElfVVJMID0gXCJodHRwczovL2xvY2FsaG9zdFwiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZFBhY2tzKGhvbGRpbmdzKSB7XG4gIGxldCByZXN1bHQgPSBhd2FpdCBmZXRjaChgJHtQQUNLU19BUElfVVJMfS9jYWZmZWluZS1jYXJkLXBhY2svZ2V0LWFsbGApO1xuXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSAyMDApIHtcbiAgICBsZXQganNvbiA9IGF3YWl0IHJlc3VsdC5qc29uKCk7XG5cbiAgICAvL2NvbXBhcmUgd2l0aCBob2xkaW5nc1xuICAgIGNvbnN0IGJhdGhlcnNJZHMgPSBob2xkaW5ncy5iYXRoZXJzLm5mdHMubWFwKChuZnQpID0+IG5mdC5hc3NldElkKTtcblxuICAgIGxldCBjbGFpbWFibGVQYWNrcyA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBwYWNrIG9mIGpzb24ucGFja3MpIHtcbiAgICAgIGlmIChiYXRoZXJzSWRzLmluY2x1ZGVzKHBhY2tbMF0pKSB7XG4gICAgICAgIGNsYWltYWJsZVBhY2tzLnB1c2gocGFjayk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNsYWltYWJsZVBhY2tzOiBjbGFpbWFibGVQYWNrcyxcbiAgICAgIGVzY3Jvd0FkZHJlc3M6IGpzb24uZXNjcm93QWRkcmVzcyxcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2FuXFwndCBsb2FkIHBhY2tzLiBFcnJvciAke3Jlc3VsdC5zdGF0dXN9YCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFBhY2tzIGV4dGVuZHMgQmFzZVBhZ2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuXG4gICAgdGhpcy51aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy51aS5pbm5lckhUTUwgPSBgXG4gICAgPGgxPkNhZmZlaW5lIENhcmRzIFBhY2tzPC9oMT5cbiAgICA8cCBpZD1cInBhY2tzLXN0YXR1c1wiIGNsYXNzPVwiZGFyay10ZXh0IHRleHQtY2VudGVyXCI+TG9hZGluZyBwYWNrcy4uLjwvcD5cbiAgICBgO1xuXG4gICAgdGhpcy5jbGFpbWFibGVQYWNrcztcbiAgICB0aGlzLmVzY3Jvd0FkZHJlc3M7XG5cbiAgICB0aGlzLmZldGNoUGFja3MoKTtcbiAgfVxuXG4gIHNsZWVwKGRlbGF5VGltZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlUaW1lKSk7XG4gIH0gXG5cbiAgYXN5bmMgZmV0Y2hQYWNrcygpIHtcblxuICAgIGNvbnN0IHBhY2tTdGF0dXNQID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3BhY2tzLXN0YXR1c1wiKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsb2FkUGFja3ModGhpcy5ob2xkaW5ncyk7XG5cbiAgICAgIHRoaXMuY2xhaW1hYmxlUGFja3MgPSByZXN1bHQuY2xhaW1hYmxlUGFja3M7XG4gICAgICB0aGlzLmVzY3Jvd0FkZHJlc3MgPSByZXN1bHQuZXNjcm93QWRkcmVzcztcblxuICAgICAgaWYgKHRoaXMuY2xhaW1hYmxlUGFja3MubGVuZ3RoID4gMCkge1xuICAgICAgICBsZXQgcGx1cmFsID0gJyc7XG4gICAgICAgIGlmICh0aGlzLmNsYWltYWJsZVBhY2tzLmxlbmd0aCA+IDEpe1xuICAgICAgICAgIHBsdXJhbCA9ICdzJztcbiAgICAgICAgfVxuICAgICAgICBwYWNrU3RhdHVzUC50ZXh0Q29udGVudCA9IGAke3RoaXMuY2xhaW1hYmxlUGFja3MubGVuZ3RofSBwYWNrJHtwbHVyYWx9IHRvIGNsYWltIWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYWNrU3RhdHVzUC5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCJhc3NldHMvcGFjazAtMC5wbmdcIiBzdHlsZT1cIndpZHRoOiAyNDBweDsgb3BhY2l0eTogMC4yO1wiIGNsYXNzPVwibWItM1wiPjxicj5cbiAgICAgICAgTm8gcGFjayB0byBvcGVuLjxicj5cbiAgICAgICAgTWFrZSBzdXJlIEJhdGhlcnMgYXJlIG5vdCBsaXN0ZWQgb24gbWFya2V0cGxhY2VzIHRvIHNlZSB5b3VyIHBhY2tzLjxicj48YnI+XG4gICAgICAgIEEgQ2FmZmVpbmUgQ2FyZCBpcyBnaXZlbiBmb3IgZXZlcnkgQmF0aGVyIGJvdWdodCBpbiB0aGUgPGEgaHJlZj1cImh0dHBzOi8vaW5zdGFudHNodWZmbGUuY29tL3NodWZmbGUveVVTYnpxNjFadnFUSXNTdkx5Y1NcIiB0YXJnZXQ9XCJfYmxhbmtcIj5JbnN0YW50IFNodWZmbGUuPC9hPlxuICAgICAgICBgO1xuICAgICAgfVxuXG4gICAgICAvL2Rpc3BsYXkgcGFjayBsaXN0XG4gICAgICBjb25zdCBwYWNrc0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBwYWNrc0Rpdi5jbGFzc05hbWUgPVxuICAgICAgICBcInJvdyByb3ctY29scy0yIHJvdy1jb2xzLW1kLTMgcm93LWNvbHMtbGctNCBneS00IG1iLTUganVzdGlmeS1jb250ZW50LWNlbnRlclwiO1xuICAgICAgdGhpcy51aS5hcHBlbmQocGFja3NEaXYpO1xuXG4gICAgICBmb3IgKGNvbnN0IHBhY2sgb2YgdGhpcy5jbGFpbWFibGVQYWNrcykge1xuICAgICAgICBjb25zdCBwYWNrRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgcGFja0Rpdi5jbGFzc05hbWUgPSBcImNvbCB0ZXh0LWNlbnRlciBwcy0zIHBlLTNcIjtcbiAgICAgICAgcGFja3NEaXYuYXBwZW5kKHBhY2tEaXYpO1xuXG4gICAgICAgIC8qY29uc3QgZ3JhcGhpY0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGdyYXBoaWNEaXYuY2xhc3NOYW1lID0gJyc7XG4gICAgICAgIGdyYXBoaWNEaXYuaW5uZXJIVE1MID0gYDxpbWcgc3JjPVwiYXNzZXRzL3BhY2swLnBuZ1wiIGNsYXNzPVwidy0xMDAgbWItMlwiPmA7XG4gICAgICAgIHBhY2tEaXYuYXBwZW5kKGdyYXBoaWNEaXYpOyovXG5cbiAgICAgICAgY29uc3QgcGFja0NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgIHBhY2tDYW52YXMuY2xhc3NOYW1lID0gJ3ctMTAwIG1iLTAnO1xuICAgICAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IFBhY2tDYW52YXNDb250cm9sbGVyKHBhY2tDYW52YXMsIHBhY2tbMV0sIHRoaXMuYWxnb0luZGV4ZXIpO1xuICAgICAgICBwYWNrRGl2LmFwcGVuZChwYWNrQ2FudmFzKTtcblxuICAgICAgICBhd2FpdCBjb250cm9sbGVyLmxvYWQoKS50aGVuKCgpID0+IHtcblxuICAgICAgICAgIGNvbnN0IGhpZGRlbk5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgIGhpZGRlbk5hbWUuY2xhc3NOYW1lID0gXCJkYXJrLXRleHQgbXQtMCBwdC0wIG1iLTIgaGlkZGVuLXBhY2stbmFtZVwiO1xuICAgICAgICAgIGhpZGRlbk5hbWUuc3R5bGUub3BhY2l0eSA9ICcwJztcbiAgICAgICAgICBoaWRkZW5OYW1lLnN0eWxlWydtYXgtaGVpZ2h0J10gPSAnMCc7XG4gICAgICAgICAgLy9oaWRkZW5OYW1lLmhpZGRlbiA9IHRydWU7XG4gICAgICAgICAgaGlkZGVuTmFtZS50ZXh0Q29udGVudCA9IGNvbnRyb2xsZXIubmZ0Lm5hbWU7XG4gICAgICAgICAgcGFja0Rpdi5hcHBlbmQoaGlkZGVuTmFtZSk7XG5cbiAgICAgICAgICBjb25zdCBvcGVuQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgICAgICBvcGVuQnV0dG9uLmNsYXNzTmFtZSA9IFwib3Blbi1wYWNrLWJ1dHRvblwiXG4gICAgICAgICAgb3BlbkJ1dHRvbi50ZXh0Q29udGVudCA9IFwiT3BlblwiO1xuICAgICAgICAgIG9wZW5CdXR0b24uZGF0YXNldC5iYXRoZXJJZCA9IHBhY2tbMF07XG4gICAgICAgICAgb3BlbkJ1dHRvbi5kYXRhc2V0LmNhZmZlaW5lQ2FyZElkID0gcGFja1sxXTtcbiAgICAgICAgICBvcGVuQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLm9wZW5QYWNrLmJpbmQodGhpcywgY29udHJvbGxlciwgaGlkZGVuTmFtZSksIGZhbHNlKTtcbiAgICAgICAgICBwYWNrRGl2LmFwcGVuZChvcGVuQnV0dG9uKTtcblxuICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zbGVlcCgzMDApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuXG4gICAgICBwYWNrU3RhdHVzUC50ZXh0Q29udGVudCA9IGVyci5tZXNzYWdlO1xuICAgICAgLy9hbGVydChlcnIubWVzc2FnZSk7XG4gICAgfVxuXG4gIH1cblxuICBkaXNhYmxlQWxsQnV0dG9ucyhleGNlcHQpe1xuXG4gICAgY29uc3QgYnV0dG9ucyA9IHRoaXMudWkucXVlcnlTZWxlY3RvckFsbCgnLm9wZW4tcGFjay1idXR0b24nKTtcbiAgICBcbiAgICBidXR0b25zLmZvckVhY2goYiA9PiB7XG5cbiAgICAgIGlmIChiICE9PSBleGNlcHQgJiYgIWIuZGF0YXNldC5vcGVuZWQpe1xuICAgICAgICBiLmNsYXNzTmFtZSA9IFwib3Blbi1wYWNrLWJ1dHRvbiBzb2Z0LWRpc2FibGVkXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgXG4gICAgfSk7XG4gIH1cblxuICBlbmFibGVBbGxCdXR0b25zKGV4Y2VwdCl7XG5cbiAgICBjb25zdCBidXR0b25zID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKCcub3Blbi1wYWNrLWJ1dHRvbicpO1xuICAgIFxuICAgIGJ1dHRvbnMuZm9yRWFjaChiID0+IHtcblxuICAgICAgaWYgKGIgIT09IGV4Y2VwdCAmJiAhYi5kYXRhc2V0Lm9wZW5lZCl7XG4gICAgICAgIGIuY2xhc3NOYW1lID0gXCJvcGVuLXBhY2stYnV0dG9uXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgICAgXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBvcGVuUGFjayhwYWNrQ2FudmFzQ29udHJvbGxlciwgaGlkZGVuTmFtZSwgZXZlbnQpIHtcblxuICAgIGNvbnN0IGNhbGxpbmdCdXR0b24gPSBldmVudC5jdXJyZW50VGFyZ2V0OyBcblxuICAgIHRoaXMuZGlzYWJsZUFsbEJ1dHRvbnMoY2FsbGluZ0J1dHRvbik7XG5cbiAgICBjb25zdCBiYXRoZXJJZCA9IGNhbGxpbmdCdXR0b24uZGF0YXNldC5iYXRoZXJJZDtcbiAgICBjb25zdCBjYWZmZWluZUNhcmRJZCA9IGNhbGxpbmdCdXR0b24uZGF0YXNldC5jYWZmZWluZUNhcmRJZDtcblxuICAgIHRyeSB7XG5cbiAgICAgIGNhbGxpbmdCdXR0b24uaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIiByb2xlPVwic3RhdHVzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9zcGFuPmA7XG4gICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgbGV0IHN1Z2dlc3RlZFBhcmFtcyA9IGF3YWl0IHRoaXMuYWxnb2RDbGllbnQuZ2V0VHJhbnNhY3Rpb25QYXJhbXMoKS5kbygpO1xuXG4gICAgICAvL3ByZXBhcmUgb3B0aW4gdHhuXG4gICAgICBsZXQgb3B0aW5UeG4gPVxuICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgZnJvbTogdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MsXG4gICAgICAgIHRvOiB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcyxcbiAgICAgICAgYW1vdW50OiAwLFxuICAgICAgICBhc3NldEluZGV4OiBwYXJzZUludChjYWZmZWluZUNhcmRJZCksXG4gICAgICAgIHN1Z2dlc3RlZFBhcmFtczogc3VnZ2VzdGVkUGFyYW1zLFxuICAgICAgfSk7XG5cbiAgICAvL3ByZXBhcmUgdHJhbnNmZXIgdHhuXG4gICAgbGV0IHRyYW5zZmVyVHhuID1cbiAgICAgIGFsZ29zZGsubWFrZUFzc2V0VHJhbnNmZXJUeG5XaXRoU3VnZ2VzdGVkUGFyYW1zRnJvbU9iamVjdCh7XG4gICAgICAgIGZyb206IHRoaXMuZXNjcm93QWRkcmVzcyxcbiAgICAgICAgdG86IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICBhbW91bnQ6IDEsXG4gICAgICAgIGFzc2V0SW5kZXg6IHBhcnNlSW50KGNhZmZlaW5lQ2FyZElkKSxcbiAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXMsXG4gICAgICB9KTtcblxuICAgICAgbGV0IGFsbFR4bnMgPSBbb3B0aW5UeG4sIHRyYW5zZmVyVHhuXTtcbiAgICAgIGFsZ29zZGsuYXNzaWduR3JvdXBJRChhbGxUeG5zKTtcblxuICAgICAgY29uc3Qgc2lnbmVkVHhucyA9IGF3YWl0IHRoaXMud2FsbGV0Q29ubmVjdC5zaWduVHJhbnNhY3Rpb25zKGFsbFR4bnMpO1xuXG4gICAgICBjb25zdCBzaWduZWRUeG5Kc29uID0ge1xuICAgICAgICBiYXRoZXJJZDogYmF0aGVySWQsXG4gICAgICAgIHR4bjogYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHNpZ25lZFR4bnNbMF0pKSxcbiAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXNcbiAgICAgIH1cblxuICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgICBPcGVuaW5nLi4uYDtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAvL2NhbGwgYXBpXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFBBQ0tTX0FQSV9VUkwgKyBcIi9jYWZmZWluZS1jYXJkLXBhY2svY2xhaW0vXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc2lnbmVkVHhuSnNvbiksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cblxuXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblxuICAgICAgICAvL2NvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyNFwiIGhlaWdodD1cIjI0XCIgZmlsbD1cImN1cnJlbnRDb2xvclwiIGNsYXNzPVwiYmkgYmktY2hlY2stY2lyY2xlLWZpbGxcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCI+XG4gICAgICAgIDxwYXRoIGQ9XCJNMTYgOEE4IDggMCAxIDEgMCA4YTggOCAwIDAgMSAxNiAwem0tMy45Ny0zLjAzYS43NS43NSAwIDAgMC0xLjA4LjAyMkw3LjQ3NyA5LjQxNyA1LjM4NCA3LjMyM2EuNzUuNzUgMCAwIDAtMS4wNiAxLjA2TDYuOTcgMTEuMDNhLjc1Ljc1IDAgMCAwIDEuMDc5LS4wMmwzLjk5Mi00Ljk5YS43NS43NSAwIDAgMC0uMDEtMS4wNXpcIi8+XG4gICAgICA8L3N2Zz5cbiAgICAgICAgT3BlbmVkYDtcbiAgICAgICAgY2FsbGluZ0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGNhbGxpbmdCdXR0b24uZGF0YXNldC5vcGVuZWQgPSB0cnVlO1xuXG4gICAgICAgIC8vYW5pbWF0ZSBwYWNrIG9wZW5pbmdcbiAgICAgICAgcGFja0NhbnZhc0NvbnRyb2xsZXIuYW5pbWF0ZSgpO1xuXG4gICAgICAgIGhpZGRlbk5hbWUuc3R5bGUub3BhY2l0eSA9ICcxJztcbiAgICAgICAgaGlkZGVuTmFtZS5zdHlsZVsnbWF4LWhlaWdodCddID0gJzUwMHB4JztcblxuICAgICAgICB0aGlzLmVuYWJsZUFsbEJ1dHRvbnMoY2FsbGluZ0J1dHRvbik7XG5cbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgbGV0IGRhdGE7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICB9IGNhdGNoKGVycikge31cbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmVycm9yKXtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnIpIHtcblxuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgYWxlcnQoZXJyLm1lc3NhZ2UpO1xuXG4gICAgICBjYWxsaW5nQnV0dG9uLnRleHRDb250ZW50ID0gXCJPcGVuXCI7XG4gICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG5cbiAgICAgIHRoaXMuZW5hYmxlQWxsQnV0dG9ucyhjYWxsaW5nQnV0dG9uKTtcblxuICAgIH1cblxuICB9XG4gIFxufVxuXG5cbmNsYXNzIFBhY2tDYW52YXNDb250cm9sbGVye1xuXG4gIGNvbnN0cnVjdG9yKGNhbnZhcywgY2FmZmVpbmVDYXJkSWQsIGFsZ29JbmRleGVyKXtcblxuICAgIHRoaXMuY2FmZmVpbmVDYXJkSWQgPSBjYWZmZWluZUNhcmRJZDtcbiAgICB0aGlzLmFsZ29JbmRleGVyID0gYWxnb0luZGV4ZXI7XG5cbiAgICB0aGlzLndpZHRoID0gNjYwO1xuICAgIHRoaXMuaGVpZ2h0ID0gOTYwXG4gICAgdGhpcy5pbWFnZVdpZHRoID0gOTYwO1xuXG4gICAgdGhpcy5udW1BbmltYXRpb25JbWFnZSA9IDQ7XG5cbiAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG5cbiAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMuY29udGV4dC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcblxuICAgIC8vdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9ICdyZWQnO1xuICAgIC8vdGhpcy5jb250ZXh0LmZpbGxSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgIHRoaXMuY29udGV4dC50cmFuc2xhdGUoLSh0aGlzLmltYWdlV2lkdGggLSB0aGlzLndpZHRoKS8yLCAwKTtcblxuICAgIC8vbG9hZCBhbmltYXRpb24gaW1hZ2VzXG4gICAgLy9sb2FkIGNhZmZlaW5lIGNhcmQgaW1hZ2VcblxuICAgIHRoaXMubmZ0O1xuXG4gICAgdGhpcy5jYXJkSW1hZ2U7XG4gICAgdGhpcy5jYXJkTWFzaztcbiAgICB0aGlzLmFuaW1hdGlvbkltYWdlcztcblxuXG4gIH1cblxuICBhc3luYyBsb2FkKCl7XG4gICAgYXdhaXQgdGhpcy5sb2FkQWxsSW1hZ2UoKTtcbiAgfVxuXG4gIHN0YXRpYyBsb2FkSW1hZ2UocGF0aCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG5cbiAgICAgIC8vaW1hZ2UuY3Jvc3NPcmlnaW4gPSAnQW5vbnltb3VzJztcblxuICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICByZXNvbHZlKGltYWdlKTtcbiAgICAgIH1cblxuICAgICAgaW1hZ2Uub25lcnJvciA9IHJlamVjdFxuXG4gICAgICBpbWFnZS5zcmMgPSBwYXRoO1xuXG4gICAgfSlcbiAgfVxuXG4gIGFzeW5jIGxvYWRBbGxJbWFnZSgpe1xuXG4gICAgdGhpcy5hbmltYXRpb25JbWFnZXMgPSBbXTtcblxuICAgIC8vY2hvb3NlIGEgY29sb3IgcmFuZG9tbHkgZGVwZW5kaW5nIG9uIGNhcmQgYXNzZXQgaWRcbiAgICBjb25zdCBjb2xvckluZGV4ID0gdGhpcy5jYWZmZWluZUNhcmRJZCAlIDQ7XG4gICAgLy9jb25zdCBjb2xvckluZGV4ID0gMDtcblxuICAgIC8vbG9hZCBmaXJzdCBpbWFnZSBhbmQgZGlzcGxheSBpdCBhcyBzb29uIGFzIHBvc3NpYmxlXG4gICAgY29uc3QgaW5pdGlhbEltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKGBhc3NldHMvcGFjayR7Y29sb3JJbmRleH0tMC5wbmdgKTtcbiAgICB0aGlzLmFuaW1hdGlvbkltYWdlcy5wdXNoKGluaXRpYWxJbWFnZSlcbiAgICB0aGlzLmRyYXdQYWNrKCk7XG5cbiAgICAvL2xvYWQgbWFza1xuICAgIHRoaXMuY2FyZE1hc2sgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoYGFzc2V0cy9jYXJkLW1hc2sucG5nYCk7XG5cbiAgICAvL2xvYWQgbmZ0IGltYWdlXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlci5sb29rdXBBc3NldEJ5SUQodGhpcy5jYWZmZWluZUNhcmRJZCkuZG8oKTtcbiAgICB0aGlzLm5mdCA9IG5ldyBORlQodGhpcy5jYWZmZWluZUNhcmRJZCwgcmVzdWx0Wydhc3NldCddKTtcbiAgICBhd2FpdCB0aGlzLm5mdC5sb2FkKHRoaXMuYWxnb0luZGV4ZXIpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICB0aGlzLmNhcmRJbWFnZSA9IGF3YWl0IFBhY2tDYW52YXNDb250cm9sbGVyLmxvYWRJbWFnZSh0aGlzLm5mdC5pbWFnZVVybCk7XG4gICAgfSBjYXRjaCAoZXJyKXtcbiAgICAgIGNvbnNvbGUubG9nKGBFcnJvciBsb2FkaW5nIGltYWdlIGZyb20gcHJpbWFyeSwgdHJ5aW5nIHNlY29uZGFyeWApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UodGhpcy5uZnQuaW1hZ2VVcmxBbHRlcm5hdGUpO1xuICAgICAgfSBjYXRjaCAoZXJyKXtcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoJ2Fzc2V0cy9lbXB0eS1jYXJkLnBuZycpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vbG9hZCBhbmltYXRpb24gaW1hZ2VzXG4gICAgXG4gICAgXG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSB0aGlzLm51bUFuaW1hdGlvbkltYWdlOyBpKyspe1xuICAgICAgY29uc3QgYW5pbWF0aW9uSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoYGFzc2V0cy9wYWNrJHtjb2xvckluZGV4fS0ke2l9LnBuZ2ApO1xuICAgICAgdGhpcy5hbmltYXRpb25JbWFnZXMucHVzaChhbmltYXRpb25JbWFnZSk7XG4gICAgfVxuXG4gIH1cblxuICBcblxuICBhc3luYyBkcmF3UGFjaygpe1xuXG4gICAgLy9sb2FkIGltYWdlXG4gICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmFuaW1hdGlvbkltYWdlc1swXSwgMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgfVxuXG4gIHN0YXRpYyBlYXNlSW5PdXRRdWFkKHgpIHtcbiAgICByZXR1cm4geCA8IDAuNSA/IDIgKiB4ICogeCA6IDEgLSBNYXRoLnBvdygtMiAqIHggKyAyLCAyKSAvIDI7XG4gIH1cblxuICBhc3luYyBhbmltYXRlKCl7XG5cbiAgICBsZXQgZnJhbWVEdXJhdGlvbiA9IDAuMTU7XG5cbiAgICBsZXQgY3VycmVudEZyYW1lID0gMTtcblxuICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG5cbiAgICAgIC8vY2xlYXIgY29udGV4dFxuICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgLy9kcmF3IG1hc2tcbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5jYXJkTWFzaywgMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLWluJztcblxuICAgICAgLy9kcmF3IGNhcmRcbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5jYXJkSW1hZ2UsIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICB0aGlzLmNvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ3NvdXJjZS1vdmVyJztcblxuICAgICAgLy9kcmF3IHBhY2sgYW5pbWF0aW9uXG4gICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuYW5pbWF0aW9uSW1hZ2VzW2N1cnJlbnRGcmFtZV0sIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICBpZiAoY3VycmVudEZyYW1lID09PSB0aGlzLm51bUFuaW1hdGlvbkltYWdlKXtcblxuICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xuXG4gICAgICAgIHBhcnR5LnNwYXJrbGVzKHRoaXMuY2FudmFzKTtcblxuICAgICAgICAvL3N0YXJ0IHNsaWRlIGFuaW1hdGlvblxuICAgICAgICBmcmFtZUR1cmF0aW9uID0gMC4wNTtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRHVyYXRpb24gPSAwLjg7XG4gICAgICAgIGxldCBjdXJyZW50VGltZSA9IDA7XG5cbiAgICAgICAgY29uc3QgaW50ZXJ2YWxJZDIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG5cbiAgICAgICAgICBjb25zdCB5T2Zmc2V0ID0gUGFja0NhbnZhc0NvbnRyb2xsZXIuZWFzZUluT3V0UXVhZChjdXJyZW50VGltZS9hbmltYXRpb25EdXJhdGlvbikqdGhpcy5oZWlnaHQ7XG5cbiAgICAgICAgICAvL2NsZWFyIGNvbnRleHRcbiAgICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICAgICAgLy9kcmF3IG1hc2tcbiAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuY2FyZE1hc2ssIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICAgICAgdGhpcy5jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2UtaW4nO1xuXG4gICAgICAgICAgLy9kcmF3IGNhcmRcbiAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuY2FyZEltYWdlLCAwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInO1xuXG4gICAgICAgICAgLy9kcmF3IHBhY2sgYW5pbWF0aW9uXG4gICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmFuaW1hdGlvbkltYWdlc1t0aGlzLm51bUFuaW1hdGlvbkltYWdlXSwgMCwgeU9mZnNldCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgICAgICBjdXJyZW50VGltZSArPSBmcmFtZUR1cmF0aW9uO1xuXG4gICAgICAgICAgaWYgKGN1cnJlbnRUaW1lID49IGFuaW1hdGlvbkR1cmF0aW9uKXtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZDIpO1xuXG4gICAgICAgICAgICBcblxuICAgICAgICAgIH1cblxuICAgICAgICB9LCBmcmFtZUR1cmF0aW9uKjEwMDApO1xuXG4gICAgICB9XG5cbiAgICAgIGN1cnJlbnRGcmFtZSsrO1xuXG4gICAgfSwgZnJhbWVEdXJhdGlvbioxMDAwKVxuXG5cblxuICB9XG5cbn1cbiJdLCJuYW1lcyI6WyJCYXNlUGFnZSIsImNvbnN0cnVjdG9yIiwid2FsbGV0Q29ubmVjdCIsImhvbGRpbmdzIiwiYWxnb2RDbGllbnQiLCJhbGdvSW5kZXhlciIsInRoaXMiLCJIb21lIiwic3VwZXIiLCJhcmd1bWVudHMiLCJ1aSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImxvYWRQYWNrcyIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImFzeW5jIiwicmVzdWx0IiwiY2xhaW1hYmxlUGFja3MiLCJsZW5ndGgiLCJxdWVyeVNlbGVjdG9yIiwid2luZG93IiwiZW5hYmxlTmF2aWdhdGlvbkxpbmtzIiwiUEFDS1NfQVBJX1VSTCIsImZldGNoIiwic3RhdHVzIiwianNvbiIsImJhdGhlcnNJZHMiLCJiYXRoZXJzIiwibmZ0cyIsIm1hcCIsIm5mdCIsImFzc2V0SWQiLCJwYWNrIiwicGFja3MiLCJpbmNsdWRlcyIsInB1c2giLCJlc2Nyb3dBZGRyZXNzIiwiRXJyb3IiLCJQYWNrcyIsImZldGNoUGFja3MiLCJzbGVlcCIsImRlbGF5VGltZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInBhY2tTdGF0dXNQIiwicGx1cmFsIiwidGV4dENvbnRlbnQiLCJwYWNrc0RpdiIsImNsYXNzTmFtZSIsImFwcGVuZCIsInBhY2tEaXYiLCJwYWNrQ2FudmFzIiwiY29udHJvbGxlciIsIlBhY2tDYW52YXNDb250cm9sbGVyIiwibG9hZCIsInRoZW4iLCJoaWRkZW5OYW1lIiwic3R5bGUiLCJvcGFjaXR5IiwibmFtZSIsIm9wZW5CdXR0b24iLCJkYXRhc2V0IiwiYmF0aGVySWQiLCJjYWZmZWluZUNhcmRJZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvcGVuUGFjayIsImJpbmQiLCJjYXRjaCIsImxvZyIsIm1lc3NhZ2UiLCJkaXNhYmxlQWxsQnV0dG9ucyIsImV4Y2VwdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiYiIsIm9wZW5lZCIsImRpc2FibGVkIiwiZW5hYmxlQWxsQnV0dG9ucyIsInBhY2tDYW52YXNDb250cm9sbGVyIiwiZXZlbnQiLCJjYWxsaW5nQnV0dG9uIiwiY3VycmVudFRhcmdldCIsInN1Z2dlc3RlZFBhcmFtcyIsImdldFRyYW5zYWN0aW9uUGFyYW1zIiwiZG8iLCJhbGxUeG5zIiwiZnJvbSIsIndhbGxldEFkZHJlc3MiLCJ0byIsImFtb3VudCIsImFzc2V0SW5kZXgiLCJwYXJzZUludCIsInNpZ25lZFR4bnMiLCJzaWduVHJhbnNhY3Rpb25zIiwic2lnbmVkVHhuSnNvbiIsInR4biIsImJ0b2EiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhcHBseSIsInJlc3BvbnNlIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJoZWFkZXJzIiwiQWNjZXB0IiwiZGF0YSIsImFuaW1hdGUiLCJhbGVydCIsImNhbnZhcyIsIndpZHRoIiwiaGVpZ2h0IiwiaW1hZ2VXaWR0aCIsIm51bUFuaW1hdGlvbkltYWdlIiwiY29udGV4dCIsImdldENvbnRleHQiLCJpbWFnZVNtb290aGluZ0VuYWJsZWQiLCJ0cmFuc2xhdGUiLCJjYXJkSW1hZ2UiLCJjYXJkTWFzayIsImFuaW1hdGlvbkltYWdlcyIsImxvYWRBbGxJbWFnZSIsInN0YXRpYyIsInBhdGgiLCJyZWplY3QiLCJpbWFnZSIsIkltYWdlIiwib25sb2FkIiwib25lcnJvciIsInNyYyIsImNvbG9ySW5kZXgiLCJpbml0aWFsSW1hZ2UiLCJsb2FkSW1hZ2UiLCJkcmF3UGFjayIsImxvb2t1cEFzc2V0QnlJRCIsImltYWdlVXJsIiwiaW1hZ2VVcmxBbHRlcm5hdGUiLCJpIiwiYW5pbWF0aW9uSW1hZ2UiLCJkcmF3SW1hZ2UiLCJ4IiwiTWF0aCIsInBvdyIsImZyYW1lRHVyYXRpb24iLCJjdXJyZW50RnJhbWUiLCJpbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJjbGVhclJlY3QiLCJnbG9iYWxDb21wb3NpdGVPcGVyYXRpb24iLCJjbGVhckludGVydmFsIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJjdXJyZW50VGltZSIsImludGVydmFsSWQyIiwieU9mZnNldCIsImVhc2VJbk91dFF1YWQiXSwic291cmNlUm9vdCI6IiJ9