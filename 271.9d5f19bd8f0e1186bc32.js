"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[271,998,468,298],{6998:(t,e,a)=>{a.r(e),a.d(e,{BasePage:()=>s});class s{constructor(t,e,a,s){this.walletConnect=t,this.algodClient=a,this.algoIndexer=s,this.holdings=e}}},1271:(t,e,a)=>{a.r(e),a.d(e,{Home:()=>r});var s=a(6998),n=a(5298),i=a(5190),o=a(7304);class r extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n        \x3c!--<h1>Welcome to the Studio</h1>--\x3e\n        <div class="text-center">\n        <p id="info-message"></p>\n        </div>\n        <div class="springboard d-flex flex-column flex-md-row w-100">\n\n            <div class="springboard-item springboard-main-item mb-3 me-md-2">\n                <a href="?grinder" class="d-block" style="background-image: url(\'assets/springbord-grinder.png\'); background-color: #d39e27;" data-page-link="grinder">\n                    <h3>Grinder</h3>\n                    <p>Use Caffeine Cards to modify your Bathers</p>\n                </a>\n            </div>\n\n            <div class="flex-fill d-flex flex-column">\n                <div class="flex-fill springboard-item mb-3 ms-md-2">\n                    <a href="?cards" class="d-block"\n                        style="background-image: url(\'assets/springboard-cards.png\'); background-color: #bb5f00;" data-page-link="cards">\n                        <h3>Caffeine<br>Cards</h3>\n                        <p>Browse all cards</p>\n                    </a>\n                </div>\n                <div class="flex-fill d-flex springboard-item mb-3 ms-md-2">\n                    <a href="?good-morning" class="d-block w-50 me-3"\n                        style="background-image: url(\'assets/springboard-gm.png\'); background-position: bottom right; background-size: 30%; background-color: #12c1b1;" data-page-link="good-morning">\n                        <h3>GM!</h3>\n                        <p>GM GIFs generator</p>\n                    </a>\n                    <a href="?longbois" class="d-block w-50"\n                        style="background-image: url(\'assets/springbord-longboi.png\'); background-color: #5b9c1a; background-position: bottom right; background-size: auto 80%;" data-page-link="longbois">\n                        <h3>Longbois</h3>\n                        <p>Longboi generator</p>\n                    </a>\n                </div>\n            </div>\n        </div>\n\n        <h3>Last grinds</h3>\n        <p class="dark-text">Don\'t miss new grinds by following <a href="https://twitter.com/coffeebits_bot" target="_blank">@coffeebits_bot</a></p>\n        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4" id="last-grinds">\n\n        ';try{this.loadPacks()}catch(t){console.error(t)}this.loadLastGrinds()}async loadPacks(){const t=await(0,n.loadPacks)(this.holdings);t&&t.claimablePacks.length>0&&(this.ui.querySelector("#info-message").innerHTML=`<img\n      src="assets/pack-icon.png" height="34"><a href="?packs" data-page-link="packs" class="text-decoration-underline">You have ${t.claimablePacks.length} Caffeine Card${t.claimablePacks.length>1?"s":""} to claim!</a>`,window.enableNavigationLinks())}async loadLastGrinds(){const t=i.default.filter((t=>"bathers"===t.name))[0].addresses[0];let e=(await this.algoIndexer.lookupAccountTransactions(t).txType("acfg").limit(48).do()).transactions;e.sort(((t,e)=>e["round-time"]-t["round-time"]));let a=[];for(const t of e)try{if(!t.note)continue;let e;try{e=JSON.parse(atob(t.note))}catch(t){console.error(t)}if(e&&"update"===e.type){const e=t["asset-config-transaction"]["asset-id"];a.push(e)}}catch(t){console.error(t)}a=a.filter(((t,e)=>a.indexOf(t)===e)),a=a.slice(0,12);const s=this.ui.querySelector("#last-grinds");let n=new IntersectionObserver(this.loadVisibleNFTs.bind(this),{root:null,rootMargin:"0px",threshold:0});for(const t of a){const e=document.createElement("div");e.className="col",e.dataset.assetId=t,e.innerHTML='\n          <div class="list-item h-100 d-flex flex-column">\n              <div class="ratio ratio-1x1 placeholder-bather">\n                <img class="nft-img img-fluid" loading="lazy" hidden>\n              </div>\n              <div class="list-item-text flex-fill d-flex flex-column">\n                  <h4 class="nft-name">xxx</h4>\n                  <span class="dark-text nft-holder"></span>\n                  <div class="flex-fill d-flex justify-content-end align-items-end mt-2">\n                        <div class="dropdown"></div>\n                  </div>\n              </div>\n          </div>\n      ',s.append(e),n.observe(e)}}sleep(t){return new Promise((e=>setTimeout(e,t)))}loadVisibleNFTs(t,e){t.forEach((async t=>{if(!t.isIntersecting)return;const e=t.target;if(e.dataset.loading)return;const a=e.dataset.assetId;if(!a)return;e.dataset.loading=!0;const s=await this.algoIndexer.lookupAssetByID(a).do();if(s){const t=new o.Sm(a,s.asset);e.querySelector(".nft-name").textContent="#"+t.unitName.substring(4,8),e.querySelector(".dropdown").innerHTML=`\n          <a href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n          <img src="assets/more.png" class="more">\n          </a>\n          <ul class="dropdown-menu">\n              <li><a class="dropdown-item" href="https://www.nftexplorer.app/asset/${t.assetId}" target="_blank">NFTExplorer</a></li>\n              <li><a class="dropdown-item" href="https://www.randgallery.com/algo-collection/?address=${t.assetId}" target="_blank">RandGallery</a></li>\n              <li><a class="dropdown-item" href="https://algoxnft.com/asset/${t.assetId}" target="_blank">ALGOxNFT</a></li>\n              <li><a class="dropdown-item" href="https://shufl.app/detail/${t.assetId}" target="_blank">Shufl</a></li>\n          </ul>\n    `,await t.load(this.algoIndexer);const n=e.querySelector(".nft-img");n.src=t.imageUrl,n.hidden=!1,t.handleImageError(n);const i=await this.algoIndexer.lookupAssetBalances(a).do(),r=e.querySelector(".nft-holder");if(i)for(const t of i.balances)if(t.amount>0){r.textContent=t.address.substring(0,12)+"...";try{const e=await fetch(`https://api.nf.domains/nfd/address?address=${t.address}`);if(200===e.status){const t=await e.json();r.textContent=t[0].name}}catch(t){console.error(t)}}}}))}}},5298:(t,e,a)=>{a.r(e),a.d(e,{Packs:()=>c,loadPacks:()=>l});var s=a(6998),n=a(7304),i=a(4483),o=a(4393);const r="https://api.atomixwap.xyz";async function l(t){let e=await fetch(`${r}/caffeine-card-pack/get-all`);if(200===e.status){let a=await e.json();if(t){let e=[];const s=t.bathers.nfts.map((t=>t.assetId));for(const t of a.packs)s.includes(t[0])&&e.push(t);return{claimablePacks:e,escrowAddress:a.escrowAddress}}return a.packs}throw new Error(`Can't load packs. Error ${e.status}`)}class c extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Caffeine Cards Packs</h1>\n    <p id="packs-status" class="dark-text text-center">Loading packs...</p>\n    ',this.claimablePacks,this.escrowAddress,this.fetchPacks()}sleep(t){return new Promise((e=>setTimeout(e,t)))}async fetchPacks(){const t=this.ui.querySelector("#packs-status");try{const e=await l(this.holdings);if(this.claimablePacks=e.claimablePacks,this.escrowAddress=e.escrowAddress,this.claimablePacks.length>0){let e="";this.claimablePacks.length>1&&(e="s"),t.textContent=`${this.claimablePacks.length} pack${e} to claim!`}else t.innerHTML='<img src="assets/pack0-0.png" style="width: 240px; opacity: 0.2;" class="mb-3"><br>\n        No pack to open.<br>\n        Make sure Bathers are not listed on marketplaces to see your packs.<br><br>\n        A Caffeine Card is given for every Bather bought in the <a href="https://instantshuffle.com/shuffle/yUSbzq61ZvqTIsSvLycS" target="_blank">Instant Shuffle.</a>\n        ';const a=document.createElement("div");a.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5 justify-content-center",this.ui.append(a);for(const t of this.claimablePacks){const e=document.createElement("div");e.className="col text-center ps-3 pe-3",a.append(e);const s=document.createElement("canvas");s.className="w-100 mb-0";const n=new d(s,t[1],this.algoIndexer);e.append(s),await n.load().then((()=>{const a=document.createElement("div");a.className="dark-text mt-0 pt-0 mb-2 hidden-pack-name",a.style.opacity="0",a.style["max-height"]="0",a.textContent=n.nft.name,e.append(a);const s=document.createElement("button");s.className="open-pack-button",s.textContent="Open",s.dataset.batherId=t[0],s.dataset.caffeineCardId=t[1],s.addEventListener("click",this.openPack.bind(this,n,a),!1),e.append(s);const i=this.holdings.bathers.nfts.find((e=>e.assetId===t[0]));if(i){const t=document.createElement("span");t.textContent="For "+i.name,t.className="d-block mt-2 dark-text",e.append(t)}})).catch((t=>{console.log(t)})),this.sleep(300)}}catch(e){console.error(e),t.textContent=e.message}}disableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button soft-disabled",e.disabled=!0)}))}enableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button",e.disabled=!1)}))}async openPack(t,e,a){const s=a.currentTarget;this.disableAllButtons(s);const n=s.dataset.batherId,o=s.dataset.caffeineCardId;try{s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',s.disabled=!0;let a=await this.algodClient.getTransactionParams().do(),l=[i.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.walletConnect.walletAddress,amount:0,assetIndex:parseInt(o),suggestedParams:a}),i.default.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.escrowAddress,to:this.walletConnect.walletAddress,amount:1,assetIndex:parseInt(o),suggestedParams:a})];i.default.assignGroupID(l);const c=await this.walletConnect.signTransactions(l),d={batherId:n,txn:btoa(String.fromCharCode.apply(null,c[0])),suggestedParams:a};s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n      Opening...',s.disabled=!0;const h=await fetch(r+"/caffeine-card-pack/claim/",{method:"POST",body:JSON.stringify(d),headers:{Accept:"application/json","Content-Type":"application/json"}});if(200!==h.status){let t;try{t=await h.json()}catch(t){}throw t&&t.error?new Error(t.error):new Error(`Error ${h.status}`)}s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">\n        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n      </svg>\n        Opened',s.disabled=!0,s.dataset.opened=!0,t.animate(),e.style.opacity="1",e.style["max-height"]="500px",this.enableAllButtons(s)}catch(t){console.error(t),alert(t.message),s.textContent="Open",s.disabled=!1,this.enableAllButtons(s)}}}class d{constructor(t,e,a){this.caffeineCardId=e,this.algoIndexer=a,this.width=660,this.height=960,this.imageWidth=960,this.numAnimationImage=4,this.canvas=t,this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.context.translate(-(this.imageWidth-this.width)/2,0),this.nft,this.cardImage,this.cardMask,this.animationImages}async load(){await this.loadAllImage()}static loadImage(t){return new Promise(((e,a)=>{const s=new Image;s.onload=()=>{e(s)},s.onerror=a,s.src=t}))}async loadAllImage(){this.animationImages=[];const t=this.caffeineCardId%4,e=await d.loadImage(`assets/pack${t}-0.png`);this.animationImages.push(e),this.drawPack(),this.cardMask=await d.loadImage("assets/card-mask.png");const a=await this.algoIndexer.lookupAssetByID(this.caffeineCardId).do();this.nft=new n.Sm(this.caffeineCardId,a.asset),await this.nft.load(this.algoIndexer);try{this.cardImage=await d.loadImage(this.nft.imageUrl)}catch(t){console.log("Error loading image from primary, trying secondary");try{this.cardImage=await d.loadImage(this.nft.imageUrlAlternate)}catch(t){this.cardImage=await d.loadImage("assets/empty-card.png")}}for(let e=1;e<=this.numAnimationImage;e++){const a=await d.loadImage(`assets/pack${t}-${e}.png`);this.animationImages.push(a)}}async drawPack(){this.context.drawImage(this.animationImages[0],0,0,this.imageWidth,this.height)}static easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}async animate(){let t=.15,e=1;const a=setInterval((()=>{if(this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[e],0,0,this.imageWidth,this.height),e===this.numAnimationImage){clearInterval(a),o.sparkles(this.canvas),t=.05;const e=.8;let s=0;const n=setInterval((()=>{const a=d.easeInOutQuad(s/e)*this.height;this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[this.numAnimationImage],0,a,this.imageWidth,this.height),s+=t,s>=e&&clearInterval(n)}),1e3*t)}e++}),1e3*t)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUduRHJLLEtBQUt3SyxRQUFRc0IsVUFDWDlMLEtBQUs2SyxTQUNMLEVBQ0EsRUFDQTdLLEtBQUtzSyxXQUNMdEssS0FBS3FLLFFBR1BySyxLQUFLd0ssUUFBUStCLHlCQUEyQixZQUd4Q3ZNLEtBQUt3SyxRQUFRc0IsVUFDWDlMLEtBQUs0SyxVQUNMLEVBQ0EsRUFDQTVLLEtBQUtzSyxXQUNMdEssS0FBS3FLLFFBR1BySyxLQUFLd0ssUUFBUStCLHlCQUEyQixjQUd4Q3ZNLEtBQUt3SyxRQUFRc0IsVUFDWDlMLEtBQUs4SyxnQkFBZ0I5SyxLQUFLdUssbUJBQzFCLEVBQ0FxQyxFQUNBNU0sS0FBS3NLLFdBQ0x0SyxLQUFLcUssUUFHUHFDLEdBQWVSLEVBRVhRLEdBQWVELEdBQ2pCRCxjQUFjRyxFQUNoQixHQUNpQixJQUFoQlQsRUFDTCxDQUVBQyxHQUFjLEdBQ0csSUFBaEJELEVBQ0wsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9iYXNlLmpzIiwid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9ob21lLmpzIiwid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9wYWNrcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBjbGFzcyBCYXNlUGFnZSB7XG5cbiAgICBjb25zdHJ1Y3Rvcih3YWxsZXRDb25uZWN0LCBob2xkaW5ncywgYWxnb2RDbGllbnQsIGFsZ29JbmRleGVyKXtcblxuICAgICAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50ID0gYWxnb2RDbGllbnQ7XG4gICAgICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcbiAgICAgICAgdGhpcy5ob2xkaW5ncyA9IGhvbGRpbmdzO1xuXG4gICAgICAgIFxuXG4gICAgfVxuXG59IiwiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBsb2FkUGFja3MgfSBmcm9tIFwiLi9wYWNrcy5qc1wiO1xuaW1wb3J0IGNvbGxlY3Rpb24gZnJvbSBcIi4uL2NvbGxlY3Rpb25zLmpzXCI7XG5pbXBvcnQgeyBORlQgfSBmcm9tIFwiYWxnby1uZnQtdXRpbHNcIjtcblxuZXhwb3J0IGNsYXNzIEhvbWUgZXh0ZW5kcyBCYXNlUGFnZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG5cbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICAgICAgPCEtLTxoMT5XZWxjb21lIHRvIHRoZSBTdHVkaW88L2gxPi0tPlxuICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXJcIj5cbiAgICAgICAgPHAgaWQ9XCJpbmZvLW1lc3NhZ2VcIj48L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaW5nYm9hcmQgZC1mbGV4IGZsZXgtY29sdW1uIGZsZXgtbWQtcm93IHctMTAwXCI+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpbmdib2FyZC1pdGVtIHNwcmluZ2JvYXJkLW1haW4taXRlbSBtYi0zIG1lLW1kLTJcIj5cbiAgICAgICAgICAgICAgICA8YSBocmVmPVwiP2dyaW5kZXJcIiBjbGFzcz1cImQtYmxvY2tcIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnYXNzZXRzL3NwcmluZ2JvcmQtZ3JpbmRlci5wbmcnKTsgYmFja2dyb3VuZC1jb2xvcjogI2QzOWUyNztcIiBkYXRhLXBhZ2UtbGluaz1cImdyaW5kZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGgzPkdyaW5kZXI8L2gzPlxuICAgICAgICAgICAgICAgICAgICA8cD5Vc2UgQ2FmZmVpbmUgQ2FyZHMgdG8gbW9kaWZ5IHlvdXIgQmF0aGVyczwvcD5cbiAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZsZXgtZmlsbCBkLWZsZXggZmxleC1jb2x1bW5cIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIHNwcmluZ2JvYXJkLWl0ZW0gbWItMyBtcy1tZC0yXCI+XG4gICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCI/Y2FyZHNcIiBjbGFzcz1cImQtYmxvY2tcIlxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJ2Fzc2V0cy9zcHJpbmdib2FyZC1jYXJkcy5wbmcnKTsgYmFja2dyb3VuZC1jb2xvcjogI2JiNWYwMDtcIiBkYXRhLXBhZ2UtbGluaz1cImNhcmRzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aDM+Q2FmZmVpbmU8YnI+Q2FyZHM8L2gzPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHA+QnJvd3NlIGFsbCBjYXJkczwvcD5cbiAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4LWZpbGwgZC1mbGV4IHNwcmluZ2JvYXJkLWl0ZW0gbWItMyBtcy1tZC0yXCI+XG4gICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCI/Z29vZC1tb3JuaW5nXCIgY2xhc3M9XCJkLWJsb2NrIHctNTAgbWUtM1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnYXNzZXRzL3NwcmluZ2JvYXJkLWdtLnBuZycpOyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBib3R0b20gcmlnaHQ7IGJhY2tncm91bmQtc2l6ZTogMzAlOyBiYWNrZ3JvdW5kLWNvbG9yOiAjMTJjMWIxO1wiIGRhdGEtcGFnZS1saW5rPVwiZ29vZC1tb3JuaW5nXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aDM+R00hPC9oMz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwPkdNIEdJRnMgZ2VuZXJhdG9yPC9wPlxuICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCI/bG9uZ2JvaXNcIiBjbGFzcz1cImQtYmxvY2sgdy01MFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnYXNzZXRzL3NwcmluZ2JvcmQtbG9uZ2JvaS5wbmcnKTsgYmFja2dyb3VuZC1jb2xvcjogIzViOWMxYTsgYmFja2dyb3VuZC1wb3NpdGlvbjogYm90dG9tIHJpZ2h0OyBiYWNrZ3JvdW5kLXNpemU6IGF1dG8gODAlO1wiIGRhdGEtcGFnZS1saW5rPVwibG9uZ2JvaXNcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxoMz5Mb25nYm9pczwvaDM+XG4gICAgICAgICAgICAgICAgICAgICAgICA8cD5Mb25nYm9pIGdlbmVyYXRvcjwvcD5cbiAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxoMz5MYXN0IGdyaW5kczwvaDM+XG4gICAgICAgIDxwIGNsYXNzPVwiZGFyay10ZXh0XCI+RG9uJ3QgbWlzcyBuZXcgZ3JpbmRzIGJ5IGZvbGxvd2luZyA8YSBocmVmPVwiaHR0cHM6Ly90d2l0dGVyLmNvbS9jb2ZmZWViaXRzX2JvdFwiIHRhcmdldD1cIl9ibGFua1wiPkBjb2ZmZWViaXRzX2JvdDwvYT48L3A+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgcm93LWNvbHMtMiByb3ctY29scy1tZC0zIHJvdy1jb2xzLWxnLTQgZ3ktNFwiIGlkPVwibGFzdC1ncmluZHNcIj5cblxuICAgICAgICBgO1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMubG9hZFBhY2tzKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfVxuXG4gICAgdGhpcy5sb2FkTGFzdEdyaW5kcygpO1xuICB9XG5cbiAgYXN5bmMgbG9hZFBhY2tzKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxvYWRQYWNrcyh0aGlzLmhvbGRpbmdzKTtcblxuICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmNsYWltYWJsZVBhY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGluZm9NZXNzYWdlU3BhbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNpbmZvLW1lc3NhZ2VcIik7XG4gICAgICBpbmZvTWVzc2FnZVNwYW4uaW5uZXJIVE1MID0gYDxpbWdcbiAgICAgIHNyYz1cImFzc2V0cy9wYWNrLWljb24ucG5nXCIgaGVpZ2h0PVwiMzRcIj48YSBocmVmPVwiP3BhY2tzXCIgZGF0YS1wYWdlLWxpbms9XCJwYWNrc1wiIGNsYXNzPVwidGV4dC1kZWNvcmF0aW9uLXVuZGVybGluZVwiPllvdSBoYXZlICR7cmVzdWx0LmNsYWltYWJsZVBhY2tzLmxlbmd0aH0gQ2FmZmVpbmUgQ2FyZCR7cmVzdWx0LmNsYWltYWJsZVBhY2tzLmxlbmd0aCA+IDEgPyAncycgOiAnJ30gdG8gY2xhaW0hPC9hPmA7XG5cbiAgICAgIHdpbmRvdy5lbmFibGVOYXZpZ2F0aW9uTGlua3MoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2FkTGFzdEdyaW5kcygpIHtcbiAgICBjb25zdCBiYXRoZXJzQ29sbGVjdGlvbkluZm8gPSBjb2xsZWN0aW9uLmZpbHRlcihcbiAgICAgIChjKSA9PiBjLm5hbWUgPT09IFwiYmF0aGVyc1wiXG4gICAgKTtcblxuICAgIGNvbnN0IGJhdGhlcnNDcmVhdG9yQWRkcmVzcyA9IGJhdGhlcnNDb2xsZWN0aW9uSW5mb1swXS5hZGRyZXNzZXNbMF07XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFsZ29JbmRleGVyXG4gICAgICAubG9va3VwQWNjb3VudFRyYW5zYWN0aW9ucyhiYXRoZXJzQ3JlYXRvckFkZHJlc3MpXG4gICAgICAudHhUeXBlKFwiYWNmZ1wiKVxuICAgICAgLmxpbWl0KDQ4KVxuICAgICAgLmRvKCk7XG5cbiAgICAvL29yZGVyIGJ5IGRhdGVcbiAgICBsZXQgdHJhbnNhY3Rpb25zID0gcmVzdWx0LnRyYW5zYWN0aW9ucztcbiAgICB0cmFuc2FjdGlvbnMuc29ydCgoYSwgYikgPT4gYltcInJvdW5kLXRpbWVcIl0gLSBhW1wicm91bmQtdGltZVwiXSk7XG5cbiAgICBsZXQgYXNzZXRzID0gW107XG5cbiAgICBjb25zdCBtYXhBc3NldHMgPSAxMjtcblxuICAgIGZvciAoY29uc3QgdHggb2YgdHJhbnNhY3Rpb25zKSB7XG4gICAgICB0cnkge1xuXG4gICAgICAgIGlmICghdHgubm90ZSl7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbm90ZVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgbm90ZSA9IEpTT04ucGFyc2UoYXRvYih0eC5ub3RlKSk7XG5cbiAgICAgICAgfSBjYXRjaCAoZSl7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5vdGUgJiYgbm90ZS50eXBlID09PSBcInVwZGF0ZVwiKSB7XG4gICAgICAgICAgY29uc3QgYXNzZXRJZCA9IHR4W1wiYXNzZXQtY29uZmlnLXRyYW5zYWN0aW9uXCJdW1wiYXNzZXQtaWRcIl07XG5cbiAgICAgICAgICBhc3NldHMucHVzaChhc3NldElkKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL3JlbW92ZSBkb3VibGVzXG4gICAgYXNzZXRzID0gYXNzZXRzLmZpbHRlcigoaXRlbSwgaW5kZXgpID0+IGFzc2V0cy5pbmRleE9mKGl0ZW0pID09PSBpbmRleCk7XG5cbiAgICAvL2tlZXAgb25seSB0aGUgZGVmaW5lZCBtYXggYXNzZXRzXG4gICAgYXNzZXRzID0gYXNzZXRzLnNsaWNlKDAsIG1heEFzc2V0cyk7XG5cbiAgICAvL2NyZWF0ZSBodG1sIGVsZW1lbnRzXG4gICAgY29uc3QgbGlzdERpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNsYXN0LWdyaW5kc1wiKTtcblxuICAgIC8vbG9hZCBvbmx5IHdoZW4gZWxlbWVudCBpcyB2aXNpYmxlXG4gICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICByb290OiBudWxsLCAvL2Jyb3dzZXIgdmlld3BvcnRcbiAgICAgIHJvb3RNYXJnaW46IFwiMHB4XCIsXG4gICAgICB0aHJlc2hvbGQ6IDAuMCxcbiAgICB9O1xuXG4gICAgbGV0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKFxuICAgICAgdGhpcy5sb2FkVmlzaWJsZU5GVHMuYmluZCh0aGlzKSxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuXG4gICAgZm9yIChjb25zdCBhc3NldCBvZiBhc3NldHMpIHtcbiAgICAgIGNvbnN0IG5mdERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBuZnREaXYuY2xhc3NOYW1lID0gXCJjb2xcIjtcbiAgICAgIG5mdERpdi5kYXRhc2V0LmFzc2V0SWQgPSBhc3NldDtcblxuICAgICAgbmZ0RGl2LmlubmVySFRNTCA9IGBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibGlzdC1pdGVtIGgtMTAwIGQtZmxleCBmbGV4LWNvbHVtblwiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmF0aW8gcmF0aW8tMXgxIHBsYWNlaG9sZGVyLWJhdGhlclwiPlxuICAgICAgICAgICAgICAgIDxpbWcgY2xhc3M9XCJuZnQtaW1nIGltZy1mbHVpZFwiIGxvYWRpbmc9XCJsYXp5XCIgaGlkZGVuPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxpc3QtaXRlbS10ZXh0IGZsZXgtZmlsbCBkLWZsZXggZmxleC1jb2x1bW5cIj5cbiAgICAgICAgICAgICAgICAgIDxoNCBjbGFzcz1cIm5mdC1uYW1lXCI+eHh4PC9oND5cbiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZGFyay10ZXh0IG5mdC1ob2xkZXJcIj48L3NwYW4+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIGQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtZW5kIGFsaWduLWl0ZW1zLWVuZCBtdC0yXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd25cIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG5cbiAgICAgIGxpc3REaXYuYXBwZW5kKG5mdERpdik7XG5cbiAgICAgIG9ic2VydmVyLm9ic2VydmUobmZ0RGl2KTtcbiAgICB9XG4gIH1cblxuICBzbGVlcChkZWxheVRpbWUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlUaW1lKSk7XG4gIH1cblxuICBsb2FkVmlzaWJsZU5GVHMoZW50cmllcywgb2JzZXJ2ZXIpIHtcbiAgICBlbnRyaWVzLmZvckVhY2goYXN5bmMgKGVudHJ5KSA9PiB7XG4gICAgICBpZiAoIWVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbmZ0RGl2ID0gZW50cnkudGFyZ2V0O1xuXG4gICAgICBpZiAobmZ0RGl2LmRhdGFzZXQubG9hZGluZykge1xuICAgICAgICAvL2xvYWRpbmcgaGF2ZSBhbHJlYWR5IHN0YXJ0ZWRcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhc3NldElkID0gbmZ0RGl2LmRhdGFzZXQuYXNzZXRJZDtcblxuICAgICAgaWYgKCFhc3NldElkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbmZ0RGl2LmRhdGFzZXQubG9hZGluZyA9IHRydWU7XG5cbiAgICAgIC8vbG9hZCBuZnRcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWxnb0luZGV4ZXIubG9va3VwQXNzZXRCeUlEKGFzc2V0SWQpLmRvKCk7XG5cbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgY29uc3QgbmZ0ID0gbmV3IE5GVChhc3NldElkLCByZXN1bHQuYXNzZXQpO1xuXG4gICAgICAgIG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLm5mdC1uYW1lXCIpLnRleHRDb250ZW50ID1cbiAgICAgICAgICBcIiNcIiArIG5mdC51bml0TmFtZS5zdWJzdHJpbmcoNCwgOCk7XG5cbiAgICAgICAgLy9hZGQgZHJvcGRvd24gd2l0aCBvcHRpb25zXG4gICAgICAgIGNvbnN0IGRyb3Bkb3duRGl2ID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIuZHJvcGRvd25cIik7XG5cbiAgICAgICAgZHJvcGRvd25EaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxhIGhyZWY9XCIjXCIgcm9sZT1cImJ1dHRvblwiIGRhdGEtYnMtdG9nZ2xlPVwiZHJvcGRvd25cIiBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9tb3JlLnBuZ1wiIGNsYXNzPVwibW9yZVwiPlxuICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8dWwgY2xhc3M9XCJkcm9wZG93bi1tZW51XCI+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly93d3cubmZ0ZXhwbG9yZXIuYXBwL2Fzc2V0LyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+TkZURXhwbG9yZXI8L2E+PC9saT5cbiAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL3d3dy5yYW5kZ2FsbGVyeS5jb20vYWxnby1jb2xsZWN0aW9uLz9hZGRyZXNzPSR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+UmFuZEdhbGxlcnk8L2E+PC9saT5cbiAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL2FsZ294bmZ0LmNvbS9hc3NldC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPkFMR094TkZUPC9hPjwvbGk+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly9zaHVmbC5hcHAvZGV0YWlsLyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+U2h1Zmw8L2E+PC9saT5cbiAgICAgICAgICA8L3VsPlxuICAgIGA7XG5cbiAgICAgICAgYXdhaXQgbmZ0LmxvYWQodGhpcy5hbGdvSW5kZXhlcik7XG5cbiAgICAgICAgY29uc3QgaW1nID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LWltZ1wiKTtcbiAgICAgICAgaW1nLnNyYyA9IG5mdC5pbWFnZVVybDtcbiAgICAgICAgaW1nLmhpZGRlbiA9IGZhbHNlO1xuXG4gICAgICAgIG5mdC5oYW5kbGVJbWFnZUVycm9yKGltZyk7XG5cbiAgICAgICAgLy9sb2FkIGhvbGRlclxuICAgICAgICBjb25zdCByZXN1bHRIb2xkZXIgPSBhd2FpdCB0aGlzLmFsZ29JbmRleGVyXG4gICAgICAgICAgLmxvb2t1cEFzc2V0QmFsYW5jZXMoYXNzZXRJZClcbiAgICAgICAgICAuZG8oKTtcblxuICAgICAgICBjb25zdCBob2xkZXJTcGFuID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LWhvbGRlclwiKTtcblxuICAgICAgICBpZiAocmVzdWx0SG9sZGVyKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBiYWxhbmNlIG9mIHJlc3VsdEhvbGRlci5iYWxhbmNlcykge1xuICAgICAgICAgICAgaWYgKGJhbGFuY2UuYW1vdW50ID4gMCkge1xuICAgICAgICAgICAgICBob2xkZXJTcGFuLnRleHRDb250ZW50ID0gYmFsYW5jZS5hZGRyZXNzLnN1YnN0cmluZygwLCAxMikgKyBcIi4uLlwiO1xuXG4gICAgICAgICAgICAgIC8vbG9hZCBuZmRcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICAgICAgICAgICAgYGh0dHBzOi8vYXBpLm5mLmRvbWFpbnMvbmZkL2FkZHJlc3M/YWRkcmVzcz0ke2JhbGFuY2UuYWRkcmVzc31gXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgY29uc3QgbmZkUmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAgICAgICAgICAgICBob2xkZXJTcGFuLnRleHRDb250ZW50ID0gbmZkUmVzdWx0WzBdLm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBORlRDb2xsZWN0aW9uIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgYWxnb3NkayBmcm9tIFwiYWxnb3Nka1wiO1xuaW1wb3J0IHsgTkZUIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgcGFydHkgZnJvbSBcInBhcnR5LWpzXCI7XG5cbmNvbnN0IFBBQ0tTX0FQSV9VUkwgPSBcImh0dHBzOi8vYXBpLmF0b21peHdhcC54eXpcIjtcbi8vY29uc3QgUEFDS1NfQVBJX1VSTCA9IFwiaHR0cHM6Ly9sb2NhbGhvc3RcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRQYWNrcyhob2xkaW5ncykge1xuICBsZXQgcmVzdWx0ID0gYXdhaXQgZmV0Y2goYCR7UEFDS1NfQVBJX1VSTH0vY2FmZmVpbmUtY2FyZC1wYWNrL2dldC1hbGxgKTtcblxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgbGV0IGpzb24gPSBhd2FpdCByZXN1bHQuanNvbigpO1xuXG4gICAgXG5cbiAgICBpZiAoaG9sZGluZ3MpIHtcblxuICAgICAgbGV0IGNsYWltYWJsZVBhY2tzID0gW107XG5cbiAgICAgIC8vY29tcGFyZSB3aXRoIGhvbGRpbmdzXG4gICAgICBjb25zdCBiYXRoZXJzSWRzID0gaG9sZGluZ3MuYmF0aGVycy5uZnRzLm1hcCgobmZ0KSA9PiBuZnQuYXNzZXRJZCk7XG5cbiAgICAgIGZvciAoY29uc3QgcGFjayBvZiBqc29uLnBhY2tzKSB7XG4gICAgICAgIGlmIChiYXRoZXJzSWRzLmluY2x1ZGVzKHBhY2tbMF0pKSB7XG4gICAgICAgICAgY2xhaW1hYmxlUGFja3MucHVzaChwYWNrKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjbGFpbWFibGVQYWNrczogY2xhaW1hYmxlUGFja3MsXG4gICAgICAgIGVzY3Jvd0FkZHJlc3M6IGpzb24uZXNjcm93QWRkcmVzcyxcbiAgICAgIH07XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGpzb24ucGFja3M7XG4gICAgfVxuXG4gICAgXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5cXCd0IGxvYWQgcGFja3MuIEVycm9yICR7cmVzdWx0LnN0YXR1c31gKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGFja3MgZXh0ZW5kcyBCYXNlUGFnZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG5cbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICA8aDE+Q2FmZmVpbmUgQ2FyZHMgUGFja3M8L2gxPlxuICAgIDxwIGlkPVwicGFja3Mtc3RhdHVzXCIgY2xhc3M9XCJkYXJrLXRleHQgdGV4dC1jZW50ZXJcIj5Mb2FkaW5nIHBhY2tzLi4uPC9wPlxuICAgIGA7XG5cbiAgICB0aGlzLmNsYWltYWJsZVBhY2tzO1xuICAgIHRoaXMuZXNjcm93QWRkcmVzcztcblxuICAgIHRoaXMuZmV0Y2hQYWNrcygpO1xuICB9XG5cbiAgc2xlZXAoZGVsYXlUaW1lKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5VGltZSkpO1xuICB9XG5cbiAgYXN5bmMgZmV0Y2hQYWNrcygpIHtcbiAgICBjb25zdCBwYWNrU3RhdHVzUCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNwYWNrcy1zdGF0dXNcIik7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbG9hZFBhY2tzKHRoaXMuaG9sZGluZ3MpO1xuXG4gICAgICB0aGlzLmNsYWltYWJsZVBhY2tzID0gcmVzdWx0LmNsYWltYWJsZVBhY2tzO1xuICAgICAgdGhpcy5lc2Nyb3dBZGRyZXNzID0gcmVzdWx0LmVzY3Jvd0FkZHJlc3M7XG5cbiAgICAgIGlmICh0aGlzLmNsYWltYWJsZVBhY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IHBsdXJhbCA9IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLmNsYWltYWJsZVBhY2tzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBwbHVyYWwgPSBcInNcIjtcbiAgICAgICAgfVxuICAgICAgICBwYWNrU3RhdHVzUC50ZXh0Q29udGVudCA9IGAke3RoaXMuY2xhaW1hYmxlUGFja3MubGVuZ3RofSBwYWNrJHtwbHVyYWx9IHRvIGNsYWltIWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYWNrU3RhdHVzUC5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCJhc3NldHMvcGFjazAtMC5wbmdcIiBzdHlsZT1cIndpZHRoOiAyNDBweDsgb3BhY2l0eTogMC4yO1wiIGNsYXNzPVwibWItM1wiPjxicj5cbiAgICAgICAgTm8gcGFjayB0byBvcGVuLjxicj5cbiAgICAgICAgTWFrZSBzdXJlIEJhdGhlcnMgYXJlIG5vdCBsaXN0ZWQgb24gbWFya2V0cGxhY2VzIHRvIHNlZSB5b3VyIHBhY2tzLjxicj48YnI+XG4gICAgICAgIEEgQ2FmZmVpbmUgQ2FyZCBpcyBnaXZlbiBmb3IgZXZlcnkgQmF0aGVyIGJvdWdodCBpbiB0aGUgPGEgaHJlZj1cImh0dHBzOi8vaW5zdGFudHNodWZmbGUuY29tL3NodWZmbGUveVVTYnpxNjFadnFUSXNTdkx5Y1NcIiB0YXJnZXQ9XCJfYmxhbmtcIj5JbnN0YW50IFNodWZmbGUuPC9hPlxuICAgICAgICBgO1xuICAgICAgfVxuXG4gICAgICAvL2Rpc3BsYXkgcGFjayBsaXN0XG4gICAgICBjb25zdCBwYWNrc0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBwYWNrc0Rpdi5jbGFzc05hbWUgPVxuICAgICAgICBcInJvdyByb3ctY29scy0yIHJvdy1jb2xzLW1kLTMgcm93LWNvbHMtbGctNCBneS00IG1iLTUganVzdGlmeS1jb250ZW50LWNlbnRlclwiO1xuICAgICAgdGhpcy51aS5hcHBlbmQocGFja3NEaXYpO1xuXG4gICAgICBmb3IgKGNvbnN0IHBhY2sgb2YgdGhpcy5jbGFpbWFibGVQYWNrcykge1xuICAgICAgICBjb25zdCBwYWNrRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgcGFja0Rpdi5jbGFzc05hbWUgPSBcImNvbCB0ZXh0LWNlbnRlciBwcy0zIHBlLTNcIjtcbiAgICAgICAgcGFja3NEaXYuYXBwZW5kKHBhY2tEaXYpO1xuXG4gICAgICAgIC8qY29uc3QgZ3JhcGhpY0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGdyYXBoaWNEaXYuY2xhc3NOYW1lID0gJyc7XG4gICAgICAgIGdyYXBoaWNEaXYuaW5uZXJIVE1MID0gYDxpbWcgc3JjPVwiYXNzZXRzL3BhY2swLnBuZ1wiIGNsYXNzPVwidy0xMDAgbWItMlwiPmA7XG4gICAgICAgIHBhY2tEaXYuYXBwZW5kKGdyYXBoaWNEaXYpOyovXG5cbiAgICAgICAgY29uc3QgcGFja0NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgIHBhY2tDYW52YXMuY2xhc3NOYW1lID0gXCJ3LTEwMCBtYi0wXCI7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgUGFja0NhbnZhc0NvbnRyb2xsZXIoXG4gICAgICAgICAgcGFja0NhbnZhcyxcbiAgICAgICAgICBwYWNrWzFdLFxuICAgICAgICAgIHRoaXMuYWxnb0luZGV4ZXJcbiAgICAgICAgKTtcbiAgICAgICAgcGFja0Rpdi5hcHBlbmQocGFja0NhbnZhcyk7XG5cbiAgICAgICAgYXdhaXQgY29udHJvbGxlclxuICAgICAgICAgIC5sb2FkKClcbiAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoaWRkZW5OYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGhpZGRlbk5hbWUuY2xhc3NOYW1lID0gXCJkYXJrLXRleHQgbXQtMCBwdC0wIG1iLTIgaGlkZGVuLXBhY2stbmFtZVwiO1xuICAgICAgICAgICAgaGlkZGVuTmFtZS5zdHlsZS5vcGFjaXR5ID0gXCIwXCI7XG4gICAgICAgICAgICBoaWRkZW5OYW1lLnN0eWxlW1wibWF4LWhlaWdodFwiXSA9IFwiMFwiO1xuICAgICAgICAgICAgLy9oaWRkZW5OYW1lLmhpZGRlbiA9IHRydWU7XG4gICAgICAgICAgICBoaWRkZW5OYW1lLnRleHRDb250ZW50ID0gY29udHJvbGxlci5uZnQubmFtZTtcbiAgICAgICAgICAgIHBhY2tEaXYuYXBwZW5kKGhpZGRlbk5hbWUpO1xuXG4gICAgICAgICAgICBjb25zdCBvcGVuQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgICAgICAgIG9wZW5CdXR0b24uY2xhc3NOYW1lID0gXCJvcGVuLXBhY2stYnV0dG9uXCI7XG4gICAgICAgICAgICBvcGVuQnV0dG9uLnRleHRDb250ZW50ID0gXCJPcGVuXCI7XG4gICAgICAgICAgICBvcGVuQnV0dG9uLmRhdGFzZXQuYmF0aGVySWQgPSBwYWNrWzBdO1xuICAgICAgICAgICAgb3BlbkJ1dHRvbi5kYXRhc2V0LmNhZmZlaW5lQ2FyZElkID0gcGFja1sxXTtcbiAgICAgICAgICAgIG9wZW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICAgXCJjbGlja1wiLFxuICAgICAgICAgICAgICB0aGlzLm9wZW5QYWNrLmJpbmQodGhpcywgY29udHJvbGxlciwgaGlkZGVuTmFtZSksXG4gICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcGFja0Rpdi5hcHBlbmQob3BlbkJ1dHRvbik7XG5cbiAgICAgICAgICAgIGNvbnN0IGJhdGhlciA9IHRoaXMuaG9sZGluZ3MuYmF0aGVycy5uZnRzLmZpbmQoKG5mdCkgPT4gbmZ0LmFzc2V0SWQgPT09IHBhY2tbMF0pO1xuICAgICAgICAgICAgaWYoYmF0aGVyKXtcbiAgICAgICAgICAgICAgY29uc3QgYmF0aGVyU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICAgICAgICBiYXRoZXJTcGFuLnRleHRDb250ZW50ID0gJ0ZvciAnK2JhdGhlci5uYW1lO1xuICAgICAgICAgICAgICBiYXRoZXJTcGFuLmNsYXNzTmFtZSA9IFwiZC1ibG9jayBtdC0yIGRhcmstdGV4dFwiO1xuICAgICAgICAgICAgICBwYWNrRGl2LmFwcGVuZChiYXRoZXJTcGFuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuc2xlZXAoMzAwKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcblxuICAgICAgcGFja1N0YXR1c1AudGV4dENvbnRlbnQgPSBlcnIubWVzc2FnZTtcbiAgICAgIC8vYWxlcnQoZXJyLm1lc3NhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGRpc2FibGVBbGxCdXR0b25zKGV4Y2VwdCkge1xuICAgIGNvbnN0IGJ1dHRvbnMgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIub3Blbi1wYWNrLWJ1dHRvblwiKTtcblxuICAgIGJ1dHRvbnMuZm9yRWFjaCgoYikgPT4ge1xuICAgICAgaWYgKGIgIT09IGV4Y2VwdCAmJiAhYi5kYXRhc2V0Lm9wZW5lZCkge1xuICAgICAgICBiLmNsYXNzTmFtZSA9IFwib3Blbi1wYWNrLWJ1dHRvbiBzb2Z0LWRpc2FibGVkXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZW5hYmxlQWxsQnV0dG9ucyhleGNlcHQpIHtcbiAgICBjb25zdCBidXR0b25zID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKFwiLm9wZW4tcGFjay1idXR0b25cIik7XG5cbiAgICBidXR0b25zLmZvckVhY2goKGIpID0+IHtcbiAgICAgIGlmIChiICE9PSBleGNlcHQgJiYgIWIuZGF0YXNldC5vcGVuZWQpIHtcbiAgICAgICAgYi5jbGFzc05hbWUgPSBcIm9wZW4tcGFjay1idXR0b25cIjtcbiAgICAgICAgYi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgb3BlblBhY2socGFja0NhbnZhc0NvbnRyb2xsZXIsIGhpZGRlbk5hbWUsIGV2ZW50KSB7XG4gICAgY29uc3QgY2FsbGluZ0J1dHRvbiA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG5cbiAgICB0aGlzLmRpc2FibGVBbGxCdXR0b25zKGNhbGxpbmdCdXR0b24pO1xuXG4gICAgY29uc3QgYmF0aGVySWQgPSBjYWxsaW5nQnV0dG9uLmRhdGFzZXQuYmF0aGVySWQ7XG4gICAgY29uc3QgY2FmZmVpbmVDYXJkSWQgPSBjYWxsaW5nQnV0dG9uLmRhdGFzZXQuY2FmZmVpbmVDYXJkSWQ7XG5cbiAgICB0cnkge1xuICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+YDtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICBsZXQgc3VnZ2VzdGVkUGFyYW1zID0gYXdhaXQgdGhpcy5hbGdvZENsaWVudC5nZXRUcmFuc2FjdGlvblBhcmFtcygpLmRvKCk7XG5cbiAgICAgIC8vcHJlcGFyZSBvcHRpbiB0eG5cbiAgICAgIGxldCBvcHRpblR4biA9IGFsZ29zZGsubWFrZUFzc2V0VHJhbnNmZXJUeG5XaXRoU3VnZ2VzdGVkUGFyYW1zRnJvbU9iamVjdCh7XG4gICAgICAgIGZyb206IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICB0bzogdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MsXG4gICAgICAgIGFtb3VudDogMCxcbiAgICAgICAgYXNzZXRJbmRleDogcGFyc2VJbnQoY2FmZmVpbmVDYXJkSWQpLFxuICAgICAgICBzdWdnZXN0ZWRQYXJhbXM6IHN1Z2dlc3RlZFBhcmFtcyxcbiAgICAgIH0pO1xuXG4gICAgICAvL3ByZXBhcmUgdHJhbnNmZXIgdHhuXG4gICAgICBsZXQgdHJhbnNmZXJUeG4gPVxuICAgICAgICBhbGdvc2RrLm1ha2VBc3NldFRyYW5zZmVyVHhuV2l0aFN1Z2dlc3RlZFBhcmFtc0Zyb21PYmplY3Qoe1xuICAgICAgICAgIGZyb206IHRoaXMuZXNjcm93QWRkcmVzcyxcbiAgICAgICAgICB0bzogdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MsXG4gICAgICAgICAgYW1vdW50OiAxLFxuICAgICAgICAgIGFzc2V0SW5kZXg6IHBhcnNlSW50KGNhZmZlaW5lQ2FyZElkKSxcbiAgICAgICAgICBzdWdnZXN0ZWRQYXJhbXM6IHN1Z2dlc3RlZFBhcmFtcyxcbiAgICAgICAgfSk7XG5cbiAgICAgIGxldCBhbGxUeG5zID0gW29wdGluVHhuLCB0cmFuc2ZlclR4bl07XG4gICAgICBhbGdvc2RrLmFzc2lnbkdyb3VwSUQoYWxsVHhucyk7XG5cbiAgICAgIGNvbnN0IHNpZ25lZFR4bnMgPSBhd2FpdCB0aGlzLndhbGxldENvbm5lY3Quc2lnblRyYW5zYWN0aW9ucyhhbGxUeG5zKTtcblxuICAgICAgY29uc3Qgc2lnbmVkVHhuSnNvbiA9IHtcbiAgICAgICAgYmF0aGVySWQ6IGJhdGhlcklkLFxuICAgICAgICB0eG46IGJ0b2EoU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBzaWduZWRUeG5zWzBdKSksXG4gICAgICAgIHN1Z2dlc3RlZFBhcmFtczogc3VnZ2VzdGVkUGFyYW1zLFxuICAgICAgfTtcblxuICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgICBPcGVuaW5nLi4uYDtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAvL2NhbGwgYXBpXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBQQUNLU19BUElfVVJMICsgXCIvY2FmZmVpbmUtY2FyZC1wYWNrL2NsYWltL1wiLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShzaWduZWRUeG5Kc29uKSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIC8vY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgICBjYWxsaW5nQnV0dG9uLmlubmVySFRNTCA9IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjI0XCIgaGVpZ2h0PVwiMjRcIiBmaWxsPVwiY3VycmVudENvbG9yXCIgY2xhc3M9XCJiaSBiaS1jaGVjay1jaXJjbGUtZmlsbFwiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIj5cbiAgICAgICAgPHBhdGggZD1cIk0xNiA4QTggOCAwIDEgMSAwIDhhOCA4IDAgMCAxIDE2IDB6bS0zLjk3LTMuMDNhLjc1Ljc1IDAgMCAwLTEuMDguMDIyTDcuNDc3IDkuNDE3IDUuMzg0IDcuMzIzYS43NS43NSAwIDAgMC0xLjA2IDEuMDZMNi45NyAxMS4wM2EuNzUuNzUgMCAwIDAgMS4wNzktLjAybDMuOTkyLTQuOTlhLjc1Ljc1IDAgMCAwLS4wMS0xLjA1elwiLz5cbiAgICAgIDwvc3ZnPlxuICAgICAgICBPcGVuZWRgO1xuICAgICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgY2FsbGluZ0J1dHRvbi5kYXRhc2V0Lm9wZW5lZCA9IHRydWU7XG5cbiAgICAgICAgLy9hbmltYXRlIHBhY2sgb3BlbmluZ1xuICAgICAgICBwYWNrQ2FudmFzQ29udHJvbGxlci5hbmltYXRlKCk7XG5cbiAgICAgICAgaGlkZGVuTmFtZS5zdHlsZS5vcGFjaXR5ID0gXCIxXCI7XG4gICAgICAgIGhpZGRlbk5hbWUuc3R5bGVbXCJtYXgtaGVpZ2h0XCJdID0gXCI1MDBweFwiO1xuXG4gICAgICAgIHRoaXMuZW5hYmxlQWxsQnV0dG9ucyhjYWxsaW5nQnV0dG9uKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBkYXRhO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7fVxuXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEuZXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZGF0YS5lcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgYWxlcnQoZXJyLm1lc3NhZ2UpO1xuXG4gICAgICBjYWxsaW5nQnV0dG9uLnRleHRDb250ZW50ID0gXCJPcGVuXCI7XG4gICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG5cbiAgICAgIHRoaXMuZW5hYmxlQWxsQnV0dG9ucyhjYWxsaW5nQnV0dG9uKTtcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgUGFja0NhbnZhc0NvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihjYW52YXMsIGNhZmZlaW5lQ2FyZElkLCBhbGdvSW5kZXhlcikge1xuICAgIHRoaXMuY2FmZmVpbmVDYXJkSWQgPSBjYWZmZWluZUNhcmRJZDtcbiAgICB0aGlzLmFsZ29JbmRleGVyID0gYWxnb0luZGV4ZXI7XG5cbiAgICB0aGlzLndpZHRoID0gNjYwO1xuICAgIHRoaXMuaGVpZ2h0ID0gOTYwO1xuICAgIHRoaXMuaW1hZ2VXaWR0aCA9IDk2MDtcblxuICAgIHRoaXMubnVtQW5pbWF0aW9uSW1hZ2UgPSA0O1xuXG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLndpZHRoO1xuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuXG4gICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIHRoaXMuY29udGV4dC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcblxuICAgIC8vdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9ICdyZWQnO1xuICAgIC8vdGhpcy5jb250ZXh0LmZpbGxSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgIHRoaXMuY29udGV4dC50cmFuc2xhdGUoLSh0aGlzLmltYWdlV2lkdGggLSB0aGlzLndpZHRoKSAvIDIsIDApO1xuXG4gICAgLy9sb2FkIGFuaW1hdGlvbiBpbWFnZXNcbiAgICAvL2xvYWQgY2FmZmVpbmUgY2FyZCBpbWFnZVxuXG4gICAgdGhpcy5uZnQ7XG5cbiAgICB0aGlzLmNhcmRJbWFnZTtcbiAgICB0aGlzLmNhcmRNYXNrO1xuICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzO1xuICB9XG5cbiAgYXN5bmMgbG9hZCgpIHtcbiAgICBhd2FpdCB0aGlzLmxvYWRBbGxJbWFnZSgpO1xuICB9XG5cbiAgc3RhdGljIGxvYWRJbWFnZShwYXRoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG5cbiAgICAgIC8vaW1hZ2UuY3Jvc3NPcmlnaW4gPSAnQW5vbnltb3VzJztcblxuICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICByZXNvbHZlKGltYWdlKTtcbiAgICAgIH07XG5cbiAgICAgIGltYWdlLm9uZXJyb3IgPSByZWplY3Q7XG5cbiAgICAgIGltYWdlLnNyYyA9IHBhdGg7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBsb2FkQWxsSW1hZ2UoKSB7XG4gICAgdGhpcy5hbmltYXRpb25JbWFnZXMgPSBbXTtcblxuICAgIC8vY2hvb3NlIGEgY29sb3IgcmFuZG9tbHkgZGVwZW5kaW5nIG9uIGNhcmQgYXNzZXQgaWRcbiAgICBjb25zdCBjb2xvckluZGV4ID0gdGhpcy5jYWZmZWluZUNhcmRJZCAlIDQ7XG4gICAgLy9jb25zdCBjb2xvckluZGV4ID0gMDtcblxuICAgIC8vbG9hZCBmaXJzdCBpbWFnZSBhbmQgZGlzcGxheSBpdCBhcyBzb29uIGFzIHBvc3NpYmxlXG4gICAgY29uc3QgaW5pdGlhbEltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKFxuICAgICAgYGFzc2V0cy9wYWNrJHtjb2xvckluZGV4fS0wLnBuZ2BcbiAgICApO1xuICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzLnB1c2goaW5pdGlhbEltYWdlKTtcbiAgICB0aGlzLmRyYXdQYWNrKCk7XG5cbiAgICAvL2xvYWQgbWFza1xuICAgIHRoaXMuY2FyZE1hc2sgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoXG4gICAgICBgYXNzZXRzL2NhcmQtbWFzay5wbmdgXG4gICAgKTtcblxuICAgIC8vbG9hZCBuZnQgaW1hZ2VcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmFsZ29JbmRleGVyXG4gICAgICAubG9va3VwQXNzZXRCeUlEKHRoaXMuY2FmZmVpbmVDYXJkSWQpXG4gICAgICAuZG8oKTtcbiAgICB0aGlzLm5mdCA9IG5ldyBORlQodGhpcy5jYWZmZWluZUNhcmRJZCwgcmVzdWx0W1wiYXNzZXRcIl0pO1xuICAgIGF3YWl0IHRoaXMubmZ0LmxvYWQodGhpcy5hbGdvSW5kZXhlcik7XG5cbiAgICB0cnkge1xuICAgICAgdGhpcy5jYXJkSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UodGhpcy5uZnQuaW1hZ2VVcmwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5sb2coYEVycm9yIGxvYWRpbmcgaW1hZ2UgZnJvbSBwcmltYXJ5LCB0cnlpbmcgc2Vjb25kYXJ5YCk7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmNhcmRJbWFnZSA9IGF3YWl0IFBhY2tDYW52YXNDb250cm9sbGVyLmxvYWRJbWFnZShcbiAgICAgICAgICB0aGlzLm5mdC5pbWFnZVVybEFsdGVybmF0ZVxuICAgICAgICApO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRoaXMuY2FyZEltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKFxuICAgICAgICAgIFwiYXNzZXRzL2VtcHR5LWNhcmQucG5nXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2xvYWQgYW5pbWF0aW9uIGltYWdlc1xuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGhpcy5udW1BbmltYXRpb25JbWFnZTsgaSsrKSB7XG4gICAgICBjb25zdCBhbmltYXRpb25JbWFnZSA9IGF3YWl0IFBhY2tDYW52YXNDb250cm9sbGVyLmxvYWRJbWFnZShcbiAgICAgICAgYGFzc2V0cy9wYWNrJHtjb2xvckluZGV4fS0ke2l9LnBuZ2BcbiAgICAgICk7XG4gICAgICB0aGlzLmFuaW1hdGlvbkltYWdlcy5wdXNoKGFuaW1hdGlvbkltYWdlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBkcmF3UGFjaygpIHtcbiAgICAvL2xvYWQgaW1hZ2VcbiAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgdGhpcy5hbmltYXRpb25JbWFnZXNbMF0sXG4gICAgICAwLFxuICAgICAgMCxcbiAgICAgIHRoaXMuaW1hZ2VXaWR0aCxcbiAgICAgIHRoaXMuaGVpZ2h0XG4gICAgKTtcbiAgfVxuXG4gIHN0YXRpYyBlYXNlSW5PdXRRdWFkKHgpIHtcbiAgICByZXR1cm4geCA8IDAuNSA/IDIgKiB4ICogeCA6IDEgLSBNYXRoLnBvdygtMiAqIHggKyAyLCAyKSAvIDI7XG4gIH1cblxuICBhc3luYyBhbmltYXRlKCkge1xuICAgIGxldCBmcmFtZUR1cmF0aW9uID0gMC4xNTtcblxuICAgIGxldCBjdXJyZW50RnJhbWUgPSAxO1xuXG4gICAgY29uc3QgaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIC8vY2xlYXIgY29udGV4dFxuICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgLy9kcmF3IG1hc2tcbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5jYXJkTWFzaywgMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1pblwiO1xuXG4gICAgICAvL2RyYXcgY2FyZFxuICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2UsXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIHRoaXMuaW1hZ2VXaWR0aCxcbiAgICAgICAgdGhpcy5oZWlnaHRcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1vdmVyXCI7XG5cbiAgICAgIC8vZHJhdyBwYWNrIGFuaW1hdGlvblxuICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShcbiAgICAgICAgdGhpcy5hbmltYXRpb25JbWFnZXNbY3VycmVudEZyYW1lXSxcbiAgICAgICAgMCxcbiAgICAgICAgMCxcbiAgICAgICAgdGhpcy5pbWFnZVdpZHRoLFxuICAgICAgICB0aGlzLmhlaWdodFxuICAgICAgKTtcblxuICAgICAgaWYgKGN1cnJlbnRGcmFtZSA9PT0gdGhpcy5udW1BbmltYXRpb25JbWFnZSkge1xuICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xuXG4gICAgICAgIHBhcnR5LnNwYXJrbGVzKHRoaXMuY2FudmFzKTtcblxuICAgICAgICAvL3N0YXJ0IHNsaWRlIGFuaW1hdGlvblxuICAgICAgICBmcmFtZUR1cmF0aW9uID0gMC4wNTtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRHVyYXRpb24gPSAwLjg7XG4gICAgICAgIGxldCBjdXJyZW50VGltZSA9IDA7XG5cbiAgICAgICAgY29uc3QgaW50ZXJ2YWxJZDIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeU9mZnNldCA9XG4gICAgICAgICAgICBQYWNrQ2FudmFzQ29udHJvbGxlci5lYXNlSW5PdXRRdWFkKFxuICAgICAgICAgICAgICBjdXJyZW50VGltZSAvIGFuaW1hdGlvbkR1cmF0aW9uXG4gICAgICAgICAgICApICogdGhpcy5oZWlnaHQ7XG5cbiAgICAgICAgICAvL2NsZWFyIGNvbnRleHRcbiAgICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICAgICAgLy9kcmF3IG1hc2tcbiAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICAgICAgdGhpcy5jYXJkTWFzayxcbiAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgdGhpcy5pbWFnZVdpZHRoLFxuICAgICAgICAgICAgdGhpcy5oZWlnaHRcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgdGhpcy5jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwic291cmNlLWluXCI7XG5cbiAgICAgICAgICAvL2RyYXcgY2FyZFxuICAgICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UoXG4gICAgICAgICAgICB0aGlzLmNhcmRJbWFnZSxcbiAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgdGhpcy5pbWFnZVdpZHRoLFxuICAgICAgICAgICAgdGhpcy5oZWlnaHRcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgdGhpcy5jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwic291cmNlLW92ZXJcIjtcblxuICAgICAgICAgIC8vZHJhdyBwYWNrIGFuaW1hdGlvblxuICAgICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UoXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkltYWdlc1t0aGlzLm51bUFuaW1hdGlvbkltYWdlXSxcbiAgICAgICAgICAgIDAsXG4gICAgICAgICAgICB5T2Zmc2V0LFxuICAgICAgICAgICAgdGhpcy5pbWFnZVdpZHRoLFxuICAgICAgICAgICAgdGhpcy5oZWlnaHRcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgY3VycmVudFRpbWUgKz0gZnJhbWVEdXJhdGlvbjtcblxuICAgICAgICAgIGlmIChjdXJyZW50VGltZSA+PSBhbmltYXRpb25EdXJhdGlvbikge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkMik7XG4gICAgICAgICAgfVxuICAgICAgICB9LCBmcmFtZUR1cmF0aW9uICogMTAwMCk7XG4gICAgICB9XG5cbiAgICAgIGN1cnJlbnRGcmFtZSsrO1xuICAgIH0sIGZyYW1lRHVyYXRpb24gKiAxMDAwKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkJhc2VQYWdlIiwiY29uc3RydWN0b3IiLCJ3YWxsZXRDb25uZWN0IiwiaG9sZGluZ3MiLCJhbGdvZENsaWVudCIsImFsZ29JbmRleGVyIiwidGhpcyIsIkhvbWUiLCJzdXBlciIsImFyZ3VtZW50cyIsInVpIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwibG9hZFBhY2tzIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwibG9hZExhc3RHcmluZHMiLCJhc3luYyIsInJlc3VsdCIsImNsYWltYWJsZVBhY2tzIiwibGVuZ3RoIiwicXVlcnlTZWxlY3RvciIsIndpbmRvdyIsImVuYWJsZU5hdmlnYXRpb25MaW5rcyIsImJhdGhlcnNDcmVhdG9yQWRkcmVzcyIsImMiLCJuYW1lIiwiYWRkcmVzc2VzIiwidHJhbnNhY3Rpb25zIiwibG9va3VwQWNjb3VudFRyYW5zYWN0aW9ucyIsInR4VHlwZSIsImxpbWl0IiwiZG8iLCJzb3J0IiwiYSIsImIiLCJhc3NldHMiLCJ0eCIsIm5vdGUiLCJKU09OIiwicGFyc2UiLCJhdG9iIiwiZSIsInR5cGUiLCJhc3NldElkIiwicHVzaCIsImZpbHRlciIsIml0ZW0iLCJpbmRleCIsImluZGV4T2YiLCJzbGljZSIsImxpc3REaXYiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwibG9hZFZpc2libGVORlRzIiwiYmluZCIsInJvb3QiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwiYXNzZXQiLCJuZnREaXYiLCJjbGFzc05hbWUiLCJkYXRhc2V0IiwiYXBwZW5kIiwib2JzZXJ2ZSIsInNsZWVwIiwiZGVsYXlUaW1lIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZW50cmllcyIsImZvckVhY2giLCJlbnRyeSIsImlzSW50ZXJzZWN0aW5nIiwidGFyZ2V0IiwibG9hZGluZyIsImxvb2t1cEFzc2V0QnlJRCIsIm5mdCIsInRleHRDb250ZW50IiwidW5pdE5hbWUiLCJzdWJzdHJpbmciLCJsb2FkIiwiaW1nIiwic3JjIiwiaW1hZ2VVcmwiLCJoaWRkZW4iLCJoYW5kbGVJbWFnZUVycm9yIiwicmVzdWx0SG9sZGVyIiwibG9va3VwQXNzZXRCYWxhbmNlcyIsImhvbGRlclNwYW4iLCJiYWxhbmNlIiwiYmFsYW5jZXMiLCJhbW91bnQiLCJhZGRyZXNzIiwicmVzcG9uc2UiLCJmZXRjaCIsInN0YXR1cyIsIm5mZFJlc3VsdCIsImpzb24iLCJQQUNLU19BUElfVVJMIiwiYmF0aGVyc0lkcyIsImJhdGhlcnMiLCJuZnRzIiwibWFwIiwicGFjayIsInBhY2tzIiwiaW5jbHVkZXMiLCJlc2Nyb3dBZGRyZXNzIiwiRXJyb3IiLCJQYWNrcyIsImZldGNoUGFja3MiLCJwYWNrU3RhdHVzUCIsInBsdXJhbCIsInBhY2tzRGl2IiwicGFja0RpdiIsInBhY2tDYW52YXMiLCJjb250cm9sbGVyIiwiUGFja0NhbnZhc0NvbnRyb2xsZXIiLCJ0aGVuIiwiaGlkZGVuTmFtZSIsInN0eWxlIiwib3BhY2l0eSIsIm9wZW5CdXR0b24iLCJiYXRoZXJJZCIsImNhZmZlaW5lQ2FyZElkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW5QYWNrIiwiYmF0aGVyIiwiZmluZCIsImJhdGhlclNwYW4iLCJjYXRjaCIsImxvZyIsIm1lc3NhZ2UiLCJkaXNhYmxlQWxsQnV0dG9ucyIsImV4Y2VwdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvcGVuZWQiLCJkaXNhYmxlZCIsImVuYWJsZUFsbEJ1dHRvbnMiLCJwYWNrQ2FudmFzQ29udHJvbGxlciIsImV2ZW50IiwiY2FsbGluZ0J1dHRvbiIsImN1cnJlbnRUYXJnZXQiLCJzdWdnZXN0ZWRQYXJhbXMiLCJnZXRUcmFuc2FjdGlvblBhcmFtcyIsImFsbFR4bnMiLCJmcm9tIiwid2FsbGV0QWRkcmVzcyIsInRvIiwiYXNzZXRJbmRleCIsInBhcnNlSW50Iiwic2lnbmVkVHhucyIsInNpZ25UcmFuc2FjdGlvbnMiLCJzaWduZWRUeG5Kc29uIiwidHhuIiwiYnRvYSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImFwcGx5IiwibWV0aG9kIiwiYm9keSIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJBY2NlcHQiLCJkYXRhIiwiYW5pbWF0ZSIsImFsZXJ0IiwiY2FudmFzIiwid2lkdGgiLCJoZWlnaHQiLCJpbWFnZVdpZHRoIiwibnVtQW5pbWF0aW9uSW1hZ2UiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImltYWdlU21vb3RoaW5nRW5hYmxlZCIsInRyYW5zbGF0ZSIsImNhcmRJbWFnZSIsImNhcmRNYXNrIiwiYW5pbWF0aW9uSW1hZ2VzIiwibG9hZEFsbEltYWdlIiwic3RhdGljIiwicGF0aCIsInJlamVjdCIsImltYWdlIiwiSW1hZ2UiLCJvbmxvYWQiLCJvbmVycm9yIiwiY29sb3JJbmRleCIsImluaXRpYWxJbWFnZSIsImxvYWRJbWFnZSIsImRyYXdQYWNrIiwiaW1hZ2VVcmxBbHRlcm5hdGUiLCJpIiwiYW5pbWF0aW9uSW1hZ2UiLCJkcmF3SW1hZ2UiLCJ4IiwiTWF0aCIsInBvdyIsImZyYW1lRHVyYXRpb24iLCJjdXJyZW50RnJhbWUiLCJpbnRlcnZhbElkIiwic2V0SW50ZXJ2YWwiLCJjbGVhclJlY3QiLCJnbG9iYWxDb21wb3NpdGVPcGVyYXRpb24iLCJjbGVhckludGVydmFsIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJjdXJyZW50VGltZSIsImludGVydmFsSWQyIiwieU9mZnNldCIsImVhc2VJbk91dFF1YWQiXSwic291cmNlUm9vdCI6IiJ9