"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[720],{9720:(t,e,s)=>{s.r(e),s.d(e,{GoodMorning:()=>p});var a=s(6998),i=s(194),o=s(1466);const{GIFEncoder:n,quantize:r,applyPalette:h}=o;class d{constructor(t,e,s=1){this.width=t,this.height=e,this.scale=s,this.gifEncoder=n()}addFrame(t,e=300){let{data:s,width:a,height:o}=t.getImageData(0,0,this.width,this.height);const n=r(s,256);if(1!=this.scale){const e=(0,i.vL)(Math.round(this.width*this.scale),Math.round(this.height*this.scale)),n=e.getContext("2d");n.imageSmoothingEnabled=!1,n.scale(this.scale,this.scale),n.drawImage(t.canvas,0,0);const r=n.getImageData(0,0,e.width,e.height);s=r.data,a=r.width,o=r.height}const d=h(s,n);this.gifEncoder.writeFrame(d,a,o,{palette:n,delay:e})}finish(){this.gifEncoder.finish()}getOutput(){return this.gifEncoder.bytes()}}var c=s(7644);class g{constructor(){this.width=48,this.height=48,this.scale=8,this.layersData,this.types=["chatty","shower","sunrise","neon_glitch"]}async drawLayers(t,e,s){this.layersData=await(0,c.i)(t,e,s,!0)}async draw_chatty(){const t=new d(this.width,this.height,this.scale),e=(0,i.vL)(this.width,this.height).getContext("2d"),s=(0,i.vL)(this.width,this.height),a=s.getContext("2d"),o=["./graphic-tools-assets/basic-1.png","./graphic-tools-assets/basic-2.png","./graphic-tools-assets/basic-3.png","./graphic-tools-assets/basic-4.png","./graphic-tools-assets/basic-5.png","./graphic-tools-assets/basic-6.png"];let n=0;for(const r of o){for(const t of this.layersData){const i=t.imageData;a.clearRect(0,0,this.width,this.height),a.putImageData(i,0,0),e.save(),n%2==1&&["body","reflection","mouth","beard","clothes","minicup","eyes","head","power","glow"].includes(t.name)&&(e.translate(this.width,0),e.scale(-1,1)),e.drawImage(s,0,0),e.restore()}const o=await(0,i.po)(r);e.drawImage(o,0,0),t.addFrame(e,700),n++}return t.finish(),t.getOutput()}async draw_shower(){const t=new d(this.width,this.height,this.scale),e=(0,i.vL)(this.width,this.height).getContext("2d"),s=(0,i.vL)(this.width,this.height),a=s.getContext("2d"),o=["./graphic-tools-assets/coffee-shower-1.png","./graphic-tools-assets/coffee-shower-2.png","./graphic-tools-assets/coffee-shower-3.png","./graphic-tools-assets/coffee-shower-4.png"];for(const n of o){let o=!1;for(const t of this.layersData){const r=t.imageData;if(a.clearRect(0,0,this.width,this.height),a.putImageData(r,0,0),e.drawImage(s,0,0),"head"===t.name){const t=await(0,i.po)(n);e.drawImage(t,0,0),o=!0}}if(!o){const t=await(0,i.po)(n);e.drawImage(t,0,0)}t.addFrame(e,100)}return t.finish(),t.getOutput()}async draw_sunrise(){const t=new d(this.width,this.height,this.scale),e=(0,i.vL)(this.width,this.height).getContext("2d"),s=(0,i.vL)(this.width,this.height),a=s.getContext("2d"),o=[{background:"./graphic-tools-assets/sunrise-1.png",foreground:null,duration:100},{background:"./graphic-tools-assets/sunrise-2.png",foreground:null,duration:100},{background:"./graphic-tools-assets/sunrise-3.png",foreground:"./graphic-tools-assets/sunrise-text-1.png",duration:100},{background:"./graphic-tools-assets/sunrise-4.png",foreground:"./graphic-tools-assets/sunrise-text-2.png",duration:100},{background:"./graphic-tools-assets/sunrise-5.png",foreground:"./graphic-tools-assets/sunrise-text-3.png",duration:100},{background:"./graphic-tools-assets/sunrise-6.png",foreground:"./graphic-tools-assets/sunrise-text-4.png",duration:1200},{background:"./graphic-tools-assets/sunrise-7.png",foreground:"./graphic-tools-assets/sunrise-text-4.png",duration:100},{background:"./graphic-tools-assets/sunrise-8.png",foreground:"./graphic-tools-assets/sunrise-text-5.png",duration:100},{background:"./graphic-tools-assets/sunrise-9.png",foreground:null,duration:100}];for(const n of o){for(const t of this.layersData){const o=t.imageData;if(a.clearRect(0,0,this.width,this.height),a.putImageData(o,0,0),e.drawImage(s,0,0),"room"===t.name){const t=await(0,i.po)(n.background);e.drawImage(t,0,0)}}if(n.foreground){const t=await(0,i.po)(n.foreground);e.drawImage(t,0,0)}t.addFrame(e,n.duration)}return t.finish(),t.getOutput()}glitch(t,e,s=!1){const a=t.data.length/4;if(s)return t;let i=e.createImageData(this.width,this.height);i.data.set(t.data);for(let e=0;e<3;e++){let e=Math.floor(Math.random()*a),s=Math.round(Math.random())?"add":"remove";if("add"===s)for(let s=e;s<a;s++)i.data[4*s+0]=t.data[4*(s-1)+0],i.data[4*s+1]=t.data[4*(s-1)+1],i.data[4*s+2]=t.data[4*(s-1)+2],i.data[4*s+3]=t.data[4*(s-1)+3];else if("remove"===s)for(let s=e;s<a;s++)i.data[4*s+0]=t.data[4*(s+1)+0],i.data[4*s+1]=t.data[4*(s+1)+1],i.data[4*s+2]=t.data[4*(s+1)+2],i.data[4*s+3]=t.data[4*(s+1)+3]}return i}async glitchedImage(t,e){const s=(0,i.vL)(this.width,this.height),a=s.getContext("2d"),o=await(0,i.po)(t);a.clearRect(0,0,this.width,this.height),a.drawImage(o,0,0);const n=this.glitch(a.getImageData(0,0,this.width,this.height),a,e);return a.putImageData(n,0,0),s}async draw_neon_glitch(){const t=new d(this.width,this.height,this.scale),e=(0,i.vL)(this.width,this.height).getContext("2d"),s=(0,i.vL)(this.width,this.height),a=s.getContext("2d"),o="./graphic-tools-assets/neon-glitch-g.png",n="./graphic-tools-assets/neon-glitch-m.png";for(let i=0;i<25;i++){let r=!1;(i>=9&&i<=12||i>=20&&i<=21)&&(r=!0);const h="foreground",d="background";for(const t of this.layersData){const i=this.glitch(t.imageData,a,!r);if(a.clearRect(0,0,this.width,this.height),a.putImageData(i,0,0),e.drawImage(s,0,0),"room"===t.name){if("background"===h){const t=await this.glitchedImage(o,!r);e.drawImage(t,0,0)}if("background"===d){const t=await this.glitchedImage(n,!r);e.drawImage(t,0,0)}}}if("foreground"===h){const t=await this.glitchedImage(o,!r);e.drawImage(t,0,0)}if("foreground"===d){const t=await this.glitchedImage(n,!r);e.drawImage(t,0,0)}t.addFrame(e,100)}return t.finish(),t.getOutput()}}var l=s(2871),u=s(4714);class p extends a.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n        <h1>Good Morning Generator</h1>\n        <p class="dark-text">Generate GM GIFs featuring your Bathers</p>\n\n        <div class="d-sm-flex flew-row" style="background-color: var(--background-dark);">\n\n            <div class="d-flex flex-column p-3 text-center justify-content-between">\n\n                <div>\n                    <img src="assets/default.png" class="mb-2 ms-auto me-auto" id="club-img" style="width: 200px; height: auto">\n\n                    <div class="dropdown mb-3" id="bath-club-dropdown">\n                        <button class="dropdown-toggle button-alt" type="button" data-bs-toggle="dropdown"\n                            aria-expanded="false">\n                            Choose Bather\n                        </button>\n\n                    </div>\n\n                    <select class="form-select mb-3" aria-label="Default select example" id="select-filter">\n                        <option value="" selected>Select filter</option>\n                        <option value="chatty">Chatty</option>\n                        <option value="shower">Coffee Shower</option>\n                        <option value="neon_glitch">Neon glitch</option>\n                    </select>\n                </div>\n                \n                <button id="button-download" disabled>Download gif</button>\n\n            </div>\n\n            <div class="d-flex flex-column flex-fill p-3 text-center">\n\n                <img src="assets/default.png" class="w-100 m-auto img-fluid" style="max-width: 384px;" id="merged-img">\n\n            </div>\n\n        </div>',this.bathersCollection,this.selectedBather,this.selectedFilter,this.load()}async load(){await this.loadBathers(),this.ui.querySelector("#select-filter").addEventListener("change",this.didSelectFilter.bind(this),!1),this.ui.querySelector("#button-download").addEventListener("click",this.downloadGif.bind(this),!1)}async loadBathers(){this.bathersCollection=this.holdings.bathers;const t=this.ui.querySelector("#bath-club-dropdown");let e=t.querySelector(".dropdown-menu");e&&e.remove(),e=new l.Z(this.bathersCollection.nfts,this.didSelectBather.bind(this)),t.append(e.ui)}didSelectBather(t){const e=t.currentTarget.dataset.index;if(!e)return;const s=this.bathersCollection.nfts[e];this.selectedBather=s,this.ui.querySelector("#club-img").src=s.imageUrl,this.generateGif(),t.preventDefault()}didSelectFilter(t){this.selectedFilter=t.currentTarget.value,this.selectedFilter&&(this.generateGif(),t.preventDefault())}async generateGif(){if(this.selectedFilter&&this.selectedBather){const t=this.ui.querySelector("#button-download");t.disabled=!0,t.textContent="Generating GIF...";const e=this.ui.querySelector("#merged-img");e.src="assets/default.png";const s=this.selectedBather.metadata.properties,a=new g;await a.drawLayers(s,u,"./layers_images");const i=await a[`draw_${this.selectedFilter}`]();e.src=URL.createObjectURL(new Blob([i.buffer],{type:"image/gif"})),t.disabled=!1,t.textContent="Download GIF"}}downloadGif(){const t=this.ui.querySelector("#merged-img");console.log(t.src);const e=document.createElement("a");e.href=t.src,e.download="good-morning.gif",e.click()}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxFQUFleEQsVUFBVyxFQUMxQndELEVBQWVDLFlBQWMsY0FDL0IsQ0FDRixDQUVBbkIsY0FDRSxNQUFNb0IsRUFBTWhILEtBQUsrRSxHQUFHUyxjQUFjLGVBQ2xDaUMsUUFBUUMsSUFBSVYsRUFBSVAsS0FFaEIsTUFBTWtCLEVBQUkzQyxTQUFTQyxjQUFjLEtBQ2pDMEMsRUFBRUMsS0FBT1osRUFBSVAsSUFDYmtCLEVBQUVFLFNBQVcsbUJBQ2JGLEVBQUVHLE9BQ0osRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0dWRpby8uLi9ncmFwaGljLXRvb2xzL2dpZi1nZW5lcmF0b3IuanMiLCJ3ZWJwYWNrOi8vc3R1ZGlvLy4uL2dyYXBoaWMtdG9vbHMvZ20tZ2VuZXJhdG9yLmpzIiwid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9nb29kLW1vcm5pbmcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2FudmFzIH0gZnJvbSBcImNhbnZhc1wiO1xuaW1wb3J0IGdpZmVuYyBmcm9tIFwiZ2lmZW5jXCI7XG5jb25zdCB7IEdJRkVuY29kZXIsIHF1YW50aXplLCBhcHBseVBhbGV0dGUgfSA9IGdpZmVuYztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2lmR2VuZXJhdG9yIHtcbiAgY29uc3RydWN0b3Iod2lkdGgsIGhlaWdodCwgc2NhbGUgPSAxLjApIHtcbiAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgdGhpcy5zY2FsZSA9IHNjYWxlO1xuXG4gICAgLy8gQ3JlYXRlIGFuIGVuY29kaW5nIHN0cmVhbVxuICAgIHRoaXMuZ2lmRW5jb2RlciA9IEdJRkVuY29kZXIoKTtcbiAgfVxuXG4gIGFkZEZyYW1lKGN0eCwgZGVsYXkgPSAzMDApIHtcblxuICAgIC8vIEdldCB5b3VyIFJHQkEgaW1hZ2UgaW50byBVaW50OEFycmF5IGRhdGFcbiAgICBsZXQgeyBkYXRhLCB3aWR0aCwgaGVpZ2h0IH0gPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgIC8vIFF1YW50aXplIGNvbG9ycyB0byBhIDI1Ni1jb2xvciBSR0IgcGFsZXR0ZSBwYWxldHRlXG4gICAgY29uc3QgcGFsZXR0ZSA9IHF1YW50aXplKGRhdGEsIDI1Nik7XG5cbiAgICBpZiAodGhpcy5zY2FsZSAhPSAxLjApe1xuICAgICAgY29uc3QgY2FudmFzID0gY3JlYXRlQ2FudmFzKE1hdGgucm91bmQodGhpcy53aWR0aCp0aGlzLnNjYWxlKSwgTWF0aC5yb3VuZCh0aGlzLmhlaWdodCp0aGlzLnNjYWxlKSk7XG4gICAgICBjb25zdCBzY2FsZUN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgc2NhbGVDdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XG5cbiAgICAgIHNjYWxlQ3R4LnNjYWxlKHRoaXMuc2NhbGUsIHRoaXMuc2NhbGUpO1xuICAgICAgc2NhbGVDdHguZHJhd0ltYWdlKGN0eC5jYW52YXMsIDAsIDApO1xuXG4gICAgICBjb25zdCBpbWFnZURhdGEgPSBzY2FsZUN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YTtcbiAgICAgIHdpZHRoID0gaW1hZ2VEYXRhLndpZHRoO1xuICAgICAgaGVpZ2h0ID0gaW1hZ2VEYXRhLmhlaWdodDtcbiAgICB9XG5cbiAgICAvLyBHZXQgYW4gaW5kZXhlZCBiaXRtYXAgYnkgcmVkdWNpbmcgZWFjaCBwaXhlbCB0byB0aGUgbmVhcmVzdCBjb2xvciBwYWxldHRlXG4gICAgY29uc3QgaW5kZXggPSBhcHBseVBhbGV0dGUoZGF0YSwgcGFsZXR0ZSk7XG5cbiAgICAvLyBXcml0ZSBhIHNpbmdsZSBmcmFtZVxuICAgIHRoaXMuZ2lmRW5jb2Rlci53cml0ZUZyYW1lKGluZGV4LCB3aWR0aCwgaGVpZ2h0LCB7IHBhbGV0dGUsIGRlbGF5OiBkZWxheSB9KTtcblxuICB9XG5cbiAgZmluaXNoKCl7XG5cbiAgICB0aGlzLmdpZkVuY29kZXIuZmluaXNoKCk7XG4gIH1cblxuICBnZXRPdXRwdXQoKXtcblxuICAgIHJldHVybiB0aGlzLmdpZkVuY29kZXIuYnl0ZXMoKTtcbiAgfVxufVxuIiwiaW1wb3J0IEdpZkdlbmVyYXRvciBmcm9tICcuL2dpZi1nZW5lcmF0b3IuanMnO1xuaW1wb3J0IHsgZHJhdyB9IGZyb20gJ2JhdGgtY2x1Yic7XG5pbXBvcnQgeyBjcmVhdGVDYW52YXMsIGxvYWRJbWFnZSB9IGZyb20gJ2NhbnZhcyc7XG5cbmV4cG9ydCBjbGFzcyBHbUdlbmVyYXRvciB7XG4gICAgY29uc3RydWN0b3IoKXtcblxuICAgICAgICB0aGlzLndpZHRoID0gNDg7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gNDg7XG5cbiAgICAgICAgdGhpcy5zY2FsZSA9IDg7XG5cbiAgICAgICAgLy9kcmF3IGxheWVycyBzZXBhcmF0ZWx5XG4gICAgICAgIHRoaXMubGF5ZXJzRGF0YTtcblxuICAgICAgICB0aGlzLnR5cGVzID0gWydjaGF0dHknLCAnc2hvd2VyJywgJ3N1bnJpc2UnLCAnbmVvbl9nbGl0Y2gnXTtcblxuICAgIH1cblxuICAgIGFzeW5jIGRyYXdMYXllcnMocHJvcGVydGllcywgbGF5ZXJzLCBsYXllcnNGb2xkZXIpe1xuXG4gICAgICAgIHRoaXMubGF5ZXJzRGF0YSA9IGF3YWl0IGRyYXcocHJvcGVydGllcywgbGF5ZXJzLCBsYXllcnNGb2xkZXIsIHRydWUpO1xuXG4gICAgfVxuXG4gICAgYXN5bmMgZHJhd19jaGF0dHkoKXtcblxuICAgICAgICBjb25zdCBnaWZHZW5lcmF0b3IgPSBuZXcgR2lmR2VuZXJhdG9yKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnNjYWxlKTtcblxuICAgICAgICBjb25zdCBjYW52YXMgPSBjcmVhdGVDYW52YXModGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICBjb25zdCBsYXllckNhbnZhcyA9IGNyZWF0ZUNhbnZhcyh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIGNvbnN0IGxheWVyc0N0eCA9IGxheWVyQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgY29uc3QgYnViYmxlSW1hZ2VzID0gW1xuICAgICAgICAgICAgJy4vZ3JhcGhpYy10b29scy1hc3NldHMvYmFzaWMtMS5wbmcnLFxuICAgICAgICAgICAgJy4vZ3JhcGhpYy10b29scy1hc3NldHMvYmFzaWMtMi5wbmcnLFxuICAgICAgICAgICAgJy4vZ3JhcGhpYy10b29scy1hc3NldHMvYmFzaWMtMy5wbmcnLFxuICAgICAgICAgICAgJy4vZ3JhcGhpYy10b29scy1hc3NldHMvYmFzaWMtNC5wbmcnLFxuICAgICAgICAgICAgJy4vZ3JhcGhpYy10b29scy1hc3NldHMvYmFzaWMtNS5wbmcnLFxuICAgICAgICAgICAgJy4vZ3JhcGhpYy10b29scy1hc3NldHMvYmFzaWMtNi5wbmcnXG4gICAgICAgIF1cblxuICAgICAgICBjb25zdCBmcmFtZUR1cmF0aW9uID0gNzAwO1xuXG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBidWJibGVJbWFnZUZpbGVwYXRoIG9mIGJ1YmJsZUltYWdlcyl7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy5sYXllcnNEYXRhKXtcblxuXG4gICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gbGF5ZXIuaW1hZ2VEYXRhO1xuICAgICAgICAgICAgICAgIGxheWVyc0N0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIGxheWVyc0N0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsgXG5cbiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGklMiA9PT0gMSAmJiBbJ2JvZHknLCAncmVmbGVjdGlvbicsICdtb3V0aCcsICdiZWFyZCcsICdjbG90aGVzJywgJ21pbmljdXAnLCAnZXllcycsICdoZWFkJywgJ3Bvd2VyJywgJ2dsb3cnXS5pbmNsdWRlcyhsYXllci5uYW1lKSl7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvL2ZsaXAgaW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh0aGlzLndpZHRoLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4LnNjYWxlKC0xLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobGF5ZXJDYW52YXMsIDAsIDApO1xuXG4gICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGJ1YmJsZUltYWdlID0gYXdhaXQgbG9hZEltYWdlKGJ1YmJsZUltYWdlRmlsZXBhdGgpO1xuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShidWJibGVJbWFnZSwgMCwgMCk7XG5cbiAgICAgICAgICAgIGdpZkdlbmVyYXRvci5hZGRGcmFtZShjdHgsIGZyYW1lRHVyYXRpb24pO1xuICAgICAgICAgICAgaSsrO1xuXG4gICAgICAgIH1cblxuICAgICAgICBnaWZHZW5lcmF0b3IuZmluaXNoKCk7XG5cbiAgICAgICAgcmV0dXJuIGdpZkdlbmVyYXRvci5nZXRPdXRwdXQoKTtcblxuICAgIH1cblxuICAgIGFzeW5jIGRyYXdfc2hvd2VyKCl7XG5cbiAgICAgICAgY29uc3QgZ2lmR2VuZXJhdG9yID0gbmV3IEdpZkdlbmVyYXRvcih0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5zY2FsZSk7XG5cbiAgICAgICAgY29uc3QgY2FudmFzID0gY3JlYXRlQ2FudmFzKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgY29uc3QgbGF5ZXJDYW52YXMgPSBjcmVhdGVDYW52YXModGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBjb25zdCBsYXllcnNDdHggPSBsYXllckNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgICAgIGNvbnN0IHNob3dlckltYWdlcyA9IFtcbiAgICAgICAgICAgICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL2NvZmZlZS1zaG93ZXItMS5wbmcnLFxuICAgICAgICAgICAgJy4vZ3JhcGhpYy10b29scy1hc3NldHMvY29mZmVlLXNob3dlci0yLnBuZycsXG4gICAgICAgICAgICAnLi9ncmFwaGljLXRvb2xzLWFzc2V0cy9jb2ZmZWUtc2hvd2VyLTMucG5nJyxcbiAgICAgICAgICAgICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL2NvZmZlZS1zaG93ZXItNC5wbmcnXG4gICAgICAgIF1cblxuICAgICAgICBjb25zdCBmcmFtZUR1cmF0aW9uID0gMTAwO1xuXG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBzaG93ZXJJbWFnZUZpbGVwYXRoIG9mIHNob3dlckltYWdlcyl7XG5cbiAgICAgICAgICAgIGxldCBkaWREcmF3U2hvd2VyID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy5sYXllcnNEYXRhKXtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGxheWVyLmltYWdlRGF0YTtcbiAgICAgICAgICAgICAgICBsYXllcnNDdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBsYXllcnNDdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7IFxuICAgIFxuICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobGF5ZXJDYW52YXMsIDAsIDApO1xuXG4gICAgICAgICAgICAgICAgaWYgKGxheWVyLm5hbWUgPT09ICdoZWFkJyl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNob3dlckltYWdlID0gYXdhaXQgbG9hZEltYWdlKHNob3dlckltYWdlRmlsZXBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHNob3dlckltYWdlLCAwLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgZGlkRHJhd1Nob3dlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFkaWREcmF3U2hvd2VyKXtcbiAgICAgICAgICAgICAgICBjb25zdCBzaG93ZXJJbWFnZSA9IGF3YWl0IGxvYWRJbWFnZShzaG93ZXJJbWFnZUZpbGVwYXRoKTtcbiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHNob3dlckltYWdlLCAwLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuXG4gICAgICAgICAgICBnaWZHZW5lcmF0b3IuYWRkRnJhbWUoY3R4LCBmcmFtZUR1cmF0aW9uKTtcbiAgICAgICAgICAgIGkrKztcblxuICAgICAgICB9XG5cbiAgICAgICAgZ2lmR2VuZXJhdG9yLmZpbmlzaCgpO1xuXG4gICAgICAgIHJldHVybiBnaWZHZW5lcmF0b3IuZ2V0T3V0cHV0KCk7XG5cbiAgICB9XG5cbiAgICBhc3luYyBkcmF3X3N1bnJpc2UoKXtcblxuICAgICAgICBjb25zdCBnaWZHZW5lcmF0b3IgPSBuZXcgR2lmR2VuZXJhdG9yKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnNjYWxlKTtcblxuICAgICAgICBjb25zdCBjYW52YXMgPSBjcmVhdGVDYW52YXModGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICBjb25zdCBsYXllckNhbnZhcyA9IGNyZWF0ZUNhbnZhcyh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIGNvbnN0IGxheWVyc0N0eCA9IGxheWVyQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgY29uc3Qgc3VucmlzZUltYWdlcyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAnLi9ncmFwaGljLXRvb2xzLWFzc2V0cy9zdW5yaXNlLTEucG5nJyxcbiAgICAgICAgICAgICAgICBmb3JlZ3JvdW5kOiBudWxsLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJy4vZ3JhcGhpYy10b29scy1hc3NldHMvc3VucmlzZS0yLnBuZycsXG4gICAgICAgICAgICAgICAgZm9yZWdyb3VuZDogbnVsbCxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL3N1bnJpc2UtMy5wbmcnLFxuICAgICAgICAgICAgICAgIGZvcmVncm91bmQ6ICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL3N1bnJpc2UtdGV4dC0xLnBuZycsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDEwMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAnLi9ncmFwaGljLXRvb2xzLWFzc2V0cy9zdW5yaXNlLTQucG5nJyxcbiAgICAgICAgICAgICAgICBmb3JlZ3JvdW5kOiAnLi9ncmFwaGljLXRvb2xzLWFzc2V0cy9zdW5yaXNlLXRleHQtMi5wbmcnLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJy4vZ3JhcGhpYy10b29scy1hc3NldHMvc3VucmlzZS01LnBuZycsXG4gICAgICAgICAgICAgICAgZm9yZWdyb3VuZDogJy4vZ3JhcGhpYy10b29scy1hc3NldHMvc3VucmlzZS10ZXh0LTMucG5nJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL3N1bnJpc2UtNi5wbmcnLFxuICAgICAgICAgICAgICAgIGZvcmVncm91bmQ6ICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL3N1bnJpc2UtdGV4dC00LnBuZycsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDEyMDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJy4vZ3JhcGhpYy10b29scy1hc3NldHMvc3VucmlzZS03LnBuZycsXG4gICAgICAgICAgICAgICAgZm9yZWdyb3VuZDogJy4vZ3JhcGhpYy10b29scy1hc3NldHMvc3VucmlzZS10ZXh0LTQucG5nJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL3N1bnJpc2UtOC5wbmcnLFxuICAgICAgICAgICAgICAgIGZvcmVncm91bmQ6ICcuL2dyYXBoaWMtdG9vbHMtYXNzZXRzL3N1bnJpc2UtdGV4dC01LnBuZycsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDEwMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAnLi9ncmFwaGljLXRvb2xzLWFzc2V0cy9zdW5yaXNlLTkucG5nJyxcbiAgICAgICAgICAgICAgICBmb3JlZ3JvdW5kOiBudWxsLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxMDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICBdXG5cbiAgICAgICAgY29uc3QgZnJhbWVEdXJhdGlvbiA9IDIwMDtcblxuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIGZvciAoY29uc3Qgc3VucmlzZUltYWdlSW5mbyBvZiBzdW5yaXNlSW1hZ2VzKXtcblxuICAgICAgICAgICAgZm9yIChjb25zdCBsYXllciBvZiB0aGlzLmxheWVyc0RhdGEpe1xuXG4gICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gbGF5ZXIuaW1hZ2VEYXRhO1xuICAgICAgICAgICAgICAgIGxheWVyc0N0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIGxheWVyc0N0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsgXG4gICAgXG4gICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShsYXllckNhbnZhcywgMCwgMCk7XG5cbiAgICAgICAgICAgICAgICBpZiAobGF5ZXIubmFtZSA9PT0gJ3Jvb20nKXtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VucmlzZUltYWdlID0gYXdhaXQgbG9hZEltYWdlKHN1bnJpc2VJbWFnZUluZm8uYmFja2dyb3VuZCk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2Uoc3VucmlzZUltYWdlLCAwLCAwKTtcblxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3VucmlzZUltYWdlSW5mby5mb3JlZ3JvdW5kKXtcbiAgICAgICAgICAgICAgICBjb25zdCBzdW5yaXNlSW1hZ2UgPSBhd2FpdCBsb2FkSW1hZ2Uoc3VucmlzZUltYWdlSW5mby5mb3JlZ3JvdW5kKTtcbiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHN1bnJpc2VJbWFnZSwgMCwgMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFxuXG4gICAgICAgICAgICBnaWZHZW5lcmF0b3IuYWRkRnJhbWUoY3R4LCBzdW5yaXNlSW1hZ2VJbmZvLmR1cmF0aW9uKTtcbiAgICAgICAgICAgIGkrKztcblxuICAgICAgICB9XG5cbiAgICAgICAgZ2lmR2VuZXJhdG9yLmZpbmlzaCgpO1xuXG4gICAgICAgIHJldHVybiBnaWZHZW5lcmF0b3IuZ2V0T3V0cHV0KCk7XG5cbiAgICB9XG5cbiAgICBnbGl0Y2goaW1hZ2VEYXRhLCBjdHgsIGRpc2FibGVkID0gZmFsc2Upe1xuXG4gICAgICAgIFxuICAgICAgICBjb25zdCBudW1HbGl0Y2hlcyA9IDM7XG4gICAgICAgIGNvbnN0IG51bVBpeGVscyA9IGltYWdlRGF0YS5kYXRhLmxlbmd0aC80O1xuXG4gICAgICAgIGlmIChkaXNhYmxlZCl7XG4gICAgICAgICAgICByZXR1cm4gaW1hZ2VEYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJldHVybkltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YS5zZXQoaW1hZ2VEYXRhLmRhdGEpO1xuXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBudW1HbGl0Y2hlczsgaSsrKXtcblxuICAgICAgICAgICAgLy9jaG9vc2UgYW4gaW5kZXhcbiAgICAgICAgICAgIGxldCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSpudW1QaXhlbHMpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBsZXQgdHlwZSA9IE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSkgPyAnYWRkJyA6ICdyZW1vdmUnO1xuXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2FkZCcpe1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IHJhbmRvbUluZGV4OyBqIDwgbnVtUGl4ZWxzOyBqKyspe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAwXSA9IGltYWdlRGF0YS5kYXRhWyhqIC0gMSkqNCArIDBdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAxXSA9IGltYWdlRGF0YS5kYXRhWyhqIC0gMSkqNCArIDFdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAyXSA9IGltYWdlRGF0YS5kYXRhWyhqIC0gMSkqNCArIDJdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAzXSA9IGltYWdlRGF0YS5kYXRhWyhqIC0gMSkqNCArIDNdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3JlbW92ZScpe1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IHJhbmRvbUluZGV4OyBqIDwgbnVtUGl4ZWxzOyBqKyspe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAwXSA9IGltYWdlRGF0YS5kYXRhWyhqICsgMSkqNCArIDBdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAxXSA9IGltYWdlRGF0YS5kYXRhWyhqICsgMSkqNCArIDFdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAyXSA9IGltYWdlRGF0YS5kYXRhWyhqICsgMSkqNCArIDJdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm5JbWFnZURhdGEuZGF0YVtqKjQgKyAzXSA9IGltYWdlRGF0YS5kYXRhWyhqICsgMSkqNCArIDNdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgIH1cbiAgICAgICAgXG5cbiAgICAgICAgcmV0dXJuIHJldHVybkltYWdlRGF0YTtcblxuICAgIH1cblxuICAgIGFzeW5jIGdsaXRjaGVkSW1hZ2UoaW1hZ2VGaWxlcGF0aCwgZGlzYWJsZWQpIHtcblxuICAgICAgICBjb25zdCBjYW52YXMgPSBjcmVhdGVDYW52YXModGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICBjb25zdCBpbWFnZSA9IGF3YWl0IGxvYWRJbWFnZShpbWFnZUZpbGVwYXRoKTtcblxuICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBpbWFnZURhdGEgPSB0aGlzLmdsaXRjaChjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KSwgY3R4LCBkaXNhYmxlZCk7XG4gICAgICAgIGN0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsgXG5cbiAgICAgICAgcmV0dXJuIGNhbnZhcztcblxuICAgIH1cblxuICAgIGFzeW5jIGRyYXdfbmVvbl9nbGl0Y2goKXtcblxuICAgICAgICBjb25zdCBnaWZHZW5lcmF0b3IgPSBuZXcgR2lmR2VuZXJhdG9yKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnNjYWxlKTtcblxuICAgICAgICBjb25zdCBjYW52YXMgPSBjcmVhdGVDYW52YXModGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgICAgICBjb25zdCBsYXllckNhbnZhcyA9IGNyZWF0ZUNhbnZhcyh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgIGNvbnN0IGxheWVyc0N0eCA9IGxheWVyQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICAgICAgY29uc3QgZ0ltYWdlRmlsZXBhdGggPSAnLi9ncmFwaGljLXRvb2xzLWFzc2V0cy9uZW9uLWdsaXRjaC1nLnBuZyc7XG4gICAgICAgIGNvbnN0IG1JbWFnZUZpbGVwYXRoID0gJy4vZ3JhcGhpYy10b29scy1hc3NldHMvbmVvbi1nbGl0Y2gtbS5wbmcnO1xuXG4gICAgICAgIGNvbnN0IG51bUZyYW1lcyA9IDI1O1xuICAgICAgICBjb25zdCBmcmFtZUR1cmF0aW9uID0gMTAwO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRnJhbWVzOyBpKyspe1xuXG4gICAgICAgICAgICBsZXQgc2hvdWxkR2xpdGNoID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8qaWYgKE1hdGgucmFuZG9tKCkgPCBnbGl0Y2hGcmVxdWVuY3kpe1xuICAgICAgICAgICAgICAgIHNob3VsZEdsaXRjaCA9IHRydWU7XG4gICAgICAgICAgICB9Ki9cblxuICAgICAgICAgICAgaWYgKChpID49IDkgJiYgaSA8PSAxMikgfHwgKGkgPj0gMjAgJiYgaSA8PSAyMSkpe1xuICAgICAgICAgICAgICAgIHNob3VsZEdsaXRjaCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vY29uc3QgZ0xheWVyID0gTWF0aC5yYW5kb20oKSA+IDAuMTAgPyAnZm9yZWdyb3VuZCcgOiAnYmFja2dyb3VuZCc7XG4gICAgICAgICAgICAvL2NvbnN0IG1MYXllciA9IE1hdGgucmFuZG9tKCkgPiAwLjEwID8gJ2JhY2tncm91bmQnIDogJ2ZvcmVncm91bmQnO1xuXG4gICAgICAgICAgICBjb25zdCBnTGF5ZXIgPSAnZm9yZWdyb3VuZCc7XG4gICAgICAgICAgICBjb25zdCBtTGF5ZXIgPSAnYmFja2dyb3VuZCc7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy5sYXllcnNEYXRhKXtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YSA9IHRoaXMuZ2xpdGNoKGxheWVyLmltYWdlRGF0YSwgbGF5ZXJzQ3R4LCAhc2hvdWxkR2xpdGNoKTtcblxuICAgICAgICAgICAgICAgIGxheWVyc0N0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICAgICAgICAgIGxheWVyc0N0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsgXG4gICAgXG4gICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShsYXllckNhbnZhcywgMCwgMCk7XG5cbiAgICAgICAgICAgICAgICBpZiAobGF5ZXIubmFtZSA9PT0gJ3Jvb20nKXtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZ0xheWVyID09PSAnYmFja2dyb3VuZCcpe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ0ltYWdlQ2FudmFzID0gYXdhaXQgdGhpcy5nbGl0Y2hlZEltYWdlKGdJbWFnZUZpbGVwYXRoLCAhc2hvdWxkR2xpdGNoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoZ0ltYWdlQ2FudmFzLCAwLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChtTGF5ZXIgPT09ICdiYWNrZ3JvdW5kJyl7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtSW1hZ2VDYW52YXMgPSBhd2FpdCB0aGlzLmdsaXRjaGVkSW1hZ2UobUltYWdlRmlsZXBhdGgsICFzaG91bGRHbGl0Y2gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShtSW1hZ2VDYW52YXMsIDAsIDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChnTGF5ZXIgPT09ICdmb3JlZ3JvdW5kJyl7XG4gICAgICAgICAgICAgICAgY29uc3QgZ0ltYWdlQ2FudmFzID0gYXdhaXQgdGhpcy5nbGl0Y2hlZEltYWdlKGdJbWFnZUZpbGVwYXRoLCAhc2hvdWxkR2xpdGNoKTtcbiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGdJbWFnZUNhbnZhcywgMCwgMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtTGF5ZXIgPT09ICdmb3JlZ3JvdW5kJyl7XG4gICAgICAgICAgICAgICAgY29uc3QgbUltYWdlQ2FudmFzID0gYXdhaXQgdGhpcy5nbGl0Y2hlZEltYWdlKG1JbWFnZUZpbGVwYXRoLCAhc2hvdWxkR2xpdGNoKTtcbiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG1JbWFnZUNhbnZhcywgMCwgMCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFxuXG4gICAgICAgICAgICBnaWZHZW5lcmF0b3IuYWRkRnJhbWUoY3R4LCBmcmFtZUR1cmF0aW9uKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZ2lmR2VuZXJhdG9yLmZpbmlzaCgpO1xuXG4gICAgICAgIHJldHVybiBnaWZHZW5lcmF0b3IuZ2V0T3V0cHV0KCk7XG5cbiAgICB9XG5cblxufSIsImltcG9ydCB7IEJhc2VQYWdlIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IHsgR21HZW5lcmF0b3IgfSBmcm9tIFwiZ3JhcGhpYy10b29sc1wiO1xuaW1wb3J0IERyb3Bkb3duTmZ0cyBmcm9tIFwiLi4vY29tbW9uL2Ryb3Bkb3duLW5mdHMuanNcIjtcblxuaW1wb3J0IGxheWVycyBmcm9tIFwiLi4vLi4vLi4vYmF0aC1jbHViL2xheWVycy5qc29uXCI7XG5cbmV4cG9ydCBjbGFzcyBHb29kTW9ybmluZyBleHRlbmRzIEJhc2VQYWdlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcblxuICAgIHRoaXMudWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYFxuICAgICAgICA8aDE+R29vZCBNb3JuaW5nIEdlbmVyYXRvcjwvaDE+XG4gICAgICAgIDxwIGNsYXNzPVwiZGFyay10ZXh0XCI+R2VuZXJhdGUgR00gR0lGcyBmZWF0dXJpbmcgeW91ciBCYXRoZXJzPC9wPlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJkLXNtLWZsZXggZmxldy1yb3dcIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtZGFyayk7XCI+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggZmxleC1jb2x1bW4gcC0zIHRleHQtY2VudGVyIGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG5cbiAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9kZWZhdWx0LnBuZ1wiIGNsYXNzPVwibWItMiBtcy1hdXRvIG1lLWF1dG9cIiBpZD1cImNsdWItaW1nXCIgc3R5bGU9XCJ3aWR0aDogMjAwcHg7IGhlaWdodDogYXV0b1wiPlxuXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93biBtYi0zXCIgaWQ9XCJiYXRoLWNsdWItZHJvcGRvd25cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJkcm9wZG93bi10b2dnbGUgYnV0dG9uLWFsdFwiIHR5cGU9XCJidXR0b25cIiBkYXRhLWJzLXRvZ2dsZT1cImRyb3Bkb3duXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaG9vc2UgQmF0aGVyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cblxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGNsYXNzPVwiZm9ybS1zZWxlY3QgbWItM1wiIGFyaWEtbGFiZWw9XCJEZWZhdWx0IHNlbGVjdCBleGFtcGxlXCIgaWQ9XCJzZWxlY3QtZmlsdGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCIgc2VsZWN0ZWQ+U2VsZWN0IGZpbHRlcjwvb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImNoYXR0eVwiPkNoYXR0eTwvb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInNob3dlclwiPkNvZmZlZSBTaG93ZXI8L29wdGlvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJuZW9uX2dsaXRjaFwiPk5lb24gZ2xpdGNoPC9vcHRpb24+XG4gICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJidXR0b24tZG93bmxvYWRcIiBkaXNhYmxlZD5Eb3dubG9hZCBnaWY8L2J1dHRvbj5cblxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggZmxleC1jb2x1bW4gZmxleC1maWxsIHAtMyB0ZXh0LWNlbnRlclwiPlxuXG4gICAgICAgICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvZGVmYXVsdC5wbmdcIiBjbGFzcz1cInctMTAwIG0tYXV0byBpbWctZmx1aWRcIiBzdHlsZT1cIm1heC13aWR0aDogMzg0cHg7XCIgaWQ9XCJtZXJnZWQtaW1nXCI+XG5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDwvZGl2PmA7XG5cbiAgICB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uO1xuXG4gICAgdGhpcy5zZWxlY3RlZEJhdGhlcjtcbiAgICB0aGlzLnNlbGVjdGVkRmlsdGVyO1xuXG4gICAgdGhpcy5sb2FkKCk7XG4gIH1cblxuICBhc3luYyBsb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZEJhdGhlcnMoKTtcblxuICAgIHRoaXMudWlcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI3NlbGVjdC1maWx0ZXJcIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIHRoaXMuZGlkU2VsZWN0RmlsdGVyLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIHRoaXMudWlcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvbi1kb3dubG9hZFwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmRvd25sb2FkR2lmLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgfVxuXG4gIGFzeW5jIGxvYWRCYXRoZXJzKCkge1xuXG4gICAgdGhpcy5iYXRoZXJzQ29sbGVjdGlvbiA9IHRoaXMuaG9sZGluZ3NbXCJiYXRoZXJzXCJdO1xuXG4gICAgY29uc3QgZHJvcGRvd25EaXYgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYmF0aC1jbHViLWRyb3Bkb3duXCIpO1xuXG4gICAgbGV0IGRyb3Bkb3duID0gZHJvcGRvd25EaXYucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93bi1tZW51XCIpO1xuICAgIGlmIChkcm9wZG93bikge1xuICAgICAgZHJvcGRvd24ucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgZHJvcGRvd24gPSBuZXcgRHJvcGRvd25OZnRzKFxuICAgICAgdGhpcy5iYXRoZXJzQ29sbGVjdGlvbi5uZnRzLFxuICAgICAgdGhpcy5kaWRTZWxlY3RCYXRoZXIuYmluZCh0aGlzKVxuICAgICk7XG5cbiAgICBkcm9wZG93bkRpdi5hcHBlbmQoZHJvcGRvd24udWkpO1xuXG4gICAgLypcblxuICAgIGNvbnN0IGJhdGhlcnNEcm9wZG93bkxpc3QgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNiYXRoLWNsdWItZHJvcGRvd24tbGlzdFwiXG4gICAgKTtcbiAgICBiYXRoZXJzRHJvcGRvd25MaXN0LnRleHRDb250ZW50ID0gXCJcIjtcblxuICAgIC8vYWRkIGRlZmF1bHQgdmFsdWVcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG4gICAgYmF0aGVyc0Ryb3Bkb3duTGlzdC5hcHBlbmRDaGlsZChvcHRpb24pO1xuXG4gICAgaWYgKHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIG9wdGlvbi5pbm5lckhUTUwgPSAnPGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtIGRpc2FibGVkXCI+Tm8gYmF0aGVyczwvYT4nO1xuICAgIH1cblxuICAgIGxldCBpID0gMDtcbiAgICBmb3IgKGNvbnN0IG5mdCBvZiB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHMpIHtcbiAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcblxuICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgYS5jbGFzc05hbWUgPSBcImRyb3Bkb3duLWl0ZW1cIjtcbiAgICAgIGEuaHJlZiA9IFwiI1wiO1xuICAgICAgYS5kYXRhc2V0LmluZGV4ID0gaTtcblxuICAgICAgYS5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCIke25mdC5pbWFnZVVybH1cIj4gJHtuZnQubmFtZX1gO1xuXG4gICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmRpZFNlbGVjdEJhdGhlci5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAgIG9wdGlvbi5hcHBlbmQoYSk7XG4gICAgICBiYXRoZXJzRHJvcGRvd25MaXN0LmFwcGVuZChvcHRpb24pO1xuXG4gICAgICBpKys7XG4gICAgfVxuICAgICovXG4gIH1cblxuICBkaWRTZWxlY3RCYXRoZXIoZXZlbnQpIHtcbiAgICBjb25zdCBuZnRJbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcblxuICAgIGlmICghbmZ0SW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuZnQgPSB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHNbbmZ0SW5kZXhdO1xuICAgIHRoaXMuc2VsZWN0ZWRCYXRoZXIgPSBuZnQ7XG5cbiAgICAvL2Rpc3BsYXkgaW1hZ2VcbiAgICBjb25zdCBiYXRoZXJJbWcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2x1Yi1pbWdcIik7XG4gICAgYmF0aGVySW1nLnNyYyA9IG5mdC5pbWFnZVVybDtcblxuICAgIHRoaXMuZ2VuZXJhdGVHaWYoKTtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBkaWRTZWxlY3RGaWx0ZXIoZXZlbnQpIHtcbiAgICB0aGlzLnNlbGVjdGVkRmlsdGVyID0gZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTtcblxuICAgIGlmICghdGhpcy5zZWxlY3RlZEZpbHRlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZ2VuZXJhdGVHaWYoKTtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBhc3luYyBnZW5lcmF0ZUdpZigpIHtcbiAgICBpZiAodGhpcy5zZWxlY3RlZEZpbHRlciAmJiB0aGlzLnNlbGVjdGVkQmF0aGVyKSB7XG4gICAgICBjb25zdCBkb3dubG9hZEJ1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b24tZG93bmxvYWRcIik7XG4gICAgICBkb3dubG9hZEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICBkb3dubG9hZEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiR2VuZXJhdGluZyBHSUYuLi5cIjtcblxuICAgICAgY29uc3QgaW1nID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI21lcmdlZC1pbWdcIik7XG4gICAgICBpbWcuc3JjID0gXCJhc3NldHMvZGVmYXVsdC5wbmdcIjtcblxuICAgICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMuc2VsZWN0ZWRCYXRoZXIubWV0YWRhdGEucHJvcGVydGllcztcblxuICAgICAgY29uc3QgZ21HZW5lcmF0b3IgPSBuZXcgR21HZW5lcmF0b3IoKTtcblxuICAgICAgLy9kcmF3IGxheWVyc1xuICAgICAgYXdhaXQgZ21HZW5lcmF0b3IuZHJhd0xheWVycyhwcm9wZXJ0aWVzLCBsYXllcnMsIFwiLi9sYXllcnNfaW1hZ2VzXCIpO1xuXG4gICAgICBjb25zdCBnaWZEYXRhID0gYXdhaXQgZ21HZW5lcmF0b3JbYGRyYXdfJHt0aGlzLnNlbGVjdGVkRmlsdGVyfWBdKCk7XG5cbiAgICAgIC8vY29uc3QgYmFzZTY0U3RyaW5nID0gYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmdpZkRhdGEpKTtcbiAgICAgIC8vaW1nLnNyYyA9IGBkYXRhOmltYWdlL2dpZjtiYXNlNjQsJHtiYXNlNjRTdHJpbmd9YDtcbiAgICAgIGltZy5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKFxuICAgICAgICBuZXcgQmxvYihbZ2lmRGF0YS5idWZmZXJdLCB7IHR5cGU6IFwiaW1hZ2UvZ2lmXCIgfSlcbiAgICAgICk7XG5cbiAgICAgIGRvd25sb2FkQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICBkb3dubG9hZEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRG93bmxvYWQgR0lGXCI7XG4gICAgfVxuICB9XG5cbiAgZG93bmxvYWRHaWYoKSB7XG4gICAgY29uc3QgaW1nID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI21lcmdlZC1pbWdcIik7XG4gICAgY29uc29sZS5sb2coaW1nLnNyYyk7XG5cbiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgYS5ocmVmID0gaW1nLnNyYztcbiAgICBhLmRvd25sb2FkID0gXCJnb29kLW1vcm5pbmcuZ2lmXCI7XG4gICAgYS5jbGljaygpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiR0lGRW5jb2RlciIsInF1YW50aXplIiwiYXBwbHlQYWxldHRlIiwiZ2lmZW5jIiwiR2lmR2VuZXJhdG9yIiwiY29uc3RydWN0b3IiLCJ3aWR0aCIsImhlaWdodCIsInNjYWxlIiwidGhpcyIsImdpZkVuY29kZXIiLCJhZGRGcmFtZSIsImN0eCIsImRlbGF5IiwiZGF0YSIsImdldEltYWdlRGF0YSIsInBhbGV0dGUiLCJjYW52YXMiLCJNYXRoIiwicm91bmQiLCJzY2FsZUN0eCIsImdldENvbnRleHQiLCJpbWFnZVNtb290aGluZ0VuYWJsZWQiLCJkcmF3SW1hZ2UiLCJpbWFnZURhdGEiLCJpbmRleCIsIndyaXRlRnJhbWUiLCJmaW5pc2giLCJnZXRPdXRwdXQiLCJieXRlcyIsIkdtR2VuZXJhdG9yIiwibGF5ZXJzRGF0YSIsInR5cGVzIiwiYXN5bmMiLCJwcm9wZXJ0aWVzIiwibGF5ZXJzIiwibGF5ZXJzRm9sZGVyIiwiZ2lmR2VuZXJhdG9yIiwibGF5ZXJDYW52YXMiLCJsYXllcnNDdHgiLCJidWJibGVJbWFnZXMiLCJpIiwiYnViYmxlSW1hZ2VGaWxlcGF0aCIsImxheWVyIiwiY2xlYXJSZWN0IiwicHV0SW1hZ2VEYXRhIiwic2F2ZSIsImluY2x1ZGVzIiwibmFtZSIsInRyYW5zbGF0ZSIsInJlc3RvcmUiLCJidWJibGVJbWFnZSIsInNob3dlckltYWdlcyIsInNob3dlckltYWdlRmlsZXBhdGgiLCJkaWREcmF3U2hvd2VyIiwic2hvd2VySW1hZ2UiLCJzdW5yaXNlSW1hZ2VzIiwiYmFja2dyb3VuZCIsImZvcmVncm91bmQiLCJkdXJhdGlvbiIsInN1bnJpc2VJbWFnZUluZm8iLCJzdW5yaXNlSW1hZ2UiLCJnbGl0Y2giLCJkaXNhYmxlZCIsIm51bVBpeGVscyIsImxlbmd0aCIsInJldHVybkltYWdlRGF0YSIsImNyZWF0ZUltYWdlRGF0YSIsInNldCIsInJhbmRvbUluZGV4IiwiZmxvb3IiLCJyYW5kb20iLCJ0eXBlIiwiaiIsImltYWdlRmlsZXBhdGgiLCJpbWFnZSIsImdJbWFnZUZpbGVwYXRoIiwibUltYWdlRmlsZXBhdGgiLCJzaG91bGRHbGl0Y2giLCJnTGF5ZXIiLCJtTGF5ZXIiLCJnSW1hZ2VDYW52YXMiLCJnbGl0Y2hlZEltYWdlIiwibUltYWdlQ2FudmFzIiwiR29vZE1vcm5pbmciLCJCYXNlUGFnZSIsInN1cGVyIiwiYXJndW1lbnRzIiwidWkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJiYXRoZXJzQ29sbGVjdGlvbiIsInNlbGVjdGVkQmF0aGVyIiwic2VsZWN0ZWRGaWx0ZXIiLCJsb2FkIiwibG9hZEJhdGhlcnMiLCJxdWVyeVNlbGVjdG9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRpZFNlbGVjdEZpbHRlciIsImJpbmQiLCJkb3dubG9hZEdpZiIsImhvbGRpbmdzIiwiZHJvcGRvd25EaXYiLCJkcm9wZG93biIsInJlbW92ZSIsIm5mdHMiLCJkaWRTZWxlY3RCYXRoZXIiLCJhcHBlbmQiLCJldmVudCIsIm5mdEluZGV4IiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJuZnQiLCJzcmMiLCJpbWFnZVVybCIsImdlbmVyYXRlR2lmIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsImRvd25sb2FkQnV0dG9uIiwidGV4dENvbnRlbnQiLCJpbWciLCJtZXRhZGF0YSIsImdtR2VuZXJhdG9yIiwiZHJhd0xheWVycyIsImdpZkRhdGEiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJCbG9iIiwiYnVmZmVyIiwiY29uc29sZSIsImxvZyIsImEiLCJocmVmIiwiZG93bmxvYWQiLCJjbGljayJdLCJzb3VyY2VSb290IjoiIn0=