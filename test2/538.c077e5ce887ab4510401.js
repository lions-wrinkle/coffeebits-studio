"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[538],{6538:(e,t,s)=>{s.r(t),s.d(t,{Grinder:()=>r});var a=s(6998),d=(s(5190),s(7304),s(7644)),n=s(4050),i=s(2871),o=s(4714);class r extends a.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Grinder</h1>\n    <p class="dark-text">Use Caffeine Cards to update your Bathers</p>\n\n    <div class="d-sm-flex flew-row" style="background-color: var(--background-dark);">\n\n        <div class="d-flex flex-column p-3 text-center">\n\n            <img src="assets/default.png" class="mb-2 ms-auto me-auto" id="club-img" style="width: 200px; height: auto">\n\n            <div class="dropdown" id="bath-club-dropdown">\n                <button class="dropdown-toggle button-alt" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false">\n                    Choose Bather\n                </button>\n            </div>\n            <div class="mb-2 mt-4 ms-auto me-auto justify-content-center row row-cols-2" id="cards" style="width: 200px;">\n              <div class="col text-center" id="default-card" style="width: 200px;">\n                <img src="assets/default-card.png" class="img-fluid" style="width: 200px; height: auto;">\n              </div>\n            </div>\n            <div class="dropdown mb-3" id="cards-dropdown">\n                <button class="dropdown-toggle button-alt mb-2" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false" id="choose-card-button" disabled>\n                    Add Card\n                </button>\n            </div>\n            <button id="button-review" disabled>Review...</button>\n\n        </div>\n\n        <div class="d-flex flex-column flex-fill p-3 text-center">\n            <small class="dark-text">preview</small>\n            <img src="assets/default.png" class="w-100 m-auto img-fluid" style="max-width: 480px;" id="merged-img">\n\n        </div>\n\n    </div>',this.bathersCollection,this.cardsCollection,this.selectedBather,this.selectedCards=[],this.mergedProperties={},this.mergedImgDataURL,this.chooseCardButton=this.ui.querySelector("#choose-card-button"),this.load()}async load(){await this.loadBathers(),this.ui.querySelector("#button-review").addEventListener("click",this.review.bind(this));const e=window.location.search,t=new URLSearchParams(e);if(t.has("bather")){const e=parseInt(t.get("bather")),s=this.bathersCollection.nfts.filter((t=>t.assetId===e))?.[0];s&&await this.displayBather(s)}}async loadBathers(){this.bathersCollection=this.holdings.bathers;const e=this.ui.querySelector("#bath-club-dropdown");let t=e.querySelector(".dropdown-menu");t&&t.remove(),t=new i.Z(this.bathersCollection.nfts,this.didSelectBather.bind(this)),e.append(t.ui)}async didSelectBather(e){this.clearCard();const t=e.currentTarget.dataset.index;if(!t)return;const s=this.bathersCollection.nfts[t];this.mergedProperties=s.metadata.properties,await this.displayBather(s),e.preventDefault()}async displayBather(e){this.selectedBather=e,this.ui.querySelector("#club-img").src=e.imageUrl,this.validate(),await this.loadCards(),this.chooseCardButton.disabled=!1}clearCard(){this.selectedCards=[],this.chooseCardButton.disabled=!0,this.mergedProperties={},this.ui.querySelector("#default-card").hidden=!1;const e=Array.from(this.ui.querySelector("#cards").children);for(const t of e)"default-card"!==t.id&&t.remove()}async loadCards(){this.cardsCollection=this.holdings.caffeineCards;const e=this.ui.querySelector("#cards-dropdown");let t=e.querySelector("#cards-dropdown-nft");t&&t.remove(),console.log(this.mergedProperties);let s=[];e:for(const e of this.cardsCollection.nfts){if(e.metadata.require)for(const t in e.metadata.require)if(this.mergedProperties[t]!=e.metadata.require[t]){s.push(e.assetId);continue e}for(const t of this.selectedCards)for(const a in t.metadata.properties)if(e.metadata.properties[a]){s.push(e.assetId);continue e}}t=new i.Z(this.cardsCollection.nfts,this.didSelectCard.bind(this),"cards-dropdown-nft",s),e.append(t.ui),new window.bootstrap.Dropdown(this.chooseCardButton)}async didSelectCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];this.selectedCards.push(s);const a=this.ui.querySelector("#default-card");a&&(a.hidden=!0);const d=document.createElement("div");d.className="col text-center",d.id=`card-${t}`,d.innerHTML=`\n    <img style="width: 80px; height: auto" src="${s.imageUrl}">\n    <p><a href="javascript:void(0);" id="rm-${t}" data-index="${t}">Remove</a></p>\n    `,d.querySelector(`#rm-${t}`).addEventListener("click",this.removeCard.bind(this),!1),this.ui.querySelector("#cards").append(d),this.validate(),await this.loadCards(),e.preventDefault()}async removeCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];if(console.log(this.selectedCards.map((e=>e.name))),this.selectedCards=this.selectedCards.filter((e=>e.assetId!=s.assetId)),console.log(this.selectedCards.map((e=>e.name))),0===this.selectedCards.length){const e=this.ui.querySelector("#default-card");e&&(e.hidden=!1)}this.validate(),await this.loadCards(),this.ui.querySelector(`#card-${t}`).remove(),e.preventDefault()}validate(){const e=this.ui.querySelector("#button-review");this.selectedBather&&this.selectedCards.length>0?(e.disabled=!1,this.preview()):this.selectedBather?(this.ui.querySelector("#merged-img").src=this.selectedBather.imageUrl,e.disabled=!0):e.disabled=!0}review(e){const t=document.createElement("div");t.className="modal",t.tabIndex="-1",t.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title">Review Bather modification</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div class="text-center mb-3">\n                <img style="width: 320px; height: auto;" id="preview-merged-img">\n            </div>\n\n          <p>\n          Your <strong>${this.selectedBather.name}</strong> will be updated.<br>\n          Your <strong>${this.selectedCards.map((e=>e.name)).join(", ")}</strong> will be burned &#128293;\n          </p>\n            \n          <p>&#128337; As the process requires a manual step, update can take up to 24h.<br>\n          &#128236; You will be notified by a zero Algo transaction when the update is complete.</p>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="button-alt" data-bs-dismiss="modal">Close</button>\n          <button type="button" id="send-button">Send request</button>\n        </div>\n      </div>\n    </div>\n    `,t.querySelector("#preview-merged-img").src=this.mergedImgDataURL;const s=t.querySelector("#send-button");s.currentModal=t,s.addEventListener("click",this.send.bind(this),!1),new window.bootstrap.Modal(t,{}).show()}async preview(){const e=this.ui.querySelector("#button-review");e.disabled=!0,e.textContent="Generating...";const t=this.ui.querySelector("#merged-img");this.mergedProperties=Object.assign({},this.selectedBather.metadata.properties);for(const e of this.selectedCards)for(const t in e.metadata.properties)this.mergedProperties[t]=e.metadata.properties[t];const s=await(0,d.i)(this.mergedProperties,o,"layers_images");this.mergedImgDataURL=s.toDataURL("image/png"),t.src=this.mergedImgDataURL,e.disabled=!1,e.textContent="Review..."}async send(e){const t=e.currentTarget;t.disabled=!0,t.textContent="Waiting for signature...";const s=await this.algodClient.getTransactionParams().do(),a={evolve:this.selectedBather.assetId},d=(new TextEncoder).encode(JSON.stringify(a));if(this.selectedCards.length>13)return void alert("No more than 14 cards can be used at once.");let i=[];for(const e of this.selectedCards)i.push(n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.cardsCollection.collections[0].addresses[0],amount:1,assetIndex:e.assetId,suggestedParams:s,note:d}));i.length>1&&n.assignGroupID(i);const o=await this.walletConnect.signTransactions(i),r=t.currentModal;let l;r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body ">\n            <div class="text-center mb-3">\n                <img src="assets/grinder.png" style="width: 128px; height: auto;">\n            </div>\n            <div class="text-center mb-3">\n            Sending Caffeine Card to the Grinder...\n            </div>\n        </div>\n      </div>\n    </div>\n    ';try{l=await this.algodClient.sendRawTransaction(o).do(),await n.waitForConfirmation(this.algodClient,l.txId,4),r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <img src="assets/heart-cup.png" width="60"><br><br>\n          We got your card and your evolution request.<br>\n          We\'ll be back to you very soon.\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    ',r.addEventListener("hidden.bs.modal",(e=>{location.reload()}))}catch(e){r.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <div class="alert alert-danger" role="alert">${e.message} </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    `,console.error(e)}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3pCQyxHQUFJaEgsS0FBS00sZ0JBQWdCMkcsWUFBWSxHQUFHQyxVQUFVLEdBQ2xEQyxPQUFRLEVBQ1JDLFdBQVlqRCxFQUFhbkMsUUFDekJpRSxnQkFBaUJBLEVBQ2pCSSxLQUFNRSxLQU1STSxFQUFLOUIsT0FBUyxHQUNoQixnQkFBc0I4QixHQUd4QixNQUFNUSxRQUFtQnJILEtBQUs4RyxjQUFjUSxpQkFBaUJULEdBR3ZEdkIsRUFBZUQsRUFBV0MsYUFxQmhDLElBQUlpQyxFQW5CSmpDLEVBQWFsRixVQUFZLG9sQkFvQnpCLElBQ0VtSCxRQUFXdkgsS0FBS2tHLFlBQVlzQixtQkFBbUJILEdBQVlqQixXQUdsQyxzQkFDdkJwRyxLQUFLa0csWUFDTHFCLEVBQUdFLEtBQ0gsR0FHRm5DLEVBQWFsRixVQUFZLHlxQkFvQnpCa0YsRUFBYXRFLGlCQUFpQixtQkFBb0J3QixJQUVoRG5CLFNBQVNxRyxRQUFRLEdBc0JyQixDQXBCRSxNQUFPQyxHQUNQckMsRUFBYWxGLFVBQVksNlhBUTBCdUgsRUFBSUMsK01BVXZEaEUsUUFBUWlFLE1BQU1GLEVBQ2hCLENBQ0YsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9ncmluZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VQYWdlIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IGNvbGxlY3Rpb24gZnJvbSBcIi4uL2NvbGxlY3Rpb25zLmpzXCI7XG5pbXBvcnQgeyBORlRIb2xkZXJDb2xsZWN0aW9uIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgeyBkcmF3IH0gZnJvbSBcImJhdGgtY2x1YlwiO1xuaW1wb3J0IGFsZ29zZGsgZnJvbSBcImFsZ29zZGtcIjtcbmltcG9ydCBEcm9wZG93bk5mdHMgZnJvbSBcIi4uL2NvbW1vbi9kcm9wZG93bi1uZnRzLmpzXCI7XG5cbmltcG9ydCBsYXllcnMgZnJvbSBcIi4uLy4uLy4uL2JhdGgtY2x1Yi9sYXllcnMuanNvblwiO1xuXG5leHBvcnQgY2xhc3MgR3JpbmRlciBleHRlbmRzIEJhc2VQYWdlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcblxuICAgIHRoaXMudWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYFxuICAgIDxoMT5HcmluZGVyPC9oMT5cbiAgICA8cCBjbGFzcz1cImRhcmstdGV4dFwiPlVzZSBDYWZmZWluZSBDYXJkcyB0byB1cGRhdGUgeW91ciBCYXRoZXJzPC9wPlxuXG4gICAgPGRpdiBjbGFzcz1cImQtc20tZmxleCBmbGV3LXJvd1wiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmFja2dyb3VuZC1kYXJrKTtcIj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGZsZXgtY29sdW1uIHAtMyB0ZXh0LWNlbnRlclwiPlxuXG4gICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9kZWZhdWx0LnBuZ1wiIGNsYXNzPVwibWItMiBtcy1hdXRvIG1lLWF1dG9cIiBpZD1cImNsdWItaW1nXCIgc3R5bGU9XCJ3aWR0aDogMjAwcHg7IGhlaWdodDogYXV0b1wiPlxuXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd25cIiBpZD1cImJhdGgtY2x1Yi1kcm9wZG93blwiPlxuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJkcm9wZG93bi10b2dnbGUgYnV0dG9uLWFsdFwiIHR5cGU9XCJidXR0b25cIiBkYXRhLWJzLXRvZ2dsZT1cImRyb3Bkb3duXCJcbiAgICAgICAgICAgICAgICAgICAgYXJpYS1leHBhbmRlZD1cImZhbHNlXCI+XG4gICAgICAgICAgICAgICAgICAgIENob29zZSBCYXRoZXJcbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1iLTIgbXQtNCBtcy1hdXRvIG1lLWF1dG8ganVzdGlmeS1jb250ZW50LWNlbnRlciByb3cgcm93LWNvbHMtMlwiIGlkPVwiY2FyZHNcIiBzdHlsZT1cIndpZHRoOiAyMDBweDtcIj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbCB0ZXh0LWNlbnRlclwiIGlkPVwiZGVmYXVsdC1jYXJkXCIgc3R5bGU9XCJ3aWR0aDogMjAwcHg7XCI+XG4gICAgICAgICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvZGVmYXVsdC1jYXJkLnBuZ1wiIGNsYXNzPVwiaW1nLWZsdWlkXCIgc3R5bGU9XCJ3aWR0aDogMjAwcHg7IGhlaWdodDogYXV0bztcIj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93biBtYi0zXCIgaWQ9XCJjYXJkcy1kcm9wZG93blwiPlxuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJkcm9wZG93bi10b2dnbGUgYnV0dG9uLWFsdCBtYi0yXCIgdHlwZT1cImJ1dHRvblwiIGRhdGEtYnMtdG9nZ2xlPVwiZHJvcGRvd25cIlxuICAgICAgICAgICAgICAgICAgICBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIiBpZD1cImNob29zZS1jYXJkLWJ1dHRvblwiIGRpc2FibGVkPlxuICAgICAgICAgICAgICAgICAgICBBZGQgQ2FyZFxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8YnV0dG9uIGlkPVwiYnV0dG9uLXJldmlld1wiIGRpc2FibGVkPlJldmlldy4uLjwvYnV0dG9uPlxuXG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggZmxleC1jb2x1bW4gZmxleC1maWxsIHAtMyB0ZXh0LWNlbnRlclwiPlxuICAgICAgICAgICAgPHNtYWxsIGNsYXNzPVwiZGFyay10ZXh0XCI+cHJldmlldzwvc21hbGw+XG4gICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9kZWZhdWx0LnBuZ1wiIGNsYXNzPVwidy0xMDAgbS1hdXRvIGltZy1mbHVpZFwiIHN0eWxlPVwibWF4LXdpZHRoOiA0ODBweDtcIiBpZD1cIm1lcmdlZC1pbWdcIj5cblxuICAgICAgICA8L2Rpdj5cblxuICAgIDwvZGl2PmA7XG5cbiAgICB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uO1xuICAgIHRoaXMuY2FyZHNDb2xsZWN0aW9uO1xuXG4gICAgdGhpcy5zZWxlY3RlZEJhdGhlcjtcbiAgICB0aGlzLnNlbGVjdGVkQ2FyZHMgPSBbXTtcbiAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXMgPSB7fTtcblxuICAgIHRoaXMubWVyZ2VkSW1nRGF0YVVSTDtcblxuICAgIHRoaXMuY2hvb3NlQ2FyZEJ1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjaG9vc2UtY2FyZC1idXR0b25cIik7XG5cbiAgICB0aGlzLmxvYWQoKTtcbiAgfVxuXG4gIGFzeW5jIGxvYWQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkQmF0aGVycygpO1xuXG4gICAgY29uc3QgcmV2aWV3QnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvbi1yZXZpZXdcIik7XG4gICAgcmV2aWV3QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnJldmlldy5iaW5kKHRoaXMpKTtcblxuICAgIC8vY29uc3Qgc2VuZEJ1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNzZW5kLWJ0blwiKTtcbiAgICAvL3NlbmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuc2VuZC5iaW5kKHRoaXMpKTtcblxuICAgIC8vY2hlY2sgaWYgYSBiYXRoZXIgd2FzIHJlcXVlc3RlZFxuICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaDtcbiAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHF1ZXJ5U3RyaW5nKTtcblxuICAgIGlmICh1cmxQYXJhbXMuaGFzKCdiYXRoZXInKSl7XG5cbiAgICAgIGNvbnN0IGJhdGhlckFzc2V0SWQgPSBwYXJzZUludCh1cmxQYXJhbXMuZ2V0KCdiYXRoZXInKSk7XG5cbiAgICAgIC8vZmluZCBiYXRoZXJcbiAgICAgIGNvbnN0IG5mdCA9IHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0cy5maWx0ZXIobmZ0ID0+IG5mdC5hc3NldElkID09PSBiYXRoZXJBc3NldElkKT8uWzBdO1xuXG4gICAgICBpZiAobmZ0KXtcbiAgICAgICAgYXdhaXQgdGhpcy5kaXNwbGF5QmF0aGVyKG5mdCk7XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICBhc3luYyBsb2FkQmF0aGVycygpIHtcbiAgICB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uID0gdGhpcy5ob2xkaW5nc1tcImJhdGhlcnNcIl07XG5cbiAgICBjb25zdCBkcm9wZG93bkRpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNiYXRoLWNsdWItZHJvcGRvd25cIik7XG5cbiAgICBsZXQgZHJvcGRvd24gPSBkcm9wZG93bkRpdi5xdWVyeVNlbGVjdG9yKFwiLmRyb3Bkb3duLW1lbnVcIik7XG4gICAgaWYgKGRyb3Bkb3duKSB7XG4gICAgICBkcm9wZG93bi5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBkcm9wZG93biA9IG5ldyBEcm9wZG93bk5mdHMoXG4gICAgICB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHMsXG4gICAgICB0aGlzLmRpZFNlbGVjdEJhdGhlci5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICBkcm9wZG93bkRpdi5hcHBlbmQoZHJvcGRvd24udWkpO1xuXG4gICAgLypcbiAgICBjb25zdCBiYXRoZXJzRHJvcGRvd25MaXN0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2JhdGgtY2x1Yi1kcm9wZG93bi1saXN0XCIpO1xuICAgIGJhdGhlcnNEcm9wZG93bkxpc3QudGV4dENvbnRlbnQgPSBcIlwiO1xuXG4gICAgLy9hZGQgZGVmYXVsdCB2YWx1ZVxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcbiAgICBiYXRoZXJzRHJvcGRvd25MaXN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG5cbiAgICBpZiAodGhpcy5iYXRoZXJzQ29sbGVjdGlvbi5uZnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgb3B0aW9uLmlubmVySFRNTCA9ICc8YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW0gZGlzYWJsZWRcIj5ObyBiYXRoZXJzPC9hPic7XG4gICAgfVxuXG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoY29uc3QgbmZ0IG9mIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0cykge1xuICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuXG4gICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgICBhLmNsYXNzTmFtZSA9ICdkcm9wZG93bi1pdGVtJztcbiAgICAgIGEuaHJlZiA9ICcjJztcbiAgICAgIGEuZGF0YXNldC5pbmRleCA9IGk7XG5cbiAgICAgIGEuaW5uZXJIVE1MID0gYDxpbWcgc3JjPVwiJHtuZnQuaW1hZ2VVcmx9XCI+ICR7bmZ0Lm5hbWV9YDtcblxuICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuZGlkU2VsZWN0QmF0aGVyLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgICAgb3B0aW9uLmFwcGVuZChhKTtcbiAgICAgIGJhdGhlcnNEcm9wZG93bkxpc3QuYXBwZW5kKG9wdGlvbik7XG5cbiAgICAgIGkrKztcbiAgICB9XG4gICAgKi9cbiAgfVxuXG4gIGFzeW5jIGRpZFNlbGVjdEJhdGhlcihldmVudCkge1xuICAgIHRoaXMuY2xlYXJDYXJkKCk7XG5cbiAgICBjb25zdCBuZnRJbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcblxuICAgIGlmICghbmZ0SW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuZnQgPSB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHNbbmZ0SW5kZXhdO1xuXG4gICAgdGhpcy5tZXJnZWRQcm9wZXJ0aWVzID0gbmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXM7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5kaXNwbGF5QmF0aGVyKG5mdCk7XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgYXN5bmMgZGlzcGxheUJhdGhlcihuZnQpe1xuICAgIHRoaXMuc2VsZWN0ZWRCYXRoZXIgPSBuZnQ7XG5cbiAgICAvL2Rpc3BsYXkgaW1hZ2VcbiAgICBjb25zdCBiYXRoZXJJbWcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2x1Yi1pbWdcIik7XG4gICAgYmF0aGVySW1nLnNyYyA9IG5mdC5pbWFnZVVybDtcblxuICAgIHRoaXMudmFsaWRhdGUoKTtcblxuICAgIGF3YWl0IHRoaXMubG9hZENhcmRzKCk7XG4gICAgdGhpcy5jaG9vc2VDYXJkQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cblxuICBjbGVhckNhcmQoKSB7XG4gICAgdGhpcy5zZWxlY3RlZENhcmRzID0gW107XG4gICAgdGhpcy5jaG9vc2VDYXJkQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXMgPSB7fTtcblxuICAgIGNvbnN0IGRlZmF1bHRDYXJkID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2RlZmF1bHQtY2FyZFwiKTtcbiAgICBkZWZhdWx0Q2FyZC5oaWRkZW4gPSBmYWxzZTtcblxuICAgIC8vcmVtb3ZlIGFsbCBkaXNwbGF5ZWQgY2FyZHNcblxuICAgIGNvbnN0IGNoaWxkcmVuID0gQXJyYXkuZnJvbSh0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHNcIikuY2hpbGRyZW4pO1xuXG4gICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGNoaWxkcmVuKXtcblxuICAgICAgaWYgKGVsZW1lbnQuaWQgIT09IFwiZGVmYXVsdC1jYXJkXCIpe1xuICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xuICAgICAgfVxuICAgICAgXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZENhcmRzKCkge1xuICAgIHRoaXMuY2FyZHNDb2xsZWN0aW9uID0gdGhpcy5ob2xkaW5nc1tcImNhZmZlaW5lQ2FyZHNcIl07XG5cbiAgICBjb25zdCBkcm9wZG93bkRpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjYXJkcy1kcm9wZG93blwiKTtcblxuICAgIGxldCBkcm9wZG93biA9IGRyb3Bkb3duRGl2LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHMtZHJvcGRvd24tbmZ0XCIpO1xuICAgIGlmIChkcm9wZG93bikge1xuICAgICAgZHJvcGRvd24ucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2codGhpcy5tZXJnZWRQcm9wZXJ0aWVzKTtcblxuICAgIGxldCBkaXNhYmxlZEFzc2V0SWRzID0gW107XG4gICAgbGV0IGkgPSAwO1xuICAgIG1haW5sb29wOiBmb3IgKGNvbnN0IG5mdCBvZiB0aGlzLmNhcmRzQ29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICAvL2NoZWNrIHJlcXVpcmVtZW50XG4gICAgICBpZiAobmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgZm9yIChjb25zdCByZXF1aXJlS2V5IGluIG5mdC5tZXRhZGF0YS5yZXF1aXJlKSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5tZXJnZWRQcm9wZXJ0aWVzW3JlcXVpcmVLZXldICE9XG4gICAgICAgICAgICBuZnQubWV0YWRhdGEucmVxdWlyZVtyZXF1aXJlS2V5XVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgZGlzYWJsZWRBc3NldElkcy5wdXNoKG5mdC5hc3NldElkKTtcbiAgICAgICAgICAgIGNvbnRpbnVlIG1haW5sb29wO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qZm9yIChjb25zdCBzZWxlY3RlZENhcmQgb2YgdGhpcy5zZWxlY3RlZENhcmRzKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHNlbGVjdGVkQ2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzW3JlcXVpcmVLZXldICE9XG4gICAgICAgICAgICAgIG5mdC5tZXRhZGF0YS5yZXF1aXJlW3JlcXVpcmVLZXldXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZGlzYWJsZWRBc3NldElkcy5wdXNoKG5mdC5hc3NldElkKTtcbiAgICAgICAgICAgICAgY29udGludWUgbWFpbmxvb3A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSovXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy9yZW1vdmUgY2FyZHMgZnJvbSB0aGUgc2FtZSB0eXBlXG4gICAgICBmb3IgKGNvbnN0IHNlbGVjdGVkQ2FyZCBvZiB0aGlzLnNlbGVjdGVkQ2FyZHMpIHtcbiAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBzZWxlY3RlZENhcmQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICAgIGlmIChuZnQubWV0YWRhdGEucHJvcGVydGllc1twcm9wZXJ0eV0pIHtcbiAgICAgICAgICAgIGRpc2FibGVkQXNzZXRJZHMucHVzaChuZnQuYXNzZXRJZCk7XG4gICAgICAgICAgICBjb250aW51ZSBtYWlubG9vcDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBkcm9wZG93biA9IG5ldyBEcm9wZG93bk5mdHMoXG4gICAgICB0aGlzLmNhcmRzQ29sbGVjdGlvbi5uZnRzLFxuICAgICAgdGhpcy5kaWRTZWxlY3RDYXJkLmJpbmQodGhpcyksXG4gICAgICBcImNhcmRzLWRyb3Bkb3duLW5mdFwiLFxuICAgICAgZGlzYWJsZWRBc3NldElkc1xuICAgICk7XG4gICAgZHJvcGRvd25EaXYuYXBwZW5kKGRyb3Bkb3duLnVpKTtcblxuICAgIG5ldyB3aW5kb3cuYm9vdHN0cmFwLkRyb3Bkb3duKHRoaXMuY2hvb3NlQ2FyZEJ1dHRvbik7XG4gIH1cblxuICBhc3luYyBkaWRTZWxlY3RDYXJkKGV2ZW50KSB7XG4gICAgY29uc3QgbmZ0SW5kZXggPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG5cbiAgICBpZiAoIW5mdEluZGV4KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbmZ0ID0gdGhpcy5jYXJkc0NvbGxlY3Rpb24ubmZ0c1tuZnRJbmRleF07XG4gICAgdGhpcy5zZWxlY3RlZENhcmRzLnB1c2gobmZ0KTtcblxuICAgIC8vcmVtb3ZlIGRlZmF1bHQgY2FyZCBpZiBuZWVkZWRcbiAgICBjb25zdCBkZWZhdWx0Q2FyZCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNkZWZhdWx0LWNhcmRcIik7XG5cbiAgICBpZiAoZGVmYXVsdENhcmQpIHtcbiAgICAgIGRlZmF1bHRDYXJkLmhpZGRlbiA9IHRydWU7XG4gICAgfVxuXG4gICAgLy9hZGQgY2FyZFxuICAgIGNvbnN0IG5ld0NhcmREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG5ld0NhcmREaXYuY2xhc3NOYW1lID0gXCJjb2wgdGV4dC1jZW50ZXJcIjtcbiAgICBuZXdDYXJkRGl2LmlkID0gYGNhcmQtJHtuZnRJbmRleH1gO1xuXG4gICAgbmV3Q2FyZERpdi5pbm5lckhUTUwgPSBgXG4gICAgPGltZyBzdHlsZT1cIndpZHRoOiA4MHB4OyBoZWlnaHQ6IGF1dG9cIiBzcmM9XCIke25mdC5pbWFnZVVybH1cIj5cbiAgICA8cD48YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGlkPVwicm0tJHtuZnRJbmRleH1cIiBkYXRhLWluZGV4PVwiJHtuZnRJbmRleH1cIj5SZW1vdmU8L2E+PC9wPlxuICAgIGA7XG5cbiAgICBuZXdDYXJkRGl2XG4gICAgICAucXVlcnlTZWxlY3RvcihgI3JtLSR7bmZ0SW5kZXh9YClcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5yZW1vdmVDYXJkLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHNcIikuYXBwZW5kKG5ld0NhcmREaXYpO1xuXG4gICAgLy9kaXNwbGF5IGltYWdlXG4gICAgLy9jb25zdCBjYXJkSW1nID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1nXCIpO1xuICAgIC8vY2FyZEltZy5zcmMgPSBuZnQuaW1hZ2VVcmw7XG5cbiAgICB0aGlzLnZhbGlkYXRlKCk7XG5cbiAgICAvL3JlbG9hZCBjYXJkc1xuICAgIGF3YWl0IHRoaXMubG9hZENhcmRzKCk7XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgYXN5bmMgcmVtb3ZlQ2FyZChldmVudCkge1xuICAgIGNvbnN0IG5mdEluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4O1xuXG4gICAgaWYgKCFuZnRJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG5mdCA9IHRoaXMuY2FyZHNDb2xsZWN0aW9uLm5mdHNbbmZ0SW5kZXhdO1xuXG4gICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RlZENhcmRzLm1hcCgoYykgPT4gYy5uYW1lKSk7XG4gICAgdGhpcy5zZWxlY3RlZENhcmRzID0gdGhpcy5zZWxlY3RlZENhcmRzLmZpbHRlcihcbiAgICAgIChjKSA9PiBjLmFzc2V0SWQgIT0gbmZ0LmFzc2V0SWRcbiAgICApO1xuICAgIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0ZWRDYXJkcy5tYXAoKGMpID0+IGMubmFtZSkpO1xuXG4gICAgLy9kaXNwbGF5IGRlZmF1bHQgY2FyZCBhZ2FpbiBpZiBuZWVkZWRcbiAgICBpZiAodGhpcy5zZWxlY3RlZENhcmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3QgZGVmYXVsdENhcmQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjZGVmYXVsdC1jYXJkXCIpO1xuXG4gICAgICBpZiAoZGVmYXVsdENhcmQpIHtcbiAgICAgICAgZGVmYXVsdENhcmQuaGlkZGVuID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy52YWxpZGF0ZSgpO1xuXG4gICAgLy9yZWxvYWQgY2FyZHNcbiAgICBhd2FpdCB0aGlzLmxvYWRDYXJkcygpO1xuXG4gICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjY2FyZC0ke25mdEluZGV4fWApLnJlbW92ZSgpO1xuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuXG4gIHZhbGlkYXRlKCkge1xuICAgIGNvbnN0IHJldmlld0J1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b24tcmV2aWV3XCIpO1xuXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRCYXRoZXIgJiYgdGhpcy5zZWxlY3RlZENhcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICB0aGlzLnByZXZpZXcoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRCYXRoZXIpIHtcbiAgICAgIGNvbnN0IG1lcmdlZEltZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNtZXJnZWQtaW1nXCIpO1xuICAgICAgbWVyZ2VkSW1nLnNyYyA9IHRoaXMuc2VsZWN0ZWRCYXRoZXIuaW1hZ2VVcmw7XG5cbiAgICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV2aWV3KGV2ZW50KSB7XG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG1vZGFsLmNsYXNzTmFtZSA9IFwibW9kYWxcIjtcbiAgICBtb2RhbC50YWJJbmRleCA9IFwiLTFcIjtcblxuICAgIG1vZGFsLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxuICAgICAgICAgIDxoNSBjbGFzcz1cIm1vZGFsLXRpdGxlXCI+UmV2aWV3IEJhdGhlciBtb2RpZmljYXRpb248L2g1PlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuLWNsb3NlXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbWItM1wiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3R5bGU9XCJ3aWR0aDogMzIwcHg7IGhlaWdodDogYXV0bztcIiBpZD1cInByZXZpZXctbWVyZ2VkLWltZ1wiPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICA8cD5cbiAgICAgICAgICBZb3VyIDxzdHJvbmc+JHt0aGlzLnNlbGVjdGVkQmF0aGVyLm5hbWV9PC9zdHJvbmc+IHdpbGwgYmUgdXBkYXRlZC48YnI+XG4gICAgICAgICAgWW91ciA8c3Ryb25nPiR7dGhpcy5zZWxlY3RlZENhcmRzXG4gICAgICAgICAgICAubWFwKChjKSA9PiBjLm5hbWUpXG4gICAgICAgICAgICAuam9pbihcIiwgXCIpfTwvc3Ryb25nPiB3aWxsIGJlIGJ1cm5lZCAmIzEyODI5MztcbiAgICAgICAgICA8L3A+XG4gICAgICAgICAgICBcbiAgICAgICAgICA8cD4mIzEyODMzNzsgQXMgdGhlIHByb2Nlc3MgcmVxdWlyZXMgYSBtYW51YWwgc3RlcCwgdXBkYXRlIGNhbiB0YWtlIHVwIHRvIDI0aC48YnI+XG4gICAgICAgICAgJiMxMjgyMzY7IFlvdSB3aWxsIGJlIG5vdGlmaWVkIGJ5IGEgemVybyBBbGdvIHRyYW5zYWN0aW9uIHdoZW4gdGhlIHVwZGF0ZSBpcyBjb21wbGV0ZS48L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidXR0b24tYWx0XCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIj5DbG9zZTwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGlkPVwic2VuZC1idXR0b25cIj5TZW5kIHJlcXVlc3Q8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgY29uc3QgcHJldmlld01lcmdlZEltZyA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tZXJnZWQtaW1nXCIpO1xuICAgIHByZXZpZXdNZXJnZWRJbWcuc3JjID0gdGhpcy5tZXJnZWRJbWdEYXRhVVJMO1xuXG4gICAgY29uc3Qgc2VuZEJ1dHRvbiA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjc2VuZC1idXR0b25cIik7XG4gICAgc2VuZEJ1dHRvbi5jdXJyZW50TW9kYWwgPSBtb2RhbDtcbiAgICBzZW5kQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnNlbmQuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgY29uc3QgbXlNb2RhbCA9IG5ldyB3aW5kb3cuYm9vdHN0cmFwLk1vZGFsKG1vZGFsLCB7fSk7XG5cbiAgICBteU1vZGFsLnNob3coKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGFzeW5jIHByZXZpZXcoKSB7XG4gICAgY29uc3QgcmV2aWV3QnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvbi1yZXZpZXdcIik7XG4gICAgcmV2aWV3QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICByZXZpZXdCdXR0b24udGV4dENvbnRlbnQgPSBcIkdlbmVyYXRpbmcuLi5cIjtcblxuICAgIGNvbnN0IG1lcmdlZEltZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNtZXJnZWQtaW1nXCIpO1xuXG4gICAgdGhpcy5tZXJnZWRQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihcbiAgICAgIHt9LFxuICAgICAgdGhpcy5zZWxlY3RlZEJhdGhlci5tZXRhZGF0YS5wcm9wZXJ0aWVzXG4gICAgKTsgLy9tYWtlIGEgc2hhbGxvdyBjb3B5XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGVkQ2FyZCBvZiB0aGlzLnNlbGVjdGVkQ2FyZHMpIHtcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIHNlbGVjdGVkQ2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgIHRoaXMubWVyZ2VkUHJvcGVydGllc1trZXldID0gc2VsZWN0ZWRDYXJkLm1ldGFkYXRhLnByb3BlcnRpZXNba2V5XTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2NvbnNvbGUubG9nKHByb3BlcnRpZXMpXG4gICAgY29uc3QgY2FudmFzID0gYXdhaXQgZHJhdyh0aGlzLm1lcmdlZFByb3BlcnRpZXMsIGxheWVycywgXCJsYXllcnNfaW1hZ2VzXCIpO1xuXG4gICAgdGhpcy5tZXJnZWRJbWdEYXRhVVJMID0gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcblxuICAgIG1lcmdlZEltZy5zcmMgPSB0aGlzLm1lcmdlZEltZ0RhdGFVUkw7XG5cbiAgICByZXZpZXdCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICByZXZpZXdCdXR0b24udGV4dENvbnRlbnQgPSBcIlJldmlldy4uLlwiO1xuICB9XG5cbiAgYXN5bmMgc2VuZChldmVudCkge1xuXG4gICAgY29uc3Qgc2VuZEJ1dHRvbiA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gICAgc2VuZEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgc2VuZEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiV2FpdGluZyBmb3Igc2lnbmF0dXJlLi4uXCI7XG5cbiAgICBjb25zdCBzdWdnZXN0ZWRQYXJhbXMgPSBhd2FpdCB0aGlzLmFsZ29kQ2xpZW50LmdldFRyYW5zYWN0aW9uUGFyYW1zKCkuZG8oKTtcblxuICAgIC8vZ2VuZXJhdGUgdHhcblxuICAgIGNvbnN0IG5vdGUgPSB7XG4gICAgICBldm9sdmU6IHRoaXMuc2VsZWN0ZWRCYXRoZXIuYXNzZXRJZCxcbiAgICB9O1xuXG4gICAgY29uc3QgdGV4dEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTtcbiAgICBjb25zdCBlbmNvZGVkTm90ZSA9IHRleHRFbmNvZGVyLmVuY29kZShKU09OLnN0cmluZ2lmeShub3RlKSk7XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZENhcmRzLmxlbmd0aCA+IDEzKSB7XG4gICAgICBhbGVydChcIk5vIG1vcmUgdGhhbiAxNCBjYXJkcyBjYW4gYmUgdXNlZCBhdCBvbmNlLlwiKTsgLy8xNiBtaW51cyBhc3NldCBjb25maWcgdHgsIG1pbnVzIG5vdGlmaWNhdGlvbiB0eCwgbWludSBhc3NldCBzZW5kXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHR4bnMgPSBbXTtcblxuICAgIGZvciAoY29uc3Qgc2VsZWN0ZWRDYXJkIG9mIHRoaXMuc2VsZWN0ZWRDYXJkcykge1xuICAgICAgdHhucy5wdXNoKFxuICAgICAgICBhbGdvc2RrLm1ha2VBc3NldFRyYW5zZmVyVHhuV2l0aFN1Z2dlc3RlZFBhcmFtc0Zyb21PYmplY3Qoe1xuICAgICAgICAgIGZyb206IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICAgIHRvOiB0aGlzLmNhcmRzQ29sbGVjdGlvbi5jb2xsZWN0aW9uc1swXS5hZGRyZXNzZXNbMF0sXG4gICAgICAgICAgYW1vdW50OiAxLFxuICAgICAgICAgIGFzc2V0SW5kZXg6IHNlbGVjdGVkQ2FyZC5hc3NldElkLFxuICAgICAgICAgIHN1Z2dlc3RlZFBhcmFtczogc3VnZ2VzdGVkUGFyYW1zLFxuICAgICAgICAgIG5vdGU6IGVuY29kZWROb3RlLFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvL2Fzc2lnbiBncm91cFxuICAgIGlmICh0eG5zLmxlbmd0aCA+IDEpe1xuICAgICAgYWxnb3Nkay5hc3NpZ25Hcm91cElEKHR4bnMpO1xuICAgIH1cblxuICAgIGNvbnN0IHNpZ25lZFR4bnMgPSBhd2FpdCB0aGlzLndhbGxldENvbm5lY3Quc2lnblRyYW5zYWN0aW9ucyh0eG5zKTtcblxuICAgIC8vZGlzcGxheSB3YWl0IGFuaW1hdGlvblxuICAgIGNvbnN0IGN1cnJlbnRNb2RhbCA9IHNlbmRCdXR0b24uY3VycmVudE1vZGFsO1xuXG4gICAgY3VycmVudE1vZGFsLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuLWNsb3NlXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5IFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9ncmluZGVyLnBuZ1wiIHN0eWxlPVwid2lkdGg6IDEyOHB4OyBoZWlnaHQ6IGF1dG87XCI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlciBtYi0zXCI+XG4gICAgICAgICAgICBTZW5kaW5nIENhZmZlaW5lIENhcmQgdG8gdGhlIEdyaW5kZXIuLi5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICAvL3NlbmQgdHJhbnNhY3Rpb25cbiAgICBsZXQgdHg7XG4gICAgdHJ5IHtcbiAgICAgIHR4ID0gYXdhaXQgdGhpcy5hbGdvZENsaWVudC5zZW5kUmF3VHJhbnNhY3Rpb24oc2lnbmVkVHhucykuZG8oKTtcblxuICAgICAgLy8gV2FpdCBmb3IgY29uZmlybWF0aW9uXG4gICAgICBsZXQgY29uZmlybWVkVHhuID0gYXdhaXQgYWxnb3Nkay53YWl0Rm9yQ29uZmlybWF0aW9uKFxuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50LFxuICAgICAgICB0eC50eElkLFxuICAgICAgICA0XG4gICAgICApO1xuXG4gICAgICBjdXJyZW50TW9kYWwuaW5uZXJIVE1MID0gYFxuICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1kaWFsb2cgbW9kYWwtZGlhbG9nLWNlbnRlcmVkXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4tY2xvc2VcIiBkYXRhLWJzLWRpc21pc3M9XCJtb2RhbFwiIGFyaWEtbGFiZWw9XCJDbG9zZVwiPjwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbWItM1wiPlxuICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2hlYXJ0LWN1cC5wbmdcIiB3aWR0aD1cIjYwXCI+PGJyPjxicj5cbiAgICAgICAgICBXZSBnb3QgeW91ciBjYXJkIGFuZCB5b3VyIGV2b2x1dGlvbiByZXF1ZXN0Ljxicj5cbiAgICAgICAgICBXZSdsbCBiZSBiYWNrIHRvIHlvdSB2ZXJ5IHNvb24uXG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIj5DbG9zZTwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICAgIGN1cnJlbnRNb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiaGlkZGVuLmJzLm1vZGFsXCIsIChldmVudCkgPT4ge1xuICAgICAgICAvL3JlbG9hZCB3aG9sZSBwYWdlIHRvIHVwZGF0ZSBob2xkaW5nc1xuICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY3VycmVudE1vZGFsLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuLWNsb3NlXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtZGFuZ2VyXCIgcm9sZT1cImFsZXJ0XCI+JHtlcnIubWVzc2FnZX0gPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIj5DbG9zZTwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJHcmluZGVyIiwiQmFzZVBhZ2UiLCJjb25zdHJ1Y3RvciIsInN1cGVyIiwiYXJndW1lbnRzIiwidGhpcyIsInVpIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiYmF0aGVyc0NvbGxlY3Rpb24iLCJjYXJkc0NvbGxlY3Rpb24iLCJzZWxlY3RlZEJhdGhlciIsInNlbGVjdGVkQ2FyZHMiLCJtZXJnZWRQcm9wZXJ0aWVzIiwibWVyZ2VkSW1nRGF0YVVSTCIsImNob29zZUNhcmRCdXR0b24iLCJxdWVyeVNlbGVjdG9yIiwibG9hZCIsImFzeW5jIiwibG9hZEJhdGhlcnMiLCJhZGRFdmVudExpc3RlbmVyIiwicmV2aWV3IiwiYmluZCIsInF1ZXJ5U3RyaW5nIiwid2luZG93IiwibG9jYXRpb24iLCJzZWFyY2giLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJoYXMiLCJiYXRoZXJBc3NldElkIiwicGFyc2VJbnQiLCJnZXQiLCJuZnQiLCJuZnRzIiwiZmlsdGVyIiwiYXNzZXRJZCIsImRpc3BsYXlCYXRoZXIiLCJob2xkaW5ncyIsImRyb3Bkb3duRGl2IiwiZHJvcGRvd24iLCJyZW1vdmUiLCJkaWRTZWxlY3RCYXRoZXIiLCJhcHBlbmQiLCJldmVudCIsImNsZWFyQ2FyZCIsIm5mdEluZGV4IiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJpbmRleCIsIm1ldGFkYXRhIiwicHJvcGVydGllcyIsInByZXZlbnREZWZhdWx0Iiwic3JjIiwiaW1hZ2VVcmwiLCJ2YWxpZGF0ZSIsImxvYWRDYXJkcyIsImRpc2FibGVkIiwiaGlkZGVuIiwiY2hpbGRyZW4iLCJBcnJheSIsImZyb20iLCJlbGVtZW50IiwiaWQiLCJjb25zb2xlIiwibG9nIiwiZGlzYWJsZWRBc3NldElkcyIsIm1haW5sb29wIiwicmVxdWlyZSIsInJlcXVpcmVLZXkiLCJwdXNoIiwic2VsZWN0ZWRDYXJkIiwicHJvcGVydHkiLCJkaWRTZWxlY3RDYXJkIiwiYm9vdHN0cmFwIiwiRHJvcGRvd24iLCJkZWZhdWx0Q2FyZCIsIm5ld0NhcmREaXYiLCJjbGFzc05hbWUiLCJyZW1vdmVDYXJkIiwibWFwIiwiYyIsIm5hbWUiLCJsZW5ndGgiLCJyZXZpZXdCdXR0b24iLCJwcmV2aWV3IiwibW9kYWwiLCJ0YWJJbmRleCIsImpvaW4iLCJzZW5kQnV0dG9uIiwiY3VycmVudE1vZGFsIiwic2VuZCIsIk1vZGFsIiwic2hvdyIsInRleHRDb250ZW50IiwibWVyZ2VkSW1nIiwiT2JqZWN0IiwiYXNzaWduIiwia2V5IiwiY2FudmFzIiwidG9EYXRhVVJMIiwic3VnZ2VzdGVkUGFyYW1zIiwiYWxnb2RDbGllbnQiLCJnZXRUcmFuc2FjdGlvblBhcmFtcyIsImRvIiwibm90ZSIsImV2b2x2ZSIsImVuY29kZWROb3RlIiwiVGV4dEVuY29kZXIiLCJlbmNvZGUiLCJKU09OIiwic3RyaW5naWZ5IiwiYWxlcnQiLCJ0eG5zIiwid2FsbGV0Q29ubmVjdCIsIndhbGxldEFkZHJlc3MiLCJ0byIsImNvbGxlY3Rpb25zIiwiYWRkcmVzc2VzIiwiYW1vdW50IiwiYXNzZXRJbmRleCIsInNpZ25lZFR4bnMiLCJzaWduVHJhbnNhY3Rpb25zIiwidHgiLCJzZW5kUmF3VHJhbnNhY3Rpb24iLCJ0eElkIiwicmVsb2FkIiwiZXJyIiwibWVzc2FnZSIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==