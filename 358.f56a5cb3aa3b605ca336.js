"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[358,998],{6998:(t,e,s)=>{s.r(e),s.d(e,{BasePage:()=>a});class a{constructor(t,e,s,a){this.walletConnect=t,this.algodClient=s,this.algoIndexer=a,this.holdings=e}}},2358:(t,e,s)=>{s.r(e),s.d(e,{GrinderQueue:()=>r});var a=s(6998),o=s(5190),n=s(2417);class r extends a.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <button class="button-alt" id="refresh-button">Refresh</button>\n    <table class="table" style="table-layout: fixed; color: var(--white);">\n      <thead>\n        <tr>\n          <th scope="col" style="width:6px">&nbsp;</th>\n          <th scope="col">Txn</th>\n          <th scope="col">Group</th>\n          <th scope="col">Date</th>\n          <th scope="col">Sender</th>\n          <th scope="col">Bather</th>\n          <th scope="col">Card</th>\n          <th scope="col">Status</th>\n        </tr>\n      </thead>\n      <tbody id="table-body">\n      </tbody>\n    </table>\n        ',this.load(),this.ui.querySelector("#refresh-button").addEventListener("click",(()=>{this.load()}),!1)}async load(){const t=o.default.filter((t=>"caffeineCards"===t.name))[0].addresses[0];let e=!1;(n.Z.algodUrl.includes("testnet")||n.Z.algoIndexerUrl.includes("testnet"))&&(e=!0);let s,a=[];do{const e=await this.algoIndexer.searchForTransactions(t).address(t).addressRole("receiver").txType("axfer").currencyGreaterThan(0).nextToken(s).do();for(const t of e.transactions)1===t["asset-transfer-transaction"].amount&&t.note&&atob(t.note).includes('"evolve":')&&a.push(t);s=e["next-token"]}while(s);a.sort(((t,e)=>e["round-time"]-t.roundtime));const r=this.ui.querySelector("#table-body");let l,d;r.textContent="";for(const s of a){const a=JSON.parse(atob(s.note)).evolve,o=s["asset-transfer-transaction"]["asset-id"];let n,c;try{n=await this.algoIndexer.lookupAssetByID(a).do()}catch(t){console.error(t)}try{c=await this.algoIndexer.lookupAssetByID(o).do()}catch(t){console.error(t)}let i="";e&&(i="testnet.");let p="";try{const t=await fetch(`https://api.${i}nf.domains/nfd/address?address=${s.sender}`);if(200===t.status){const e=await t.json();p=`<a href="https://${e[0].name}.xyz" target="_blank">${e[0].name}</a>`}}catch(t){console.error(t)}const u=new Date(1e3*s["round-time"]),{statuses:h,groupId:g}=await this.getStatus(s.id,s.group,a,o,t);let b="";g&&(b=`<br><small><a href="https://${i}algoexplorer.io/tx/group/${encodeURIComponent(g)}" class="link-secondary" target="_blank">Txns group</a></small>`),l?void 0!==s.group&&d!==s.group&&(l="darkgoldenrod"===l?"darkcyan":"darkgoldenrod"):l="darkgoldenrod";const f=document.createElement("tr");f.innerHTML=`\n      <td style="background-color:${s.group?l:"none"};">\n      </td>\n      <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><a href="https://${i}algoexplorer.io/tx/${s.id}" target="_blank">${s.id}</a><br><a href="#" id="btn-${s.id}" style="opacity: 0.5;">copy</a>\n      </td>\n      <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">\n      <a href="https://${i}algoexplorer.io/tx/group/${encodeURIComponent(s.group)}" target="_blank">${s.group}</a>\n      </td>\n      <td>${u.toLocaleString()}</td>\n      <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><a href="https://${i}algoexplorer.io/address/${s.sender}" target="_blank">${s.sender}</a><br>${p}</td>\n      <td><a href="https://www.nftexplorer.app/asset/${a}" target="_blank">${n?n.asset.params.name:"unknown"}</a><br><small class="text-secondary">${a}</small></td>\n      <td><a href="https://www.nftexplorer.app/asset/${o}" target="_blank">${c?c.asset.params.name:"unknown"}</a><br><small class="text-secondary">${o}</small></td>\n      <td>${h.join(" ")}${b}</td>\n      `,r.appendChild(f),f.querySelector(`#btn-${s.id}`).addEventListener("click",(t=>{navigator.clipboard.writeText(s.id),t.preventDefault()}),!1),d=s.group}}async getStatus(t,e,s,a,o){let n,r=[];const l=await this.algoIndexer.lookupAssetTransactions(s).txType("acfg").do();for(const s of l.transactions)if(s.note){const a=JSON.parse(atob(s.note));a&&"update"===a.type&&(a.requestTxn===t||a.group&&a.group===e)&&(r.push('<span class="badge text-bg-success">updated</span>'),n=s.group)}const d=await this.algoIndexer.lookupAssetTransactions(a).txType("axfer").address(o).addressRole("sender").do();for(const s of d.transactions)if(s.note){const a=JSON.parse(atob(s.note));a&&"burn"===a.type&&(a.requestTxn===t||a.group&&a.group===e)&&r.push('<span class="badge text-bg-success">burned</span>')}return 0===r.length&&r.push('<span class="badge text-bg-warning">pending</span>'),{statuses:r,groupId:n}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3hCcEIsT0FBTyxTQUNQRixRQUFRVCxHQUNSVSxZQUFZLFVBQ1pHLEtBRUgsSUFBSyxNQUFNK0QsS0FBZ0JELEVBQXNCckUsYUFDL0MsR0FBSXNFLEVBQWE1RCxLQUFNLENBQ3JCLE1BQU13RCxFQUFXNUMsS0FBS0MsTUFBTVosS0FBSzJELEVBQWE1RCxPQUc1Q3dELEdBQ2tCLFNBQWxCQSxFQUFTQyxPQUNSRCxFQUFTRSxhQUFlUCxHQUN0QkssRUFBU3BCLE9BQVNvQixFQUFTcEIsUUFBVWdCLElBRXhDcEIsRUFBUzdCLEtBQUssb0RBRWxCLENBT0YsT0FKd0IsSUFBcEI2QixFQUFTNkIsUUFDWDdCLEVBQVM3QixLQUFLLHNEQUdULENBQUU2QixXQUFVQyxVQUNyQixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3R1ZGlvLy4vc3JjL3BhZ2VzL2Jhc2UuanMiLCJ3ZWJwYWNrOi8vc3R1ZGlvLy4vc3JjL3BhZ2VzL2dyaW5kZXItcXVldWUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgY2xhc3MgQmFzZVBhZ2Uge1xuXG4gICAgY29uc3RydWN0b3Iod2FsbGV0Q29ubmVjdCwgaG9sZGluZ3MsIGFsZ29kQ2xpZW50LCBhbGdvSW5kZXhlcil7XG5cbiAgICAgICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcbiAgICAgICAgdGhpcy5hbGdvZENsaWVudCA9IGFsZ29kQ2xpZW50O1xuICAgICAgICB0aGlzLmFsZ29JbmRleGVyID0gYWxnb0luZGV4ZXI7XG4gICAgICAgIHRoaXMuaG9sZGluZ3MgPSBob2xkaW5ncztcblxuICAgICAgICBcblxuICAgIH1cblxufSIsImltcG9ydCB7IEJhc2VQYWdlIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IGNvbGxlY3Rpb24gZnJvbSBcIi4uL2NvbGxlY3Rpb25zLmpzXCI7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSBcImN1c3RvbS1zZXR0aW5nc1wiO1xuXG5leHBvcnQgY2xhc3MgR3JpbmRlclF1ZXVlIGV4dGVuZHMgQmFzZVBhZ2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuXG4gICAgdGhpcy51aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy51aS5pbm5lckhUTUwgPSBgXG4gICAgPGJ1dHRvbiBjbGFzcz1cImJ1dHRvbi1hbHRcIiBpZD1cInJlZnJlc2gtYnV0dG9uXCI+UmVmcmVzaDwvYnV0dG9uPlxuICAgIDx0YWJsZSBjbGFzcz1cInRhYmxlXCIgc3R5bGU9XCJ0YWJsZS1sYXlvdXQ6IGZpeGVkOyBjb2xvcjogdmFyKC0td2hpdGUpO1wiPlxuICAgICAgPHRoZWFkPlxuICAgICAgICA8dHI+XG4gICAgICAgICAgPHRoIHNjb3BlPVwiY29sXCIgc3R5bGU9XCJ3aWR0aDo2cHhcIj4mbmJzcDs8L3RoPlxuICAgICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlR4bjwvdGg+XG4gICAgICAgICAgPHRoIHNjb3BlPVwiY29sXCI+R3JvdXA8L3RoPlxuICAgICAgICAgIDx0aCBzY29wZT1cImNvbFwiPkRhdGU8L3RoPlxuICAgICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlNlbmRlcjwvdGg+XG4gICAgICAgICAgPHRoIHNjb3BlPVwiY29sXCI+QmF0aGVyPC90aD5cbiAgICAgICAgICA8dGggc2NvcGU9XCJjb2xcIj5DYXJkPC90aD5cbiAgICAgICAgICA8dGggc2NvcGU9XCJjb2xcIj5TdGF0dXM8L3RoPlxuICAgICAgICA8L3RyPlxuICAgICAgPC90aGVhZD5cbiAgICAgIDx0Ym9keSBpZD1cInRhYmxlLWJvZHlcIj5cbiAgICAgIDwvdGJvZHk+XG4gICAgPC90YWJsZT5cbiAgICAgICAgYDtcblxuICAgIHRoaXMubG9hZCgpO1xuXG4gICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3JlZnJlc2gtYnV0dG9uXCIpLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICBcImNsaWNrXCIsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIHRoaXMubG9hZCgpO1xuICAgICAgfSxcbiAgICAgIGZhbHNlXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGxvYWQoKSB7XG4gICAgY29uc3QgY2FyZENvbGxlY3Rpb25JbmZvID0gY29sbGVjdGlvbi5maWx0ZXIoXG4gICAgICAoYykgPT4gYy5uYW1lID09PSBcImNhZmZlaW5lQ2FyZHNcIlxuICAgICk7XG4gICAgY29uc3QgY2FyZENyZWF0b3JBZGRyZXNzID0gY2FyZENvbGxlY3Rpb25JbmZvWzBdLmFkZHJlc3Nlc1swXTtcblxuICAgIGxldCB0ZXN0bmV0ID0gZmFsc2U7XG5cbiAgICBpZiAoXG4gICAgICBzZXR0aW5ncy5hbGdvZFVybC5pbmNsdWRlcyhcInRlc3RuZXRcIikgfHxcbiAgICAgIHNldHRpbmdzLmFsZ29JbmRleGVyVXJsLmluY2x1ZGVzKFwidGVzdG5ldFwiKVxuICAgICkge1xuICAgICAgdGVzdG5ldCA9IHRydWU7XG4gICAgfVxuXG4gICAgbGV0IHRyYW5zYWN0aW9ucyA9IFtdO1xuXG4gICAgbGV0IG5leHRUb2tlbjtcblxuICAgIGRvIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWxnb0luZGV4ZXJcbiAgICAgICAgLnNlYXJjaEZvclRyYW5zYWN0aW9ucyhjYXJkQ3JlYXRvckFkZHJlc3MpXG4gICAgICAgIC5hZGRyZXNzKGNhcmRDcmVhdG9yQWRkcmVzcylcbiAgICAgICAgLmFkZHJlc3NSb2xlKFwicmVjZWl2ZXJcIilcbiAgICAgICAgLnR4VHlwZShcImF4ZmVyXCIpXG4gICAgICAgIC5jdXJyZW5jeUdyZWF0ZXJUaGFuKDApXG4gICAgICAgIC5uZXh0VG9rZW4obmV4dFRva2VuKVxuICAgICAgICAuZG8oKTtcblxuICAgICAgZm9yIChjb25zdCB0eG4gb2YgcmVzdWx0LnRyYW5zYWN0aW9ucykge1xuICAgICAgICBpZiAodHhuW1wiYXNzZXQtdHJhbnNmZXItdHJhbnNhY3Rpb25cIl0uYW1vdW50ICE9PSAxKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXR4bi5ub3RlKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXRvYih0eG4ubm90ZSkuaW5jbHVkZXMoJ1wiZXZvbHZlXCI6JykpIHtcbiAgICAgICAgICB0cmFuc2FjdGlvbnMucHVzaCh0eG4pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIG5leHRUb2tlbiA9IHJlc3VsdFtcIm5leHQtdG9rZW5cIl07XG4gICAgfSB3aGlsZSAobmV4dFRva2VuKTtcblxuICAgIC8vb3JkZXIgYnkgdGltZSBiYWNrd2FyZFxuICAgIHRyYW5zYWN0aW9ucy5zb3J0KChhLCBiKSA9PiBiW1wicm91bmQtdGltZVwiXSAtIGFbXCJyb3VuZHRpbWVcIl0pO1xuXG4gICAgY29uc3QgdGFibGVCb2R5ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3RhYmxlLWJvZHlcIik7XG4gICAgdGFibGVCb2R5LnRleHRDb250ZW50ID0gXCJcIjtcblxuICAgIGxldCBncm91cENvbG9yO1xuICAgIGxldCBwcmV2R3JvdXA7XG5cbiAgICBmb3IgKGNvbnN0IHR4biBvZiB0cmFuc2FjdGlvbnMpIHtcbiAgICAgIGNvbnN0IG5vdGUgPSBKU09OLnBhcnNlKGF0b2IodHhuLm5vdGUpKTtcbiAgICAgIGNvbnN0IGJhdGhlckFzc2V0SWQgPSBub3RlLmV2b2x2ZTtcbiAgICAgIGNvbnN0IGNhcmRBc3NldElkID0gdHhuW1wiYXNzZXQtdHJhbnNmZXItdHJhbnNhY3Rpb25cIl1bXCJhc3NldC1pZFwiXTtcblxuICAgICAgLy9sb2FkIGFzc2V0cyBkZXRhaWxzXG4gICAgICBsZXQgYmF0aGVyQXNzZXRSZXN1bHQ7XG4gICAgICBsZXQgY2FyZEFzc2V0UmVzdWx0O1xuXG4gICAgICB0cnkge1xuICAgICAgICBiYXRoZXJBc3NldFJlc3VsdCA9IGF3YWl0IHRoaXMuYWxnb0luZGV4ZXJcbiAgICAgICAgICAubG9va3VwQXNzZXRCeUlEKGJhdGhlckFzc2V0SWQpXG4gICAgICAgICAgLmRvKCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBjYXJkQXNzZXRSZXN1bHQgPSBhd2FpdCB0aGlzLmFsZ29JbmRleGVyXG4gICAgICAgICAgLmxvb2t1cEFzc2V0QnlJRChjYXJkQXNzZXRJZClcbiAgICAgICAgICAuZG8oKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9XG5cbiAgICAgIGxldCB0ZXNuZXRTdWJkb21haW4gPSBcIlwiO1xuICAgICAgaWYgKHRlc3RuZXQpIHtcbiAgICAgICAgdGVzbmV0U3ViZG9tYWluID0gXCJ0ZXN0bmV0LlwiO1xuICAgICAgfVxuXG4gICAgICAvL3RyeSB0byBsb2FkIG5mZCBhZGRyZXNzXG4gICAgICAvL2xvb2sgZm9yIGFuIG5mZCBkb21haW4gYWRkcmVzc1xuXG4gICAgICBsZXQgbmZkID0gXCJcIjtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXG4gICAgICAgICAgYGh0dHBzOi8vYXBpLiR7dGVzbmV0U3ViZG9tYWlufW5mLmRvbWFpbnMvbmZkL2FkZHJlc3M/YWRkcmVzcz0ke3R4bi5zZW5kZXJ9YFxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgIGNvbnN0IG5mZFJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgICAgIG5mZCA9IGA8YSBocmVmPVwiaHR0cHM6Ly8ke25mZFJlc3VsdFswXS5uYW1lfS54eXpcIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke25mZFJlc3VsdFswXS5uYW1lfTwvYT5gO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByb3VuZERhdGUgPSBuZXcgRGF0ZSh0eG5bXCJyb3VuZC10aW1lXCJdICogMTAwMCk7XG5cbiAgICAgIGNvbnN0IHsgc3RhdHVzZXMsIGdyb3VwSWQgfSA9IGF3YWl0IHRoaXMuZ2V0U3RhdHVzKFxuICAgICAgICB0eG4uaWQsXG4gICAgICAgIHR4bi5ncm91cCxcbiAgICAgICAgYmF0aGVyQXNzZXRJZCxcbiAgICAgICAgY2FyZEFzc2V0SWQsXG4gICAgICAgIGNhcmRDcmVhdG9yQWRkcmVzc1xuICAgICAgKTtcblxuICAgICAgbGV0IGdyb3VwVHhuTGluayA9IFwiXCI7XG4gICAgICBpZiAoZ3JvdXBJZCkge1xuICAgICAgICBncm91cFR4bkxpbmsgPSBgPGJyPjxzbWFsbD48YSBocmVmPVwiaHR0cHM6Ly8ke3Rlc25ldFN1YmRvbWFpbn1hbGdvZXhwbG9yZXIuaW8vdHgvZ3JvdXAvJHtlbmNvZGVVUklDb21wb25lbnQoXG4gICAgICAgICAgZ3JvdXBJZFxuICAgICAgICApfVwiIGNsYXNzPVwibGluay1zZWNvbmRhcnlcIiB0YXJnZXQ9XCJfYmxhbmtcIj5UeG5zIGdyb3VwPC9hPjwvc21hbGw+YDtcbiAgICAgIH1cblxuICAgICAgLy9ncm91cCBjb2xvclxuICAgICAgaWYgKCFncm91cENvbG9yKXtcbiAgICAgICAgZ3JvdXBDb2xvciA9ICdkYXJrZ29sZGVucm9kJztcbiAgICAgIH0gZWxzZSBpZiAodHhuLmdyb3VwICE9PSB1bmRlZmluZWQgJiYgcHJldkdyb3VwICE9PSB0eG4uZ3JvdXApe1xuICAgICAgICBncm91cENvbG9yID0gZ3JvdXBDb2xvciA9PT0gJ2Rhcmtnb2xkZW5yb2QnID8gJ2RhcmtjeWFuJyA6ICdkYXJrZ29sZGVucm9kJztcbiAgICAgIH0gXG5cbiAgICAgIGNvbnN0IG5ld1RhYmxlUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xuICAgICAgbmV3VGFibGVSb3cuaW5uZXJIVE1MID0gYFxuICAgICAgPHRkIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjoke3R4bi5ncm91cCA/IGdyb3VwQ29sb3IgOiAnbm9uZSd9O1wiPlxuICAgICAgPC90ZD5cbiAgICAgIDx0ZCBzdHlsZT1cIm92ZXJmbG93OiBoaWRkZW47IHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOyB3aGl0ZS1zcGFjZTogbm93cmFwO1wiPjxhIGhyZWY9XCJodHRwczovLyR7dGVzbmV0U3ViZG9tYWlufWFsZ29leHBsb3Jlci5pby90eC8ke1xuICAgICAgICB0eG4uaWRcbiAgICAgIH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj4ke3R4bi5pZH08L2E+PGJyPjxhIGhyZWY9XCIjXCIgaWQ9XCJidG4tJHtcbiAgICAgICAgdHhuLmlkXG4gICAgICB9XCIgc3R5bGU9XCJvcGFjaXR5OiAwLjU7XCI+Y29weTwvYT5cbiAgICAgIDwvdGQ+XG4gICAgICA8dGQgc3R5bGU9XCJvdmVyZmxvdzogaGlkZGVuOyB0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsgd2hpdGUtc3BhY2U6IG5vd3JhcDtcIj5cbiAgICAgIDxhIGhyZWY9XCJodHRwczovLyR7dGVzbmV0U3ViZG9tYWlufWFsZ29leHBsb3Jlci5pby90eC9ncm91cC8ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgICAgdHhuLmdyb3VwXG4gICAgICApfVwiIHRhcmdldD1cIl9ibGFua1wiPiR7dHhuLmdyb3VwfTwvYT5cbiAgICAgIDwvdGQ+XG4gICAgICA8dGQ+JHtyb3VuZERhdGUudG9Mb2NhbGVTdHJpbmcoKX08L3RkPlxuICAgICAgPHRkIHN0eWxlPVwib3ZlcmZsb3c6IGhpZGRlbjsgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7IHdoaXRlLXNwYWNlOiBub3dyYXA7XCI+PGEgaHJlZj1cImh0dHBzOi8vJHt0ZXNuZXRTdWJkb21haW59YWxnb2V4cGxvcmVyLmlvL2FkZHJlc3MvJHtcbiAgICAgICAgdHhuLnNlbmRlclxuICAgICAgfVwiIHRhcmdldD1cIl9ibGFua1wiPiR7dHhuLnNlbmRlcn08L2E+PGJyPiR7bmZkfTwvdGQ+XG4gICAgICA8dGQ+PGEgaHJlZj1cImh0dHBzOi8vd3d3Lm5mdGV4cGxvcmVyLmFwcC9hc3NldC8ke2JhdGhlckFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JHtcbiAgICAgICAgYmF0aGVyQXNzZXRSZXN1bHQgPyBiYXRoZXJBc3NldFJlc3VsdC5hc3NldC5wYXJhbXMubmFtZSA6IFwidW5rbm93blwiXG4gICAgICB9PC9hPjxicj48c21hbGwgY2xhc3M9XCJ0ZXh0LXNlY29uZGFyeVwiPiR7YmF0aGVyQXNzZXRJZH08L3NtYWxsPjwvdGQ+XG4gICAgICA8dGQ+PGEgaHJlZj1cImh0dHBzOi8vd3d3Lm5mdGV4cGxvcmVyLmFwcC9hc3NldC8ke2NhcmRBc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPiR7XG4gICAgICAgIGNhcmRBc3NldFJlc3VsdCA/IGNhcmRBc3NldFJlc3VsdC5hc3NldC5wYXJhbXMubmFtZSA6IFwidW5rbm93blwiXG4gICAgICB9PC9hPjxicj48c21hbGwgY2xhc3M9XCJ0ZXh0LXNlY29uZGFyeVwiPiR7Y2FyZEFzc2V0SWR9PC9zbWFsbD48L3RkPlxuICAgICAgPHRkPiR7c3RhdHVzZXMuam9pbihcIiBcIil9JHtncm91cFR4bkxpbmt9PC90ZD5cbiAgICAgIGA7XG5cbiAgICAgIHRhYmxlQm9keS5hcHBlbmRDaGlsZChuZXdUYWJsZVJvdyk7XG5cbiAgICAgIG5ld1RhYmxlUm93LnF1ZXJ5U2VsZWN0b3IoYCNidG4tJHt0eG4uaWR9YCkuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgXCJjbGlja1wiLFxuICAgICAgICAoZXZlbnQpID0+IHtcbiAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0eG4uaWQpO1xuXG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZmFsc2VcbiAgICAgICk7XG5cbiAgICAgIHByZXZHcm91cCA9IHR4bi5ncm91cDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRTdGF0dXModHhuSWQsIHJlcXVlc3RHcm91cElkLCBiYXRoZXJBc3NldElkLCBjYXJkQXNzZXRJZCwgY2FyZENyZWF0b3JBZGRyZXNzKSB7XG4gICAgbGV0IHN0YXR1c2VzID0gW107XG4gICAgbGV0IGdyb3VwSWQ7XG5cbiAgICAvL2NoZWNrIGlmIGJhdGhlciBhc3NldCBoYXZlIGJlZW4gdXBkYXRlZFxuICAgIGNvbnN0IGJhdGhlckFzc2V0VHJhbnNhY3Rpb25zID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlclxuICAgICAgLmxvb2t1cEFzc2V0VHJhbnNhY3Rpb25zKGJhdGhlckFzc2V0SWQpXG4gICAgICAudHhUeXBlKFwiYWNmZ1wiKVxuICAgICAgLmRvKCk7XG5cbiAgICBmb3IgKGNvbnN0IGNvbmZpZ1R4biBvZiBiYXRoZXJBc3NldFRyYW5zYWN0aW9ucy50cmFuc2FjdGlvbnMpIHtcbiAgICAgIGlmIChjb25maWdUeG4ubm90ZSkge1xuICAgICAgICBjb25zdCBub3RlSnNvbiA9IEpTT04ucGFyc2UoYXRvYihjb25maWdUeG4ubm90ZSkpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBub3RlSnNvbiAmJlxuICAgICAgICAgIG5vdGVKc29uLnR5cGUgPT09IFwidXBkYXRlXCIgJiZcbiAgICAgICAgICAobm90ZUpzb24ucmVxdWVzdFR4biA9PT0gdHhuSWQgfHxcbiAgICAgICAgICAgIChub3RlSnNvbi5ncm91cCAmJiBub3RlSnNvbi5ncm91cCA9PT0gcmVxdWVzdEdyb3VwSWQpKVxuICAgICAgICApIHtcbiAgICAgICAgICBzdGF0dXNlcy5wdXNoKCc8c3BhbiBjbGFzcz1cImJhZGdlIHRleHQtYmctc3VjY2Vzc1wiPnVwZGF0ZWQ8L3NwYW4+Jyk7XG4gICAgICAgICAgZ3JvdXBJZCA9IGNvbmZpZ1R4bi5ncm91cDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vY2hlY2sgaWYgY2FyZCBhc3NldCBoYXZlIGJlZW4gYnVybmVkXG4gICAgY29uc3QgY2FyZEFzc2V0VHJhbnNhY3Rpb25zID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlclxuICAgICAgLmxvb2t1cEFzc2V0VHJhbnNhY3Rpb25zKGNhcmRBc3NldElkKVxuICAgICAgLnR4VHlwZShcImF4ZmVyXCIpXG4gICAgICAuYWRkcmVzcyhjYXJkQ3JlYXRvckFkZHJlc3MpXG4gICAgICAuYWRkcmVzc1JvbGUoXCJzZW5kZXJcIilcbiAgICAgIC5kbygpO1xuXG4gICAgZm9yIChjb25zdCB0cmFuc2ZlcnRUeG4gb2YgY2FyZEFzc2V0VHJhbnNhY3Rpb25zLnRyYW5zYWN0aW9ucykge1xuICAgICAgaWYgKHRyYW5zZmVydFR4bi5ub3RlKSB7XG4gICAgICAgIGNvbnN0IG5vdGVKc29uID0gSlNPTi5wYXJzZShhdG9iKHRyYW5zZmVydFR4bi5ub3RlKSk7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIG5vdGVKc29uICYmXG4gICAgICAgICAgbm90ZUpzb24udHlwZSA9PT0gXCJidXJuXCIgJiZcbiAgICAgICAgICAobm90ZUpzb24ucmVxdWVzdFR4biA9PT0gdHhuSWQgfHxcbiAgICAgICAgICAgIChub3RlSnNvbi5ncm91cCAmJiBub3RlSnNvbi5ncm91cCA9PT0gcmVxdWVzdEdyb3VwSWQpKVxuICAgICAgICApIHtcbiAgICAgICAgICBzdGF0dXNlcy5wdXNoKCc8c3BhbiBjbGFzcz1cImJhZGdlIHRleHQtYmctc3VjY2Vzc1wiPmJ1cm5lZDwvc3Bhbj4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzdGF0dXNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHN0YXR1c2VzLnB1c2goJzxzcGFuIGNsYXNzPVwiYmFkZ2UgdGV4dC1iZy13YXJuaW5nXCI+cGVuZGluZzwvc3Bhbj4nKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBzdGF0dXNlcywgZ3JvdXBJZCB9O1xuICB9XG59XG4iXSwibmFtZXMiOlsiQmFzZVBhZ2UiLCJjb25zdHJ1Y3RvciIsIndhbGxldENvbm5lY3QiLCJob2xkaW5ncyIsImFsZ29kQ2xpZW50IiwiYWxnb0luZGV4ZXIiLCJ0aGlzIiwiR3JpbmRlclF1ZXVlIiwic3VwZXIiLCJhcmd1bWVudHMiLCJ1aSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImxvYWQiLCJxdWVyeVNlbGVjdG9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImFzeW5jIiwiY2FyZENyZWF0b3JBZGRyZXNzIiwiYyIsIm5hbWUiLCJhZGRyZXNzZXMiLCJ0ZXN0bmV0IiwibmV4dFRva2VuIiwidHJhbnNhY3Rpb25zIiwicmVzdWx0Iiwic2VhcmNoRm9yVHJhbnNhY3Rpb25zIiwiYWRkcmVzcyIsImFkZHJlc3NSb2xlIiwidHhUeXBlIiwiY3VycmVuY3lHcmVhdGVyVGhhbiIsImRvIiwidHhuIiwiYW1vdW50Iiwibm90ZSIsImF0b2IiLCJpbmNsdWRlcyIsInB1c2giLCJzb3J0IiwiYSIsImIiLCJ0YWJsZUJvZHkiLCJncm91cENvbG9yIiwicHJldkdyb3VwIiwidGV4dENvbnRlbnQiLCJiYXRoZXJBc3NldElkIiwiSlNPTiIsInBhcnNlIiwiZXZvbHZlIiwiY2FyZEFzc2V0SWQiLCJiYXRoZXJBc3NldFJlc3VsdCIsImNhcmRBc3NldFJlc3VsdCIsImxvb2t1cEFzc2V0QnlJRCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsInRlc25ldFN1YmRvbWFpbiIsIm5mZCIsInJlc3BvbnNlIiwiZmV0Y2giLCJzZW5kZXIiLCJzdGF0dXMiLCJuZmRSZXN1bHQiLCJqc29uIiwicm91bmREYXRlIiwiRGF0ZSIsInN0YXR1c2VzIiwiZ3JvdXBJZCIsImdldFN0YXR1cyIsImlkIiwiZ3JvdXAiLCJncm91cFR4bkxpbmsiLCJlbmNvZGVVUklDb21wb25lbnQiLCJ1bmRlZmluZWQiLCJuZXdUYWJsZVJvdyIsInRvTG9jYWxlU3RyaW5nIiwiYXNzZXQiLCJwYXJhbXMiLCJqb2luIiwiYXBwZW5kQ2hpbGQiLCJldmVudCIsIm5hdmlnYXRvciIsImNsaXBib2FyZCIsIndyaXRlVGV4dCIsInByZXZlbnREZWZhdWx0IiwidHhuSWQiLCJyZXF1ZXN0R3JvdXBJZCIsImJhdGhlckFzc2V0VHJhbnNhY3Rpb25zIiwibG9va3VwQXNzZXRUcmFuc2FjdGlvbnMiLCJjb25maWdUeG4iLCJub3RlSnNvbiIsInR5cGUiLCJyZXF1ZXN0VHhuIiwiY2FyZEFzc2V0VHJhbnNhY3Rpb25zIiwidHJhbnNmZXJ0VHhuIiwibGVuZ3RoIl0sInNvdXJjZVJvb3QiOiIifQ==