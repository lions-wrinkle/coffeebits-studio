"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[538],{6538:(e,t,s)=>{s.r(t),s.d(t,{Grinder:()=>r});var a=s(6998),d=(s(5190),s(7304),s(7644)),n=s(4050),i=s(2871),o=s(4714);class r extends a.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Grinder</h1>\n    <p class="dark-text">Use Caffeine Cards to update your Bathers</p>\n\n    <div class="d-sm-flex flew-row" style="background-color: var(--background-dark);">\n\n        <div class="d-flex flex-column p-3 text-center">\n\n            <img src="assets/default.png" class="mb-2 ms-auto me-auto" id="club-img" style="width: 200px; height: auto">\n\n            <div class="dropdown" id="bath-club-dropdown">\n                <button class="dropdown-toggle button-alt" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false">\n                    Choose Bather\n                </button>\n            </div>\n            <div class="mb-2 mt-4 ms-auto me-auto justify-content-center row row-cols-2" id="cards" style="width: 200px;">\n              <div class="col text-center" id="default-card" style="width: 200px;">\n                <img src="assets/default-card.png" class="img-fluid" style="width: 200px; height: auto;">\n              </div>\n            </div>\n            <div class="dropdown mb-3" id="cards-dropdown">\n                <button class="dropdown-toggle button-alt mb-2" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false" id="choose-card-button" disabled>\n                    Add Card\n                </button>\n            </div>\n            <button id="button-review" disabled>Review...</button>\n\n        </div>\n\n        <div class="d-flex flex-column flex-fill p-3 text-center">\n            <small class="dark-text">preview</small>\n            <img src="assets/default.png" class="w-100 m-auto img-fluid" style="max-width: 480px;" id="merged-img">\n\n        </div>\n\n    </div>',this.bathersCollection,this.cardsCollection,this.selectedBather,this.selectedCards=[],this.mergedProperties={},this.mergedImgDataURL,this.chooseCardButton=this.ui.querySelector("#choose-card-button"),this.load()}async load(){await this.loadBathers(),this.ui.querySelector("#button-review").addEventListener("click",this.review.bind(this));const e=window.location.search,t=new URLSearchParams(e);if(t.has("bather")){const e=parseInt(t.get("bather")),s=this.bathersCollection.nfts.filter((t=>t.assetId===e))?.[0];s&&await this.displayBather(s)}}async loadBathers(){this.bathersCollection=this.holdings.bathers;const e=this.ui.querySelector("#bath-club-dropdown");let t=e.querySelector(".dropdown-menu");t&&t.remove(),t=new i.Z(this.bathersCollection.nfts,this.didSelectBather.bind(this)),e.append(t.ui)}async didSelectBather(e){this.clearCard();const t=e.currentTarget.dataset.index;if(!t)return;const s=this.bathersCollection.nfts[t];this.mergedProperties=s.metadata.properties,await this.displayBather(s),e.preventDefault()}async displayBather(e){this.selectedBather=e,this.ui.querySelector("#club-img").src=e.imageUrl,this.validate(),await this.loadCards(),this.chooseCardButton.disabled=!1}clearCard(){this.selectedCards=[],this.chooseCardButton.disabled=!0,this.mergedProperties={},this.ui.querySelector("#default-card").hidden=!1;const e=Array.from(this.ui.querySelector("#cards").children);for(const t of e)"default-card"!==t.id&&t.remove()}async loadCards(){this.cardsCollection=this.holdings.caffeineCards;const e=this.ui.querySelector("#cards-dropdown");let t=e.querySelector("#cards-dropdown-nft");t&&t.remove();let s=[];e:for(const e of this.cardsCollection.nfts){if(e.metadata.require)for(const t in e.metadata.require)if(this.mergedProperties[t]!=e.metadata.require[t]){s.push(e.assetId);continue e}for(const t of this.selectedCards)for(const a in t.metadata.properties)if(e.metadata.properties[a]){s.push(e.assetId);continue e}}t=new i.Z(this.cardsCollection.nfts,this.didSelectCard.bind(this),"cards-dropdown-nft",s),e.append(t.ui),new window.bootstrap.Dropdown(this.chooseCardButton)}async didSelectCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];this.selectedCards.push(s);const a=this.ui.querySelector("#default-card");a&&(a.hidden=!0);const d=document.createElement("div");d.className="col text-center",d.id=`card-${t}`,d.innerHTML=`\n    <img style="width: 80px; height: auto" src="${s.imageUrl}">\n    <p><a href="javascript:void(0);" id="rm-${t}" data-index="${t}">Remove</a></p>\n    `,d.querySelector(`#rm-${t}`).addEventListener("click",this.removeCard.bind(this),!1),this.ui.querySelector("#cards").append(d),this.validate(),await this.loadCards(),e.preventDefault()}async removeCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];if(console.log(this.selectedCards.map((e=>e.name))),this.selectedCards=this.selectedCards.filter((e=>e.assetId!=s.assetId)),console.log(this.selectedCards.map((e=>e.name))),0===this.selectedCards.length){const e=this.ui.querySelector("#default-card");e&&(e.hidden=!1)}this.validate(),await this.loadCards(),this.ui.querySelector(`#card-${t}`).remove(),e.preventDefault()}validate(){const e=this.ui.querySelector("#button-review");this.selectedBather&&this.selectedCards.length>0?(e.disabled=!1,this.preview()):this.selectedBather?(this.ui.querySelector("#merged-img").src=this.selectedBather.imageUrl,e.disabled=!0):e.disabled=!0}review(e){const t=document.createElement("div");t.className="modal",t.tabIndex="-1",t.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title">Review Bather modification</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div class="text-center mb-3">\n                <img style="width: 320px; height: auto;" id="preview-merged-img">\n            </div>\n\n          <p>\n          Your <strong>${this.selectedBather.name}</strong> will be updated.<br>\n          Your <strong>${this.selectedCards.map((e=>e.name)).join(", ")}</strong> will be burned &#128293;\n          </p>\n            \n          <p>&#128337; As the process requires a manual step, update can take up to 24h.<br>\n          &#128236; You will be notified by a zero Algo transaction when the update is complete.</p>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="button-alt" data-bs-dismiss="modal">Close</button>\n          <button type="button" id="send-button">Send request</button>\n        </div>\n      </div>\n    </div>\n    `,t.querySelector("#preview-merged-img").src=this.mergedImgDataURL;const s=t.querySelector("#send-button");s.currentModal=t,s.addEventListener("click",this.send.bind(this),!1),new window.bootstrap.Modal(t,{}).show()}async preview(){const e=this.ui.querySelector("#button-review");e.disabled=!0,e.textContent="Generating...";const t=this.ui.querySelector("#merged-img");this.mergedProperties=Object.assign({},this.selectedBather.metadata.properties);for(const e of this.selectedCards)for(const t in e.metadata.properties)this.mergedProperties[t]=e.metadata.properties[t];const s=await(0,d.i)(this.mergedProperties,o,"layers_images");this.mergedImgDataURL=s.toDataURL("image/png"),t.src=this.mergedImgDataURL,e.disabled=!1,e.textContent="Review..."}async send(e){const t=e.currentTarget;t.disabled=!0,t.textContent="Waiting for signature...";const s=await this.algodClient.getTransactionParams().do(),a={evolve:this.selectedBather.assetId},d=(new TextEncoder).encode(JSON.stringify(a));if(this.selectedCards.length>13)return void alert("No more than 14 cards can be used at once.");let i=[];for(const e of this.selectedCards)i.push(n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.cardsCollection.collections[0].addresses[0],amount:1,assetIndex:e.assetId,suggestedParams:s,note:d}));i.length>1&&n.assignGroupID(i);const o=await this.walletConnect.signTransactions(i),r=t.currentModal;let l;r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body ">\n            <div class="text-center mb-3">\n                <img src="assets/grinder.png" style="width: 128px; height: auto;">\n            </div>\n            <div class="text-center mb-3">\n            Sending Caffeine Card to the Grinder...\n            </div>\n        </div>\n      </div>\n    </div>\n    ';try{l=await this.algodClient.sendRawTransaction(o).do(),await n.waitForConfirmation(this.algodClient,l.txId,4),r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <img src="assets/heart-cup.png" width="60"><br><br>\n          We got your card and your evolution request.<br>\n          We\'ll be back to you very soon.\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    ',r.addEventListener("hidden.bs.modal",(e=>{location.reload()}))}catch(e){r.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <div class="alert alert-danger" role="alert">${e.message} </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    `,console.error(e)}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFZLEdBQUdDLFVBQVUsR0FDbERDLE9BQVEsRUFDUkMsV0FBWW5ELEVBQWFqQyxRQUN6QmlFLGdCQUFpQkEsRUFDakJJLEtBQU1FLEtBTVJNLEVBQUs5QixPQUFTLEdBQ2hCLGdCQUFzQjhCLEdBR3hCLE1BQU1RLFFBQW1CckgsS0FBSzhHLGNBQWNRLGlCQUFpQlQsR0FHdkR2QixFQUFlRCxFQUFXQyxhQXFCaEMsSUFBSWlDLEVBbkJKakMsRUFBYWxGLFVBQVksb2xCQW9CekIsSUFDRW1ILFFBQVd2SCxLQUFLa0csWUFBWXNCLG1CQUFtQkgsR0FBWWpCLFdBR2xDLHNCQUN2QnBHLEtBQUtrRyxZQUNMcUIsRUFBR0UsS0FDSCxHQUdGbkMsRUFBYWxGLFVBQVkseXFCQW9CekJrRixFQUFhdEUsaUJBQWlCLG1CQUFvQndCLElBRWhEbkIsU0FBU3FHLFFBQVEsR0FzQnJCLENBcEJFLE1BQU9DLEdBQ1ByQyxFQUFhbEYsVUFBWSw2WEFRMEJ1SCxFQUFJQywrTUFVdkRsRCxRQUFRbUQsTUFBTUYsRUFDaEIsQ0FDRixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3R1ZGlvLy4vc3JjL3BhZ2VzL2dyaW5kZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgY29sbGVjdGlvbiBmcm9tIFwiLi4vY29sbGVjdGlvbnMuanNcIjtcbmltcG9ydCB7IE5GVEhvbGRlckNvbGxlY3Rpb24gfSBmcm9tIFwiYWxnby1uZnQtdXRpbHNcIjtcbmltcG9ydCB7IGRyYXcgfSBmcm9tIFwiYmF0aC1jbHViXCI7XG5pbXBvcnQgYWxnb3NkayBmcm9tIFwiYWxnb3Nka1wiO1xuaW1wb3J0IERyb3Bkb3duTmZ0cyBmcm9tIFwiLi4vY29tbW9uL2Ryb3Bkb3duLW5mdHMuanNcIjtcblxuaW1wb3J0IGxheWVycyBmcm9tIFwiLi4vLi4vLi4vYmF0aC1jbHViL2xheWVycy5qc29uXCI7XG5cbmV4cG9ydCBjbGFzcyBHcmluZGVyIGV4dGVuZHMgQmFzZVBhZ2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuXG4gICAgdGhpcy51aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy51aS5pbm5lckhUTUwgPSBgXG4gICAgPGgxPkdyaW5kZXI8L2gxPlxuICAgIDxwIGNsYXNzPVwiZGFyay10ZXh0XCI+VXNlIENhZmZlaW5lIENhcmRzIHRvIHVwZGF0ZSB5b3VyIEJhdGhlcnM8L3A+XG5cbiAgICA8ZGl2IGNsYXNzPVwiZC1zbS1mbGV4IGZsZXctcm93XCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWRhcmspO1wiPlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggZmxleC1jb2x1bW4gcC0zIHRleHQtY2VudGVyXCI+XG5cbiAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2RlZmF1bHQucG5nXCIgY2xhc3M9XCJtYi0yIG1zLWF1dG8gbWUtYXV0b1wiIGlkPVwiY2x1Yi1pbWdcIiBzdHlsZT1cIndpZHRoOiAyMDBweDsgaGVpZ2h0OiBhdXRvXCI+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93blwiIGlkPVwiYmF0aC1jbHViLWRyb3Bkb3duXCI+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImRyb3Bkb3duLXRvZ2dsZSBidXR0b24tYWx0XCIgdHlwZT1cImJ1dHRvblwiIGRhdGEtYnMtdG9nZ2xlPVwiZHJvcGRvd25cIlxuICAgICAgICAgICAgICAgICAgICBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgICAgICAgICAgICAgICAgQ2hvb3NlIEJhdGhlclxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItMiBtdC00IG1zLWF1dG8gbWUtYXV0byBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyIHJvdyByb3ctY29scy0yXCIgaWQ9XCJjYXJkc1wiIHN0eWxlPVwid2lkdGg6IDIwMHB4O1wiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIHRleHQtY2VudGVyXCIgaWQ9XCJkZWZhdWx0LWNhcmRcIiBzdHlsZT1cIndpZHRoOiAyMDBweDtcIj5cbiAgICAgICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9kZWZhdWx0LWNhcmQucG5nXCIgY2xhc3M9XCJpbWctZmx1aWRcIiBzdHlsZT1cIndpZHRoOiAyMDBweDsgaGVpZ2h0OiBhdXRvO1wiPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRyb3Bkb3duIG1iLTNcIiBpZD1cImNhcmRzLWRyb3Bkb3duXCI+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImRyb3Bkb3duLXRvZ2dsZSBidXR0b24tYWx0IG1iLTJcIiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1icy10b2dnbGU9XCJkcm9wZG93blwiXG4gICAgICAgICAgICAgICAgICAgIGFyaWEtZXhwYW5kZWQ9XCJmYWxzZVwiIGlkPVwiY2hvb3NlLWNhcmQtYnV0dG9uXCIgZGlzYWJsZWQ+XG4gICAgICAgICAgICAgICAgICAgIEFkZCBDYXJkXG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxidXR0b24gaWQ9XCJidXR0b24tcmV2aWV3XCIgZGlzYWJsZWQ+UmV2aWV3Li4uPC9idXR0b24+XG5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LWNvbHVtbiBmbGV4LWZpbGwgcC0zIHRleHQtY2VudGVyXCI+XG4gICAgICAgICAgICA8c21hbGwgY2xhc3M9XCJkYXJrLXRleHRcIj5wcmV2aWV3PC9zbWFsbD5cbiAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2RlZmF1bHQucG5nXCIgY2xhc3M9XCJ3LTEwMCBtLWF1dG8gaW1nLWZsdWlkXCIgc3R5bGU9XCJtYXgtd2lkdGg6IDQ4MHB4O1wiIGlkPVwibWVyZ2VkLWltZ1wiPlxuXG4gICAgICAgIDwvZGl2PlxuXG4gICAgPC9kaXY+YDtcblxuICAgIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb247XG4gICAgdGhpcy5jYXJkc0NvbGxlY3Rpb247XG5cbiAgICB0aGlzLnNlbGVjdGVkQmF0aGVyO1xuICAgIHRoaXMuc2VsZWN0ZWRDYXJkcyA9IFtdO1xuICAgIHRoaXMubWVyZ2VkUHJvcGVydGllcyA9IHt9O1xuXG4gICAgdGhpcy5tZXJnZWRJbWdEYXRhVVJMO1xuXG4gICAgdGhpcy5jaG9vc2VDYXJkQnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2Nob29zZS1jYXJkLWJ1dHRvblwiKTtcblxuICAgIHRoaXMubG9hZCgpO1xuICB9XG5cbiAgYXN5bmMgbG9hZCgpIHtcbiAgICBhd2FpdCB0aGlzLmxvYWRCYXRoZXJzKCk7XG5cbiAgICBjb25zdCByZXZpZXdCdXR0b24gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnV0dG9uLXJldmlld1wiKTtcbiAgICByZXZpZXdCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMucmV2aWV3LmJpbmQodGhpcykpO1xuXG4gICAgLy9jb25zdCBzZW5kQnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3NlbmQtYnRuXCIpO1xuICAgIC8vc2VuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5zZW5kLmJpbmQodGhpcykpO1xuXG4gICAgLy9jaGVjayBpZiBhIGJhdGhlciB3YXMgcmVxdWVzdGVkXG4gICAgY29uc3QgcXVlcnlTdHJpbmcgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoO1xuICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocXVlcnlTdHJpbmcpO1xuXG4gICAgaWYgKHVybFBhcmFtcy5oYXMoJ2JhdGhlcicpKXtcblxuICAgICAgY29uc3QgYmF0aGVyQXNzZXRJZCA9IHBhcnNlSW50KHVybFBhcmFtcy5nZXQoJ2JhdGhlcicpKTtcblxuICAgICAgLy9maW5kIGJhdGhlclxuICAgICAgY29uc3QgbmZ0ID0gdGhpcy5iYXRoZXJzQ29sbGVjdGlvbi5uZnRzLmZpbHRlcihuZnQgPT4gbmZ0LmFzc2V0SWQgPT09IGJhdGhlckFzc2V0SWQpPy5bMF07XG5cbiAgICAgIGlmIChuZnQpe1xuICAgICAgICBhd2FpdCB0aGlzLmRpc3BsYXlCYXRoZXIobmZ0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIGFzeW5jIGxvYWRCYXRoZXJzKCkge1xuICAgIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24gPSB0aGlzLmhvbGRpbmdzW1wiYmF0aGVyc1wiXTtcblxuICAgIGNvbnN0IGRyb3Bkb3duRGl2ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2JhdGgtY2x1Yi1kcm9wZG93blwiKTtcblxuICAgIGxldCBkcm9wZG93biA9IGRyb3Bkb3duRGl2LnF1ZXJ5U2VsZWN0b3IoXCIuZHJvcGRvd24tbWVudVwiKTtcbiAgICBpZiAoZHJvcGRvd24pIHtcbiAgICAgIGRyb3Bkb3duLnJlbW92ZSgpO1xuICAgIH1cblxuICAgIGRyb3Bkb3duID0gbmV3IERyb3Bkb3duTmZ0cyhcbiAgICAgIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0cyxcbiAgICAgIHRoaXMuZGlkU2VsZWN0QmF0aGVyLmJpbmQodGhpcylcbiAgICApO1xuICAgIGRyb3Bkb3duRGl2LmFwcGVuZChkcm9wZG93bi51aSk7XG5cbiAgICAvKlxuICAgIGNvbnN0IGJhdGhlcnNEcm9wZG93bkxpc3QgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYmF0aC1jbHViLWRyb3Bkb3duLWxpc3RcIik7XG4gICAgYmF0aGVyc0Ryb3Bkb3duTGlzdC50ZXh0Q29udGVudCA9IFwiXCI7XG5cbiAgICAvL2FkZCBkZWZhdWx0IHZhbHVlXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuICAgIGJhdGhlcnNEcm9wZG93bkxpc3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcblxuICAgIGlmICh0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBvcHRpb24uaW5uZXJIVE1MID0gJzxhIGNsYXNzPVwiZHJvcGRvd24taXRlbSBkaXNhYmxlZFwiPk5vIGJhdGhlcnM8L2E+JztcbiAgICB9XG5cbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChjb25zdCBuZnQgb2YgdGhpcy5iYXRoZXJzQ29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG5cbiAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICAgIGEuY2xhc3NOYW1lID0gJ2Ryb3Bkb3duLWl0ZW0nO1xuICAgICAgYS5ocmVmID0gJyMnO1xuICAgICAgYS5kYXRhc2V0LmluZGV4ID0gaTtcblxuICAgICAgYS5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCIke25mdC5pbWFnZVVybH1cIj4gJHtuZnQubmFtZX1gO1xuXG4gICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kaWRTZWxlY3RCYXRoZXIuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgICBvcHRpb24uYXBwZW5kKGEpO1xuICAgICAgYmF0aGVyc0Ryb3Bkb3duTGlzdC5hcHBlbmQob3B0aW9uKTtcblxuICAgICAgaSsrO1xuICAgIH1cbiAgICAqL1xuICB9XG5cbiAgYXN5bmMgZGlkU2VsZWN0QmF0aGVyKGV2ZW50KSB7XG4gICAgdGhpcy5jbGVhckNhcmQoKTtcblxuICAgIGNvbnN0IG5mdEluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4O1xuXG4gICAgaWYgKCFuZnRJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG5mdCA9IHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0c1tuZnRJbmRleF07XG5cbiAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXMgPSBuZnQubWV0YWRhdGEucHJvcGVydGllcztcbiAgICBcbiAgICBhd2FpdCB0aGlzLmRpc3BsYXlCYXRoZXIobmZ0KTtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBhc3luYyBkaXNwbGF5QmF0aGVyKG5mdCl7XG4gICAgdGhpcy5zZWxlY3RlZEJhdGhlciA9IG5mdDtcblxuICAgIC8vZGlzcGxheSBpbWFnZVxuICAgIGNvbnN0IGJhdGhlckltZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjbHViLWltZ1wiKTtcbiAgICBiYXRoZXJJbWcuc3JjID0gbmZ0LmltYWdlVXJsO1xuXG4gICAgdGhpcy52YWxpZGF0ZSgpO1xuXG4gICAgYXdhaXQgdGhpcy5sb2FkQ2FyZHMoKTtcbiAgICB0aGlzLmNob29zZUNhcmRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGNsZWFyQ2FyZCgpIHtcbiAgICB0aGlzLnNlbGVjdGVkQ2FyZHMgPSBbXTtcbiAgICB0aGlzLmNob29zZUNhcmRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIHRoaXMubWVyZ2VkUHJvcGVydGllcyA9IHt9O1xuXG4gICAgY29uc3QgZGVmYXVsdENhcmQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjZGVmYXVsdC1jYXJkXCIpO1xuICAgIGRlZmF1bHRDYXJkLmhpZGRlbiA9IGZhbHNlO1xuXG4gICAgLy9yZW1vdmUgYWxsIGRpc3BsYXllZCBjYXJkc1xuXG4gICAgY29uc3QgY2hpbGRyZW4gPSBBcnJheS5mcm9tKHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjYXJkc1wiKS5jaGlsZHJlbik7XG5cbiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgY2hpbGRyZW4pe1xuXG4gICAgICBpZiAoZWxlbWVudC5pZCAhPT0gXCJkZWZhdWx0LWNhcmRcIil7XG4gICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICB9XG4gICAgICBcbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2FkQ2FyZHMoKSB7XG4gICAgdGhpcy5jYXJkc0NvbGxlY3Rpb24gPSB0aGlzLmhvbGRpbmdzW1wiY2FmZmVpbmVDYXJkc1wiXTtcblxuICAgIGNvbnN0IGRyb3Bkb3duRGl2ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NhcmRzLWRyb3Bkb3duXCIpO1xuXG4gICAgbGV0IGRyb3Bkb3duID0gZHJvcGRvd25EaXYucXVlcnlTZWxlY3RvcihcIiNjYXJkcy1kcm9wZG93bi1uZnRcIik7XG4gICAgaWYgKGRyb3Bkb3duKSB7XG4gICAgICBkcm9wZG93bi5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBsZXQgZGlzYWJsZWRBc3NldElkcyA9IFtdO1xuICAgIGxldCBpID0gMDtcbiAgICBtYWlubG9vcDogZm9yIChjb25zdCBuZnQgb2YgdGhpcy5jYXJkc0NvbGxlY3Rpb24ubmZ0cykge1xuICAgICAgLy9jaGVjayByZXF1aXJlbWVudFxuICAgICAgaWYgKG5mdC5tZXRhZGF0YS5yZXF1aXJlKSB7XG4gICAgICAgIGZvciAoY29uc3QgcmVxdWlyZUtleSBpbiBuZnQubWV0YWRhdGEucmVxdWlyZSkge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMubWVyZ2VkUHJvcGVydGllc1tyZXF1aXJlS2V5XSAhPVxuICAgICAgICAgICAgbmZ0Lm1ldGFkYXRhLnJlcXVpcmVbcmVxdWlyZUtleV1cbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGRpc2FibGVkQXNzZXRJZHMucHVzaChuZnQuYXNzZXRJZCk7XG4gICAgICAgICAgICBjb250aW51ZSBtYWlubG9vcDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvKmZvciAoY29uc3Qgc2VsZWN0ZWRDYXJkIG9mIHRoaXMuc2VsZWN0ZWRDYXJkcykge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBzZWxlY3RlZENhcmQubWV0YWRhdGEucHJvcGVydGllc1tyZXF1aXJlS2V5XSAhPVxuICAgICAgICAgICAgICBuZnQubWV0YWRhdGEucmVxdWlyZVtyZXF1aXJlS2V5XVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGRpc2FibGVkQXNzZXRJZHMucHVzaChuZnQuYXNzZXRJZCk7XG4gICAgICAgICAgICAgIGNvbnRpbnVlIG1haW5sb29wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0qL1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vcmVtb3ZlIGNhcmRzIGZyb20gdGhlIHNhbWUgdHlwZVxuICAgICAgZm9yIChjb25zdCBzZWxlY3RlZENhcmQgb2YgdGhpcy5zZWxlY3RlZENhcmRzKSB7XG4gICAgICAgIGZvciAoY29uc3QgcHJvcGVydHkgaW4gc2VsZWN0ZWRDYXJkLm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXNbcHJvcGVydHldKSB7XG4gICAgICAgICAgICBkaXNhYmxlZEFzc2V0SWRzLnB1c2gobmZ0LmFzc2V0SWQpO1xuICAgICAgICAgICAgY29udGludWUgbWFpbmxvb3A7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgZHJvcGRvd24gPSBuZXcgRHJvcGRvd25OZnRzKFxuICAgICAgdGhpcy5jYXJkc0NvbGxlY3Rpb24ubmZ0cyxcbiAgICAgIHRoaXMuZGlkU2VsZWN0Q2FyZC5iaW5kKHRoaXMpLFxuICAgICAgXCJjYXJkcy1kcm9wZG93bi1uZnRcIixcbiAgICAgIGRpc2FibGVkQXNzZXRJZHNcbiAgICApO1xuICAgIGRyb3Bkb3duRGl2LmFwcGVuZChkcm9wZG93bi51aSk7XG5cbiAgICBuZXcgd2luZG93LmJvb3RzdHJhcC5Ecm9wZG93bih0aGlzLmNob29zZUNhcmRCdXR0b24pO1xuICB9XG5cbiAgYXN5bmMgZGlkU2VsZWN0Q2FyZChldmVudCkge1xuICAgIGNvbnN0IG5mdEluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4O1xuXG4gICAgaWYgKCFuZnRJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG5mdCA9IHRoaXMuY2FyZHNDb2xsZWN0aW9uLm5mdHNbbmZ0SW5kZXhdO1xuICAgIHRoaXMuc2VsZWN0ZWRDYXJkcy5wdXNoKG5mdCk7XG5cbiAgICAvL3JlbW92ZSBkZWZhdWx0IGNhcmQgaWYgbmVlZGVkXG4gICAgY29uc3QgZGVmYXVsdENhcmQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjZGVmYXVsdC1jYXJkXCIpO1xuXG4gICAgaWYgKGRlZmF1bHRDYXJkKSB7XG4gICAgICBkZWZhdWx0Q2FyZC5oaWRkZW4gPSB0cnVlO1xuICAgIH1cblxuICAgIC8vYWRkIGNhcmRcbiAgICBjb25zdCBuZXdDYXJkRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBuZXdDYXJkRGl2LmNsYXNzTmFtZSA9IFwiY29sIHRleHQtY2VudGVyXCI7XG4gICAgbmV3Q2FyZERpdi5pZCA9IGBjYXJkLSR7bmZ0SW5kZXh9YDtcblxuICAgIG5ld0NhcmREaXYuaW5uZXJIVE1MID0gYFxuICAgIDxpbWcgc3R5bGU9XCJ3aWR0aDogODBweDsgaGVpZ2h0OiBhdXRvXCIgc3JjPVwiJHtuZnQuaW1hZ2VVcmx9XCI+XG4gICAgPHA+PGEgaHJlZj1cImphdmFzY3JpcHQ6dm9pZCgwKTtcIiBpZD1cInJtLSR7bmZ0SW5kZXh9XCIgZGF0YS1pbmRleD1cIiR7bmZ0SW5kZXh9XCI+UmVtb3ZlPC9hPjwvcD5cbiAgICBgO1xuXG4gICAgbmV3Q2FyZERpdlxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoYCNybS0ke25mdEluZGV4fWApXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMucmVtb3ZlQ2FyZC5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NhcmRzXCIpLmFwcGVuZChuZXdDYXJkRGl2KTtcblxuICAgIC8vZGlzcGxheSBpbWFnZVxuICAgIC8vY29uc3QgY2FyZEltZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjYXJkLWltZ1wiKTtcbiAgICAvL2NhcmRJbWcuc3JjID0gbmZ0LmltYWdlVXJsO1xuXG4gICAgdGhpcy52YWxpZGF0ZSgpO1xuXG4gICAgLy9yZWxvYWQgY2FyZHNcbiAgICBhd2FpdCB0aGlzLmxvYWRDYXJkcygpO1xuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuXG4gIGFzeW5jIHJlbW92ZUNhcmQoZXZlbnQpIHtcbiAgICBjb25zdCBuZnRJbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcblxuICAgIGlmICghbmZ0SW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuZnQgPSB0aGlzLmNhcmRzQ29sbGVjdGlvbi5uZnRzW25mdEluZGV4XTtcblxuICAgIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0ZWRDYXJkcy5tYXAoKGMpID0+IGMubmFtZSkpO1xuICAgIHRoaXMuc2VsZWN0ZWRDYXJkcyA9IHRoaXMuc2VsZWN0ZWRDYXJkcy5maWx0ZXIoXG4gICAgICAoYykgPT4gYy5hc3NldElkICE9IG5mdC5hc3NldElkXG4gICAgKTtcbiAgICBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdGVkQ2FyZHMubWFwKChjKSA9PiBjLm5hbWUpKTtcblxuICAgIC8vZGlzcGxheSBkZWZhdWx0IGNhcmQgYWdhaW4gaWYgbmVlZGVkXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRDYXJkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRDYXJkID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2RlZmF1bHQtY2FyZFwiKTtcblxuICAgICAgaWYgKGRlZmF1bHRDYXJkKSB7XG4gICAgICAgIGRlZmF1bHRDYXJkLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMudmFsaWRhdGUoKTtcblxuICAgIC8vcmVsb2FkIGNhcmRzXG4gICAgYXdhaXQgdGhpcy5sb2FkQ2FyZHMoKTtcblxuICAgIHRoaXMudWkucXVlcnlTZWxlY3RvcihgI2NhcmQtJHtuZnRJbmRleH1gKS5yZW1vdmUoKTtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICB2YWxpZGF0ZSgpIHtcbiAgICBjb25zdCByZXZpZXdCdXR0b24gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnV0dG9uLXJldmlld1wiKTtcblxuICAgIGlmICh0aGlzLnNlbGVjdGVkQmF0aGVyICYmIHRoaXMuc2VsZWN0ZWRDYXJkcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXZpZXdCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgICAgdGhpcy5wcmV2aWV3KCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnNlbGVjdGVkQmF0aGVyKSB7XG4gICAgICBjb25zdCBtZXJnZWRJbWcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjbWVyZ2VkLWltZ1wiKTtcbiAgICAgIG1lcmdlZEltZy5zcmMgPSB0aGlzLnNlbGVjdGVkQmF0aGVyLmltYWdlVXJsO1xuXG4gICAgICByZXZpZXdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXZpZXdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldmlldyhldmVudCkge1xuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtb2RhbC5jbGFzc05hbWUgPSBcIm1vZGFsXCI7XG4gICAgbW9kYWwudGFiSW5kZXggPSBcIi0xXCI7XG5cbiAgICBtb2RhbC5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZyBtb2RhbC1kaWFsb2ctY2VudGVyZWRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIj5cbiAgICAgICAgICA8aDUgY2xhc3M9XCJtb2RhbC10aXRsZVwiPlJldmlldyBCYXRoZXIgbW9kaWZpY2F0aW9uPC9oNT5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0bi1jbG9zZVwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCIgYXJpYS1sYWJlbD1cIkNsb3NlXCI+PC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICAgICAgICA8aW1nIHN0eWxlPVwid2lkdGg6IDMyMHB4OyBoZWlnaHQ6IGF1dG87XCIgaWQ9XCJwcmV2aWV3LW1lcmdlZC1pbWdcIj5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPHA+XG4gICAgICAgICAgWW91ciA8c3Ryb25nPiR7dGhpcy5zZWxlY3RlZEJhdGhlci5uYW1lfTwvc3Ryb25nPiB3aWxsIGJlIHVwZGF0ZWQuPGJyPlxuICAgICAgICAgIFlvdXIgPHN0cm9uZz4ke3RoaXMuc2VsZWN0ZWRDYXJkc1xuICAgICAgICAgICAgLm1hcCgoYykgPT4gYy5uYW1lKVxuICAgICAgICAgICAgLmpvaW4oXCIsIFwiKX08L3N0cm9uZz4gd2lsbCBiZSBidXJuZWQgJiMxMjgyOTM7XG4gICAgICAgICAgPC9wPlxuICAgICAgICAgICAgXG4gICAgICAgICAgPHA+JiMxMjgzMzc7IEFzIHRoZSBwcm9jZXNzIHJlcXVpcmVzIGEgbWFudWFsIHN0ZXAsIHVwZGF0ZSBjYW4gdGFrZSB1cCB0byAyNGguPGJyPlxuICAgICAgICAgICYjMTI4MjM2OyBZb3Ugd2lsbCBiZSBub3RpZmllZCBieSBhIHplcm8gQWxnbyB0cmFuc2FjdGlvbiB3aGVuIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnV0dG9uLWFsdFwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCI+Q2xvc2U8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cInNlbmQtYnV0dG9uXCI+U2VuZCByZXF1ZXN0PC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IHByZXZpZXdNZXJnZWRJbWcgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbWVyZ2VkLWltZ1wiKTtcbiAgICBwcmV2aWV3TWVyZ2VkSW1nLnNyYyA9IHRoaXMubWVyZ2VkSW1nRGF0YVVSTDtcblxuICAgIGNvbnN0IHNlbmRCdXR0b24gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3NlbmQtYnV0dG9uXCIpO1xuICAgIHNlbmRCdXR0b24uY3VycmVudE1vZGFsID0gbW9kYWw7XG4gICAgc2VuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5zZW5kLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIGNvbnN0IG15TW9kYWwgPSBuZXcgd2luZG93LmJvb3RzdHJhcC5Nb2RhbChtb2RhbCwge30pO1xuXG4gICAgbXlNb2RhbC5zaG93KCk7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBhc3luYyBwcmV2aWV3KCkge1xuICAgIGNvbnN0IHJldmlld0J1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b24tcmV2aWV3XCIpO1xuICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgcmV2aWV3QnV0dG9uLnRleHRDb250ZW50ID0gXCJHZW5lcmF0aW5nLi4uXCI7XG5cbiAgICBjb25zdCBtZXJnZWRJbWcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjbWVyZ2VkLWltZ1wiKTtcblxuICAgIHRoaXMubWVyZ2VkUHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7fSxcbiAgICAgIHRoaXMuc2VsZWN0ZWRCYXRoZXIubWV0YWRhdGEucHJvcGVydGllc1xuICAgICk7IC8vbWFrZSBhIHNoYWxsb3cgY29weVxuXG4gICAgZm9yIChjb25zdCBzZWxlY3RlZENhcmQgb2YgdGhpcy5zZWxlY3RlZENhcmRzKSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBzZWxlY3RlZENhcmQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXNba2V5XSA9IHNlbGVjdGVkQ2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzW2tleV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9jb25zb2xlLmxvZyhwcm9wZXJ0aWVzKVxuICAgIGNvbnN0IGNhbnZhcyA9IGF3YWl0IGRyYXcodGhpcy5tZXJnZWRQcm9wZXJ0aWVzLCBsYXllcnMsIFwibGF5ZXJzX2ltYWdlc1wiKTtcblxuICAgIHRoaXMubWVyZ2VkSW1nRGF0YVVSTCA9IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIik7XG5cbiAgICBtZXJnZWRJbWcuc3JjID0gdGhpcy5tZXJnZWRJbWdEYXRhVVJMO1xuXG4gICAgcmV2aWV3QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgcmV2aWV3QnV0dG9uLnRleHRDb250ZW50ID0gXCJSZXZpZXcuLi5cIjtcbiAgfVxuXG4gIGFzeW5jIHNlbmQoZXZlbnQpIHtcblxuICAgIGNvbnN0IHNlbmRCdXR0b24gPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgIHNlbmRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIHNlbmRCdXR0b24udGV4dENvbnRlbnQgPSBcIldhaXRpbmcgZm9yIHNpZ25hdHVyZS4uLlwiO1xuXG4gICAgY29uc3Qgc3VnZ2VzdGVkUGFyYW1zID0gYXdhaXQgdGhpcy5hbGdvZENsaWVudC5nZXRUcmFuc2FjdGlvblBhcmFtcygpLmRvKCk7XG5cbiAgICAvL2dlbmVyYXRlIHR4XG5cbiAgICBjb25zdCBub3RlID0ge1xuICAgICAgZXZvbHZlOiB0aGlzLnNlbGVjdGVkQmF0aGVyLmFzc2V0SWQsXG4gICAgfTtcblxuICAgIGNvbnN0IHRleHRFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7XG4gICAgY29uc3QgZW5jb2RlZE5vdGUgPSB0ZXh0RW5jb2Rlci5lbmNvZGUoSlNPTi5zdHJpbmdpZnkobm90ZSkpO1xuXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRDYXJkcy5sZW5ndGggPiAxMykge1xuICAgICAgYWxlcnQoXCJObyBtb3JlIHRoYW4gMTQgY2FyZHMgY2FuIGJlIHVzZWQgYXQgb25jZS5cIik7IC8vMTYgbWludXMgYXNzZXQgY29uZmlnIHR4LCBtaW51cyBub3RpZmljYXRpb24gdHgsIG1pbnUgYXNzZXQgc2VuZFxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCB0eG5zID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGVkQ2FyZCBvZiB0aGlzLnNlbGVjdGVkQ2FyZHMpIHtcbiAgICAgIHR4bnMucHVzaChcbiAgICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgICBmcm9tOiB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcyxcbiAgICAgICAgICB0bzogdGhpcy5jYXJkc0NvbGxlY3Rpb24uY29sbGVjdGlvbnNbMF0uYWRkcmVzc2VzWzBdLFxuICAgICAgICAgIGFtb3VudDogMSxcbiAgICAgICAgICBhc3NldEluZGV4OiBzZWxlY3RlZENhcmQuYXNzZXRJZCxcbiAgICAgICAgICBzdWdnZXN0ZWRQYXJhbXM6IHN1Z2dlc3RlZFBhcmFtcyxcbiAgICAgICAgICBub3RlOiBlbmNvZGVkTm90ZSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy9hc3NpZ24gZ3JvdXBcbiAgICBpZiAodHhucy5sZW5ndGggPiAxKXtcbiAgICAgIGFsZ29zZGsuYXNzaWduR3JvdXBJRCh0eG5zKTtcbiAgICB9XG5cbiAgICBjb25zdCBzaWduZWRUeG5zID0gYXdhaXQgdGhpcy53YWxsZXRDb25uZWN0LnNpZ25UcmFuc2FjdGlvbnModHhucyk7XG5cbiAgICAvL2Rpc3BsYXkgd2FpdCBhbmltYXRpb25cbiAgICBjb25zdCBjdXJyZW50TW9kYWwgPSBzZW5kQnV0dG9uLmN1cnJlbnRNb2RhbDtcblxuICAgIGN1cnJlbnRNb2RhbC5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZyBtb2RhbC1kaWFsb2ctY2VudGVyZWRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0bi1jbG9zZVwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCIgYXJpYS1sYWJlbD1cIkNsb3NlXCI+PC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtYm9keSBcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlciBtYi0zXCI+XG4gICAgICAgICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvZ3JpbmRlci5wbmdcIiBzdHlsZT1cIndpZHRoOiAxMjhweDsgaGVpZ2h0OiBhdXRvO1wiPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbWItM1wiPlxuICAgICAgICAgICAgU2VuZGluZyBDYWZmZWluZSBDYXJkIHRvIHRoZSBHcmluZGVyLi4uXG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgLy9zZW5kIHRyYW5zYWN0aW9uXG4gICAgbGV0IHR4O1xuICAgIHRyeSB7XG4gICAgICB0eCA9IGF3YWl0IHRoaXMuYWxnb2RDbGllbnQuc2VuZFJhd1RyYW5zYWN0aW9uKHNpZ25lZFR4bnMpLmRvKCk7XG5cbiAgICAgIC8vIFdhaXQgZm9yIGNvbmZpcm1hdGlvblxuICAgICAgbGV0IGNvbmZpcm1lZFR4biA9IGF3YWl0IGFsZ29zZGsud2FpdEZvckNvbmZpcm1hdGlvbihcbiAgICAgICAgdGhpcy5hbGdvZENsaWVudCxcbiAgICAgICAgdHgudHhJZCxcbiAgICAgICAgNFxuICAgICAgKTtcblxuICAgICAgY3VycmVudE1vZGFsLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuLWNsb3NlXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9oZWFydC1jdXAucG5nXCIgd2lkdGg9XCI2MFwiPjxicj48YnI+XG4gICAgICAgICAgV2UgZ290IHlvdXIgY2FyZCBhbmQgeW91ciBldm9sdXRpb24gcmVxdWVzdC48YnI+XG4gICAgICAgICAgV2UnbGwgYmUgYmFjayB0byB5b3UgdmVyeSBzb29uLlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCI+Q2xvc2U8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgICBjdXJyZW50TW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImhpZGRlbi5icy5tb2RhbFwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgLy9yZWxvYWQgd2hvbGUgcGFnZSB0byB1cGRhdGUgaG9sZGluZ3NcbiAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGN1cnJlbnRNb2RhbC5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZyBtb2RhbC1kaWFsb2ctY2VudGVyZWRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0bi1jbG9zZVwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCIgYXJpYS1sYWJlbD1cIkNsb3NlXCI+PC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlciBtYi0zXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImFsZXJ0IGFsZXJ0LWRhbmdlclwiIHJvbGU9XCJhbGVydFwiPiR7ZXJyLm1lc3NhZ2V9IDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCI+Q2xvc2U8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiR3JpbmRlciIsIkJhc2VQYWdlIiwiY29uc3RydWN0b3IiLCJzdXBlciIsImFyZ3VtZW50cyIsInRoaXMiLCJ1aSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImJhdGhlcnNDb2xsZWN0aW9uIiwiY2FyZHNDb2xsZWN0aW9uIiwic2VsZWN0ZWRCYXRoZXIiLCJzZWxlY3RlZENhcmRzIiwibWVyZ2VkUHJvcGVydGllcyIsIm1lcmdlZEltZ0RhdGFVUkwiLCJjaG9vc2VDYXJkQnV0dG9uIiwicXVlcnlTZWxlY3RvciIsImxvYWQiLCJhc3luYyIsImxvYWRCYXRoZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJldmlldyIsImJpbmQiLCJxdWVyeVN0cmluZyIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwidXJsUGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwiaGFzIiwiYmF0aGVyQXNzZXRJZCIsInBhcnNlSW50IiwiZ2V0IiwibmZ0IiwibmZ0cyIsImZpbHRlciIsImFzc2V0SWQiLCJkaXNwbGF5QmF0aGVyIiwiaG9sZGluZ3MiLCJkcm9wZG93bkRpdiIsImRyb3Bkb3duIiwicmVtb3ZlIiwiZGlkU2VsZWN0QmF0aGVyIiwiYXBwZW5kIiwiZXZlbnQiLCJjbGVhckNhcmQiLCJuZnRJbmRleCIsImN1cnJlbnRUYXJnZXQiLCJkYXRhc2V0IiwiaW5kZXgiLCJtZXRhZGF0YSIsInByb3BlcnRpZXMiLCJwcmV2ZW50RGVmYXVsdCIsInNyYyIsImltYWdlVXJsIiwidmFsaWRhdGUiLCJsb2FkQ2FyZHMiLCJkaXNhYmxlZCIsImhpZGRlbiIsImNoaWxkcmVuIiwiQXJyYXkiLCJmcm9tIiwiZWxlbWVudCIsImlkIiwiZGlzYWJsZWRBc3NldElkcyIsIm1haW5sb29wIiwicmVxdWlyZSIsInJlcXVpcmVLZXkiLCJwdXNoIiwic2VsZWN0ZWRDYXJkIiwicHJvcGVydHkiLCJkaWRTZWxlY3RDYXJkIiwiYm9vdHN0cmFwIiwiRHJvcGRvd24iLCJkZWZhdWx0Q2FyZCIsIm5ld0NhcmREaXYiLCJjbGFzc05hbWUiLCJyZW1vdmVDYXJkIiwiY29uc29sZSIsImxvZyIsIm1hcCIsImMiLCJuYW1lIiwibGVuZ3RoIiwicmV2aWV3QnV0dG9uIiwicHJldmlldyIsIm1vZGFsIiwidGFiSW5kZXgiLCJqb2luIiwic2VuZEJ1dHRvbiIsImN1cnJlbnRNb2RhbCIsInNlbmQiLCJNb2RhbCIsInNob3ciLCJ0ZXh0Q29udGVudCIsIm1lcmdlZEltZyIsIk9iamVjdCIsImFzc2lnbiIsImtleSIsImNhbnZhcyIsInRvRGF0YVVSTCIsInN1Z2dlc3RlZFBhcmFtcyIsImFsZ29kQ2xpZW50IiwiZ2V0VHJhbnNhY3Rpb25QYXJhbXMiLCJkbyIsIm5vdGUiLCJldm9sdmUiLCJlbmNvZGVkTm90ZSIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwiSlNPTiIsInN0cmluZ2lmeSIsImFsZXJ0IiwidHhucyIsIndhbGxldENvbm5lY3QiLCJ3YWxsZXRBZGRyZXNzIiwidG8iLCJjb2xsZWN0aW9ucyIsImFkZHJlc3NlcyIsImFtb3VudCIsImFzc2V0SW5kZXgiLCJzaWduZWRUeG5zIiwic2lnblRyYW5zYWN0aW9ucyIsInR4Iiwic2VuZFJhd1RyYW5zYWN0aW9uIiwidHhJZCIsInJlbG9hZCIsImVyciIsIm1lc3NhZ2UiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=