"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[271,998,468,298],{6998:(t,e,a)=>{a.r(e),a.d(e,{BasePage:()=>s});class s{constructor(t,e,a,s){this.walletConnect=t,this.algodClient=a,this.algoIndexer=s,this.holdings=e}}},1271:(t,e,a)=>{a.r(e),a.d(e,{Home:()=>r});var s=a(6998),n=a(5298),i=a(5190),o=a(7304);class r extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n        \x3c!--<h1>Welcome to the Studio</h1>--\x3e\n        <div class="text-center">\n        <img src="assets/logo-studio.png" width="160" alt="The Studio" class="mb-4">\n        <p id="info-message"></p>\n        </div>\n        <div class="springboard d-flex flex-column flex-md-row w-100">\n\n            <div class="flex-fill springboard-item springboard-main-item mb-3 me-md-2">\n                <a href="?grinder" class="d-block" style="background-image: url(\'assets/springbord-grinder.png\'); background-color: #d39e27;" data-page-link="grinder">\n                    <h3>Grinder</h3>\n                    <p>Use Caffeine Cards to evolve your Bathers</p>\n                </a>\n            </div>\n\n            <div class="flex-fill d-flex flex-column">\n                <div class="flex-fill springboard-item mb-3 ms-md-2">\n                    <a href="?cards" class="d-block"\n                        style="background-image: url(\'assets/springboard-cards.png\'); background-color: #bb5f00;" data-page-link="cards">\n                        <h3>Caffeine<br>Cards</h3>\n                        <p>Browse all cards</p>\n                    </a>\n                </div>\n                <div class="flex-fill springboard-item mb-3 ms-md-2">\n                    <a href="?good-morning" class="d-block"\n                        style="background-image: url(\'assets/springboard-gm.png\'); background-color: #12c1b1;" data-page-link="good-morning">\n                        <h3>Good Morning!</h3>\n                        <p>Generate GM GIFs featuring your Bathers</p>\n                    </a>\n                </div>\n            </div>\n        </div>\n\n        <h3>Last grinds</h3>\n        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4" id="last-grinds">\n\n        ';try{this.loadPacks()}catch(t){console.error(t)}this.loadLastGrinds()}async loadPacks(){const t=await(0,n.loadPacks)(this.holdings);t&&t.claimablePacks.length>0&&(this.ui.querySelector("#info-message").innerHTML=`<a href="?packs" data-page-link="packs">You have ${t.claimablePacks.length} Caffeine Cards to claim!</a>`,window.enableNavigationLinks())}async loadLastGrinds(){const t=i.Z.filter((t=>"bathers"===t.name))[0].addresses[0],e=await this.algoIndexer.lookupAccountTransactions(t).txType("acfg").limit(48).do();console.log(e);let a=e.transactions;a.sort(((t,e)=>e["round-time"]-t["round-time"]));let s=[];for(const t of a)if("update"===JSON.parse(atob(t.note)).type){const e=t["asset-config-transaction"]["asset-id"];s.push(e)}s=s.filter(((t,e)=>s.indexOf(t)===e)),s=s.slice(0,12);const n=this.ui.querySelector("#last-grinds");let o=new IntersectionObserver(this.loadVisibleNFTs.bind(this),{root:null,rootMargin:"0px",threshold:0});for(const t of s){const e=document.createElement("div");e.className="col",e.dataset.assetId=t,e.innerHTML='\n          <div class="list-item h-100 d-flex flex-column">\n              <div class="ratio ratio-1x1 placeholder-bather">\n                <img class="nft-img img-fluid" loading="lazy" hidden>\n              </div>\n              <div class="list-item-text flex-fill d-flex flex-column">\n                  <h4 class="nft-name">xxx</h4>\n                  <span class="dark-text nft-holder"></span>\n                  <div class="flex-fill d-flex justify-content-end align-items-end mt-2">\n                        <div class="dropdown"></div>\n                  </div>\n              </div>\n          </div>\n      ',n.append(e),o.observe(e)}}sleep(t){return new Promise((e=>setTimeout(e,t)))}loadVisibleNFTs(t,e){t.forEach((async t=>{if(!t.isIntersecting)return;const e=t.target;if(e.dataset.loading)return;const a=e.dataset.assetId;if(!a)return;e.dataset.loading=!0;const s=await this.algoIndexer.lookupAssetByID(a).do();if(s){const t=new o.Sm(a,s.asset);e.querySelector(".nft-name").textContent="#"+t.unitName.substring(4,8),e.querySelector(".dropdown").innerHTML=`\n          <a href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n          <img src="assets/more.png" class="more">\n          </a>\n          <ul class="dropdown-menu">\n              <li><a class="dropdown-item" href="https://www.nftexplorer.app/asset/${t.assetId}" target="_blank">NFTExplorer</a></li>\n              <li><a class="dropdown-item" href="https://www.randgallery.com/algo-collection/?address=${t.assetId}" target="_blank">RandGallery</a></li>\n              <li><a class="dropdown-item" href="https://algoxnft.com/asset/${t.assetId}" target="_blank">ALGOxNFT</a></li>\n          </ul>\n    `,await t.load(this.algoIndexer,!0);const n=e.querySelector(".nft-img");n.src=t.imageUrl,n.hidden=!1,t.handleImageError(n);const i=await this.algoIndexer.lookupAssetBalances(a).do(),r=e.querySelector(".nft-holder");if(i)for(const t of i.balances)if(t.amount>0){r.textContent=t.address.substring(0,12)+"...";try{const e=await fetch(`https://api.nf.domains/nfd/address?address=${t.address}`);if(200===e.status){const t=await e.json();r.textContent=t[0].name}}catch(t){console.error(t)}}}}))}}},5298:(t,e,a)=>{a.r(e),a.d(e,{Packs:()=>c,loadPacks:()=>l});var s=a(6998),n=a(7304),i=a(4050),o=a(4393);const r="https://api.atomixwap.xyz";async function l(t){let e=await fetch(`${r}/caffeine-card-pack/get-all`);if(200===e.status){let a=await e.json();if(t){let e=[];const s=t.bathers.nfts.map((t=>t.assetId));for(const t of a.packs)s.includes(t[0])&&e.push(t);return{claimablePacks:e,escrowAddress:a.escrowAddress}}return a.packs}throw new Error(`Can't load packs. Error ${e.status}`)}class c extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Caffeine Cards Packs</h1>\n    <p id="packs-status" class="dark-text text-center">Loading packs...</p>\n    ',this.claimablePacks,this.escrowAddress,this.fetchPacks()}sleep(t){return new Promise((e=>setTimeout(e,t)))}async fetchPacks(){const t=this.ui.querySelector("#packs-status");try{const e=await l(this.holdings);if(this.claimablePacks=e.claimablePacks,this.escrowAddress=e.escrowAddress,this.claimablePacks.length>0){let e="";this.claimablePacks.length>1&&(e="s"),t.textContent=`${this.claimablePacks.length} pack${e} to claim!`}else t.innerHTML='<img src="assets/pack0-0.png" style="width: 240px; opacity: 0.2;" class="mb-3"><br>\n        No pack to open.<br>\n        Make sure Bathers are not listed on marketplaces to see your packs.<br><br>\n        A Caffeine Card is given for every Bather bought in the <a href="https://instantshuffle.com/shuffle/yUSbzq61ZvqTIsSvLycS" target="_blank">Instant Shuffle.</a>\n        ';const a=document.createElement("div");a.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5 justify-content-center",this.ui.append(a);for(const t of this.claimablePacks){const e=document.createElement("div");e.className="col text-center ps-3 pe-3",a.append(e);const s=document.createElement("canvas");s.className="w-100 mb-0";const n=new d(s,t[1],this.algoIndexer);e.append(s),await n.load().then((()=>{const a=document.createElement("div");a.className="dark-text mt-0 pt-0 mb-2 hidden-pack-name",a.style.opacity="0",a.style["max-height"]="0",a.textContent=n.nft.name,e.append(a);const s=document.createElement("button");s.className="open-pack-button",s.textContent="Open",s.dataset.batherId=t[0],s.dataset.caffeineCardId=t[1],s.addEventListener("click",this.openPack.bind(this,n,a),!1),e.append(s)})).catch((t=>{console.log(t)})),this.sleep(300)}}catch(e){console.error(e),t.textContent=e.message}}disableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button soft-disabled",e.disabled=!0)}))}enableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button",e.disabled=!1)}))}async openPack(t,e,a){const s=a.currentTarget;this.disableAllButtons(s);const n=s.dataset.batherId,o=s.dataset.caffeineCardId;try{s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',s.disabled=!0;let a=await this.algodClient.getTransactionParams().do(),l=[i.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.walletConnect.walletAddress,amount:0,assetIndex:parseInt(o),suggestedParams:a}),i.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.escrowAddress,to:this.walletConnect.walletAddress,amount:1,assetIndex:parseInt(o),suggestedParams:a})];i.assignGroupID(l);const c=await this.walletConnect.signTransactions(l),d={batherId:n,txn:btoa(String.fromCharCode.apply(null,c[0])),suggestedParams:a};s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n      Opening...',s.disabled=!0;const h=await fetch(r+"/caffeine-card-pack/claim/",{method:"POST",body:JSON.stringify(d),headers:{Accept:"application/json","Content-Type":"application/json"}});if(200!==h.status){let t;try{t=await h.json()}catch(t){}throw t&&t.error?new Error(t.error):new Error(`Error ${h.status}`)}s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">\n        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n      </svg>\n        Opened',s.disabled=!0,s.dataset.opened=!0,t.animate(),e.style.opacity="1",e.style["max-height"]="500px",this.enableAllButtons(s)}catch(t){console.error(t),alert(t.message),s.textContent="Open",s.disabled=!1,this.enableAllButtons(s)}}}class d{constructor(t,e,a){this.caffeineCardId=e,this.algoIndexer=a,this.width=660,this.height=960,this.imageWidth=960,this.numAnimationImage=4,this.canvas=t,this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.context.translate(-(this.imageWidth-this.width)/2,0),this.nft,this.cardImage,this.cardMask,this.animationImages}async load(){await this.loadAllImage()}static loadImage(t){return new Promise(((e,a)=>{const s=new Image;s.onload=()=>{e(s)},s.onerror=a,s.src=t}))}async loadAllImage(){this.animationImages=[];const t=this.caffeineCardId%4,e=await d.loadImage(`assets/pack${t}-0.png`);this.animationImages.push(e),this.drawPack(),this.cardMask=await d.loadImage("assets/card-mask.png");const a=await this.algoIndexer.lookupAssetByID(this.caffeineCardId).do();this.nft=new n.Sm(this.caffeineCardId,a.asset),await this.nft.load(this.algoIndexer);try{this.cardImage=await d.loadImage(this.nft.imageUrl)}catch(t){console.log("Error loading image from primary, trying secondary");try{this.cardImage=await d.loadImage(this.nft.imageUrlAlternate)}catch(t){this.cardImage=await d.loadImage("assets/empty-card.png")}}for(let e=1;e<=this.numAnimationImage;e++){const a=await d.loadImage(`assets/pack${t}-${e}.png`);this.animationImages.push(a)}}async drawPack(){this.context.drawImage(this.animationImages[0],0,0,this.imageWidth,this.height)}static easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}async animate(){let t=.15,e=1;const a=setInterval((()=>{if(this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[e],0,0,this.imageWidth,this.height),e===this.numAnimationImage){clearInterval(a),o.sparkles(this.canvas),t=.05;const e=.8;let s=0;const n=setInterval((()=>{const a=d.easeInOutQuad(s/e)*this.height;this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[this.numAnimationImage],0,a,this.imageWidth,this.height),s+=t,s>=e&&clearInterval(n)}),1e3*t)}e++}),1e3*t)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YyxHQUNHLElBQWhCRCxFQUNMLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdHVkaW8vLi9zcmMvcGFnZXMvYmFzZS5qcyIsIndlYnBhY2s6Ly9zdHVkaW8vLi9zcmMvcGFnZXMvaG9tZS5qcyIsIndlYnBhY2s6Ly9zdHVkaW8vLi9zcmMvcGFnZXMvcGFja3MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgY2xhc3MgQmFzZVBhZ2Uge1xuXG4gICAgY29uc3RydWN0b3Iod2FsbGV0Q29ubmVjdCwgaG9sZGluZ3MsIGFsZ29kQ2xpZW50LCBhbGdvSW5kZXhlcil7XG5cbiAgICAgICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcbiAgICAgICAgdGhpcy5hbGdvZENsaWVudCA9IGFsZ29kQ2xpZW50O1xuICAgICAgICB0aGlzLmFsZ29JbmRleGVyID0gYWxnb0luZGV4ZXI7XG4gICAgICAgIHRoaXMuaG9sZGluZ3MgPSBob2xkaW5ncztcblxuICAgICAgICBcblxuICAgIH1cblxufSIsImltcG9ydCB7IEJhc2VQYWdlIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IHsgbG9hZFBhY2tzIH0gZnJvbSBcIi4vcGFja3MuanNcIjtcbmltcG9ydCBjb2xsZWN0aW9uIGZyb20gXCIuLi9jb2xsZWN0aW9ucy5qc1wiO1xuaW1wb3J0IHsgTkZUIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5cbmV4cG9ydCBjbGFzcyBIb21lIGV4dGVuZHMgQmFzZVBhZ2Uge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuXG4gICAgdGhpcy51aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgdGhpcy51aS5pbm5lckhUTUwgPSBgXG4gICAgICAgIDwhLS08aDE+V2VsY29tZSB0byB0aGUgU3R1ZGlvPC9oMT4tLT5cbiAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyXCI+XG4gICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2xvZ28tc3R1ZGlvLnBuZ1wiIHdpZHRoPVwiMTYwXCIgYWx0PVwiVGhlIFN0dWRpb1wiIGNsYXNzPVwibWItNFwiPlxuICAgICAgICA8cCBpZD1cImluZm8tbWVzc2FnZVwiPjwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpbmdib2FyZCBkLWZsZXggZmxleC1jb2x1bW4gZmxleC1tZC1yb3cgdy0xMDBcIj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZsZXgtZmlsbCBzcHJpbmdib2FyZC1pdGVtIHNwcmluZ2JvYXJkLW1haW4taXRlbSBtYi0zIG1lLW1kLTJcIj5cbiAgICAgICAgICAgICAgICA8YSBocmVmPVwiP2dyaW5kZXJcIiBjbGFzcz1cImQtYmxvY2tcIiBzdHlsZT1cImJhY2tncm91bmQtaW1hZ2U6IHVybCgnYXNzZXRzL3NwcmluZ2JvcmQtZ3JpbmRlci5wbmcnKTsgYmFja2dyb3VuZC1jb2xvcjogI2QzOWUyNztcIiBkYXRhLXBhZ2UtbGluaz1cImdyaW5kZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGgzPkdyaW5kZXI8L2gzPlxuICAgICAgICAgICAgICAgICAgICA8cD5Vc2UgQ2FmZmVpbmUgQ2FyZHMgdG8gZXZvbHZlIHlvdXIgQmF0aGVyczwvcD5cbiAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZsZXgtZmlsbCBkLWZsZXggZmxleC1jb2x1bW5cIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIHNwcmluZ2JvYXJkLWl0ZW0gbWItMyBtcy1tZC0yXCI+XG4gICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCI/Y2FyZHNcIiBjbGFzcz1cImQtYmxvY2tcIlxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJ2Fzc2V0cy9zcHJpbmdib2FyZC1jYXJkcy5wbmcnKTsgYmFja2dyb3VuZC1jb2xvcjogI2JiNWYwMDtcIiBkYXRhLXBhZ2UtbGluaz1cImNhcmRzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8aDM+Q2FmZmVpbmU8YnI+Q2FyZHM8L2gzPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHA+QnJvd3NlIGFsbCBjYXJkczwvcD5cbiAgICAgICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4LWZpbGwgc3ByaW5nYm9hcmQtaXRlbSBtYi0zIG1zLW1kLTJcIj5cbiAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cIj9nb29kLW1vcm5pbmdcIiBjbGFzcz1cImQtYmxvY2tcIlxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJ2Fzc2V0cy9zcHJpbmdib2FyZC1nbS5wbmcnKTsgYmFja2dyb3VuZC1jb2xvcjogIzEyYzFiMTtcIiBkYXRhLXBhZ2UtbGluaz1cImdvb2QtbW9ybmluZ1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGgzPkdvb2QgTW9ybmluZyE8L2gzPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHA+R2VuZXJhdGUgR00gR0lGcyBmZWF0dXJpbmcgeW91ciBCYXRoZXJzPC9wPlxuICAgICAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGgzPkxhc3QgZ3JpbmRzPC9oMz5cbiAgICAgICAgPGRpdiBjbGFzcz1cInJvdyByb3ctY29scy0yIHJvdy1jb2xzLW1kLTMgcm93LWNvbHMtbGctNCBneS00XCIgaWQ9XCJsYXN0LWdyaW5kc1wiPlxuXG4gICAgICAgIGA7XG5cbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2FkUGFja3MoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvYWRMYXN0R3JpbmRzKCk7XG4gIH1cblxuICBhc3luYyBsb2FkUGFja3MoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbG9hZFBhY2tzKHRoaXMuaG9sZGluZ3MpO1xuXG4gICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuY2xhaW1hYmxlUGFja3MubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgaW5mb01lc3NhZ2VTcGFuID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2luZm8tbWVzc2FnZVwiKTtcbiAgICAgIGluZm9NZXNzYWdlU3Bhbi5pbm5lckhUTUwgPSBgPGEgaHJlZj1cIj9wYWNrc1wiIGRhdGEtcGFnZS1saW5rPVwicGFja3NcIj5Zb3UgaGF2ZSAke3Jlc3VsdC5jbGFpbWFibGVQYWNrcy5sZW5ndGh9IENhZmZlaW5lIENhcmRzIHRvIGNsYWltITwvYT5gO1xuXG4gICAgICB3aW5kb3cuZW5hYmxlTmF2aWdhdGlvbkxpbmtzKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZExhc3RHcmluZHMoKSB7XG4gICAgY29uc3QgYmF0aGVyc0NvbGxlY3Rpb25JbmZvID0gY29sbGVjdGlvbi5maWx0ZXIoXG4gICAgICAoYykgPT4gYy5uYW1lID09PSBcImJhdGhlcnNcIlxuICAgICk7XG5cbiAgICBjb25zdCBiYXRoZXJzQ3JlYXRvckFkZHJlc3MgPSBiYXRoZXJzQ29sbGVjdGlvbkluZm9bMF0uYWRkcmVzc2VzWzBdO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlclxuICAgICAgLmxvb2t1cEFjY291bnRUcmFuc2FjdGlvbnMoYmF0aGVyc0NyZWF0b3JBZGRyZXNzKVxuICAgICAgLnR4VHlwZShcImFjZmdcIilcbiAgICAgIC5saW1pdCg0OClcbiAgICAgIC5kbygpO1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgICAvL29yZGVyIGJ5IGRhdGVcbiAgICBsZXQgdHJhbnNhY3Rpb25zID0gcmVzdWx0LnRyYW5zYWN0aW9ucztcbiAgICB0cmFuc2FjdGlvbnMuc29ydCgoYSwgYikgPT4gYltcInJvdW5kLXRpbWVcIl0gLSBhW1wicm91bmQtdGltZVwiXSk7XG5cbiAgICBsZXQgYXNzZXRzID0gW107XG5cbiAgICBjb25zdCBtYXhBc3NldHMgPSAxMjtcblxuICAgIGZvciAoY29uc3QgdHggb2YgdHJhbnNhY3Rpb25zKSB7XG4gICAgICBjb25zdCBub3RlID0gSlNPTi5wYXJzZShhdG9iKHR4Lm5vdGUpKTtcblxuICAgICAgaWYgKG5vdGUudHlwZSA9PT0gXCJ1cGRhdGVcIikge1xuICAgICAgICBjb25zdCBhc3NldElkID0gdHhbXCJhc3NldC1jb25maWctdHJhbnNhY3Rpb25cIl1bXCJhc3NldC1pZFwiXTtcblxuICAgICAgICBhc3NldHMucHVzaChhc3NldElkKTtcblxuICAgICAgfVxuICAgIH1cblxuICAgIC8vcmVtb3ZlIGRvdWJsZXNcbiAgICBhc3NldHMgPSBhc3NldHMuZmlsdGVyKChpdGVtLCBpbmRleCkgPT4gYXNzZXRzLmluZGV4T2YoaXRlbSkgPT09IGluZGV4KTtcblxuICAgIC8va2VlcCBvbmx5IHRoZSBkZWZpbmVkIG1heCBhc3NldHNcbiAgICBhc3NldHMgPSBhc3NldHMuc2xpY2UoMCwgbWF4QXNzZXRzKTtcblxuICAgIC8vY3JlYXRlIGh0bWwgZWxlbWVudHNcbiAgICBjb25zdCBsaXN0RGl2ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2xhc3QtZ3JpbmRzXCIpO1xuXG4gICAgLy9sb2FkIG9ubHkgd2hlbiBlbGVtZW50IGlzIHZpc2libGVcbiAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgIHJvb3Q6IG51bGwsIC8vYnJvd3NlciB2aWV3cG9ydFxuICAgICAgcm9vdE1hcmdpbjogXCIwcHhcIixcbiAgICAgIHRocmVzaG9sZDogMC4wLFxuICAgIH07XG5cbiAgICBsZXQgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoXG4gICAgICB0aGlzLmxvYWRWaXNpYmxlTkZUcy5iaW5kKHRoaXMpLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG5cbiAgICBmb3IgKGNvbnN0IGFzc2V0IG9mIGFzc2V0cykge1xuICAgICAgY29uc3QgbmZ0RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIG5mdERpdi5jbGFzc05hbWUgPSBcImNvbFwiO1xuICAgICAgbmZ0RGl2LmRhdGFzZXQuYXNzZXRJZCA9IGFzc2V0O1xuXG4gICAgICBuZnREaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaXN0LWl0ZW0gaC0xMDAgZC1mbGV4IGZsZXgtY29sdW1uXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyYXRpbyByYXRpby0xeDEgcGxhY2Vob2xkZXItYmF0aGVyXCI+XG4gICAgICAgICAgICAgICAgPGltZyBjbGFzcz1cIm5mdC1pbWcgaW1nLWZsdWlkXCIgbG9hZGluZz1cImxhenlcIiBoaWRkZW4+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibGlzdC1pdGVtLXRleHQgZmxleC1maWxsIGQtZmxleCBmbGV4LWNvbHVtblwiPlxuICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzPVwibmZ0LW5hbWVcIj54eHg8L2g0PlxuICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJkYXJrLXRleHQgbmZ0LWhvbGRlclwiPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4LWZpbGwgZC1mbGV4IGp1c3RpZnktY29udGVudC1lbmQgYWxpZ24taXRlbXMtZW5kIG10LTJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93blwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgYDtcblxuICAgICAgbGlzdERpdi5hcHBlbmQobmZ0RGl2KTtcblxuICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShuZnREaXYpO1xuICAgIH1cbiAgfVxuXG4gIHNsZWVwKGRlbGF5VGltZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWxheVRpbWUpKTtcbiAgfVxuXG4gIGxvYWRWaXNpYmxlTkZUcyhlbnRyaWVzLCBvYnNlcnZlcikge1xuICAgIGVudHJpZXMuZm9yRWFjaChhc3luYyAoZW50cnkpID0+IHtcbiAgICAgIGlmICghZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuZnREaXYgPSBlbnRyeS50YXJnZXQ7XG5cbiAgICAgIGlmIChuZnREaXYuZGF0YXNldC5sb2FkaW5nKSB7XG4gICAgICAgIC8vbG9hZGluZyBoYXZlIGFscmVhZHkgc3RhcnRlZFxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFzc2V0SWQgPSBuZnREaXYuZGF0YXNldC5hc3NldElkO1xuXG4gICAgICBpZiAoIWFzc2V0SWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBuZnREaXYuZGF0YXNldC5sb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgLy9sb2FkIG5mdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlci5sb29rdXBBc3NldEJ5SUQoYXNzZXRJZCkuZG8oKTtcblxuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICBjb25zdCBuZnQgPSBuZXcgTkZUKGFzc2V0SWQsIHJlc3VsdC5hc3NldCk7XG5cbiAgICAgICAgbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LW5hbWVcIikudGV4dENvbnRlbnQgPVxuICAgICAgICAgIFwiI1wiICsgbmZ0LnVuaXROYW1lLnN1YnN0cmluZyg0LCA4KTtcblxuICAgICAgICAvL2FkZCBkcm9wZG93biB3aXRoIG9wdGlvbnNcbiAgICAgICAgY29uc3QgZHJvcGRvd25EaXYgPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93blwiKTtcblxuICAgICAgICBkcm9wZG93bkRpdi5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgPGEgaHJlZj1cIiNcIiByb2xlPVwiYnV0dG9uXCIgZGF0YS1icy10b2dnbGU9XCJkcm9wZG93blwiIGFyaWEtZXhwYW5kZWQ9XCJmYWxzZVwiPlxuICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL21vcmUucG5nXCIgY2xhc3M9XCJtb3JlXCI+XG4gICAgICAgICAgPC9hPlxuICAgICAgICAgIDx1bCBjbGFzcz1cImRyb3Bkb3duLW1lbnVcIj5cbiAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL3d3dy5uZnRleHBsb3Jlci5hcHAvYXNzZXQvJHtuZnQuYXNzZXRJZH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj5ORlRFeHBsb3JlcjwvYT48L2xpPlxuICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgaHJlZj1cImh0dHBzOi8vd3d3LnJhbmRnYWxsZXJ5LmNvbS9hbGdvLWNvbGxlY3Rpb24vP2FkZHJlc3M9JHtuZnQuYXNzZXRJZH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj5SYW5kR2FsbGVyeTwvYT48L2xpPlxuICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgaHJlZj1cImh0dHBzOi8vYWxnb3huZnQuY29tL2Fzc2V0LyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+QUxHT3hORlQ8L2E+PC9saT5cbiAgICAgICAgICA8L3VsPlxuICAgIGA7XG5cbiAgICAgICAgYXdhaXQgbmZ0LmxvYWQodGhpcy5hbGdvSW5kZXhlciwgdHJ1ZSk7XG5cbiAgICAgICAgY29uc3QgaW1nID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LWltZ1wiKTtcbiAgICAgICAgaW1nLnNyYyA9IG5mdC5pbWFnZVVybDtcbiAgICAgICAgaW1nLmhpZGRlbiA9IGZhbHNlO1xuXG4gICAgICAgIG5mdC5oYW5kbGVJbWFnZUVycm9yKGltZyk7XG5cbiAgICAgICAgLy9sb2FkIGhvbGRlclxuICAgICAgICBjb25zdCByZXN1bHRIb2xkZXIgPSBhd2FpdCB0aGlzLmFsZ29JbmRleGVyXG4gICAgICAgICAgLmxvb2t1cEFzc2V0QmFsYW5jZXMoYXNzZXRJZClcbiAgICAgICAgICAuZG8oKTtcblxuICAgICAgICBjb25zdCBob2xkZXJTcGFuID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LWhvbGRlclwiKTtcblxuICAgICAgICBpZiAocmVzdWx0SG9sZGVyKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBiYWxhbmNlIG9mIHJlc3VsdEhvbGRlci5iYWxhbmNlcykge1xuICAgICAgICAgICAgaWYgKGJhbGFuY2UuYW1vdW50ID4gMCkge1xuICAgICAgICAgICAgICBob2xkZXJTcGFuLnRleHRDb250ZW50ID0gYmFsYW5jZS5hZGRyZXNzLnN1YnN0cmluZygwLCAxMikgKyBcIi4uLlwiO1xuXG4gICAgICAgICAgICAgIC8vbG9hZCBuZmRcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICAgICAgICAgICAgYGh0dHBzOi8vYXBpLm5mLmRvbWFpbnMvbmZkL2FkZHJlc3M/YWRkcmVzcz0ke2JhbGFuY2UuYWRkcmVzc31gXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgY29uc3QgbmZkUmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAgICAgICAgICAgICBob2xkZXJTcGFuLnRleHRDb250ZW50ID0gbmZkUmVzdWx0WzBdLm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBORlRDb2xsZWN0aW9uIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgYWxnb3NkayBmcm9tIFwiYWxnb3Nka1wiO1xuaW1wb3J0IHsgTkZUIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgcGFydHkgZnJvbSBcInBhcnR5LWpzXCI7XG5cbmNvbnN0IFBBQ0tTX0FQSV9VUkwgPSBcImh0dHBzOi8vYXBpLmF0b21peHdhcC54eXpcIjtcbi8vY29uc3QgUEFDS1NfQVBJX1VSTCA9IFwiaHR0cHM6Ly9sb2NhbGhvc3RcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRQYWNrcyhob2xkaW5ncykge1xuICBsZXQgcmVzdWx0ID0gYXdhaXQgZmV0Y2goYCR7UEFDS1NfQVBJX1VSTH0vY2FmZmVpbmUtY2FyZC1wYWNrL2dldC1hbGxgKTtcblxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgbGV0IGpzb24gPSBhd2FpdCByZXN1bHQuanNvbigpO1xuXG4gICAgXG5cbiAgICBpZiAoaG9sZGluZ3MpIHtcblxuICAgICAgbGV0IGNsYWltYWJsZVBhY2tzID0gW107XG5cbiAgICAgIC8vY29tcGFyZSB3aXRoIGhvbGRpbmdzXG4gICAgICBjb25zdCBiYXRoZXJzSWRzID0gaG9sZGluZ3MuYmF0aGVycy5uZnRzLm1hcCgobmZ0KSA9PiBuZnQuYXNzZXRJZCk7XG5cbiAgICAgIGZvciAoY29uc3QgcGFjayBvZiBqc29uLnBhY2tzKSB7XG4gICAgICAgIGlmIChiYXRoZXJzSWRzLmluY2x1ZGVzKHBhY2tbMF0pKSB7XG4gICAgICAgICAgY2xhaW1hYmxlUGFja3MucHVzaChwYWNrKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjbGFpbWFibGVQYWNrczogY2xhaW1hYmxlUGFja3MsXG4gICAgICAgIGVzY3Jvd0FkZHJlc3M6IGpzb24uZXNjcm93QWRkcmVzcyxcbiAgICAgIH07XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGpzb24ucGFja3M7XG4gICAgfVxuXG4gICAgXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5cXCd0IGxvYWQgcGFja3MuIEVycm9yICR7cmVzdWx0LnN0YXR1c31gKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGFja3MgZXh0ZW5kcyBCYXNlUGFnZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG5cbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICA8aDE+Q2FmZmVpbmUgQ2FyZHMgUGFja3M8L2gxPlxuICAgIDxwIGlkPVwicGFja3Mtc3RhdHVzXCIgY2xhc3M9XCJkYXJrLXRleHQgdGV4dC1jZW50ZXJcIj5Mb2FkaW5nIHBhY2tzLi4uPC9wPlxuICAgIGA7XG5cbiAgICB0aGlzLmNsYWltYWJsZVBhY2tzO1xuICAgIHRoaXMuZXNjcm93QWRkcmVzcztcblxuICAgIHRoaXMuZmV0Y2hQYWNrcygpO1xuICB9XG5cbiAgc2xlZXAoZGVsYXlUaW1lKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5VGltZSkpO1xuICB9XG5cbiAgYXN5bmMgZmV0Y2hQYWNrcygpIHtcbiAgICBjb25zdCBwYWNrU3RhdHVzUCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNwYWNrcy1zdGF0dXNcIik7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbG9hZFBhY2tzKHRoaXMuaG9sZGluZ3MpO1xuXG4gICAgICB0aGlzLmNsYWltYWJsZVBhY2tzID0gcmVzdWx0LmNsYWltYWJsZVBhY2tzO1xuICAgICAgdGhpcy5lc2Nyb3dBZGRyZXNzID0gcmVzdWx0LmVzY3Jvd0FkZHJlc3M7XG5cbiAgICAgIGlmICh0aGlzLmNsYWltYWJsZVBhY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IHBsdXJhbCA9IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLmNsYWltYWJsZVBhY2tzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBwbHVyYWwgPSBcInNcIjtcbiAgICAgICAgfVxuICAgICAgICBwYWNrU3RhdHVzUC50ZXh0Q29udGVudCA9IGAke3RoaXMuY2xhaW1hYmxlUGFja3MubGVuZ3RofSBwYWNrJHtwbHVyYWx9IHRvIGNsYWltIWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYWNrU3RhdHVzUC5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCJhc3NldHMvcGFjazAtMC5wbmdcIiBzdHlsZT1cIndpZHRoOiAyNDBweDsgb3BhY2l0eTogMC4yO1wiIGNsYXNzPVwibWItM1wiPjxicj5cbiAgICAgICAgTm8gcGFjayB0byBvcGVuLjxicj5cbiAgICAgICAgTWFrZSBzdXJlIEJhdGhlcnMgYXJlIG5vdCBsaXN0ZWQgb24gbWFya2V0cGxhY2VzIHRvIHNlZSB5b3VyIHBhY2tzLjxicj48YnI+XG4gICAgICAgIEEgQ2FmZmVpbmUgQ2FyZCBpcyBnaXZlbiBmb3IgZXZlcnkgQmF0aGVyIGJvdWdodCBpbiB0aGUgPGEgaHJlZj1cImh0dHBzOi8vaW5zdGFudHNodWZmbGUuY29tL3NodWZmbGUveVVTYnpxNjFadnFUSXNTdkx5Y1NcIiB0YXJnZXQ9XCJfYmxhbmtcIj5JbnN0YW50IFNodWZmbGUuPC9hPlxuICAgICAgICBgO1xuICAgICAgfVxuXG4gICAgICAvL2Rpc3BsYXkgcGFjayBsaXN0XG4gICAgICBjb25zdCBwYWNrc0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBwYWNrc0Rpdi5jbGFzc05hbWUgPVxuICAgICAgICBcInJvdyByb3ctY29scy0yIHJvdy1jb2xzLW1kLTMgcm93LWNvbHMtbGctNCBneS00IG1iLTUganVzdGlmeS1jb250ZW50LWNlbnRlclwiO1xuICAgICAgdGhpcy51aS5hcHBlbmQocGFja3NEaXYpO1xuXG4gICAgICBmb3IgKGNvbnN0IHBhY2sgb2YgdGhpcy5jbGFpbWFibGVQYWNrcykge1xuICAgICAgICBjb25zdCBwYWNrRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgcGFja0Rpdi5jbGFzc05hbWUgPSBcImNvbCB0ZXh0LWNlbnRlciBwcy0zIHBlLTNcIjtcbiAgICAgICAgcGFja3NEaXYuYXBwZW5kKHBhY2tEaXYpO1xuXG4gICAgICAgIC8qY29uc3QgZ3JhcGhpY0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIGdyYXBoaWNEaXYuY2xhc3NOYW1lID0gJyc7XG4gICAgICAgIGdyYXBoaWNEaXYuaW5uZXJIVE1MID0gYDxpbWcgc3JjPVwiYXNzZXRzL3BhY2swLnBuZ1wiIGNsYXNzPVwidy0xMDAgbWItMlwiPmA7XG4gICAgICAgIHBhY2tEaXYuYXBwZW5kKGdyYXBoaWNEaXYpOyovXG5cbiAgICAgICAgY29uc3QgcGFja0NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgIHBhY2tDYW52YXMuY2xhc3NOYW1lID0gXCJ3LTEwMCBtYi0wXCI7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgUGFja0NhbnZhc0NvbnRyb2xsZXIoXG4gICAgICAgICAgcGFja0NhbnZhcyxcbiAgICAgICAgICBwYWNrWzFdLFxuICAgICAgICAgIHRoaXMuYWxnb0luZGV4ZXJcbiAgICAgICAgKTtcbiAgICAgICAgcGFja0Rpdi5hcHBlbmQocGFja0NhbnZhcyk7XG5cbiAgICAgICAgYXdhaXQgY29udHJvbGxlclxuICAgICAgICAgIC5sb2FkKClcbiAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBoaWRkZW5OYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGhpZGRlbk5hbWUuY2xhc3NOYW1lID0gXCJkYXJrLXRleHQgbXQtMCBwdC0wIG1iLTIgaGlkZGVuLXBhY2stbmFtZVwiO1xuICAgICAgICAgICAgaGlkZGVuTmFtZS5zdHlsZS5vcGFjaXR5ID0gXCIwXCI7XG4gICAgICAgICAgICBoaWRkZW5OYW1lLnN0eWxlW1wibWF4LWhlaWdodFwiXSA9IFwiMFwiO1xuICAgICAgICAgICAgLy9oaWRkZW5OYW1lLmhpZGRlbiA9IHRydWU7XG4gICAgICAgICAgICBoaWRkZW5OYW1lLnRleHRDb250ZW50ID0gY29udHJvbGxlci5uZnQubmFtZTtcbiAgICAgICAgICAgIHBhY2tEaXYuYXBwZW5kKGhpZGRlbk5hbWUpO1xuXG4gICAgICAgICAgICBjb25zdCBvcGVuQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgICAgICAgIG9wZW5CdXR0b24uY2xhc3NOYW1lID0gXCJvcGVuLXBhY2stYnV0dG9uXCI7XG4gICAgICAgICAgICBvcGVuQnV0dG9uLnRleHRDb250ZW50ID0gXCJPcGVuXCI7XG4gICAgICAgICAgICBvcGVuQnV0dG9uLmRhdGFzZXQuYmF0aGVySWQgPSBwYWNrWzBdO1xuICAgICAgICAgICAgb3BlbkJ1dHRvbi5kYXRhc2V0LmNhZmZlaW5lQ2FyZElkID0gcGFja1sxXTtcbiAgICAgICAgICAgIG9wZW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICAgXCJjbGlja1wiLFxuICAgICAgICAgICAgICB0aGlzLm9wZW5QYWNrLmJpbmQodGhpcywgY29udHJvbGxlciwgaGlkZGVuTmFtZSksXG4gICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcGFja0Rpdi5hcHBlbmQob3BlbkJ1dHRvbik7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnNsZWVwKDMwMCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG5cbiAgICAgIHBhY2tTdGF0dXNQLnRleHRDb250ZW50ID0gZXJyLm1lc3NhZ2U7XG4gICAgICAvL2FsZXJ0KGVyci5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICBkaXNhYmxlQWxsQnV0dG9ucyhleGNlcHQpIHtcbiAgICBjb25zdCBidXR0b25zID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKFwiLm9wZW4tcGFjay1idXR0b25cIik7XG5cbiAgICBidXR0b25zLmZvckVhY2goKGIpID0+IHtcbiAgICAgIGlmIChiICE9PSBleGNlcHQgJiYgIWIuZGF0YXNldC5vcGVuZWQpIHtcbiAgICAgICAgYi5jbGFzc05hbWUgPSBcIm9wZW4tcGFjay1idXR0b24gc29mdC1kaXNhYmxlZFwiO1xuICAgICAgICBiLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZUFsbEJ1dHRvbnMoZXhjZXB0KSB7XG4gICAgY29uc3QgYnV0dG9ucyA9IHRoaXMudWkucXVlcnlTZWxlY3RvckFsbChcIi5vcGVuLXBhY2stYnV0dG9uXCIpO1xuXG4gICAgYnV0dG9ucy5mb3JFYWNoKChiKSA9PiB7XG4gICAgICBpZiAoYiAhPT0gZXhjZXB0ICYmICFiLmRhdGFzZXQub3BlbmVkKSB7XG4gICAgICAgIGIuY2xhc3NOYW1lID0gXCJvcGVuLXBhY2stYnV0dG9uXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIG9wZW5QYWNrKHBhY2tDYW52YXNDb250cm9sbGVyLCBoaWRkZW5OYW1lLCBldmVudCkge1xuICAgIGNvbnN0IGNhbGxpbmdCdXR0b24gPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuXG4gICAgdGhpcy5kaXNhYmxlQWxsQnV0dG9ucyhjYWxsaW5nQnV0dG9uKTtcblxuICAgIGNvbnN0IGJhdGhlcklkID0gY2FsbGluZ0J1dHRvbi5kYXRhc2V0LmJhdGhlcklkO1xuICAgIGNvbnN0IGNhZmZlaW5lQ2FyZElkID0gY2FsbGluZ0J1dHRvbi5kYXRhc2V0LmNhZmZlaW5lQ2FyZElkO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNhbGxpbmdCdXR0b24uaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIiByb2xlPVwic3RhdHVzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9zcGFuPmA7XG4gICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgbGV0IHN1Z2dlc3RlZFBhcmFtcyA9IGF3YWl0IHRoaXMuYWxnb2RDbGllbnQuZ2V0VHJhbnNhY3Rpb25QYXJhbXMoKS5kbygpO1xuXG4gICAgICAvL3ByZXBhcmUgb3B0aW4gdHhuXG4gICAgICBsZXQgb3B0aW5UeG4gPSBhbGdvc2RrLm1ha2VBc3NldFRyYW5zZmVyVHhuV2l0aFN1Z2dlc3RlZFBhcmFtc0Zyb21PYmplY3Qoe1xuICAgICAgICBmcm9tOiB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcyxcbiAgICAgICAgdG86IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICBhbW91bnQ6IDAsXG4gICAgICAgIGFzc2V0SW5kZXg6IHBhcnNlSW50KGNhZmZlaW5lQ2FyZElkKSxcbiAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXMsXG4gICAgICB9KTtcblxuICAgICAgLy9wcmVwYXJlIHRyYW5zZmVyIHR4blxuICAgICAgbGV0IHRyYW5zZmVyVHhuID1cbiAgICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgICBmcm9tOiB0aGlzLmVzY3Jvd0FkZHJlc3MsXG4gICAgICAgICAgdG86IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICAgIGFtb3VudDogMSxcbiAgICAgICAgICBhc3NldEluZGV4OiBwYXJzZUludChjYWZmZWluZUNhcmRJZCksXG4gICAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXMsXG4gICAgICAgIH0pO1xuXG4gICAgICBsZXQgYWxsVHhucyA9IFtvcHRpblR4biwgdHJhbnNmZXJUeG5dO1xuICAgICAgYWxnb3Nkay5hc3NpZ25Hcm91cElEKGFsbFR4bnMpO1xuXG4gICAgICBjb25zdCBzaWduZWRUeG5zID0gYXdhaXQgdGhpcy53YWxsZXRDb25uZWN0LnNpZ25UcmFuc2FjdGlvbnMoYWxsVHhucyk7XG5cbiAgICAgIGNvbnN0IHNpZ25lZFR4bkpzb24gPSB7XG4gICAgICAgIGJhdGhlcklkOiBiYXRoZXJJZCxcbiAgICAgICAgdHhuOiBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgc2lnbmVkVHhuc1swXSkpLFxuICAgICAgICBzdWdnZXN0ZWRQYXJhbXM6IHN1Z2dlc3RlZFBhcmFtcyxcbiAgICAgIH07XG5cbiAgICAgIGNhbGxpbmdCdXR0b24uaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIiByb2xlPVwic3RhdHVzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9zcGFuPlxuICAgICAgT3BlbmluZy4uLmA7XG4gICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgLy9jYWxsIGFwaVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgUEFDS1NfQVBJX1VSTCArIFwiL2NhZmZlaW5lLWNhcmQtcGFjay9jbGFpbS9cIixcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc2lnbmVkVHhuSnNvbiksXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAvL2NvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgd2lkdGg9XCIyNFwiIGhlaWdodD1cIjI0XCIgZmlsbD1cImN1cnJlbnRDb2xvclwiIGNsYXNzPVwiYmkgYmktY2hlY2stY2lyY2xlLWZpbGxcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCI+XG4gICAgICAgIDxwYXRoIGQ9XCJNMTYgOEE4IDggMCAxIDEgMCA4YTggOCAwIDAgMSAxNiAwem0tMy45Ny0zLjAzYS43NS43NSAwIDAgMC0xLjA4LjAyMkw3LjQ3NyA5LjQxNyA1LjM4NCA3LjMyM2EuNzUuNzUgMCAwIDAtMS4wNiAxLjA2TDYuOTcgMTEuMDNhLjc1Ljc1IDAgMCAwIDEuMDc5LS4wMmwzLjk5Mi00Ljk5YS43NS43NSAwIDAgMC0uMDEtMS4wNXpcIi8+XG4gICAgICA8L3N2Zz5cbiAgICAgICAgT3BlbmVkYDtcbiAgICAgICAgY2FsbGluZ0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGNhbGxpbmdCdXR0b24uZGF0YXNldC5vcGVuZWQgPSB0cnVlO1xuXG4gICAgICAgIC8vYW5pbWF0ZSBwYWNrIG9wZW5pbmdcbiAgICAgICAgcGFja0NhbnZhc0NvbnRyb2xsZXIuYW5pbWF0ZSgpO1xuXG4gICAgICAgIGhpZGRlbk5hbWUuc3R5bGUub3BhY2l0eSA9IFwiMVwiO1xuICAgICAgICBoaWRkZW5OYW1lLnN0eWxlW1wibWF4LWhlaWdodFwiXSA9IFwiNTAwcHhcIjtcblxuICAgICAgICB0aGlzLmVuYWJsZUFsbEJ1dHRvbnMoY2FsbGluZ0J1dHRvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgZGF0YTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge31cblxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIGFsZXJ0KGVyci5tZXNzYWdlKTtcblxuICAgICAgY2FsbGluZ0J1dHRvbi50ZXh0Q29udGVudCA9IFwiT3BlblwiO1xuICAgICAgY2FsbGluZ0J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICB0aGlzLmVuYWJsZUFsbEJ1dHRvbnMoY2FsbGluZ0J1dHRvbik7XG4gICAgfVxuICB9XG59XG5cbmNsYXNzIFBhY2tDYW52YXNDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoY2FudmFzLCBjYWZmZWluZUNhcmRJZCwgYWxnb0luZGV4ZXIpIHtcbiAgICB0aGlzLmNhZmZlaW5lQ2FyZElkID0gY2FmZmVpbmVDYXJkSWQ7XG4gICAgdGhpcy5hbGdvSW5kZXhlciA9IGFsZ29JbmRleGVyO1xuXG4gICAgdGhpcy53aWR0aCA9IDY2MDtcbiAgICB0aGlzLmhlaWdodCA9IDk2MDtcbiAgICB0aGlzLmltYWdlV2lkdGggPSA5NjA7XG5cbiAgICB0aGlzLm51bUFuaW1hdGlvbkltYWdlID0gNDtcblxuICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcblxuICAgIHRoaXMuY29udGV4dCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICB0aGlzLmNvbnRleHQuaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XG5cbiAgICAvL3RoaXMuY29udGV4dC5maWxsU3R5bGUgPSAncmVkJztcbiAgICAvL3RoaXMuY29udGV4dC5maWxsUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICB0aGlzLmNvbnRleHQudHJhbnNsYXRlKC0odGhpcy5pbWFnZVdpZHRoIC0gdGhpcy53aWR0aCkgLyAyLCAwKTtcblxuICAgIC8vbG9hZCBhbmltYXRpb24gaW1hZ2VzXG4gICAgLy9sb2FkIGNhZmZlaW5lIGNhcmQgaW1hZ2VcblxuICAgIHRoaXMubmZ0O1xuXG4gICAgdGhpcy5jYXJkSW1hZ2U7XG4gICAgdGhpcy5jYXJkTWFzaztcbiAgICB0aGlzLmFuaW1hdGlvbkltYWdlcztcbiAgfVxuXG4gIGFzeW5jIGxvYWQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkQWxsSW1hZ2UoKTtcbiAgfVxuXG4gIHN0YXRpYyBsb2FkSW1hZ2UocGF0aCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuXG4gICAgICAvL2ltYWdlLmNyb3NzT3JpZ2luID0gJ0Fub255bW91cyc7XG5cbiAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgcmVzb2x2ZShpbWFnZSk7XG4gICAgICB9O1xuXG4gICAgICBpbWFnZS5vbmVycm9yID0gcmVqZWN0O1xuXG4gICAgICBpbWFnZS5zcmMgPSBwYXRoO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgbG9hZEFsbEltYWdlKCkge1xuICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzID0gW107XG5cbiAgICAvL2Nob29zZSBhIGNvbG9yIHJhbmRvbWx5IGRlcGVuZGluZyBvbiBjYXJkIGFzc2V0IGlkXG4gICAgY29uc3QgY29sb3JJbmRleCA9IHRoaXMuY2FmZmVpbmVDYXJkSWQgJSA0O1xuICAgIC8vY29uc3QgY29sb3JJbmRleCA9IDA7XG5cbiAgICAvL2xvYWQgZmlyc3QgaW1hZ2UgYW5kIGRpc3BsYXkgaXQgYXMgc29vbiBhcyBwb3NzaWJsZVxuICAgIGNvbnN0IGluaXRpYWxJbWFnZSA9IGF3YWl0IFBhY2tDYW52YXNDb250cm9sbGVyLmxvYWRJbWFnZShcbiAgICAgIGBhc3NldHMvcGFjayR7Y29sb3JJbmRleH0tMC5wbmdgXG4gICAgKTtcbiAgICB0aGlzLmFuaW1hdGlvbkltYWdlcy5wdXNoKGluaXRpYWxJbWFnZSk7XG4gICAgdGhpcy5kcmF3UGFjaygpO1xuXG4gICAgLy9sb2FkIG1hc2tcbiAgICB0aGlzLmNhcmRNYXNrID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKFxuICAgICAgYGFzc2V0cy9jYXJkLW1hc2sucG5nYFxuICAgICk7XG5cbiAgICAvL2xvYWQgbmZ0IGltYWdlXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlclxuICAgICAgLmxvb2t1cEFzc2V0QnlJRCh0aGlzLmNhZmZlaW5lQ2FyZElkKVxuICAgICAgLmRvKCk7XG4gICAgdGhpcy5uZnQgPSBuZXcgTkZUKHRoaXMuY2FmZmVpbmVDYXJkSWQsIHJlc3VsdFtcImFzc2V0XCJdKTtcbiAgICBhd2FpdCB0aGlzLm5mdC5sb2FkKHRoaXMuYWxnb0luZGV4ZXIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuY2FyZEltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKHRoaXMubmZ0LmltYWdlVXJsKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBFcnJvciBsb2FkaW5nIGltYWdlIGZyb20gcHJpbWFyeSwgdHJ5aW5nIHNlY29uZGFyeWApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoXG4gICAgICAgICAgdGhpcy5uZnQuaW1hZ2VVcmxBbHRlcm5hdGVcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0aGlzLmNhcmRJbWFnZSA9IGF3YWl0IFBhY2tDYW52YXNDb250cm9sbGVyLmxvYWRJbWFnZShcbiAgICAgICAgICBcImFzc2V0cy9lbXB0eS1jYXJkLnBuZ1wiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9sb2FkIGFuaW1hdGlvbiBpbWFnZXNcblxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHRoaXMubnVtQW5pbWF0aW9uSW1hZ2U7IGkrKykge1xuICAgICAgY29uc3QgYW5pbWF0aW9uSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoXG4gICAgICAgIGBhc3NldHMvcGFjayR7Y29sb3JJbmRleH0tJHtpfS5wbmdgXG4gICAgICApO1xuICAgICAgdGhpcy5hbmltYXRpb25JbWFnZXMucHVzaChhbmltYXRpb25JbWFnZSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZHJhd1BhY2soKSB7XG4gICAgLy9sb2FkIGltYWdlXG4gICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShcbiAgICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzWzBdLFxuICAgICAgMCxcbiAgICAgIDAsXG4gICAgICB0aGlzLmltYWdlV2lkdGgsXG4gICAgICB0aGlzLmhlaWdodFxuICAgICk7XG4gIH1cblxuICBzdGF0aWMgZWFzZUluT3V0UXVhZCh4KSB7XG4gICAgcmV0dXJuIHggPCAwLjUgPyAyICogeCAqIHggOiAxIC0gTWF0aC5wb3coLTIgKiB4ICsgMiwgMikgLyAyO1xuICB9XG5cbiAgYXN5bmMgYW5pbWF0ZSgpIHtcbiAgICBsZXQgZnJhbWVEdXJhdGlvbiA9IDAuMTU7XG5cbiAgICBsZXQgY3VycmVudEZyYW1lID0gMTtcblxuICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAvL2NsZWFyIGNvbnRleHRcbiAgICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgIC8vZHJhdyBtYXNrXG4gICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuY2FyZE1hc2ssIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICB0aGlzLmNvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2UtaW5cIjtcblxuICAgICAgLy9kcmF3IGNhcmRcbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UoXG4gICAgICAgIHRoaXMuY2FyZEltYWdlLFxuICAgICAgICAwLFxuICAgICAgICAwLFxuICAgICAgICB0aGlzLmltYWdlV2lkdGgsXG4gICAgICAgIHRoaXMuaGVpZ2h0XG4gICAgICApO1xuXG4gICAgICB0aGlzLmNvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xuXG4gICAgICAvL2RyYXcgcGFjayBhbmltYXRpb25cbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UoXG4gICAgICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzW2N1cnJlbnRGcmFtZV0sXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIHRoaXMuaW1hZ2VXaWR0aCxcbiAgICAgICAgdGhpcy5oZWlnaHRcbiAgICAgICk7XG5cbiAgICAgIGlmIChjdXJyZW50RnJhbWUgPT09IHRoaXMubnVtQW5pbWF0aW9uSW1hZ2UpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcblxuICAgICAgICBwYXJ0eS5zcGFya2xlcyh0aGlzLmNhbnZhcyk7XG5cbiAgICAgICAgLy9zdGFydCBzbGlkZSBhbmltYXRpb25cbiAgICAgICAgZnJhbWVEdXJhdGlvbiA9IDAuMDU7XG4gICAgICAgIGNvbnN0IGFuaW1hdGlvbkR1cmF0aW9uID0gMC44O1xuICAgICAgICBsZXQgY3VycmVudFRpbWUgPSAwO1xuXG4gICAgICAgIGNvbnN0IGludGVydmFsSWQyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHlPZmZzZXQgPVxuICAgICAgICAgICAgUGFja0NhbnZhc0NvbnRyb2xsZXIuZWFzZUluT3V0UXVhZChcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgLyBhbmltYXRpb25EdXJhdGlvblxuICAgICAgICAgICAgKSAqIHRoaXMuaGVpZ2h0O1xuXG4gICAgICAgICAgLy9jbGVhciBjb250ZXh0XG4gICAgICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgICAgIC8vZHJhdyBtYXNrXG4gICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShcbiAgICAgICAgICAgIHRoaXMuY2FyZE1hc2ssXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgMCxcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VXaWR0aCxcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1pblwiO1xuXG4gICAgICAgICAgLy9kcmF3IGNhcmRcbiAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICAgICAgdGhpcy5jYXJkSW1hZ2UsXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgMCxcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VXaWR0aCxcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1vdmVyXCI7XG5cbiAgICAgICAgICAvL2RyYXcgcGFjayBhbmltYXRpb25cbiAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICAgICAgdGhpcy5hbmltYXRpb25JbWFnZXNbdGhpcy5udW1BbmltYXRpb25JbWFnZV0sXG4gICAgICAgICAgICAwLFxuICAgICAgICAgICAgeU9mZnNldCxcbiAgICAgICAgICAgIHRoaXMuaW1hZ2VXaWR0aCxcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGN1cnJlbnRUaW1lICs9IGZyYW1lRHVyYXRpb247XG5cbiAgICAgICAgICBpZiAoY3VycmVudFRpbWUgPj0gYW5pbWF0aW9uRHVyYXRpb24pIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZDIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZnJhbWVEdXJhdGlvbiAqIDEwMDApO1xuICAgICAgfVxuXG4gICAgICBjdXJyZW50RnJhbWUrKztcbiAgICB9LCBmcmFtZUR1cmF0aW9uICogMTAwMCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJCYXNlUGFnZSIsImNvbnN0cnVjdG9yIiwid2FsbGV0Q29ubmVjdCIsImhvbGRpbmdzIiwiYWxnb2RDbGllbnQiLCJhbGdvSW5kZXhlciIsInRoaXMiLCJIb21lIiwic3VwZXIiLCJhcmd1bWVudHMiLCJ1aSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImxvYWRQYWNrcyIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImxvYWRMYXN0R3JpbmRzIiwiYXN5bmMiLCJyZXN1bHQiLCJjbGFpbWFibGVQYWNrcyIsImxlbmd0aCIsInF1ZXJ5U2VsZWN0b3IiLCJ3aW5kb3ciLCJlbmFibGVOYXZpZ2F0aW9uTGlua3MiLCJiYXRoZXJzQ3JlYXRvckFkZHJlc3MiLCJjIiwibmFtZSIsImFkZHJlc3NlcyIsImxvb2t1cEFjY291bnRUcmFuc2FjdGlvbnMiLCJ0eFR5cGUiLCJsaW1pdCIsImRvIiwibG9nIiwidHJhbnNhY3Rpb25zIiwic29ydCIsImEiLCJiIiwiYXNzZXRzIiwidHgiLCJKU09OIiwicGFyc2UiLCJhdG9iIiwibm90ZSIsInR5cGUiLCJhc3NldElkIiwicHVzaCIsImZpbHRlciIsIml0ZW0iLCJpbmRleCIsImluZGV4T2YiLCJzbGljZSIsImxpc3REaXYiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwibG9hZFZpc2libGVORlRzIiwiYmluZCIsInJvb3QiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwiYXNzZXQiLCJuZnREaXYiLCJjbGFzc05hbWUiLCJkYXRhc2V0IiwiYXBwZW5kIiwib2JzZXJ2ZSIsInNsZWVwIiwiZGVsYXlUaW1lIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiZW50cmllcyIsImZvckVhY2giLCJlbnRyeSIsImlzSW50ZXJzZWN0aW5nIiwidGFyZ2V0IiwibG9hZGluZyIsImxvb2t1cEFzc2V0QnlJRCIsIm5mdCIsInRleHRDb250ZW50IiwidW5pdE5hbWUiLCJzdWJzdHJpbmciLCJsb2FkIiwiaW1nIiwic3JjIiwiaW1hZ2VVcmwiLCJoaWRkZW4iLCJoYW5kbGVJbWFnZUVycm9yIiwicmVzdWx0SG9sZGVyIiwibG9va3VwQXNzZXRCYWxhbmNlcyIsImhvbGRlclNwYW4iLCJiYWxhbmNlIiwiYmFsYW5jZXMiLCJhbW91bnQiLCJhZGRyZXNzIiwicmVzcG9uc2UiLCJmZXRjaCIsInN0YXR1cyIsIm5mZFJlc3VsdCIsImpzb24iLCJQQUNLU19BUElfVVJMIiwiYmF0aGVyc0lkcyIsImJhdGhlcnMiLCJuZnRzIiwibWFwIiwicGFjayIsInBhY2tzIiwiaW5jbHVkZXMiLCJlc2Nyb3dBZGRyZXNzIiwiRXJyb3IiLCJQYWNrcyIsImZldGNoUGFja3MiLCJwYWNrU3RhdHVzUCIsInBsdXJhbCIsInBhY2tzRGl2IiwicGFja0RpdiIsInBhY2tDYW52YXMiLCJjb250cm9sbGVyIiwiUGFja0NhbnZhc0NvbnRyb2xsZXIiLCJ0aGVuIiwiaGlkZGVuTmFtZSIsInN0eWxlIiwib3BhY2l0eSIsIm9wZW5CdXR0b24iLCJiYXRoZXJJZCIsImNhZmZlaW5lQ2FyZElkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9wZW5QYWNrIiwiY2F0Y2giLCJtZXNzYWdlIiwiZGlzYWJsZUFsbEJ1dHRvbnMiLCJleGNlcHQiLCJxdWVyeVNlbGVjdG9yQWxsIiwib3BlbmVkIiwiZGlzYWJsZWQiLCJlbmFibGVBbGxCdXR0b25zIiwicGFja0NhbnZhc0NvbnRyb2xsZXIiLCJldmVudCIsImNhbGxpbmdCdXR0b24iLCJjdXJyZW50VGFyZ2V0Iiwic3VnZ2VzdGVkUGFyYW1zIiwiZ2V0VHJhbnNhY3Rpb25QYXJhbXMiLCJhbGxUeG5zIiwiZnJvbSIsIndhbGxldEFkZHJlc3MiLCJ0byIsImFzc2V0SW5kZXgiLCJwYXJzZUludCIsInNpZ25lZFR4bnMiLCJzaWduVHJhbnNhY3Rpb25zIiwic2lnbmVkVHhuSnNvbiIsInR4biIsImJ0b2EiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhcHBseSIsIm1ldGhvZCIsImJvZHkiLCJzdHJpbmdpZnkiLCJoZWFkZXJzIiwiQWNjZXB0IiwiZGF0YSIsImFuaW1hdGUiLCJhbGVydCIsImNhbnZhcyIsIndpZHRoIiwiaGVpZ2h0IiwiaW1hZ2VXaWR0aCIsIm51bUFuaW1hdGlvbkltYWdlIiwiY29udGV4dCIsImdldENvbnRleHQiLCJpbWFnZVNtb290aGluZ0VuYWJsZWQiLCJ0cmFuc2xhdGUiLCJjYXJkSW1hZ2UiLCJjYXJkTWFzayIsImFuaW1hdGlvbkltYWdlcyIsImxvYWRBbGxJbWFnZSIsInN0YXRpYyIsInBhdGgiLCJyZWplY3QiLCJpbWFnZSIsIkltYWdlIiwib25sb2FkIiwib25lcnJvciIsImNvbG9ySW5kZXgiLCJpbml0aWFsSW1hZ2UiLCJsb2FkSW1hZ2UiLCJkcmF3UGFjayIsImltYWdlVXJsQWx0ZXJuYXRlIiwiaSIsImFuaW1hdGlvbkltYWdlIiwiZHJhd0ltYWdlIiwieCIsIk1hdGgiLCJwb3ciLCJmcmFtZUR1cmF0aW9uIiwiY3VycmVudEZyYW1lIiwiaW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiY2xlYXJSZWN0IiwiZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uIiwiY2xlYXJJbnRlcnZhbCIsImFuaW1hdGlvbkR1cmF0aW9uIiwiY3VycmVudFRpbWUiLCJpbnRlcnZhbElkMiIsInlPZmZzZXQiLCJlYXNlSW5PdXRRdWFkIl0sInNvdXJjZVJvb3QiOiIifQ==