"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[892,998],{6998:(e,t,s)=>{s.r(t),s.d(t,{BasePage:()=>a});class a{constructor(e,t,s,a){this.walletConnect=e,this.algodClient=s,this.algoIndexer=a,this.holdings=t}}},6892:(e,t,s)=>{s.r(t),s.d(t,{Browse:()=>o});var a=s(6998),i=s(7304),n=s(5190);class o extends a.BasePage{constructor(...e){super(...arguments),this.collectionName=e[e.length-1],this.title="","caffeineCards"===this.collectionName?this.title="Caffeine Cards":"bathers"===this.collectionName&&(this.title="Bathers"),this.ui=document.createElement("div"),this.ui.innerHTML=`\n    <h1 class="mb-0">${this.title}</h1>\n    <div class="dark-text mb-4">Browse all ${this.title}</div>\n    <div class="row mb-3" id="filters"></div>\n    `,this.collection,this.bathersWithPacks,this.loadAll()}sleep(e){return new Promise((t=>setTimeout(t,e)))}async loadAll(){const e=document.createElement("p");e.textContent=`Loading ${this.title}...`,this.ui.append(e);const t=n.default.filter((e=>e.name===this.collectionName))[0];if(this.collection=new i.tf([t]),await this.collection.load(this.algoIndexer),"bathers"===this.collectionName){const{loadPacks:e}=await Promise.all([s.e(393),s.e(298)]).then(s.bind(s,5298));try{const t=await e();t&&t.length>0&&(this.bathersWithPacks=t.map((e=>e[0])))}catch(e){console.error(e)}}e.remove(),this.displayList()}displayList(){if(!this.collection.nfts.length){const e=document.createElement("div");return e.innerHTML='<div class="dark-text mb-5">No assets</div>',void this.ui.append(e)}const e=this.ui.querySelector("#filters");let t;"caffeineCards"===this.collectionName&&(t='<div class="col-6 col-md-3">\n        <select class="form-control custom-form-control" id="filter-type">\n          <option value="">Card type</option>\n          <option value="Body">Body</option>\n          <option value="Clothes">Clothes</option>\n          <option value="Cup">Cup</option>\n          <option value="Decoration">Decoration</option>\n          <option value="Mini Cup">Mini Cup</option>\n          <option value="Power">Power</option>\n          <option value="Room">Room</option>\n        </select>\n        <span id="filter-type-loading" hidden>Searching...</span>\n      </div>');let s="";"bathers"===this.collectionName&&(s='<div class="col-6 col-md-3 d-flex align-items-center">\n          <input type="checkbox" class="form-check-input mt-0" id="pack-checkbox" /> <label class="form-check-label ms-2" for="pack-checkbox">Unopened packs only</label>\n        </div>'),e.innerHTML=`\n    <div class="col-6 col-md-3">\n      <input type="search" class="form-control custom-form-control" placeholder="Name or asset ID" id="filter-search" style="max-width: 16rem;">\n    </div>\n      ${t||""}\n      ${s}\n    `,e.querySelector("#filter-search").addEventListener("keypress",this.search.bind(this),!1),e.querySelector("#pack-checkbox")?.addEventListener("change",this.filterPacks.bind(this),!1),t&&e.querySelector("#filter-type").addEventListener("change",this.filterType.bind(this),!1);const a=document.createElement("div");a.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5",this.ui.append(a);let i=new IntersectionObserver(this.loadVisibleNFTs.bind(this),{root:null,rootMargin:"0px",threshold:0}),n=0;for(const e of this.collection.nfts){const t=document.createElement("div");t.id=`nft-${n}`,t.className="col nft-item",t.dataset.i=n;let s="bathers"===this.collectionName?"placeholder-bather":"placeholder-card";if(t.innerHTML=`\n          <div class="list-item h-100 d-flex flex-column">\n              <div class="ratio ratio-1x1 ${s}">\n                <img src="" class="nft-img img-fluid" loading="lazy" hidden>\n              </div>\n              <div class="list-item-text flex-fill d-flex flex-column">\n                  <h4>${e.name}</h4>\n                  <div class="d-flex justify-content-between">\n                      <span class="asset-id">${e.assetId}</span>\n                      ${e.total}\n                  </div>\n                  <div class="mt-3 nft-properties">\n                  </div>\n                  <div class="flex-fill d-flex justify-content-between align-items-end mt-2">\n                        <div class="nft-special d-flex align-items-end"></div>\n                        <div class="dropdown d-flex align-items-end"></div>\n                  </div>\n              </div>\n          </div>\n      `,t.querySelector(".dropdown").innerHTML=`\n          <a href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n          <img src="assets/more.png" class="more">\n          </a>\n          <ul class="dropdown-menu">\n              <li><a class="dropdown-item" href="https://www.nftexplorer.app/asset/${e.assetId}" target="_blank">NFTExplorer</a></li>\n              <li><a class="dropdown-item" href="https://www.asalytic.app/nft/${e.assetId}" target="_blank">Asalytic</a></li>\n              <li><a class="dropdown-item" href="https://www.randgallery.com/algo-collection/?address=${e.assetId}" target="_blank">RandGallery</a></li>\n              <li><a class="dropdown-item" href="https://algoxnft.com/asset/${e.assetId}" target="_blank">ALGOxNFT</a></li>\n              <li><a class="dropdown-item" href="https://shufl.app/detail/${e.assetId}" target="_blank">Shufl</a></li>\n              <li><a class="dropdown-item" href="https://exa.market/asset/${e.assetId}" target="_blank">exa.market</a></li>\n          </ul>\n    `,"bathers"===this.collectionName&&this.bathersWithPacks&&this.bathersWithPacks.includes(e.assetId)){const e=t.querySelector(".nft-special");e.dataset.bsTitle="The pack tied to this Bather has not been opened yet",e.dataset.bsToggle="tooltip",e.dataset.bsCustomClass="custom-tooltip",e.innerHTML='<img src="assets/pack-icon.png">',e.className="me-2",new window.bootstrap.Tooltip(e)}a.append(t),n++,i.observe(t)}}loadVisibleNFTs(e,t){e.forEach((e=>{if(!e.isIntersecting)return;const t=e.target,s=this.collection.nfts[t.dataset.i];s.loading||(s.load(this.algoIndexer,!1).then((()=>{const e=t.querySelector(".nft-img");if(e.src=s.imageUrl,e.hidden=!1,s.handleImageError(e),"caffeineCards"===this.collectionName){let e="";if(s.metadata.properties){for(const t in s.metadata.properties)e+=`<span class="custom-badge">${t}</span> `;e+="<br>"}let a="";if(s.metadata.require){let e=[];for(const t in s.metadata.require)e.push(`<span class="custom-badge light">${t}: ${s.metadata.require[t]}</span>`);a=`<span class="custom-badge dark">Require:</span> ${e.join(" ")}`}t.querySelector(".nft-properties").innerHTML=`${e} ${a}<br>`;const i=t.querySelector(".nft-special");i.innerHTML='&#128293; <span id="burn-count">...</span>',i.dataset.bsTitle="Number of card definitively burned",i.dataset.bsToggle="tooltip",i.dataset.bsCustomClass="custom-tooltip",new window.bootstrap.Tooltip(i),this.algodClient.accountAssetInformation(s.metadata.burn_address,s.assetId).do().then((e=>{i.innerHTML=`&#128293; <span id="burn-count">${e["asset-holding"].amount}</span>`}))}if(s.metadata?.pop_battle_wins&&s.metadata.pop_battle_wins?.length>0)for(const e of s.metadata.pop_battle_wins){let s,a;1===e.rank?(s="pop-battle-icon-1st.png",a="1st"):2===e.rank?(s="pop-battle-icon-2nd.png",a="2nd"):3===e.rank&&(s="pop-battle-icon-3rd.png",a="3rd");const i=document.createElement("div");i.dataset.bsTitle=`Pop Battle Winner (${a})`,i.dataset.bsToggle="tooltip",i.dataset.bsCustomClass="custom-tooltip",i.innerHTML=`<img src="assets/${s}" width="32" height="32">`,i.className="me-1",t.querySelector(".nft-special").append(i),new window.bootstrap.Tooltip(i)}})),s.loading=!0,this.sleep(100))}))}search(e){if("Enter"!==e.key)return;const t=e.currentTarget.value;if(!t)return void this.ui.querySelectorAll(".nft-item").forEach((e=>{e.hidden=!1}));let s=t.split(" ");s=s.map((e=>e.trim().toLowerCase())),s=s.filter((e=>e));let a=0;for(const e of this.collection.nfts){let t=!1;e:for(const a of s){if(e.name.toLowerCase().includes(a)||e.assetId==a){t=!0;break}if(e.metadata&&e.metadata.properties)for(const s in e.metadata.properties)if(s.toLowerCase().includes(a)||e.metadata.properties[s].toLowerCase().includes(a)){t=!0;break e}}this.ui.querySelector(`#nft-${a}`).hidden=!t,a++}}async filterType(e){const t=this.ui.querySelector("#filter-type-loading");t.hidden=!1;const s=e?.currentTarget?.value;if(this.ui.querySelectorAll(".nft-item").forEach((e=>{e.hidden=!!s})),!s)return void(t.hidden=!0);let a=0;for(const e of this.collection.nfts){let t=!1;e.isLoaded||await e.load(this.algoIndexer),e.metadata?.properties?.[s]&&(t=!0);this.ui.querySelector(`#nft-${a}`).hidden=!t,a++}t.hidden=!0}filterPacks(e){const t=e.target?.checked;let s=0;for(const e of this.collection.nfts){const a=this.ui.querySelector(`#nft-${s}`);t?this.bathersWithPacks?.includes(e.assetId)?a.hidden=!t:a.hidden=t:a.hidden=!1,s++}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c3JjL3BhZ2VzL2Jyb3dzZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBjbGFzcyBCYXNlUGFnZSB7XG5cbiAgICBjb25zdHJ1Y3Rvcih3YWxsZXRDb25uZWN0LCBob2xkaW5ncywgYWxnb2RDbGllbnQsIGFsZ29JbmRleGVyKXtcblxuICAgICAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50ID0gYWxnb2RDbGllbnQ7XG4gICAgICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcbiAgICAgICAgdGhpcy5ob2xkaW5ncyA9IGhvbGRpbmdzO1xuXG4gICAgICAgIFxuXG4gICAgfVxuXG59IiwiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBORlRDb2xsZWN0aW9uIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5cbmltcG9ydCBjb2xsZWN0aW9ucyBmcm9tIFwiLi4vY29sbGVjdGlvbnMuanNcIjtcblxuZXhwb3J0IGNsYXNzIEJyb3dzZSBleHRlbmRzIEJhc2VQYWdlIHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG5cbiAgICAvL3RoaXMuY29sbGVjdGlvbk5hbWUgPSBcImNhZmZlaW5lQ2FyZHNcIjtcbiAgICB0aGlzLmNvbGxlY3Rpb25OYW1lID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuXG4gICAgdGhpcy50aXRsZSA9IFwiXCI7XG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiY2FmZmVpbmVDYXJkc1wiKSB7XG4gICAgICB0aGlzLnRpdGxlID0gXCJDYWZmZWluZSBDYXJkc1wiO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJiYXRoZXJzXCIpIHtcbiAgICAgIHRoaXMudGl0bGUgPSBcIkJhdGhlcnNcIjtcbiAgICB9XG5cbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYFxuICAgIDxoMSBjbGFzcz1cIm1iLTBcIj4ke3RoaXMudGl0bGV9PC9oMT5cbiAgICA8ZGl2IGNsYXNzPVwiZGFyay10ZXh0IG1iLTRcIj5Ccm93c2UgYWxsICR7dGhpcy50aXRsZX08L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwicm93IG1iLTNcIiBpZD1cImZpbHRlcnNcIj48L2Rpdj5cbiAgICBgO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uO1xuXG4gICAgdGhpcy5iYXRoZXJzV2l0aFBhY2tzO1xuXG4gICAgdGhpcy5sb2FkQWxsKCk7XG4gIH1cblxuICBzbGVlcChkZWxheVRpbWUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlUaW1lKSk7XG4gIH1cblxuICBhc3luYyBsb2FkQWxsKCkge1xuICAgIGNvbnN0IGxvYWRpbmdQID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgbG9hZGluZ1AudGV4dENvbnRlbnQgPSBgTG9hZGluZyAke3RoaXMudGl0bGV9Li4uYDtcbiAgICB0aGlzLnVpLmFwcGVuZChsb2FkaW5nUCk7XG5cbiAgICBjb25zdCBjYXJkQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb25zLmZpbHRlcihcbiAgICAgIChjKSA9PiBjLm5hbWUgPT09IHRoaXMuY29sbGVjdGlvbk5hbWVcbiAgICApWzBdO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IE5GVENvbGxlY3Rpb24oW2NhcmRDb2xsZWN0aW9uXSk7XG4gICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmxvYWQodGhpcy5hbGdvSW5kZXhlcik7XG5cbiAgICAvL2xvYWQgcGFja3NcbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJiYXRoZXJzXCIpIHtcbiAgICAgIGNvbnN0IHsgbG9hZFBhY2tzIH0gPSBhd2FpdCBpbXBvcnQoXCIuL3BhY2tzLmpzXCIpO1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwYWNrcyA9IGF3YWl0IGxvYWRQYWNrcygpO1xuXG4gICAgICAgIGlmIChwYWNrcyAmJiBwYWNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5iYXRoZXJzV2l0aFBhY2tzID0gcGFja3MubWFwKChwKSA9PiBwWzBdKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkaW5nUC5yZW1vdmUoKTtcblxuICAgIHRoaXMuZGlzcGxheUxpc3QoKTtcbiAgfVxuXG4gIGRpc3BsYXlMaXN0KCkge1xuICAgIGlmICghdGhpcy5jb2xsZWN0aW9uLm5mdHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBlbXB0eURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBlbXB0eURpdi5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cImRhcmstdGV4dCBtYi01XCI+Tm8gYXNzZXRzPC9kaXY+JztcblxuICAgICAgdGhpcy51aS5hcHBlbmQoZW1wdHlEaXYpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy9kaXNwbGF5IGZpbHRlclxuICAgIGNvbnN0IGZpbHRlckRpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNmaWx0ZXJzXCIpO1xuXG4gICAgbGV0IHR5cGVEcm9wZG93bjtcblxuICAgIGlmICh0aGlzLmNvbGxlY3Rpb25OYW1lID09PSBcImNhZmZlaW5lQ2FyZHNcIikge1xuICAgICAgdHlwZURyb3Bkb3duID0gYDxkaXYgY2xhc3M9XCJjb2wtNiBjb2wtbWQtM1wiPlxuICAgICAgICA8c2VsZWN0IGNsYXNzPVwiZm9ybS1jb250cm9sIGN1c3RvbS1mb3JtLWNvbnRyb2xcIiBpZD1cImZpbHRlci10eXBlXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlwiPkNhcmQgdHlwZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJCb2R5XCI+Qm9keTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJDbG90aGVzXCI+Q2xvdGhlczwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJDdXBcIj5DdXA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiRGVjb3JhdGlvblwiPkRlY29yYXRpb248L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiTWluaSBDdXBcIj5NaW5pIEN1cDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJQb3dlclwiPlBvd2VyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlJvb21cIj5Sb29tPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgICA8c3BhbiBpZD1cImZpbHRlci10eXBlLWxvYWRpbmdcIiBoaWRkZW4+U2VhcmNoaW5nLi4uPC9zcGFuPlxuICAgICAgPC9kaXY+YDtcbiAgICB9XG5cbiAgICBsZXQgcGFja3NDaGVja2JveCA9IFwiXCI7XG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiYmF0aGVyc1wiKSB7XG4gICAgICBwYWNrc0NoZWNrYm94ID0gYDxkaXYgY2xhc3M9XCJjb2wtNiBjb2wtbWQtMyBkLWZsZXggYWxpZ24taXRlbXMtY2VudGVyXCI+XG4gICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGNsYXNzPVwiZm9ybS1jaGVjay1pbnB1dCBtdC0wXCIgaWQ9XCJwYWNrLWNoZWNrYm94XCIgLz4gPGxhYmVsIGNsYXNzPVwiZm9ybS1jaGVjay1sYWJlbCBtcy0yXCIgZm9yPVwicGFjay1jaGVja2JveFwiPlVub3BlbmVkIHBhY2tzIG9ubHk8L2xhYmVsPlxuICAgICAgICA8L2Rpdj5gO1xuICAgIH1cblxuICAgIGZpbHRlckRpdi5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cImNvbC02IGNvbC1tZC0zXCI+XG4gICAgICA8aW5wdXQgdHlwZT1cInNlYXJjaFwiIGNsYXNzPVwiZm9ybS1jb250cm9sIGN1c3RvbS1mb3JtLWNvbnRyb2xcIiBwbGFjZWhvbGRlcj1cIk5hbWUgb3IgYXNzZXQgSURcIiBpZD1cImZpbHRlci1zZWFyY2hcIiBzdHlsZT1cIm1heC13aWR0aDogMTZyZW07XCI+XG4gICAgPC9kaXY+XG4gICAgICAke3R5cGVEcm9wZG93biA/IHR5cGVEcm9wZG93biA6IFwiXCJ9XG4gICAgICAke3BhY2tzQ2hlY2tib3h9XG4gICAgYDtcblxuICAgIGZpbHRlckRpdlxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjZmlsdGVyLXNlYXJjaFwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlwcmVzc1wiLCB0aGlzLnNlYXJjaC5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICBmaWx0ZXJEaXZcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI3BhY2stY2hlY2tib3hcIilcbiAgICAgID8uYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLmZpbHRlclBhY2tzLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIGlmICh0eXBlRHJvcGRvd24pIHtcbiAgICAgIGZpbHRlckRpdlxuICAgICAgICAucXVlcnlTZWxlY3RvcihcIiNmaWx0ZXItdHlwZVwiKVxuICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLmZpbHRlclR5cGUuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgIH1cblxuICAgIGNvbnN0IGxpc3RWaWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBsaXN0Vmlldy5jbGFzc05hbWUgPSBcInJvdyByb3ctY29scy0yIHJvdy1jb2xzLW1kLTMgcm93LWNvbHMtbGctNCBneS00IG1iLTVcIjtcbiAgICB0aGlzLnVpLmFwcGVuZChsaXN0Vmlldyk7XG5cbiAgICAvL2xvYWQgb25seSB3aGVuIGVsZW1lbnQgaXMgdmlzaWJsZVxuICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgcm9vdDogbnVsbCwgLy9icm93c2VyIHZpZXdwb3J0XG4gICAgICByb290TWFyZ2luOiBcIjBweFwiLFxuICAgICAgdGhyZXNob2xkOiAwLjAsXG4gICAgfTtcblxuICAgIGxldCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihcbiAgICAgIHRoaXMubG9hZFZpc2libGVORlRzLmJpbmQodGhpcyksXG4gICAgICBvcHRpb25zXG4gICAgKTtcblxuICAgIC8vZGlzcGxheSBuZnRzXG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoY29uc3QgbmZ0IG9mIHRoaXMuY29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICBjb25zdCBuZnREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgbmZ0RGl2LmlkID0gYG5mdC0ke2l9YDtcbiAgICAgIG5mdERpdi5jbGFzc05hbWUgPSBcImNvbCBuZnQtaXRlbVwiO1xuICAgICAgbmZ0RGl2LmRhdGFzZXQuaSA9IGk7XG5cbiAgICAgIGxldCBwbGFjZUhvbGRlckNsYXNzID1cbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJiYXRoZXJzXCJcbiAgICAgICAgICA/IFwicGxhY2Vob2xkZXItYmF0aGVyXCJcbiAgICAgICAgICA6IFwicGxhY2Vob2xkZXItY2FyZFwiO1xuXG4gICAgICBuZnREaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaXN0LWl0ZW0gaC0xMDAgZC1mbGV4IGZsZXgtY29sdW1uXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyYXRpbyByYXRpby0xeDEgJHtwbGFjZUhvbGRlckNsYXNzfVwiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiXCIgY2xhc3M9XCJuZnQtaW1nIGltZy1mbHVpZFwiIGxvYWRpbmc9XCJsYXp5XCIgaGlkZGVuPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxpc3QtaXRlbS10ZXh0IGZsZXgtZmlsbCBkLWZsZXggZmxleC1jb2x1bW5cIj5cbiAgICAgICAgICAgICAgICAgIDxoND4ke25mdC5uYW1lfTwvaDQ+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJhc3NldC1pZFwiPiR7bmZ0LmFzc2V0SWR9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICR7bmZ0LnRvdGFsfVxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXQtMyBuZnQtcHJvcGVydGllc1wiPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIGQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiBhbGlnbi1pdGVtcy1lbmQgbXQtMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5mdC1zcGVjaWFsIGQtZmxleCBhbGlnbi1pdGVtcy1lbmRcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93biBkLWZsZXggYWxpZ24taXRlbXMtZW5kXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICBgO1xuXG4gICAgICAvL2FkZCBkcm9wZG93biB3aXRoIG9wdGlvbnNcbiAgICAgIGNvbnN0IGRyb3Bkb3duRGl2ID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIuZHJvcGRvd25cIik7XG5cbiAgICAgIGRyb3Bkb3duRGl2LmlubmVySFRNTCA9IGBcbiAgICAgICAgICA8YSBocmVmPVwiI1wiIHJvbGU9XCJidXR0b25cIiBkYXRhLWJzLXRvZ2dsZT1cImRyb3Bkb3duXCIgYXJpYS1leHBhbmRlZD1cImZhbHNlXCI+XG4gICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvbW9yZS5wbmdcIiBjbGFzcz1cIm1vcmVcIj5cbiAgICAgICAgICA8L2E+XG4gICAgICAgICAgPHVsIGNsYXNzPVwiZHJvcGRvd24tbWVudVwiPlxuICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgaHJlZj1cImh0dHBzOi8vd3d3Lm5mdGV4cGxvcmVyLmFwcC9hc3NldC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPk5GVEV4cGxvcmVyPC9hPjwvbGk+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly93d3cuYXNhbHl0aWMuYXBwL25mdC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPkFzYWx5dGljPC9hPjwvbGk+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly93d3cucmFuZGdhbGxlcnkuY29tL2FsZ28tY29sbGVjdGlvbi8/YWRkcmVzcz0ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPlJhbmRHYWxsZXJ5PC9hPjwvbGk+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly9hbGdveG5mdC5jb20vYXNzZXQvJHtuZnQuYXNzZXRJZH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj5BTEdPeE5GVDwvYT48L2xpPlxuICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgaHJlZj1cImh0dHBzOi8vc2h1ZmwuYXBwL2RldGFpbC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPlNodWZsPC9hPjwvbGk+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly9leGEubWFya2V0L2Fzc2V0LyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+ZXhhLm1hcmtldDwvYT48L2xpPlxuICAgICAgICAgIDwvdWw+XG4gICAgYDtcblxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmNvbGxlY3Rpb25OYW1lID09PSBcImJhdGhlcnNcIiAmJlxuICAgICAgICB0aGlzLmJhdGhlcnNXaXRoUGFja3MgJiZcbiAgICAgICAgdGhpcy5iYXRoZXJzV2l0aFBhY2tzLmluY2x1ZGVzKG5mdC5hc3NldElkKVxuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IG5mdFNwZWNpYWxEaXYgPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIi5uZnQtc3BlY2lhbFwiKTtcbiAgICAgICAgbmZ0U3BlY2lhbERpdi5kYXRhc2V0LmJzVGl0bGUgPVxuICAgICAgICAgIFwiVGhlIHBhY2sgdGllZCB0byB0aGlzIEJhdGhlciBoYXMgbm90IGJlZW4gb3BlbmVkIHlldFwiO1xuICAgICAgICBuZnRTcGVjaWFsRGl2LmRhdGFzZXQuYnNUb2dnbGUgPSBcInRvb2x0aXBcIjtcbiAgICAgICAgbmZ0U3BlY2lhbERpdi5kYXRhc2V0LmJzQ3VzdG9tQ2xhc3MgPSBcImN1c3RvbS10b29sdGlwXCI7XG4gICAgICAgIG5mdFNwZWNpYWxEaXYuaW5uZXJIVE1MID0gJzxpbWcgc3JjPVwiYXNzZXRzL3BhY2staWNvbi5wbmdcIj4nO1xuICAgICAgICBuZnRTcGVjaWFsRGl2LmNsYXNzTmFtZSA9IFwibWUtMlwiO1xuXG4gICAgICAgIG5ldyB3aW5kb3cuYm9vdHN0cmFwLlRvb2x0aXAobmZ0U3BlY2lhbERpdik7XG4gICAgICB9XG5cbiAgICAgIGxpc3RWaWV3LmFwcGVuZChuZnREaXYpO1xuXG4gICAgICBpKys7XG5cbiAgICAgIG9ic2VydmVyLm9ic2VydmUobmZ0RGl2KTtcblxuICAgICAgLypuZnQubG9hZCh0aGlzLmFsZ29JbmRleGVyKS50aGVuKCgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cobmZ0RGl2KTtcblxuICAgICAgICBsZXQgcHJvcGVydGllc05hbWVzID0gXCJcIjtcblxuICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5TmFtZSBpbiBuZnQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICAgICAgcHJvcGVydGllc05hbWVzICs9IGA8c3BhbiBjbGFzcz1cImN1c3RvbS1iYWRnZVwiPiR7cHJvcGVydHlOYW1lfTwvc3Bhbj4gYDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwcm9wZXJ0aWVzTmFtZXMgKz0gXCI8YnI+XCI7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgcmVxdWlyZSA9IFwiXCI7XG5cbiAgICAgICAgaWYgKG5mdC5tZXRhZGF0YS5yZXF1aXJlKSB7XG4gICAgICAgICAgbGV0IHJlcXVpcmVMaXN0ID0gW107XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IHJlcXVpcmVLZXkgaW4gbmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgICAgIHJlcXVpcmVMaXN0LnB1c2goXG4gICAgICAgICAgICAgIGA8c3BhbiBjbGFzcz1cImN1c3RvbS1iYWRnZSBsaWdodFwiPiR7cmVxdWlyZUtleX06ICR7bmZ0Lm1ldGFkYXRhLnJlcXVpcmVbcmVxdWlyZUtleV19PC9zcGFuPmBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmVxdWlyZSA9IGA8c3BhbiBjbGFzcz1cImN1c3RvbS1iYWRnZSBkYXJrXCI+UmVxdWlyZTo8L3NwYW4+ICR7cmVxdWlyZUxpc3Quam9pbihcbiAgICAgICAgICAgIFwiIFwiXG4gICAgICAgICAgKX1gO1xuICAgICAgICB9XG5cbiAgICAgICAgbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgXCIubmZ0LXByb3BlcnRpZXNcIlxuICAgICAgICApLmlubmVySFRNTCA9IGAke3Byb3BlcnRpZXNOYW1lc30gJHtyZXF1aXJlfTxicj5gO1xuXG4gICAgICAgIC8vbG9hZCBpbWFnZVxuICAgICAgICBjb25zdCBpbWFnZSA9IG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLm5mdC1pbWdcIik7XG4gICAgICAgIGltYWdlLnNyYyA9IG5mdC5pbWFnZVVybDtcbiAgICAgICAgbmZ0LmhhbmRsZUltYWdlRXJyb3IoaW1hZ2UpO1xuXG4gICAgICAgIC8vbG9hZCBiYWxhbmNlIGZyb20gYnVybmluZyBhZGRyZXNzXG4gICAgICAgIGNvbnN0IGJ1cm5Db3VudFNwYW4gPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIiNidXJuLWNvdW50XCIpO1xuICAgICAgICBidXJuQ291bnRTcGFuLnRleHRDb250ZW50ID0gXCIuLi5cIjtcblxuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50XG4gICAgICAgICAgLmFjY291bnRBc3NldEluZm9ybWF0aW9uKG5mdC5tZXRhZGF0YS5idXJuX2FkZHJlc3MsIG5mdC5hc3NldElkKVxuICAgICAgICAgIC5kbygpXG4gICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgYnVybkNvdW50U3Bhbi50ZXh0Q29udGVudCA9IGAke3Jlc3VsdFtcImFzc2V0LWhvbGRpbmdcIl0uYW1vdW50fWA7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgLy9hZGQgZHJvcGRvd24gd2l0aCBvcHRpb25zXG4gICAgICAgIGNvbnN0IGRyb3Bkb3duRGl2ID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIuZHJvcGRvd25cIik7XG5cbiAgICAgICAgZHJvcGRvd25EaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPGEgaHJlZj1cIiNcIiByb2xlPVwiYnV0dG9uXCIgZGF0YS1icy10b2dnbGU9XCJkcm9wZG93blwiIGFyaWEtZXhwYW5kZWQ9XCJmYWxzZVwiPlxuICAgICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvbW9yZS5wbmdcIiBjbGFzcz1cIm1vcmVcIj5cbiAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgIDx1bCBjbGFzcz1cImRyb3Bkb3duLW1lbnVcIj5cbiAgICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgaHJlZj1cImh0dHBzOi8vd3d3Lm5mdGV4cGxvcmVyLmFwcC9hc3NldC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPk5GVEV4cGxvcmVyPC9hPjwvbGk+XG4gICAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL3d3dy5yYW5kZ2FsbGVyeS5jb20vYWxnby1jb2xsZWN0aW9uLz9hZGRyZXNzPSR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+UmFuZEdhbGxlcnk8L2E+PC9saT5cbiAgICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgaHJlZj1cImh0dHBzOi8vYWxnb3huZnQuY29tL2Fzc2V0LyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+QUxHT3hORlQ8L2E+PC9saT5cbiAgICAgICAgICAgIDwvdWw+XG4gICAgICBgO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc2xlZXAoMTAwKTsqL1xuICAgIH1cbiAgfVxuXG4gIGxvYWRWaXNpYmxlTkZUcyhlbnRyaWVzLCBvYnNlcnZlcikge1xuICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgIGlmICghZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuZnREaXYgPSBlbnRyeS50YXJnZXQ7XG4gICAgICBjb25zdCBuZnQgPSB0aGlzLmNvbGxlY3Rpb24ubmZ0c1tuZnREaXYuZGF0YXNldC5pXTtcblxuICAgICAgaWYgKG5mdC5sb2FkaW5nKSB7XG4gICAgICAgIC8vbG9hZGluZyBoYXZlIGFscmVhZHkgc3RhcnRlZFxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vY29uc3QgdXNlUGVyYSA9IHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiYmF0aGVyc1wiID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgY29uc3QgdXNlUGVyYSA9IGZhbHNlO1xuXG4gICAgICBuZnQubG9hZCh0aGlzLmFsZ29JbmRleGVyLCB1c2VQZXJhKS50aGVuKCgpID0+IHtcbiAgICAgICAgLy9sb2FkIGltYWdlXG4gICAgICAgIGNvbnN0IGltYWdlID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LWltZ1wiKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gbmZ0LmltYWdlVXJsO1xuICAgICAgICBpbWFnZS5oaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgbmZ0LmhhbmRsZUltYWdlRXJyb3IoaW1hZ2UpO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb25OYW1lID09PSBcImNhZmZlaW5lQ2FyZHNcIikge1xuICAgICAgICAgIC8vZGlzcGxheSBwcm9wZXJ0aWVzXG4gICAgICAgICAgbGV0IHByb3BlcnRpZXNOYW1lcyA9IFwiXCI7XG5cbiAgICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlOYW1lIGluIG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgIHByb3BlcnRpZXNOYW1lcyArPSBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2VcIj4ke3Byb3BlcnR5TmFtZX08L3NwYW4+IGA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHByb3BlcnRpZXNOYW1lcyArPSBcIjxicj5cIjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsZXQgcmVxdWlyZSA9IFwiXCI7XG5cbiAgICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgICAgIGxldCByZXF1aXJlTGlzdCA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJlcXVpcmVLZXkgaW4gbmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgICAgICAgcmVxdWlyZUxpc3QucHVzaChcbiAgICAgICAgICAgICAgICBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2UgbGlnaHRcIj4ke3JlcXVpcmVLZXl9OiAke25mdC5tZXRhZGF0YS5yZXF1aXJlW3JlcXVpcmVLZXldfTwvc3Bhbj5gXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVpcmUgPSBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2UgZGFya1wiPlJlcXVpcmU6PC9zcGFuPiAke3JlcXVpcmVMaXN0LmpvaW4oXG4gICAgICAgICAgICAgIFwiIFwiXG4gICAgICAgICAgICApfWA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBcIi5uZnQtcHJvcGVydGllc1wiXG4gICAgICAgICAgKS5pbm5lckhUTUwgPSBgJHtwcm9wZXJ0aWVzTmFtZXN9ICR7cmVxdWlyZX08YnI+YDtcblxuICAgICAgICAgIC8vbG9hZCBiYWxhbmNlIGZyb20gYnVybmluZyBhZGRyZXNzXG4gICAgICAgICAgY29uc3QgbmZ0U3BlY2lhbERpdiA9IG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLm5mdC1zcGVjaWFsXCIpO1xuICAgICAgICAgIG5mdFNwZWNpYWxEaXYuaW5uZXJIVE1MID1cbiAgICAgICAgICAgICcmIzEyODI5MzsgPHNwYW4gaWQ9XCJidXJuLWNvdW50XCI+Li4uPC9zcGFuPic7XG5cbiAgICAgICAgICAvL2FkZCB0b29sdGlwXG4gICAgICAgICAgbmZ0U3BlY2lhbERpdi5kYXRhc2V0LmJzVGl0bGUgPSBcIk51bWJlciBvZiBjYXJkIGRlZmluaXRpdmVseSBidXJuZWRcIjtcbiAgICAgICAgICBuZnRTcGVjaWFsRGl2LmRhdGFzZXQuYnNUb2dnbGUgPSBcInRvb2x0aXBcIjtcbiAgICAgICAgICBuZnRTcGVjaWFsRGl2LmRhdGFzZXQuYnNDdXN0b21DbGFzcyA9IFwiY3VzdG9tLXRvb2x0aXBcIjtcbiAgICAgICAgICBuZXcgd2luZG93LmJvb3RzdHJhcC5Ub29sdGlwKG5mdFNwZWNpYWxEaXYpO1xuXG4gICAgICAgICAgdGhpcy5hbGdvZENsaWVudFxuICAgICAgICAgICAgLmFjY291bnRBc3NldEluZm9ybWF0aW9uKG5mdC5tZXRhZGF0YS5idXJuX2FkZHJlc3MsIG5mdC5hc3NldElkKVxuICAgICAgICAgICAgLmRvKClcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgbmZ0U3BlY2lhbERpdi5pbm5lckhUTUwgPSBgJiMxMjgyOTM7IDxzcGFuIGlkPVwiYnVybi1jb3VudFwiPiR7cmVzdWx0W1wiYXNzZXQtaG9sZGluZ1wiXS5hbW91bnR9PC9zcGFuPmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vYWRkIHBvcCBiYXR0bGUgaWNvbiBpZiBuZWVkZWRcbiAgICAgICAgaWYgKFxuICAgICAgICAgIG5mdC5tZXRhZGF0YT8ucG9wX2JhdHRsZV93aW5zICYmXG4gICAgICAgICAgbmZ0Lm1ldGFkYXRhLnBvcF9iYXR0bGVfd2lucz8ubGVuZ3RoID4gMFxuICAgICAgICApIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IHBvcEJhdHRsZVdpbiBvZiBuZnQubWV0YWRhdGEucG9wX2JhdHRsZV93aW5zKSB7XG4gICAgICAgICAgICBsZXQgaW1nVXJsO1xuICAgICAgICAgICAgbGV0IHJhbmtTdHJpbmc7XG5cbiAgICAgICAgICAgIGlmIChwb3BCYXR0bGVXaW4ucmFuayA9PT0gMSkge1xuICAgICAgICAgICAgICBpbWdVcmwgPSBcInBvcC1iYXR0bGUtaWNvbi0xc3QucG5nXCI7XG4gICAgICAgICAgICAgIHJhbmtTdHJpbmcgPSBcIjFzdFwiO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwb3BCYXR0bGVXaW4ucmFuayA9PT0gMikge1xuICAgICAgICAgICAgICBpbWdVcmwgPSBcInBvcC1iYXR0bGUtaWNvbi0ybmQucG5nXCI7XG4gICAgICAgICAgICAgIHJhbmtTdHJpbmcgPSBcIjJuZFwiO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwb3BCYXR0bGVXaW4ucmFuayA9PT0gMykge1xuICAgICAgICAgICAgICBpbWdVcmwgPSBcInBvcC1iYXR0bGUtaWNvbi0zcmQucG5nXCI7XG4gICAgICAgICAgICAgIHJhbmtTdHJpbmcgPSBcIjNyZFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBwb3BCYXR0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgcG9wQmF0dGxlLmRhdGFzZXQuYnNUaXRsZSA9IGBQb3AgQmF0dGxlIFdpbm5lciAoJHtyYW5rU3RyaW5nfSlgO1xuICAgICAgICAgICAgcG9wQmF0dGxlLmRhdGFzZXQuYnNUb2dnbGUgPSBcInRvb2x0aXBcIjtcbiAgICAgICAgICAgIHBvcEJhdHRsZS5kYXRhc2V0LmJzQ3VzdG9tQ2xhc3MgPSBcImN1c3RvbS10b29sdGlwXCI7XG4gICAgICAgICAgICBwb3BCYXR0bGUuaW5uZXJIVE1MID0gYDxpbWcgc3JjPVwiYXNzZXRzLyR7aW1nVXJsfVwiIHdpZHRoPVwiMzJcIiBoZWlnaHQ9XCIzMlwiPmA7XG4gICAgICAgICAgICBwb3BCYXR0bGUuY2xhc3NOYW1lID0gXCJtZS0xXCI7XG5cbiAgICAgICAgICAgIG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLm5mdC1zcGVjaWFsXCIpLmFwcGVuZChwb3BCYXR0bGUpO1xuICAgICAgICAgICAgbmV3IHdpbmRvdy5ib290c3RyYXAuVG9vbHRpcChwb3BCYXR0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIG5mdC5sb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgdGhpcy5zbGVlcCgxMDApO1xuICAgIH0pO1xuICB9XG5cbiAgc2VhcmNoKGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmtleSAhPT0gXCJFbnRlclwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgc2VhcmNoU2VudGVuY2UgPSBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlO1xuXG4gICAgaWYgKCFzZWFyY2hTZW50ZW5jZSkge1xuICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubmZ0LWl0ZW1cIik7XG4gICAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGl0ZW0uaGlkZGVuID0gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBzZWFyY2hUZXJtcyA9IHNlYXJjaFNlbnRlbmNlLnNwbGl0KFwiIFwiKTtcbiAgICBzZWFyY2hUZXJtcyA9IHNlYXJjaFRlcm1zLm1hcCgodykgPT4gdy50cmltKCkudG9Mb3dlckNhc2UoKSk7XG4gICAgc2VhcmNoVGVybXMgPSBzZWFyY2hUZXJtcy5maWx0ZXIoKHcpID0+IHcpO1xuXG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoY29uc3QgbmZ0IG9mIHRoaXMuY29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICBsZXQgZm91bmQgPSBmYWxzZTtcblxuICAgICAgdGVybUxvb3A6IGZvciAoY29uc3QgdGVybSBvZiBzZWFyY2hUZXJtcykge1xuICAgICAgICBpZiAobmZ0Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fCBuZnQuYXNzZXRJZCA9PSB0ZXJtKSB7XG4gICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5mdC5tZXRhZGF0YSAmJiBuZnQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pIHx8XG4gICAgICAgICAgICAgIG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzW2tleV0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgYnJlYWsgdGVybUxvb3A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGl0ZW1FbGVtZW50ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjbmZ0LSR7aX1gKTtcbiAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICBpdGVtRWxlbWVudC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW1FbGVtZW50LmhpZGRlbiA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGkrKztcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaWx0ZXJUeXBlKGV2ZW50KSB7XG4gICAgY29uc3QgbG9hZGluZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNmaWx0ZXItdHlwZS1sb2FkaW5nXCIpO1xuICAgIGxvYWRpbmcuaGlkZGVuID0gZmFsc2U7XG5cbiAgICBjb25zdCB0eXBlID0gZXZlbnQ/LmN1cnJlbnRUYXJnZXQ/LnZhbHVlO1xuXG4gICAgY29uc3QgaXRlbXMgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubmZ0LWl0ZW1cIik7XG4gICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgaWYgKCF0eXBlKSB7XG4gICAgICAgIGl0ZW0uaGlkZGVuID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmhpZGRlbiA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoIXR5cGUpIHtcbiAgICAgIGxvYWRpbmcuaGlkZGVuID0gdHJ1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChjb25zdCBuZnQgb2YgdGhpcy5jb2xsZWN0aW9uLm5mdHMpIHtcbiAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuXG4gICAgICBpZiAoIW5mdC5pc0xvYWRlZCkge1xuICAgICAgICBhd2FpdCBuZnQubG9hZCh0aGlzLmFsZ29JbmRleGVyKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5mdC5tZXRhZGF0YT8ucHJvcGVydGllcz8uW3R5cGVdKSB7XG4gICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaXRlbUVsZW1lbnQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoYCNuZnQtJHtpfWApO1xuICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgIGl0ZW1FbGVtZW50LmhpZGRlbiA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbUVsZW1lbnQuaGlkZGVuID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaSsrO1xuICAgIH1cblxuICAgIGxvYWRpbmcuaGlkZGVuID0gdHJ1ZTtcbiAgfVxuXG4gIGZpbHRlclBhY2tzKGUpIHtcbiAgICBjb25zdCBjaGVja2VkID0gZS50YXJnZXQ/LmNoZWNrZWQ7XG5cbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChjb25zdCBuZnQgb2YgdGhpcy5jb2xsZWN0aW9uLm5mdHMpIHtcbiAgICAgIGNvbnN0IGl0ZW1FbGVtZW50ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjbmZ0LSR7aX1gKTtcblxuICAgICAgaWYgKGNoZWNrZWQpIHtcbiAgICAgICAgaWYgKHRoaXMuYmF0aGVyc1dpdGhQYWNrcz8uaW5jbHVkZXMobmZ0LmFzc2V0SWQpKSB7XG4gICAgICAgICAgaXRlbUVsZW1lbnQuaGlkZGVuID0gIWNoZWNrZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaXRlbUVsZW1lbnQuaGlkZGVuID0gY2hlY2tlZDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbUVsZW1lbnQuaGlkZGVuID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGkrKztcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJCYXNlUGFnZSIsImNvbnN0cnVjdG9yIiwid2FsbGV0Q29ubmVjdCIsImhvbGRpbmdzIiwiYWxnb2RDbGllbnQiLCJhbGdvSW5kZXhlciIsInRoaXMiLCJCcm93c2UiLCJhcmdzIiwic3VwZXIiLCJhcmd1bWVudHMiLCJjb2xsZWN0aW9uTmFtZSIsImxlbmd0aCIsInRpdGxlIiwidWkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJjb2xsZWN0aW9uIiwiYmF0aGVyc1dpdGhQYWNrcyIsImxvYWRBbGwiLCJzbGVlcCIsImRlbGF5VGltZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImFzeW5jIiwibG9hZGluZ1AiLCJ0ZXh0Q29udGVudCIsImFwcGVuZCIsImNhcmRDb2xsZWN0aW9uIiwiYyIsIm5hbWUiLCJsb2FkIiwibG9hZFBhY2tzIiwicGFja3MiLCJtYXAiLCJwIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwicmVtb3ZlIiwiZGlzcGxheUxpc3QiLCJuZnRzIiwiZW1wdHlEaXYiLCJmaWx0ZXJEaXYiLCJxdWVyeVNlbGVjdG9yIiwidHlwZURyb3Bkb3duIiwicGFja3NDaGVja2JveCIsImFkZEV2ZW50TGlzdGVuZXIiLCJzZWFyY2giLCJiaW5kIiwiZmlsdGVyUGFja3MiLCJmaWx0ZXJUeXBlIiwibGlzdFZpZXciLCJjbGFzc05hbWUiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwibG9hZFZpc2libGVORlRzIiwicm9vdCIsInJvb3RNYXJnaW4iLCJ0aHJlc2hvbGQiLCJpIiwibmZ0IiwibmZ0RGl2IiwiaWQiLCJkYXRhc2V0IiwicGxhY2VIb2xkZXJDbGFzcyIsImFzc2V0SWQiLCJ0b3RhbCIsImluY2x1ZGVzIiwibmZ0U3BlY2lhbERpdiIsImJzVGl0bGUiLCJic1RvZ2dsZSIsImJzQ3VzdG9tQ2xhc3MiLCJ3aW5kb3ciLCJib290c3RyYXAiLCJUb29sdGlwIiwib2JzZXJ2ZSIsImVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInRhcmdldCIsImxvYWRpbmciLCJ0aGVuIiwiaW1hZ2UiLCJzcmMiLCJpbWFnZVVybCIsImhpZGRlbiIsImhhbmRsZUltYWdlRXJyb3IiLCJwcm9wZXJ0aWVzTmFtZXMiLCJtZXRhZGF0YSIsInByb3BlcnRpZXMiLCJwcm9wZXJ0eU5hbWUiLCJyZXF1aXJlIiwicmVxdWlyZUxpc3QiLCJyZXF1aXJlS2V5IiwicHVzaCIsImpvaW4iLCJhY2NvdW50QXNzZXRJbmZvcm1hdGlvbiIsImJ1cm5fYWRkcmVzcyIsImRvIiwicmVzdWx0IiwiYW1vdW50IiwicG9wX2JhdHRsZV93aW5zIiwicG9wQmF0dGxlV2luIiwiaW1nVXJsIiwicmFua1N0cmluZyIsInJhbmsiLCJwb3BCYXR0bGUiLCJldmVudCIsImtleSIsInNlYXJjaFNlbnRlbmNlIiwiY3VycmVudFRhcmdldCIsInZhbHVlIiwicXVlcnlTZWxlY3RvckFsbCIsIml0ZW0iLCJzZWFyY2hUZXJtcyIsInNwbGl0IiwidyIsInRyaW0iLCJ0b0xvd2VyQ2FzZSIsImZpbHRlciIsImZvdW5kIiwidGVybUxvb3AiLCJ0ZXJtIiwidHlwZSIsImlzTG9hZGVkIiwiZSIsImNoZWNrZWQiLCJpdGVtRWxlbWVudCJdLCJzb3VyY2VSb290IjoiIn0=