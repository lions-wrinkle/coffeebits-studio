"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[538],{6538:(e,t,s)=>{s.r(t),s.d(t,{Grinder:()=>r});var a=s(6998),d=(s(5190),s(7304),s(7644)),n=s(4050),i=s(2871),o=s(4714);class r extends a.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Grinder</h1>\n    <p class="dark-text">Use your Caffeine Cards to customize your Bathers</p>\n\n    <div class="d-sm-flex flew-row" style="background-color: var(--background-dark);">\n\n        <div class="d-flex flex-column p-3 text-center">\n\n            <img src="assets/default.png" class="mb-2 ms-auto me-auto" id="club-img" style="width: 200px; height: auto">\n\n            <div class="dropdown" id="bath-club-dropdown">\n                <button class="dropdown-toggle button-alt" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false">\n                    Choose Bather\n                </button>\n            </div>\n            <div class="mb-2 mt-4 ms-auto me-auto justify-content-center row row-cols-2" id="cards" style="width: 200px;">\n              <div class="col text-center" id="default-card" style="width: 200px;">\n                <img src="assets/default-card.png" class="img-fluid" style="width: 200px; height: auto;">\n              </div>\n            </div>\n            <div class="dropdown mb-3" id="cards-dropdown">\n                <button class="dropdown-toggle button-alt mb-2" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false" id="choose-card-button" disabled>\n                    Add Card\n                </button>\n            </div>\n            <button id="button-review" disabled>Review...</button>\n\n        </div>\n\n        <div class="d-flex flex-column flex-fill p-3 text-center">\n            <small class="dark-text">preview</small>\n            <img src="assets/default.png" class="w-100 m-auto img-fluid" style="max-width: 480px;" id="merged-img">\n\n        </div>\n\n    </div>',this.bathersCollection,this.cardsCollection,this.selectedBather,this.selectedCards=[],this.mergedProperties={},this.mergedImgDataURL,this.chooseCardButton=this.ui.querySelector("#choose-card-button"),this.load()}async load(){await this.loadBathers(),this.ui.querySelector("#button-review").addEventListener("click",this.review.bind(this));const e=window.location.search,t=new URLSearchParams(e);if(t.has("bather")){const e=parseInt(t.get("bather")),s=this.bathersCollection.nfts.filter((t=>t.assetId===e))?.[0];s&&await this.displayBather(s)}}async loadBathers(){this.bathersCollection=this.holdings.bathers;const e=this.ui.querySelector("#bath-club-dropdown");let t=e.querySelector(".dropdown-menu");t&&t.remove(),t=new i.Z(this.bathersCollection.nfts,this.didSelectBather.bind(this)),e.append(t.ui)}async didSelectBather(e){this.clearCard();const t=e.currentTarget.dataset.index;if(!t)return;const s=this.bathersCollection.nfts[t];this.mergedProperties=s.metadata.properties,await this.displayBather(s),e.preventDefault()}async displayBather(e){this.selectedBather=e,this.ui.querySelector("#club-img").src=e.imageUrl,this.validate(),await this.loadCards(),this.chooseCardButton.disabled=!1}clearCard(){this.selectedCards=[],this.chooseCardButton.disabled=!0,this.mergedProperties={},this.ui.querySelector("#default-card").hidden=!1;const e=Array.from(this.ui.querySelector("#cards").children);for(const t of e)"default-card"!==t.id&&t.remove()}async loadCards(){this.cardsCollection=this.holdings.caffeineCards;const e=this.ui.querySelector("#cards-dropdown");let t=e.querySelector("#cards-dropdown-nft");t&&t.remove();let s=[];e:for(const e of this.cardsCollection.nfts){if(e.metadata.require)for(const t in e.metadata.require)if(this.mergedProperties[t]!=e.metadata.require[t]){s.push(e.assetId);continue e}for(const t of this.selectedCards)for(const a in t.metadata.properties)if(e.metadata.properties[a]){s.push(e.assetId);continue e}}t=new i.Z(this.cardsCollection.nfts,this.didSelectCard.bind(this),"cards-dropdown-nft",s),e.append(t.ui),new window.bootstrap.Dropdown(this.chooseCardButton)}async didSelectCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];this.selectedCards.push(s);const a=this.ui.querySelector("#default-card");a&&(a.hidden=!0);const d=document.createElement("div");d.className="col text-center",d.id=`card-${t}`,d.innerHTML=`\n    <img style="width: 80px; height: auto" src="${s.imageUrl}">\n    <p><a href="javascript:void(0);" id="rm-${t}" data-index="${t}">Remove</a></p>\n    `,d.querySelector(`#rm-${t}`).addEventListener("click",this.removeCard.bind(this),!1),this.ui.querySelector("#cards").append(d),this.validate(),await this.loadCards(),e.preventDefault()}async removeCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];if(console.log(this.selectedCards.map((e=>e.name))),this.selectedCards=this.selectedCards.filter((e=>e.assetId!=s.assetId)),console.log(this.selectedCards.map((e=>e.name))),0===this.selectedCards.length){const e=this.ui.querySelector("#default-card");e&&(e.hidden=!1)}this.validate(),await this.loadCards(),this.ui.querySelector(`#card-${t}`).remove(),e.preventDefault()}validate(){const e=this.ui.querySelector("#button-review");this.selectedBather&&this.selectedCards.length>0?(e.disabled=!1,this.preview()):this.selectedBather?(this.ui.querySelector("#merged-img").src=this.selectedBather.imageUrl,e.disabled=!0):e.disabled=!0}review(e){const t=document.createElement("div");t.className="modal",t.tabIndex="-1";let s,a=[];for(const e of this.selectedCards)for(const t in e.metadata.properties)o.duplicateCriteria.includes(t)&&a.push(t);a.length>0&&(s=`&#9888;&#65039; This request contains a modification that can generate a duplicate (${a.join(",")}). If it's the case, the request will be canceled and the cards returned to your wallet.<br>`),t.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title">Review Bather modification</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div class="text-center mb-3">\n                <img style="width: 320px; height: auto;" id="preview-merged-img">\n            </div>\n\n          <p>\n          Your <strong>${this.selectedBather.name}</strong> will be updated.<br>\n          Your <strong>${this.selectedCards.map((e=>e.name)).join(", ")}</strong> will be burned &#128293;\n          </p>\n\n          <p>You'll get <strong>${11*this.selectedCards.length} $Roar</strong></p>\n            \n          <p>${s||""}&#128337; As the process requires a manual step, update can take up to 24h.<br>\n          &#128236; You will be notified by a zero Algo transaction when the update is complete.</p>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="button-alt" data-bs-dismiss="modal">Close</button>\n          <button type="button" id="send-button">Send request</button>\n        </div>\n      </div>\n    </div>\n    `,t.querySelector("#preview-merged-img").src=this.mergedImgDataURL;const d=t.querySelector("#send-button");d.currentModal=t,d.addEventListener("click",this.send.bind(this),!1),new window.bootstrap.Modal(t,{}).show()}async preview(){const e=this.ui.querySelector("#button-review");e.disabled=!0,e.textContent="Generating...";const t=this.ui.querySelector("#merged-img");this.mergedProperties=Object.assign({},this.selectedBather.metadata.properties);for(const e of this.selectedCards)for(const t in e.metadata.properties)this.mergedProperties[t]=e.metadata.properties[t];const s=await(0,d.i)(this.mergedProperties,o,"layers_images");this.mergedImgDataURL=s.toDataURL("image/png"),t.src=this.mergedImgDataURL,e.disabled=!1,e.textContent="Review..."}async send(e){const t=e.currentTarget;t.disabled=!0,t.textContent="Waiting for signature...";const s=await this.algodClient.getTransactionParams().do(),a={evolve:this.selectedBather.assetId},d=(new TextEncoder).encode(JSON.stringify(a));if(this.selectedCards.length>13)return void alert("No more than 14 cards can be used at once.");let i=[];for(const e of this.selectedCards)i.push(n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.cardsCollection.collections[0].addresses[0],amount:1,assetIndex:e.assetId,suggestedParams:s,note:d}));i.length>1&&n.assignGroupID(i);const o=await this.walletConnect.signTransactions(i),r=t.currentModal;let l;r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body ">\n            <div class="text-center mb-3">\n                <img src="assets/grinder.png" style="width: 128px; height: auto;">\n            </div>\n            <div class="text-center mb-3">\n            Sending Caffeine Card to the Grinder...\n            </div>\n        </div>\n      </div>\n    </div>\n    ';try{l=await this.algodClient.sendRawTransaction(o).do(),await n.waitForConfirmation(this.algodClient,l.txId,4),r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <img src="assets/heart-cup.png" width="60"><br><br>\n          We got your card and your evolution request.<br>\n          We\'ll be back to you very soon.\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    ',r.addEventListener("hidden.bs.modal",(e=>{location.reload()}))}catch(e){r.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <div class="alert alert-danger" role="alert">${e.message} </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    `,console.error(e)}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUl4QjJFLEdBRGMsSUFBSUMsYUFDUUMsT0FBT0MsS0FBS0MsVUFBVU4sSUFFdEQsR0FBSXpHLEtBQUtRLGNBQWN1RSxPQUFTLEdBRTlCLFlBREFpQyxNQUFNLDhDQUlSLElBQUlDLEVBQU8sR0FFWCxJQUFLLE1BQU1oRCxLQUFnQmpFLEtBQUtRLGNBQzlCeUcsRUFBS2pELEtBQ0gsb0RBQTBELENBQ3hEUCxLQUFNekQsS0FBS2tILGNBQWNDLGNBQ3pCQyxHQUFJcEgsS0FBS00sZ0JBQWdCK0csWUFBWSxHQUFHQyxVQUFVLEdBQ2xEQyxPQUFRLEVBQ1JDLFdBQVl2RCxFQUFhakMsUUFDekJxRSxnQkFBaUJBLEVBQ2pCSSxLQUFNRSxLQU1STSxFQUFLbEMsT0FBUyxHQUNoQixnQkFBc0JrQyxHQUd4QixNQUFNUSxRQUFtQnpILEtBQUtrSCxjQUFjUSxpQkFBaUJULEdBR3ZEdkIsRUFBZUQsRUFBV0MsYUFxQmhDLElBQUlpQyxFQW5CSmpDLEVBQWF0RixVQUFZLG9sQkFvQnpCLElBQ0V1SCxRQUFXM0gsS0FBS3NHLFlBQVlzQixtQkFBbUJILEdBQVlqQixXQUdsQyxzQkFDdkJ4RyxLQUFLc0csWUFDTHFCLEVBQUdFLEtBQ0gsR0FHRm5DLEVBQWF0RixVQUFZLHlxQkFvQnpCc0YsRUFBYTFFLGlCQUFpQixtQkFBb0J3QixJQUVoRG5CLFNBQVN5RyxRQUFRLEdBc0JyQixDQXBCRSxNQUFPQyxHQUNQckMsRUFBYXRGLFVBQVksNlhBUTBCMkgsRUFBSUMsK01BVXZEdEQsUUFBUXVELE1BQU1GLEVBQ2hCLENBQ0YsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9ncmluZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VQYWdlIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IGNvbGxlY3Rpb24gZnJvbSBcIi4uL2NvbGxlY3Rpb25zLmpzXCI7XG5pbXBvcnQgeyBORlRIb2xkZXJDb2xsZWN0aW9uIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgeyBkcmF3IH0gZnJvbSBcImJhdGgtY2x1YlwiO1xuaW1wb3J0IGFsZ29zZGsgZnJvbSBcImFsZ29zZGtcIjtcbmltcG9ydCBEcm9wZG93bk5mdHMgZnJvbSBcIi4uL2NvbW1vbi9kcm9wZG93bi1uZnRzLmpzXCI7XG5cbmltcG9ydCBsYXllcnMgZnJvbSBcIi4uLy4uLy4uL2JhdGgtY2x1Yi9sYXllcnMuanNvblwiO1xuXG5leHBvcnQgY2xhc3MgR3JpbmRlciBleHRlbmRzIEJhc2VQYWdlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcblxuICAgIHRoaXMudWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYFxuICAgIDxoMT5HcmluZGVyPC9oMT5cbiAgICA8cCBjbGFzcz1cImRhcmstdGV4dFwiPlVzZSB5b3VyIENhZmZlaW5lIENhcmRzIHRvIGN1c3RvbWl6ZSB5b3VyIEJhdGhlcnM8L3A+XG5cbiAgICA8ZGl2IGNsYXNzPVwiZC1zbS1mbGV4IGZsZXctcm93XCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1iYWNrZ3JvdW5kLWRhcmspO1wiPlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJkLWZsZXggZmxleC1jb2x1bW4gcC0zIHRleHQtY2VudGVyXCI+XG5cbiAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2RlZmF1bHQucG5nXCIgY2xhc3M9XCJtYi0yIG1zLWF1dG8gbWUtYXV0b1wiIGlkPVwiY2x1Yi1pbWdcIiBzdHlsZT1cIndpZHRoOiAyMDBweDsgaGVpZ2h0OiBhdXRvXCI+XG5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93blwiIGlkPVwiYmF0aC1jbHViLWRyb3Bkb3duXCI+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImRyb3Bkb3duLXRvZ2dsZSBidXR0b24tYWx0XCIgdHlwZT1cImJ1dHRvblwiIGRhdGEtYnMtdG9nZ2xlPVwiZHJvcGRvd25cIlxuICAgICAgICAgICAgICAgICAgICBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgICAgICAgICAgICAgICAgQ2hvb3NlIEJhdGhlclxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWItMiBtdC00IG1zLWF1dG8gbWUtYXV0byBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyIHJvdyByb3ctY29scy0yXCIgaWQ9XCJjYXJkc1wiIHN0eWxlPVwid2lkdGg6IDIwMHB4O1wiPlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIHRleHQtY2VudGVyXCIgaWQ9XCJkZWZhdWx0LWNhcmRcIiBzdHlsZT1cIndpZHRoOiAyMDBweDtcIj5cbiAgICAgICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9kZWZhdWx0LWNhcmQucG5nXCIgY2xhc3M9XCJpbWctZmx1aWRcIiBzdHlsZT1cIndpZHRoOiAyMDBweDsgaGVpZ2h0OiBhdXRvO1wiPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRyb3Bkb3duIG1iLTNcIiBpZD1cImNhcmRzLWRyb3Bkb3duXCI+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImRyb3Bkb3duLXRvZ2dsZSBidXR0b24tYWx0IG1iLTJcIiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1icy10b2dnbGU9XCJkcm9wZG93blwiXG4gICAgICAgICAgICAgICAgICAgIGFyaWEtZXhwYW5kZWQ9XCJmYWxzZVwiIGlkPVwiY2hvb3NlLWNhcmQtYnV0dG9uXCIgZGlzYWJsZWQ+XG4gICAgICAgICAgICAgICAgICAgIEFkZCBDYXJkXG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxidXR0b24gaWQ9XCJidXR0b24tcmV2aWV3XCIgZGlzYWJsZWQ+UmV2aWV3Li4uPC9idXR0b24+XG5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LWNvbHVtbiBmbGV4LWZpbGwgcC0zIHRleHQtY2VudGVyXCI+XG4gICAgICAgICAgICA8c21hbGwgY2xhc3M9XCJkYXJrLXRleHRcIj5wcmV2aWV3PC9zbWFsbD5cbiAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2RlZmF1bHQucG5nXCIgY2xhc3M9XCJ3LTEwMCBtLWF1dG8gaW1nLWZsdWlkXCIgc3R5bGU9XCJtYXgtd2lkdGg6IDQ4MHB4O1wiIGlkPVwibWVyZ2VkLWltZ1wiPlxuXG4gICAgICAgIDwvZGl2PlxuXG4gICAgPC9kaXY+YDtcblxuICAgIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb247XG4gICAgdGhpcy5jYXJkc0NvbGxlY3Rpb247XG5cbiAgICB0aGlzLnNlbGVjdGVkQmF0aGVyO1xuICAgIHRoaXMuc2VsZWN0ZWRDYXJkcyA9IFtdO1xuICAgIHRoaXMubWVyZ2VkUHJvcGVydGllcyA9IHt9O1xuXG4gICAgdGhpcy5tZXJnZWRJbWdEYXRhVVJMO1xuXG4gICAgdGhpcy5jaG9vc2VDYXJkQnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2Nob29zZS1jYXJkLWJ1dHRvblwiKTtcblxuICAgIHRoaXMubG9hZCgpO1xuICB9XG5cbiAgYXN5bmMgbG9hZCgpIHtcbiAgICBhd2FpdCB0aGlzLmxvYWRCYXRoZXJzKCk7XG5cbiAgICBjb25zdCByZXZpZXdCdXR0b24gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYnV0dG9uLXJldmlld1wiKTtcbiAgICByZXZpZXdCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMucmV2aWV3LmJpbmQodGhpcykpO1xuXG4gICAgLy9jb25zdCBzZW5kQnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI3NlbmQtYnRuXCIpO1xuICAgIC8vc2VuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5zZW5kLmJpbmQodGhpcykpO1xuXG4gICAgLy9jaGVjayBpZiBhIGJhdGhlciB3YXMgcmVxdWVzdGVkXG4gICAgY29uc3QgcXVlcnlTdHJpbmcgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoO1xuICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocXVlcnlTdHJpbmcpO1xuXG4gICAgaWYgKHVybFBhcmFtcy5oYXMoXCJiYXRoZXJcIikpIHtcbiAgICAgIGNvbnN0IGJhdGhlckFzc2V0SWQgPSBwYXJzZUludCh1cmxQYXJhbXMuZ2V0KFwiYmF0aGVyXCIpKTtcblxuICAgICAgLy9maW5kIGJhdGhlclxuICAgICAgY29uc3QgbmZ0ID0gdGhpcy5iYXRoZXJzQ29sbGVjdGlvbi5uZnRzLmZpbHRlcihcbiAgICAgICAgKG5mdCkgPT4gbmZ0LmFzc2V0SWQgPT09IGJhdGhlckFzc2V0SWRcbiAgICAgICk/LlswXTtcblxuICAgICAgaWYgKG5mdCkge1xuICAgICAgICBhd2FpdCB0aGlzLmRpc3BsYXlCYXRoZXIobmZ0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBsb2FkQmF0aGVycygpIHtcbiAgICB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uID0gdGhpcy5ob2xkaW5nc1tcImJhdGhlcnNcIl07XG5cbiAgICBjb25zdCBkcm9wZG93bkRpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNiYXRoLWNsdWItZHJvcGRvd25cIik7XG5cbiAgICBsZXQgZHJvcGRvd24gPSBkcm9wZG93bkRpdi5xdWVyeVNlbGVjdG9yKFwiLmRyb3Bkb3duLW1lbnVcIik7XG4gICAgaWYgKGRyb3Bkb3duKSB7XG4gICAgICBkcm9wZG93bi5yZW1vdmUoKTtcbiAgICB9XG5cbiAgICBkcm9wZG93biA9IG5ldyBEcm9wZG93bk5mdHMoXG4gICAgICB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHMsXG4gICAgICB0aGlzLmRpZFNlbGVjdEJhdGhlci5iaW5kKHRoaXMpXG4gICAgKTtcbiAgICBkcm9wZG93bkRpdi5hcHBlbmQoZHJvcGRvd24udWkpO1xuXG4gICAgLypcbiAgICBjb25zdCBiYXRoZXJzRHJvcGRvd25MaXN0ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2JhdGgtY2x1Yi1kcm9wZG93bi1saXN0XCIpO1xuICAgIGJhdGhlcnNEcm9wZG93bkxpc3QudGV4dENvbnRlbnQgPSBcIlwiO1xuXG4gICAgLy9hZGQgZGVmYXVsdCB2YWx1ZVxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcbiAgICBiYXRoZXJzRHJvcGRvd25MaXN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG5cbiAgICBpZiAodGhpcy5iYXRoZXJzQ29sbGVjdGlvbi5uZnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgb3B0aW9uLmlubmVySFRNTCA9ICc8YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW0gZGlzYWJsZWRcIj5ObyBiYXRoZXJzPC9hPic7XG4gICAgfVxuXG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoY29uc3QgbmZ0IG9mIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0cykge1xuICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuXG4gICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgICBhLmNsYXNzTmFtZSA9ICdkcm9wZG93bi1pdGVtJztcbiAgICAgIGEuaHJlZiA9ICcjJztcbiAgICAgIGEuZGF0YXNldC5pbmRleCA9IGk7XG5cbiAgICAgIGEuaW5uZXJIVE1MID0gYDxpbWcgc3JjPVwiJHtuZnQuaW1hZ2VVcmx9XCI+ICR7bmZ0Lm5hbWV9YDtcblxuICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuZGlkU2VsZWN0QmF0aGVyLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgICAgb3B0aW9uLmFwcGVuZChhKTtcbiAgICAgIGJhdGhlcnNEcm9wZG93bkxpc3QuYXBwZW5kKG9wdGlvbik7XG5cbiAgICAgIGkrKztcbiAgICB9XG4gICAgKi9cbiAgfVxuXG4gIGFzeW5jIGRpZFNlbGVjdEJhdGhlcihldmVudCkge1xuICAgIHRoaXMuY2xlYXJDYXJkKCk7XG5cbiAgICBjb25zdCBuZnRJbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcblxuICAgIGlmICghbmZ0SW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuZnQgPSB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHNbbmZ0SW5kZXhdO1xuXG4gICAgdGhpcy5tZXJnZWRQcm9wZXJ0aWVzID0gbmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXM7XG5cbiAgICBhd2FpdCB0aGlzLmRpc3BsYXlCYXRoZXIobmZ0KTtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBhc3luYyBkaXNwbGF5QmF0aGVyKG5mdCkge1xuICAgIHRoaXMuc2VsZWN0ZWRCYXRoZXIgPSBuZnQ7XG5cbiAgICAvL2Rpc3BsYXkgaW1hZ2VcbiAgICBjb25zdCBiYXRoZXJJbWcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2x1Yi1pbWdcIik7XG4gICAgYmF0aGVySW1nLnNyYyA9IG5mdC5pbWFnZVVybDtcblxuICAgIHRoaXMudmFsaWRhdGUoKTtcblxuICAgIGF3YWl0IHRoaXMubG9hZENhcmRzKCk7XG4gICAgdGhpcy5jaG9vc2VDYXJkQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cblxuICBjbGVhckNhcmQoKSB7XG4gICAgdGhpcy5zZWxlY3RlZENhcmRzID0gW107XG4gICAgdGhpcy5jaG9vc2VDYXJkQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXMgPSB7fTtcblxuICAgIGNvbnN0IGRlZmF1bHRDYXJkID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2RlZmF1bHQtY2FyZFwiKTtcbiAgICBkZWZhdWx0Q2FyZC5oaWRkZW4gPSBmYWxzZTtcblxuICAgIC8vcmVtb3ZlIGFsbCBkaXNwbGF5ZWQgY2FyZHNcblxuICAgIGNvbnN0IGNoaWxkcmVuID0gQXJyYXkuZnJvbSh0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHNcIikuY2hpbGRyZW4pO1xuXG4gICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGNoaWxkcmVuKSB7XG4gICAgICBpZiAoZWxlbWVudC5pZCAhPT0gXCJkZWZhdWx0LWNhcmRcIikge1xuICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxvYWRDYXJkcygpIHtcbiAgICB0aGlzLmNhcmRzQ29sbGVjdGlvbiA9IHRoaXMuaG9sZGluZ3NbXCJjYWZmZWluZUNhcmRzXCJdO1xuXG4gICAgY29uc3QgZHJvcGRvd25EaXYgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHMtZHJvcGRvd25cIik7XG5cbiAgICBsZXQgZHJvcGRvd24gPSBkcm9wZG93bkRpdi5xdWVyeVNlbGVjdG9yKFwiI2NhcmRzLWRyb3Bkb3duLW5mdFwiKTtcbiAgICBpZiAoZHJvcGRvd24pIHtcbiAgICAgIGRyb3Bkb3duLnJlbW92ZSgpO1xuICAgIH1cblxuICAgIGxldCBkaXNhYmxlZEFzc2V0SWRzID0gW107XG4gICAgbGV0IGkgPSAwO1xuICAgIG1haW5sb29wOiBmb3IgKGNvbnN0IG5mdCBvZiB0aGlzLmNhcmRzQ29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICAvL2NoZWNrIHJlcXVpcmVtZW50XG4gICAgICBpZiAobmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgZm9yIChjb25zdCByZXF1aXJlS2V5IGluIG5mdC5tZXRhZGF0YS5yZXF1aXJlKSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5tZXJnZWRQcm9wZXJ0aWVzW3JlcXVpcmVLZXldICE9XG4gICAgICAgICAgICBuZnQubWV0YWRhdGEucmVxdWlyZVtyZXF1aXJlS2V5XVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgZGlzYWJsZWRBc3NldElkcy5wdXNoKG5mdC5hc3NldElkKTtcbiAgICAgICAgICAgIGNvbnRpbnVlIG1haW5sb29wO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8qZm9yIChjb25zdCBzZWxlY3RlZENhcmQgb2YgdGhpcy5zZWxlY3RlZENhcmRzKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHNlbGVjdGVkQ2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzW3JlcXVpcmVLZXldICE9XG4gICAgICAgICAgICAgIG5mdC5tZXRhZGF0YS5yZXF1aXJlW3JlcXVpcmVLZXldXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZGlzYWJsZWRBc3NldElkcy5wdXNoKG5mdC5hc3NldElkKTtcbiAgICAgICAgICAgICAgY29udGludWUgbWFpbmxvb3A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSovXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy9yZW1vdmUgY2FyZHMgZnJvbSB0aGUgc2FtZSB0eXBlXG4gICAgICBmb3IgKGNvbnN0IHNlbGVjdGVkQ2FyZCBvZiB0aGlzLnNlbGVjdGVkQ2FyZHMpIHtcbiAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBzZWxlY3RlZENhcmQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICAgIGlmIChuZnQubWV0YWRhdGEucHJvcGVydGllc1twcm9wZXJ0eV0pIHtcbiAgICAgICAgICAgIGRpc2FibGVkQXNzZXRJZHMucHVzaChuZnQuYXNzZXRJZCk7XG4gICAgICAgICAgICBjb250aW51ZSBtYWlubG9vcDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBkcm9wZG93biA9IG5ldyBEcm9wZG93bk5mdHMoXG4gICAgICB0aGlzLmNhcmRzQ29sbGVjdGlvbi5uZnRzLFxuICAgICAgdGhpcy5kaWRTZWxlY3RDYXJkLmJpbmQodGhpcyksXG4gICAgICBcImNhcmRzLWRyb3Bkb3duLW5mdFwiLFxuICAgICAgZGlzYWJsZWRBc3NldElkc1xuICAgICk7XG4gICAgZHJvcGRvd25EaXYuYXBwZW5kKGRyb3Bkb3duLnVpKTtcblxuICAgIG5ldyB3aW5kb3cuYm9vdHN0cmFwLkRyb3Bkb3duKHRoaXMuY2hvb3NlQ2FyZEJ1dHRvbik7XG4gIH1cblxuICBhc3luYyBkaWRTZWxlY3RDYXJkKGV2ZW50KSB7XG4gICAgY29uc3QgbmZ0SW5kZXggPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG5cbiAgICBpZiAoIW5mdEluZGV4KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbmZ0ID0gdGhpcy5jYXJkc0NvbGxlY3Rpb24ubmZ0c1tuZnRJbmRleF07XG4gICAgdGhpcy5zZWxlY3RlZENhcmRzLnB1c2gobmZ0KTtcblxuICAgIC8vcmVtb3ZlIGRlZmF1bHQgY2FyZCBpZiBuZWVkZWRcbiAgICBjb25zdCBkZWZhdWx0Q2FyZCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNkZWZhdWx0LWNhcmRcIik7XG5cbiAgICBpZiAoZGVmYXVsdENhcmQpIHtcbiAgICAgIGRlZmF1bHRDYXJkLmhpZGRlbiA9IHRydWU7XG4gICAgfVxuXG4gICAgLy9hZGQgY2FyZFxuICAgIGNvbnN0IG5ld0NhcmREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG5ld0NhcmREaXYuY2xhc3NOYW1lID0gXCJjb2wgdGV4dC1jZW50ZXJcIjtcbiAgICBuZXdDYXJkRGl2LmlkID0gYGNhcmQtJHtuZnRJbmRleH1gO1xuXG4gICAgbmV3Q2FyZERpdi5pbm5lckhUTUwgPSBgXG4gICAgPGltZyBzdHlsZT1cIndpZHRoOiA4MHB4OyBoZWlnaHQ6IGF1dG9cIiBzcmM9XCIke25mdC5pbWFnZVVybH1cIj5cbiAgICA8cD48YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGlkPVwicm0tJHtuZnRJbmRleH1cIiBkYXRhLWluZGV4PVwiJHtuZnRJbmRleH1cIj5SZW1vdmU8L2E+PC9wPlxuICAgIGA7XG5cbiAgICBuZXdDYXJkRGl2XG4gICAgICAucXVlcnlTZWxlY3RvcihgI3JtLSR7bmZ0SW5kZXh9YClcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5yZW1vdmVDYXJkLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHNcIikuYXBwZW5kKG5ld0NhcmREaXYpO1xuXG4gICAgLy9kaXNwbGF5IGltYWdlXG4gICAgLy9jb25zdCBjYXJkSW1nID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1nXCIpO1xuICAgIC8vY2FyZEltZy5zcmMgPSBuZnQuaW1hZ2VVcmw7XG5cbiAgICB0aGlzLnZhbGlkYXRlKCk7XG5cbiAgICAvL3JlbG9hZCBjYXJkc1xuICAgIGF3YWl0IHRoaXMubG9hZENhcmRzKCk7XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgYXN5bmMgcmVtb3ZlQ2FyZChldmVudCkge1xuICAgIGNvbnN0IG5mdEluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4O1xuXG4gICAgaWYgKCFuZnRJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG5mdCA9IHRoaXMuY2FyZHNDb2xsZWN0aW9uLm5mdHNbbmZ0SW5kZXhdO1xuXG4gICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RlZENhcmRzLm1hcCgoYykgPT4gYy5uYW1lKSk7XG4gICAgdGhpcy5zZWxlY3RlZENhcmRzID0gdGhpcy5zZWxlY3RlZENhcmRzLmZpbHRlcihcbiAgICAgIChjKSA9PiBjLmFzc2V0SWQgIT0gbmZ0LmFzc2V0SWRcbiAgICApO1xuICAgIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0ZWRDYXJkcy5tYXAoKGMpID0+IGMubmFtZSkpO1xuXG4gICAgLy9kaXNwbGF5IGRlZmF1bHQgY2FyZCBhZ2FpbiBpZiBuZWVkZWRcbiAgICBpZiAodGhpcy5zZWxlY3RlZENhcmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc3QgZGVmYXVsdENhcmQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjZGVmYXVsdC1jYXJkXCIpO1xuXG4gICAgICBpZiAoZGVmYXVsdENhcmQpIHtcbiAgICAgICAgZGVmYXVsdENhcmQuaGlkZGVuID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy52YWxpZGF0ZSgpO1xuXG4gICAgLy9yZWxvYWQgY2FyZHNcbiAgICBhd2FpdCB0aGlzLmxvYWRDYXJkcygpO1xuXG4gICAgdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjY2FyZC0ke25mdEluZGV4fWApLnJlbW92ZSgpO1xuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuXG4gIHZhbGlkYXRlKCkge1xuICAgIGNvbnN0IHJldmlld0J1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b24tcmV2aWV3XCIpO1xuXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRCYXRoZXIgJiYgdGhpcy5zZWxlY3RlZENhcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICB0aGlzLnByZXZpZXcoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRCYXRoZXIpIHtcbiAgICAgIGNvbnN0IG1lcmdlZEltZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNtZXJnZWQtaW1nXCIpO1xuICAgICAgbWVyZ2VkSW1nLnNyYyA9IHRoaXMuc2VsZWN0ZWRCYXRoZXIuaW1hZ2VVcmw7XG5cbiAgICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV2aWV3KGV2ZW50KSB7XG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG1vZGFsLmNsYXNzTmFtZSA9IFwibW9kYWxcIjtcbiAgICBtb2RhbC50YWJJbmRleCA9IFwiLTFcIjtcblxuICAgIC8vaWYgdGhlIGdyaW5kIGNvbnRhaW4gYSBkb3VibGUtc2Vuc2l0aXZlIG1vZGlmaWNhdGlvbiBkaXNwbGF5IGEgbWVzc2FnZVxuXG4gICAgbGV0IGR1cGxpY2F0ZVNlbnNpdGl2ZUxheWVycyA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBjYXJkIG9mIHRoaXMuc2VsZWN0ZWRDYXJkcykge1xuICAgICAgZm9yIChjb25zdCBsYXllck5hbWUgaW4gY2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgIGlmIChsYXllcnMuZHVwbGljYXRlQ3JpdGVyaWEuaW5jbHVkZXMobGF5ZXJOYW1lKSkge1xuICAgICAgICAgIGR1cGxpY2F0ZVNlbnNpdGl2ZUxheWVycy5wdXNoKGxheWVyTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgZHVwbGljYXRlTWVzc2FnZTtcblxuICAgIGlmIChkdXBsaWNhdGVTZW5zaXRpdmVMYXllcnMubGVuZ3RoID4gMCl7XG4gICAgICBkdXBsaWNhdGVNZXNzYWdlID0gYCYjOTg4ODsmIzY1MDM5OyBUaGlzIHJlcXVlc3QgY29udGFpbnMgYSBtb2RpZmljYXRpb24gdGhhdCBjYW4gZ2VuZXJhdGUgYSBkdXBsaWNhdGUgKCR7ZHVwbGljYXRlU2Vuc2l0aXZlTGF5ZXJzLmpvaW4oJywnKX0pLiBJZiBpdCdzIHRoZSBjYXNlLCB0aGUgcmVxdWVzdCB3aWxsIGJlIGNhbmNlbGVkIGFuZCB0aGUgY2FyZHMgcmV0dXJuZWQgdG8geW91ciB3YWxsZXQuPGJyPmBcbiAgICB9XG5cbiAgICBtb2RhbC5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZyBtb2RhbC1kaWFsb2ctY2VudGVyZWRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIj5cbiAgICAgICAgICA8aDUgY2xhc3M9XCJtb2RhbC10aXRsZVwiPlJldmlldyBCYXRoZXIgbW9kaWZpY2F0aW9uPC9oNT5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0bi1jbG9zZVwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCIgYXJpYS1sYWJlbD1cIkNsb3NlXCI+PC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICAgICAgICA8aW1nIHN0eWxlPVwid2lkdGg6IDMyMHB4OyBoZWlnaHQ6IGF1dG87XCIgaWQ9XCJwcmV2aWV3LW1lcmdlZC1pbWdcIj5cbiAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPHA+XG4gICAgICAgICAgWW91ciA8c3Ryb25nPiR7dGhpcy5zZWxlY3RlZEJhdGhlci5uYW1lfTwvc3Ryb25nPiB3aWxsIGJlIHVwZGF0ZWQuPGJyPlxuICAgICAgICAgIFlvdXIgPHN0cm9uZz4ke3RoaXMuc2VsZWN0ZWRDYXJkc1xuICAgICAgICAgICAgLm1hcCgoYykgPT4gYy5uYW1lKVxuICAgICAgICAgICAgLmpvaW4oXCIsIFwiKX08L3N0cm9uZz4gd2lsbCBiZSBidXJuZWQgJiMxMjgyOTM7XG4gICAgICAgICAgPC9wPlxuXG4gICAgICAgICAgPHA+WW91J2xsIGdldCA8c3Ryb25nPiR7dGhpcy5zZWxlY3RlZENhcmRzLmxlbmd0aCAqIDExfSAkUm9hcjwvc3Ryb25nPjwvcD5cbiAgICAgICAgICAgIFxuICAgICAgICAgIDxwPiR7ZHVwbGljYXRlTWVzc2FnZSA/IGR1cGxpY2F0ZU1lc3NhZ2UgOiAnJ30mIzEyODMzNzsgQXMgdGhlIHByb2Nlc3MgcmVxdWlyZXMgYSBtYW51YWwgc3RlcCwgdXBkYXRlIGNhbiB0YWtlIHVwIHRvIDI0aC48YnI+XG4gICAgICAgICAgJiMxMjgyMzY7IFlvdSB3aWxsIGJlIG5vdGlmaWVkIGJ5IGEgemVybyBBbGdvIHRyYW5zYWN0aW9uIHdoZW4gdGhlIHVwZGF0ZSBpcyBjb21wbGV0ZS48L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidXR0b24tYWx0XCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIj5DbG9zZTwvYnV0dG9uPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGlkPVwic2VuZC1idXR0b25cIj5TZW5kIHJlcXVlc3Q8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgY29uc3QgcHJldmlld01lcmdlZEltZyA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tZXJnZWQtaW1nXCIpO1xuICAgIHByZXZpZXdNZXJnZWRJbWcuc3JjID0gdGhpcy5tZXJnZWRJbWdEYXRhVVJMO1xuXG4gICAgY29uc3Qgc2VuZEJ1dHRvbiA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjc2VuZC1idXR0b25cIik7XG4gICAgc2VuZEJ1dHRvbi5jdXJyZW50TW9kYWwgPSBtb2RhbDtcbiAgICBzZW5kQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnNlbmQuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgY29uc3QgbXlNb2RhbCA9IG5ldyB3aW5kb3cuYm9vdHN0cmFwLk1vZGFsKG1vZGFsLCB7fSk7XG5cbiAgICBteU1vZGFsLnNob3coKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGFzeW5jIHByZXZpZXcoKSB7XG4gICAgY29uc3QgcmV2aWV3QnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvbi1yZXZpZXdcIik7XG4gICAgcmV2aWV3QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICByZXZpZXdCdXR0b24udGV4dENvbnRlbnQgPSBcIkdlbmVyYXRpbmcuLi5cIjtcblxuICAgIGNvbnN0IG1lcmdlZEltZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNtZXJnZWQtaW1nXCIpO1xuXG4gICAgdGhpcy5tZXJnZWRQcm9wZXJ0aWVzID0gT2JqZWN0LmFzc2lnbihcbiAgICAgIHt9LFxuICAgICAgdGhpcy5zZWxlY3RlZEJhdGhlci5tZXRhZGF0YS5wcm9wZXJ0aWVzXG4gICAgKTsgLy9tYWtlIGEgc2hhbGxvdyBjb3B5XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGVkQ2FyZCBvZiB0aGlzLnNlbGVjdGVkQ2FyZHMpIHtcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIHNlbGVjdGVkQ2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgIHRoaXMubWVyZ2VkUHJvcGVydGllc1trZXldID0gc2VsZWN0ZWRDYXJkLm1ldGFkYXRhLnByb3BlcnRpZXNba2V5XTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2NvbnNvbGUubG9nKHByb3BlcnRpZXMpXG4gICAgY29uc3QgY2FudmFzID0gYXdhaXQgZHJhdyh0aGlzLm1lcmdlZFByb3BlcnRpZXMsIGxheWVycywgXCJsYXllcnNfaW1hZ2VzXCIpO1xuXG4gICAgdGhpcy5tZXJnZWRJbWdEYXRhVVJMID0gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcblxuICAgIG1lcmdlZEltZy5zcmMgPSB0aGlzLm1lcmdlZEltZ0RhdGFVUkw7XG5cbiAgICByZXZpZXdCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICByZXZpZXdCdXR0b24udGV4dENvbnRlbnQgPSBcIlJldmlldy4uLlwiO1xuICB9XG5cbiAgYXN5bmMgc2VuZChldmVudCkge1xuICAgIGNvbnN0IHNlbmRCdXR0b24gPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgIHNlbmRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIHNlbmRCdXR0b24udGV4dENvbnRlbnQgPSBcIldhaXRpbmcgZm9yIHNpZ25hdHVyZS4uLlwiO1xuXG4gICAgY29uc3Qgc3VnZ2VzdGVkUGFyYW1zID0gYXdhaXQgdGhpcy5hbGdvZENsaWVudC5nZXRUcmFuc2FjdGlvblBhcmFtcygpLmRvKCk7XG5cbiAgICAvL2dlbmVyYXRlIHR4XG5cbiAgICBjb25zdCBub3RlID0ge1xuICAgICAgZXZvbHZlOiB0aGlzLnNlbGVjdGVkQmF0aGVyLmFzc2V0SWQsXG4gICAgfTtcblxuICAgIGNvbnN0IHRleHRFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7XG4gICAgY29uc3QgZW5jb2RlZE5vdGUgPSB0ZXh0RW5jb2Rlci5lbmNvZGUoSlNPTi5zdHJpbmdpZnkobm90ZSkpO1xuXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRDYXJkcy5sZW5ndGggPiAxMykge1xuICAgICAgYWxlcnQoXCJObyBtb3JlIHRoYW4gMTQgY2FyZHMgY2FuIGJlIHVzZWQgYXQgb25jZS5cIik7IC8vMTYgbWludXMgYXNzZXQgY29uZmlnIHR4LCBtaW51cyBub3RpZmljYXRpb24gdHgsIG1pbnUgYXNzZXQgc2VuZFxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCB0eG5zID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHNlbGVjdGVkQ2FyZCBvZiB0aGlzLnNlbGVjdGVkQ2FyZHMpIHtcbiAgICAgIHR4bnMucHVzaChcbiAgICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgICBmcm9tOiB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcyxcbiAgICAgICAgICB0bzogdGhpcy5jYXJkc0NvbGxlY3Rpb24uY29sbGVjdGlvbnNbMF0uYWRkcmVzc2VzWzBdLFxuICAgICAgICAgIGFtb3VudDogMSxcbiAgICAgICAgICBhc3NldEluZGV4OiBzZWxlY3RlZENhcmQuYXNzZXRJZCxcbiAgICAgICAgICBzdWdnZXN0ZWRQYXJhbXM6IHN1Z2dlc3RlZFBhcmFtcyxcbiAgICAgICAgICBub3RlOiBlbmNvZGVkTm90ZSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy9hc3NpZ24gZ3JvdXBcbiAgICBpZiAodHhucy5sZW5ndGggPiAxKSB7XG4gICAgICBhbGdvc2RrLmFzc2lnbkdyb3VwSUQodHhucyk7XG4gICAgfVxuXG4gICAgY29uc3Qgc2lnbmVkVHhucyA9IGF3YWl0IHRoaXMud2FsbGV0Q29ubmVjdC5zaWduVHJhbnNhY3Rpb25zKHR4bnMpO1xuXG4gICAgLy9kaXNwbGF5IHdhaXQgYW5pbWF0aW9uXG4gICAgY29uc3QgY3VycmVudE1vZGFsID0gc2VuZEJ1dHRvbi5jdXJyZW50TW9kYWw7XG5cbiAgICBjdXJyZW50TW9kYWwuaW5uZXJIVE1MID0gYFxuICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1kaWFsb2cgbW9kYWwtZGlhbG9nLWNlbnRlcmVkXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4tY2xvc2VcIiBkYXRhLWJzLWRpc21pc3M9XCJtb2RhbFwiIGFyaWEtbGFiZWw9XCJDbG9zZVwiPjwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHkgXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbWItM1wiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2dyaW5kZXIucG5nXCIgc3R5bGU9XCJ3aWR0aDogMTI4cHg7IGhlaWdodDogYXV0bztcIj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICAgIFNlbmRpbmcgQ2FmZmVpbmUgQ2FyZCB0byB0aGUgR3JpbmRlci4uLlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYDtcblxuICAgIC8vc2VuZCB0cmFuc2FjdGlvblxuICAgIGxldCB0eDtcbiAgICB0cnkge1xuICAgICAgdHggPSBhd2FpdCB0aGlzLmFsZ29kQ2xpZW50LnNlbmRSYXdUcmFuc2FjdGlvbihzaWduZWRUeG5zKS5kbygpO1xuXG4gICAgICAvLyBXYWl0IGZvciBjb25maXJtYXRpb25cbiAgICAgIGxldCBjb25maXJtZWRUeG4gPSBhd2FpdCBhbGdvc2RrLndhaXRGb3JDb25maXJtYXRpb24oXG4gICAgICAgIHRoaXMuYWxnb2RDbGllbnQsXG4gICAgICAgIHR4LnR4SWQsXG4gICAgICAgIDRcbiAgICAgICk7XG5cbiAgICAgIGN1cnJlbnRNb2RhbC5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZyBtb2RhbC1kaWFsb2ctY2VudGVyZWRcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0bi1jbG9zZVwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCIgYXJpYS1sYWJlbD1cIkNsb3NlXCI+PC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlciBtYi0zXCI+XG4gICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvaGVhcnQtY3VwLnBuZ1wiIHdpZHRoPVwiNjBcIj48YnI+PGJyPlxuICAgICAgICAgIFdlIGdvdCB5b3VyIGNhcmQgYW5kIHlvdXIgZXZvbHV0aW9uIHJlcXVlc3QuPGJyPlxuICAgICAgICAgIFdlJ2xsIGJlIGJhY2sgdG8geW91IHZlcnkgc29vbi5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1mb290ZXJcIj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBkYXRhLWJzLWRpc21pc3M9XCJtb2RhbFwiPkNsb3NlPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYDtcblxuICAgICAgY3VycmVudE1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJoaWRkZW4uYnMubW9kYWxcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgIC8vcmVsb2FkIHdob2xlIHBhZ2UgdG8gdXBkYXRlIGhvbGRpbmdzXG4gICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjdXJyZW50TW9kYWwuaW5uZXJIVE1MID0gYFxuICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1kaWFsb2cgbW9kYWwtZGlhbG9nLWNlbnRlcmVkXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4tY2xvc2VcIiBkYXRhLWJzLWRpc21pc3M9XCJtb2RhbFwiIGFyaWEtbGFiZWw9XCJDbG9zZVwiPjwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbWItM1wiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJhbGVydCBhbGVydC1kYW5nZXJcIiByb2xlPVwiYWxlcnRcIj4ke2Vyci5tZXNzYWdlfSA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1mb290ZXJcIj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBkYXRhLWJzLWRpc21pc3M9XCJtb2RhbFwiPkNsb3NlPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYDtcblxuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIkdyaW5kZXIiLCJCYXNlUGFnZSIsImNvbnN0cnVjdG9yIiwic3VwZXIiLCJhcmd1bWVudHMiLCJ0aGlzIiwidWkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJiYXRoZXJzQ29sbGVjdGlvbiIsImNhcmRzQ29sbGVjdGlvbiIsInNlbGVjdGVkQmF0aGVyIiwic2VsZWN0ZWRDYXJkcyIsIm1lcmdlZFByb3BlcnRpZXMiLCJtZXJnZWRJbWdEYXRhVVJMIiwiY2hvb3NlQ2FyZEJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3IiLCJsb2FkIiwiYXN5bmMiLCJsb2FkQmF0aGVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZXZpZXciLCJiaW5kIiwicXVlcnlTdHJpbmciLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsInVybFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsImhhcyIsImJhdGhlckFzc2V0SWQiLCJwYXJzZUludCIsImdldCIsIm5mdCIsIm5mdHMiLCJmaWx0ZXIiLCJhc3NldElkIiwiZGlzcGxheUJhdGhlciIsImhvbGRpbmdzIiwiZHJvcGRvd25EaXYiLCJkcm9wZG93biIsInJlbW92ZSIsImRpZFNlbGVjdEJhdGhlciIsImFwcGVuZCIsImV2ZW50IiwiY2xlYXJDYXJkIiwibmZ0SW5kZXgiLCJjdXJyZW50VGFyZ2V0IiwiZGF0YXNldCIsImluZGV4IiwibWV0YWRhdGEiLCJwcm9wZXJ0aWVzIiwicHJldmVudERlZmF1bHQiLCJzcmMiLCJpbWFnZVVybCIsInZhbGlkYXRlIiwibG9hZENhcmRzIiwiZGlzYWJsZWQiLCJoaWRkZW4iLCJjaGlsZHJlbiIsIkFycmF5IiwiZnJvbSIsImVsZW1lbnQiLCJpZCIsImRpc2FibGVkQXNzZXRJZHMiLCJtYWlubG9vcCIsInJlcXVpcmUiLCJyZXF1aXJlS2V5IiwicHVzaCIsInNlbGVjdGVkQ2FyZCIsInByb3BlcnR5IiwiZGlkU2VsZWN0Q2FyZCIsImJvb3RzdHJhcCIsIkRyb3Bkb3duIiwiZGVmYXVsdENhcmQiLCJuZXdDYXJkRGl2IiwiY2xhc3NOYW1lIiwicmVtb3ZlQ2FyZCIsImNvbnNvbGUiLCJsb2ciLCJtYXAiLCJjIiwibmFtZSIsImxlbmd0aCIsInJldmlld0J1dHRvbiIsInByZXZpZXciLCJtb2RhbCIsInRhYkluZGV4IiwiZHVwbGljYXRlTWVzc2FnZSIsImR1cGxpY2F0ZVNlbnNpdGl2ZUxheWVycyIsImNhcmQiLCJsYXllck5hbWUiLCJqb2luIiwic2VuZEJ1dHRvbiIsImN1cnJlbnRNb2RhbCIsInNlbmQiLCJNb2RhbCIsInNob3ciLCJ0ZXh0Q29udGVudCIsIm1lcmdlZEltZyIsIk9iamVjdCIsImFzc2lnbiIsImtleSIsImNhbnZhcyIsInRvRGF0YVVSTCIsInN1Z2dlc3RlZFBhcmFtcyIsImFsZ29kQ2xpZW50IiwiZ2V0VHJhbnNhY3Rpb25QYXJhbXMiLCJkbyIsIm5vdGUiLCJldm9sdmUiLCJlbmNvZGVkTm90ZSIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwiSlNPTiIsInN0cmluZ2lmeSIsImFsZXJ0IiwidHhucyIsIndhbGxldENvbm5lY3QiLCJ3YWxsZXRBZGRyZXNzIiwidG8iLCJjb2xsZWN0aW9ucyIsImFkZHJlc3NlcyIsImFtb3VudCIsImFzc2V0SW5kZXgiLCJzaWduZWRUeG5zIiwic2lnblRyYW5zYWN0aW9ucyIsInR4Iiwic2VuZFJhd1RyYW5zYWN0aW9uIiwidHhJZCIsInJlbG9hZCIsImVyciIsIm1lc3NhZ2UiLCJlcnJvciJdLCJzb3VyY2VSb290IjoiIn0=