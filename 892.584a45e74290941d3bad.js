"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[892,998],{6998:(e,t,s)=>{s.r(t),s.d(t,{BasePage:()=>a});class a{constructor(e,t,s,a){this.walletConnect=e,this.algodClient=s,this.algoIndexer=a,this.holdings=t}}},6892:(e,t,s)=>{s.r(t),s.d(t,{Browse:()=>o});var a=s(6998),i=s(7304),n=s(5190);class o extends a.BasePage{constructor(...e){super(...arguments),this.collectionName=e[e.length-1],this.title="","caffeineCards"===this.collectionName?this.title="Caffeine Cards":"bathers"===this.collectionName&&(this.title="Bathers"),this.ui=document.createElement("div"),this.ui.innerHTML=`\n    <h1 class="mb-0">${this.title}</h1>\n    <div class="dark-text mb-4">Browse all ${this.title}</div>\n    <div class="row mb-3" id="filters"></div>\n    `,this.collection,this.bathersWithPacks,this.loadAll()}sleep(e){return new Promise((t=>setTimeout(t,e)))}async loadAll(){const e=document.createElement("p");e.textContent=`Loading ${this.title}...`,this.ui.append(e);const t=n.Z.filter((e=>e.name===this.collectionName))[0];if(this.collection=new i.tf([t]),await this.collection.load(this.algoIndexer),"bathers"===this.collectionName){const{loadPacks:e}=await Promise.all([s.e(393),s.e(298)]).then(s.bind(s,5298));try{const t=await e();t&&t.length>0&&(this.bathersWithPacks=t.map((e=>e[0])))}catch(e){console.error(e)}}e.remove(),this.displayList()}displayList(){if(!this.collection.nfts.length){const e=document.createElement("div");return e.innerHTML='<div class="dark-text mb-5">No assets</div>',void this.ui.append(e)}const e=this.ui.querySelector("#filters");e.innerHTML='\n    <div class="col-12 col-md-6">\n      <input type="search" class="form-control custom-form-control" placeholder="Name or asset ID" id="filter-search" style="max-width: 16rem;">\n    </div>\n    ',e.querySelector("#filter-search").addEventListener("search",this.search.bind(this),!1);const t=document.createElement("div");t.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5",this.ui.append(t);let s=new IntersectionObserver(this.loadVisibleNFTs.bind(this),{root:null,rootMargin:"0px",threshold:0}),a=0;for(const e of this.collection.nfts){const i=document.createElement("div");i.id=`nft-${a}`,i.className="col nft-item",i.dataset.i=a;let n="bathers"===this.collectionName?"placeholder-bather":"placeholder-card";if(i.innerHTML=`\n          <div class="list-item h-100 d-flex flex-column">\n              <div class="ratio ratio-1x1 ${n}">\n                <img src="" class="nft-img img-fluid" loading="lazy" hidden>\n              </div>\n              <div class="list-item-text flex-fill d-flex flex-column">\n                  <h4>${e.name}</h4>\n                  <div class="d-flex justify-content-between">\n                      <span class="asset-id">${e.assetId}</span>\n                      ${e.total}\n                  </div>\n                  <div class="mt-3 nft-properties">\n                  </div>\n                  <div class="flex-fill d-flex justify-content-between align-items-end mt-2">\n                        <div class="nft-special"></div>\n                        <div class="dropdown"></div>\n                  </div>\n              </div>\n          </div>\n      `,i.querySelector(".dropdown").innerHTML=`\n          <a href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n          <img src="assets/more.png" class="more">\n          </a>\n          <ul class="dropdown-menu">\n              <li><a class="dropdown-item" href="https://www.nftexplorer.app/asset/${e.assetId}" target="_blank">NFTExplorer</a></li>\n              <li><a class="dropdown-item" href="https://www.randgallery.com/algo-collection/?address=${e.assetId}" target="_blank">RandGallery</a></li>\n              <li><a class="dropdown-item" href="https://algoxnft.com/asset/${e.assetId}" target="_blank">ALGOxNFT</a></li>\n          </ul>\n    `,"bathers"===this.collectionName&&this.bathersWithPacks&&this.bathersWithPacks.includes(e.assetId)){const e=i.querySelector(".nft-special");e.dataset.bsTitle="The pack tied to this Bather has not been opened yet",e.dataset.bsToggle="tooltip",e.dataset.bsCustomClass="custom-tooltip",e.innerHTML='<img src="assets/pack-icon.png">',new window.bootstrap.Tooltip(e)}t.append(i),a++,s.observe(i)}}loadVisibleNFTs(e,t){e.forEach((e=>{if(!e.isIntersecting)return;const t=e.target,s=this.collection.nfts[t.dataset.i];if(s.loading)return;const a="bathers"===this.collectionName;s.load(this.algoIndexer,a).then((()=>{const e=t.querySelector(".nft-img");if(e.src=s.imageUrl,e.hidden=!1,s.handleImageError(e),"caffeineCards"===this.collectionName){let e="";if(s.metadata.properties){for(const t in s.metadata.properties)e+=`<span class="custom-badge">${t}</span> `;e+="<br>"}let a="";if(s.metadata.require){let e=[];for(const t in s.metadata.require)e.push(`<span class="custom-badge light">${t}: ${s.metadata.require[t]}</span>`);a=`<span class="custom-badge dark">Require:</span> ${e.join(" ")}`}t.querySelector(".nft-properties").innerHTML=`${e} ${a}<br>`;const i=t.querySelector(".nft-special");i.innerHTML='&#128293; <span id="burn-count">...</span>',i.dataset.bsTitle="Number of card definitively burned",i.dataset.bsToggle="tooltip",i.dataset.bsCustomClass="custom-tooltip",new window.bootstrap.Tooltip(i),this.algodClient.accountAssetInformation(s.metadata.burn_address,s.assetId).do().then((e=>{i.innerHTML=`&#128293; <span id="burn-count">${e["asset-holding"].amount}</span>`}))}})),s.loading=!0,this.sleep(100)}))}search(e){const t=e.currentTarget.value;if(!t)return void this.ui.querySelectorAll(".nft-item").forEach((e=>{e.hidden=!1}));let s=t.split(" ");s=s.map((e=>e.trim().toLowerCase())),s=s.filter((e=>e));let a=0;for(const e of this.collection.nfts){let t=!1;e:for(const a of s){if(e.name.toLowerCase().includes(a)||e.assetId==a){t=!0;break}if(e.metadata&&e.metadata.properties)for(const s in e.metadata.properties)if(s.toLowerCase().includes(a)||e.metadata.properties[s].toLowerCase().includes(a)){t=!0;break e}}this.ui.querySelector(`#nft-${a}`).hidden=!t,a++}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MkIsS0FBTzFELEVBQUk4QixTQUFTQyxXQUM3QixHQUNFMkIsRUFBSUwsY0FBYzlDLFNBQVNrRCxJQUMzQnpELEVBQUk4QixTQUFTQyxXQUFXMkIsR0FBS0wsY0FBYzlDLFNBQVNrRCxHQUNwRCxDQUNBRixHQUFRLEVBQ1IsTUFBTUMsQ0FDUixDQUdOLENBRW9CN0csS0FBS1EsR0FBR2dDLGNBQWMsUUFBUVksS0FFcEM0QixRQURWNEIsRUFNSnhELEdBQ0YsQ0FDRixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3R1ZGlvLy4vc3JjL3BhZ2VzL2Jhc2UuanMiLCJ3ZWJwYWNrOi8vc3R1ZGlvLy4vc3JjL3BhZ2VzL2Jyb3dzZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBjbGFzcyBCYXNlUGFnZSB7XG5cbiAgICBjb25zdHJ1Y3Rvcih3YWxsZXRDb25uZWN0LCBob2xkaW5ncywgYWxnb2RDbGllbnQsIGFsZ29JbmRleGVyKXtcblxuICAgICAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50ID0gYWxnb2RDbGllbnQ7XG4gICAgICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcbiAgICAgICAgdGhpcy5ob2xkaW5ncyA9IGhvbGRpbmdzO1xuXG4gICAgICAgIFxuXG4gICAgfVxuXG59IiwiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBORlRDb2xsZWN0aW9uIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5cbmltcG9ydCBjb2xsZWN0aW9ucyBmcm9tIFwiLi4vY29sbGVjdGlvbnMuanNcIjtcblxuZXhwb3J0IGNsYXNzIEJyb3dzZSBleHRlbmRzIEJhc2VQYWdlIHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG5cbiAgICAvL3RoaXMuY29sbGVjdGlvbk5hbWUgPSBcImNhZmZlaW5lQ2FyZHNcIjtcbiAgICB0aGlzLmNvbGxlY3Rpb25OYW1lID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuXG4gICAgdGhpcy50aXRsZSA9IFwiXCI7XG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiY2FmZmVpbmVDYXJkc1wiKSB7XG4gICAgICB0aGlzLnRpdGxlID0gXCJDYWZmZWluZSBDYXJkc1wiO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJiYXRoZXJzXCIpIHtcbiAgICAgIHRoaXMudGl0bGUgPSBcIkJhdGhlcnNcIjtcbiAgICB9XG5cbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYFxuICAgIDxoMSBjbGFzcz1cIm1iLTBcIj4ke3RoaXMudGl0bGV9PC9oMT5cbiAgICA8ZGl2IGNsYXNzPVwiZGFyay10ZXh0IG1iLTRcIj5Ccm93c2UgYWxsICR7dGhpcy50aXRsZX08L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwicm93IG1iLTNcIiBpZD1cImZpbHRlcnNcIj48L2Rpdj5cbiAgICBgO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uO1xuXG4gICAgdGhpcy5iYXRoZXJzV2l0aFBhY2tzO1xuXG4gICAgdGhpcy5sb2FkQWxsKCk7XG4gIH1cblxuICBzbGVlcChkZWxheVRpbWUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlUaW1lKSk7XG4gIH1cblxuICBhc3luYyBsb2FkQWxsKCkge1xuICAgIGNvbnN0IGxvYWRpbmdQID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgbG9hZGluZ1AudGV4dENvbnRlbnQgPSBgTG9hZGluZyAke3RoaXMudGl0bGV9Li4uYDtcbiAgICB0aGlzLnVpLmFwcGVuZChsb2FkaW5nUCk7XG5cbiAgICBjb25zdCBjYXJkQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb25zLmZpbHRlcihcbiAgICAgIChjKSA9PiBjLm5hbWUgPT09IHRoaXMuY29sbGVjdGlvbk5hbWVcbiAgICApWzBdO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uID0gbmV3IE5GVENvbGxlY3Rpb24oW2NhcmRDb2xsZWN0aW9uXSk7XG4gICAgYXdhaXQgdGhpcy5jb2xsZWN0aW9uLmxvYWQodGhpcy5hbGdvSW5kZXhlcik7XG5cbiAgICAvL2xvYWQgcGFja3NcbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJiYXRoZXJzXCIpIHtcbiAgICAgIGNvbnN0IHsgbG9hZFBhY2tzIH0gPSBhd2FpdCBpbXBvcnQoXCIuL3BhY2tzLmpzXCIpO1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwYWNrcyA9IGF3YWl0IGxvYWRQYWNrcygpO1xuXG4gICAgICAgIGlmIChwYWNrcyAmJiBwYWNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdGhpcy5iYXRoZXJzV2l0aFBhY2tzID0gcGFja3MubWFwKChwKSA9PiBwWzBdKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2FkaW5nUC5yZW1vdmUoKTtcblxuICAgIHRoaXMuZGlzcGxheUxpc3QoKTtcbiAgfVxuXG4gIGRpc3BsYXlMaXN0KCkge1xuICAgIGlmICghdGhpcy5jb2xsZWN0aW9uLm5mdHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBlbXB0eURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBlbXB0eURpdi5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cImRhcmstdGV4dCBtYi01XCI+Tm8gYXNzZXRzPC9kaXY+JztcblxuICAgICAgdGhpcy51aS5hcHBlbmQoZW1wdHlEaXYpO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy9kaXNwbGF5IGZpbHRlclxuICAgIGNvbnN0IGZpbHRlckRpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNmaWx0ZXJzXCIpO1xuXG4gICAgZmlsdGVyRGl2LmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwiY29sLTEyIGNvbC1tZC02XCI+XG4gICAgICA8aW5wdXQgdHlwZT1cInNlYXJjaFwiIGNsYXNzPVwiZm9ybS1jb250cm9sIGN1c3RvbS1mb3JtLWNvbnRyb2xcIiBwbGFjZWhvbGRlcj1cIk5hbWUgb3IgYXNzZXQgSURcIiBpZD1cImZpbHRlci1zZWFyY2hcIiBzdHlsZT1cIm1heC13aWR0aDogMTZyZW07XCI+XG4gICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGZpbHRlckRpdlxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjZmlsdGVyLXNlYXJjaFwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJzZWFyY2hcIiwgdGhpcy5zZWFyY2guYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgY29uc3QgbGlzdFZpZXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGxpc3RWaWV3LmNsYXNzTmFtZSA9IFwicm93IHJvdy1jb2xzLTIgcm93LWNvbHMtbWQtMyByb3ctY29scy1sZy00IGd5LTQgbWItNVwiO1xuICAgIHRoaXMudWkuYXBwZW5kKGxpc3RWaWV3KTtcblxuICAgIC8vbG9hZCBvbmx5IHdoZW4gZWxlbWVudCBpcyB2aXNpYmxlXG4gICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICByb290OiBudWxsLCAvL2Jyb3dzZXIgdmlld3BvcnRcbiAgICAgIHJvb3RNYXJnaW46IFwiMHB4XCIsXG4gICAgICB0aHJlc2hvbGQ6IDAuMCxcbiAgICB9O1xuXG4gICAgbGV0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKFxuICAgICAgdGhpcy5sb2FkVmlzaWJsZU5GVHMuYmluZCh0aGlzKSxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuXG4gICAgLy9kaXNwbGF5IG5mdHNcbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChjb25zdCBuZnQgb2YgdGhpcy5jb2xsZWN0aW9uLm5mdHMpIHtcbiAgICAgIGNvbnN0IG5mdERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBuZnREaXYuaWQgPSBgbmZ0LSR7aX1gO1xuICAgICAgbmZ0RGl2LmNsYXNzTmFtZSA9IFwiY29sIG5mdC1pdGVtXCI7XG4gICAgICBuZnREaXYuZGF0YXNldC5pID0gaTtcblxuICAgICAgbGV0IHBsYWNlSG9sZGVyQ2xhc3MgPSB0aGlzLmNvbGxlY3Rpb25OYW1lID09PSBcImJhdGhlcnNcIiA/IFwicGxhY2Vob2xkZXItYmF0aGVyXCIgOiBcInBsYWNlaG9sZGVyLWNhcmRcIlxuXG4gICAgICBuZnREaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaXN0LWl0ZW0gaC0xMDAgZC1mbGV4IGZsZXgtY29sdW1uXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyYXRpbyByYXRpby0xeDEgJHtwbGFjZUhvbGRlckNsYXNzfVwiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiXCIgY2xhc3M9XCJuZnQtaW1nIGltZy1mbHVpZFwiIGxvYWRpbmc9XCJsYXp5XCIgaGlkZGVuPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxpc3QtaXRlbS10ZXh0IGZsZXgtZmlsbCBkLWZsZXggZmxleC1jb2x1bW5cIj5cbiAgICAgICAgICAgICAgICAgIDxoND4ke25mdC5uYW1lfTwvaDQ+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJhc3NldC1pZFwiPiR7bmZ0LmFzc2V0SWR9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICR7bmZ0LnRvdGFsfVxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXQtMyBuZnQtcHJvcGVydGllc1wiPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIGQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiBhbGlnbi1pdGVtcy1lbmQgbXQtMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5mdC1zcGVjaWFsXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd25cIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG5cbiAgICAgIC8vYWRkIGRyb3Bkb3duIHdpdGggb3B0aW9uc1xuICAgICAgY29uc3QgZHJvcGRvd25EaXYgPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93blwiKTtcblxuICAgICAgZHJvcGRvd25EaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxhIGhyZWY9XCIjXCIgcm9sZT1cImJ1dHRvblwiIGRhdGEtYnMtdG9nZ2xlPVwiZHJvcGRvd25cIiBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9tb3JlLnBuZ1wiIGNsYXNzPVwibW9yZVwiPlxuICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8dWwgY2xhc3M9XCJkcm9wZG93bi1tZW51XCI+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly93d3cubmZ0ZXhwbG9yZXIuYXBwL2Fzc2V0LyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+TkZURXhwbG9yZXI8L2E+PC9saT5cbiAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL3d3dy5yYW5kZ2FsbGVyeS5jb20vYWxnby1jb2xsZWN0aW9uLz9hZGRyZXNzPSR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+UmFuZEdhbGxlcnk8L2E+PC9saT5cbiAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL2FsZ294bmZ0LmNvbS9hc3NldC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPkFMR094TkZUPC9hPjwvbGk+XG4gICAgICAgICAgPC91bD5cbiAgICBgO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiYmF0aGVyc1wiICYmXG4gICAgICAgIHRoaXMuYmF0aGVyc1dpdGhQYWNrcyAmJlxuICAgICAgICB0aGlzLmJhdGhlcnNXaXRoUGFja3MuaW5jbHVkZXMobmZ0LmFzc2V0SWQpXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgbmZ0U3BlY2lhbERpdiA9IG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLm5mdC1zcGVjaWFsXCIpO1xuICAgICAgICBuZnRTcGVjaWFsRGl2LmRhdGFzZXQuYnNUaXRsZSA9XG4gICAgICAgICAgXCJUaGUgcGFjayB0aWVkIHRvIHRoaXMgQmF0aGVyIGhhcyBub3QgYmVlbiBvcGVuZWQgeWV0XCI7XG4gICAgICAgIG5mdFNwZWNpYWxEaXYuZGF0YXNldC5ic1RvZ2dsZSA9IFwidG9vbHRpcFwiO1xuICAgICAgICBuZnRTcGVjaWFsRGl2LmRhdGFzZXQuYnNDdXN0b21DbGFzcyA9IFwiY3VzdG9tLXRvb2x0aXBcIjtcbiAgICAgICAgbmZ0U3BlY2lhbERpdi5pbm5lckhUTUwgPSAnPGltZyBzcmM9XCJhc3NldHMvcGFjay1pY29uLnBuZ1wiPic7XG5cbiAgICAgICAgbmV3IHdpbmRvdy5ib290c3RyYXAuVG9vbHRpcChuZnRTcGVjaWFsRGl2KTtcbiAgICAgIH1cblxuICAgICAgbGlzdFZpZXcuYXBwZW5kKG5mdERpdik7XG5cbiAgICAgIGkrKztcblxuICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShuZnREaXYpO1xuXG4gICAgICAvKm5mdC5sb2FkKHRoaXMuYWxnb0luZGV4ZXIpLnRoZW4oKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhuZnREaXYpO1xuXG4gICAgICAgIGxldCBwcm9wZXJ0aWVzTmFtZXMgPSBcIlwiO1xuXG4gICAgICAgIGlmIChuZnQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlOYW1lIGluIG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICBwcm9wZXJ0aWVzTmFtZXMgKz0gYDxzcGFuIGNsYXNzPVwiY3VzdG9tLWJhZGdlXCI+JHtwcm9wZXJ0eU5hbWV9PC9zcGFuPiBgO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByb3BlcnRpZXNOYW1lcyArPSBcIjxicj5cIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCByZXF1aXJlID0gXCJcIjtcblxuICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgICBsZXQgcmVxdWlyZUxpc3QgPSBbXTtcblxuICAgICAgICAgIGZvciAoY29uc3QgcmVxdWlyZUtleSBpbiBuZnQubWV0YWRhdGEucmVxdWlyZSkge1xuICAgICAgICAgICAgcmVxdWlyZUxpc3QucHVzaChcbiAgICAgICAgICAgICAgYDxzcGFuIGNsYXNzPVwiY3VzdG9tLWJhZGdlIGxpZ2h0XCI+JHtyZXF1aXJlS2V5fTogJHtuZnQubWV0YWRhdGEucmVxdWlyZVtyZXF1aXJlS2V5XX08L3NwYW4+YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXF1aXJlID0gYDxzcGFuIGNsYXNzPVwiY3VzdG9tLWJhZGdlIGRhcmtcIj5SZXF1aXJlOjwvc3Bhbj4gJHtyZXF1aXJlTGlzdC5qb2luKFxuICAgICAgICAgICAgXCIgXCJcbiAgICAgICAgICApfWA7XG4gICAgICAgIH1cblxuICAgICAgICBuZnREaXYucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBcIi5uZnQtcHJvcGVydGllc1wiXG4gICAgICAgICkuaW5uZXJIVE1MID0gYCR7cHJvcGVydGllc05hbWVzfSAke3JlcXVpcmV9PGJyPmA7XG5cbiAgICAgICAgLy9sb2FkIGltYWdlXG4gICAgICAgIGNvbnN0IGltYWdlID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LWltZ1wiKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gbmZ0LmltYWdlVXJsO1xuICAgICAgICBuZnQuaGFuZGxlSW1hZ2VFcnJvcihpbWFnZSk7XG5cbiAgICAgICAgLy9sb2FkIGJhbGFuY2UgZnJvbSBidXJuaW5nIGFkZHJlc3NcbiAgICAgICAgY29uc3QgYnVybkNvdW50U3BhbiA9IG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiI2J1cm4tY291bnRcIik7XG4gICAgICAgIGJ1cm5Db3VudFNwYW4udGV4dENvbnRlbnQgPSBcIi4uLlwiO1xuXG4gICAgICAgIHRoaXMuYWxnb2RDbGllbnRcbiAgICAgICAgICAuYWNjb3VudEFzc2V0SW5mb3JtYXRpb24obmZ0Lm1ldGFkYXRhLmJ1cm5fYWRkcmVzcywgbmZ0LmFzc2V0SWQpXG4gICAgICAgICAgLmRvKClcbiAgICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBidXJuQ291bnRTcGFuLnRleHRDb250ZW50ID0gYCR7cmVzdWx0W1wiYXNzZXQtaG9sZGluZ1wiXS5hbW91bnR9YDtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAvL2FkZCBkcm9wZG93biB3aXRoIG9wdGlvbnNcbiAgICAgICAgY29uc3QgZHJvcGRvd25EaXYgPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93blwiKTtcblxuICAgICAgICBkcm9wZG93bkRpdi5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICA8YSBocmVmPVwiI1wiIHJvbGU9XCJidXR0b25cIiBkYXRhLWJzLXRvZ2dsZT1cImRyb3Bkb3duXCIgYXJpYS1leHBhbmRlZD1cImZhbHNlXCI+XG4gICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9tb3JlLnBuZ1wiIGNsYXNzPVwibW9yZVwiPlxuICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgPHVsIGNsYXNzPVwiZHJvcGRvd24tbWVudVwiPlxuICAgICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly93d3cubmZ0ZXhwbG9yZXIuYXBwL2Fzc2V0LyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+TkZURXhwbG9yZXI8L2E+PC9saT5cbiAgICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9XCJkcm9wZG93bi1pdGVtXCIgaHJlZj1cImh0dHBzOi8vd3d3LnJhbmRnYWxsZXJ5LmNvbS9hbGdvLWNvbGxlY3Rpb24vP2FkZHJlc3M9JHtuZnQuYXNzZXRJZH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj5SYW5kR2FsbGVyeTwvYT48L2xpPlxuICAgICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly9hbGdveG5mdC5jb20vYXNzZXQvJHtuZnQuYXNzZXRJZH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj5BTEdPeE5GVDwvYT48L2xpPlxuICAgICAgICAgICAgPC91bD5cbiAgICAgIGA7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zbGVlcCgxMDApOyovXG4gICAgfVxuICB9XG5cbiAgbG9hZFZpc2libGVORlRzKGVudHJpZXMsIG9ic2VydmVyKSB7XG4gICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgaWYgKCFlbnRyeS5pc0ludGVyc2VjdGluZykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5mdERpdiA9IGVudHJ5LnRhcmdldDtcbiAgICAgIGNvbnN0IG5mdCA9IHRoaXMuY29sbGVjdGlvbi5uZnRzW25mdERpdi5kYXRhc2V0LmldO1xuXG4gICAgICBpZiAobmZ0LmxvYWRpbmcpIHtcbiAgICAgICAgLy9sb2FkaW5nIGhhdmUgYWxyZWFkeSBzdGFydGVkXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlUGVyYSA9IHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiYmF0aGVyc1wiID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICBuZnQubG9hZCh0aGlzLmFsZ29JbmRleGVyLCB1c2VQZXJhKS50aGVuKCgpID0+IHtcbiAgICAgICAgLy9sb2FkIGltYWdlXG4gICAgICAgIGNvbnN0IGltYWdlID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LWltZ1wiKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gbmZ0LmltYWdlVXJsO1xuICAgICAgICBpbWFnZS5oaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgbmZ0LmhhbmRsZUltYWdlRXJyb3IoaW1hZ2UpO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbGxlY3Rpb25OYW1lID09PSBcImNhZmZlaW5lQ2FyZHNcIikge1xuICAgICAgICAgIC8vZGlzcGxheSBwcm9wZXJ0aWVzXG4gICAgICAgICAgbGV0IHByb3BlcnRpZXNOYW1lcyA9IFwiXCI7XG5cbiAgICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlOYW1lIGluIG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICAgIHByb3BlcnRpZXNOYW1lcyArPSBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2VcIj4ke3Byb3BlcnR5TmFtZX08L3NwYW4+IGA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHByb3BlcnRpZXNOYW1lcyArPSBcIjxicj5cIjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsZXQgcmVxdWlyZSA9IFwiXCI7XG5cbiAgICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgICAgIGxldCByZXF1aXJlTGlzdCA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHJlcXVpcmVLZXkgaW4gbmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgICAgICAgcmVxdWlyZUxpc3QucHVzaChcbiAgICAgICAgICAgICAgICBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2UgbGlnaHRcIj4ke3JlcXVpcmVLZXl9OiAke25mdC5tZXRhZGF0YS5yZXF1aXJlW3JlcXVpcmVLZXldfTwvc3Bhbj5gXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVpcmUgPSBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2UgZGFya1wiPlJlcXVpcmU6PC9zcGFuPiAke3JlcXVpcmVMaXN0LmpvaW4oXG4gICAgICAgICAgICAgIFwiIFwiXG4gICAgICAgICAgICApfWA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBcIi5uZnQtcHJvcGVydGllc1wiXG4gICAgICAgICAgKS5pbm5lckhUTUwgPSBgJHtwcm9wZXJ0aWVzTmFtZXN9ICR7cmVxdWlyZX08YnI+YDtcblxuICAgICAgICAgIC8vbG9hZCBiYWxhbmNlIGZyb20gYnVybmluZyBhZGRyZXNzXG4gICAgICAgICAgY29uc3QgbmZ0U3BlY2lhbERpdiA9IG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLm5mdC1zcGVjaWFsXCIpO1xuICAgICAgICAgIG5mdFNwZWNpYWxEaXYuaW5uZXJIVE1MID1cbiAgICAgICAgICAgICcmIzEyODI5MzsgPHNwYW4gaWQ9XCJidXJuLWNvdW50XCI+Li4uPC9zcGFuPic7XG5cbiAgICAgICAgICAvL2FkZCB0b29sdGlwXG4gICAgICAgICAgbmZ0U3BlY2lhbERpdi5kYXRhc2V0LmJzVGl0bGUgPSBcIk51bWJlciBvZiBjYXJkIGRlZmluaXRpdmVseSBidXJuZWRcIjtcbiAgICAgICAgICBuZnRTcGVjaWFsRGl2LmRhdGFzZXQuYnNUb2dnbGUgPSBcInRvb2x0aXBcIjtcbiAgICAgICAgICBuZnRTcGVjaWFsRGl2LmRhdGFzZXQuYnNDdXN0b21DbGFzcyA9IFwiY3VzdG9tLXRvb2x0aXBcIjtcbiAgICAgICAgICBuZXcgd2luZG93LmJvb3RzdHJhcC5Ub29sdGlwKG5mdFNwZWNpYWxEaXYpO1xuXG4gICAgICAgICAgdGhpcy5hbGdvZENsaWVudFxuICAgICAgICAgICAgLmFjY291bnRBc3NldEluZm9ybWF0aW9uKG5mdC5tZXRhZGF0YS5idXJuX2FkZHJlc3MsIG5mdC5hc3NldElkKVxuICAgICAgICAgICAgLmRvKClcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgbmZ0U3BlY2lhbERpdi5pbm5lckhUTUwgPSBgJiMxMjgyOTM7IDxzcGFuIGlkPVwiYnVybi1jb3VudFwiPiR7cmVzdWx0W1wiYXNzZXQtaG9sZGluZ1wiXS5hbW91bnR9PC9zcGFuPmA7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIG5mdC5sb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgdGhpcy5zbGVlcCgxMDApO1xuICAgIH0pO1xuICB9XG5cbiAgc2VhcmNoKGV2ZW50KSB7XG5cbiAgICBjb25zdCBzZWFyY2hTZW50ZW5jZSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWU7XG5cbiAgICBpZiAoIXNlYXJjaFNlbnRlbmNlKSB7XG4gICAgICBjb25zdCBpdGVtcyA9IHRoaXMudWkucXVlcnlTZWxlY3RvckFsbChcIi5uZnQtaXRlbVwiKTtcbiAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgaXRlbS5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IHNlYXJjaFRlcm1zID0gc2VhcmNoU2VudGVuY2Uuc3BsaXQoXCIgXCIpO1xuICAgIHNlYXJjaFRlcm1zID0gc2VhcmNoVGVybXMubWFwKCh3KSA9PiB3LnRyaW0oKS50b0xvd2VyQ2FzZSgpKTtcbiAgICBzZWFyY2hUZXJtcyA9IHNlYXJjaFRlcm1zLmZpbHRlcigodykgPT4gdyk7XG5cbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChjb25zdCBuZnQgb2YgdGhpcy5jb2xsZWN0aW9uLm5mdHMpIHtcbiAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuXG4gICAgICB0ZXJtTG9vcDogZm9yIChjb25zdCB0ZXJtIG9mIHNlYXJjaFRlcm1zKSB7XG4gICAgICAgIGlmIChuZnQubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pIHx8IG5mdC5hc3NldElkID09IHRlcm0pIHtcbiAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmZ0Lm1ldGFkYXRhICYmIG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gbmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAga2V5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSkgfHxcbiAgICAgICAgICAgICAgbmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXNba2V5XS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICBicmVhayB0ZXJtTG9vcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgaXRlbUVsZW1lbnQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoYCNuZnQtJHtpfWApO1xuICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgIGl0ZW1FbGVtZW50LmhpZGRlbiA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbUVsZW1lbnQuaGlkZGVuID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaSsrO1xuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIkJhc2VQYWdlIiwiY29uc3RydWN0b3IiLCJ3YWxsZXRDb25uZWN0IiwiaG9sZGluZ3MiLCJhbGdvZENsaWVudCIsImFsZ29JbmRleGVyIiwidGhpcyIsIkJyb3dzZSIsImFyZ3MiLCJzdXBlciIsImFyZ3VtZW50cyIsImNvbGxlY3Rpb25OYW1lIiwibGVuZ3RoIiwidGl0bGUiLCJ1aSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImNvbGxlY3Rpb24iLCJiYXRoZXJzV2l0aFBhY2tzIiwibG9hZEFsbCIsInNsZWVwIiwiZGVsYXlUaW1lIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiYXN5bmMiLCJsb2FkaW5nUCIsInRleHRDb250ZW50IiwiYXBwZW5kIiwiY2FyZENvbGxlY3Rpb24iLCJjIiwibmFtZSIsImxvYWQiLCJsb2FkUGFja3MiLCJwYWNrcyIsIm1hcCIsInAiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJyZW1vdmUiLCJkaXNwbGF5TGlzdCIsIm5mdHMiLCJlbXB0eURpdiIsImZpbHRlckRpdiIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwic2VhcmNoIiwiYmluZCIsImxpc3RWaWV3IiwiY2xhc3NOYW1lIiwib2JzZXJ2ZXIiLCJJbnRlcnNlY3Rpb25PYnNlcnZlciIsImxvYWRWaXNpYmxlTkZUcyIsInJvb3QiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwiaSIsIm5mdCIsIm5mdERpdiIsImlkIiwiZGF0YXNldCIsInBsYWNlSG9sZGVyQ2xhc3MiLCJhc3NldElkIiwidG90YWwiLCJpbmNsdWRlcyIsIm5mdFNwZWNpYWxEaXYiLCJic1RpdGxlIiwiYnNUb2dnbGUiLCJic0N1c3RvbUNsYXNzIiwid2luZG93IiwiYm9vdHN0cmFwIiwiVG9vbHRpcCIsIm9ic2VydmUiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImVudHJ5IiwiaXNJbnRlcnNlY3RpbmciLCJ0YXJnZXQiLCJsb2FkaW5nIiwidXNlUGVyYSIsInRoZW4iLCJpbWFnZSIsInNyYyIsImltYWdlVXJsIiwiaGlkZGVuIiwiaGFuZGxlSW1hZ2VFcnJvciIsInByb3BlcnRpZXNOYW1lcyIsIm1ldGFkYXRhIiwicHJvcGVydGllcyIsInByb3BlcnR5TmFtZSIsInJlcXVpcmUiLCJyZXF1aXJlTGlzdCIsInJlcXVpcmVLZXkiLCJwdXNoIiwiam9pbiIsImFjY291bnRBc3NldEluZm9ybWF0aW9uIiwiYnVybl9hZGRyZXNzIiwiZG8iLCJyZXN1bHQiLCJhbW91bnQiLCJldmVudCIsInNlYXJjaFNlbnRlbmNlIiwiY3VycmVudFRhcmdldCIsInZhbHVlIiwicXVlcnlTZWxlY3RvckFsbCIsIml0ZW0iLCJzZWFyY2hUZXJtcyIsInNwbGl0IiwidyIsInRyaW0iLCJ0b0xvd2VyQ2FzZSIsImZpbHRlciIsImZvdW5kIiwidGVybUxvb3AiLCJ0ZXJtIiwia2V5Il0sInNvdXJjZVJvb3QiOiIifQ==