"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[298,998],{6998:(t,e,a)=>{a.r(e),a.d(e,{BasePage:()=>s});class s{constructor(t,e,a,s){this.walletConnect=t,this.algodClient=a,this.algoIndexer=s,this.holdings=e}}},5298:(t,e,a)=>{a.r(e),a.d(e,{Packs:()=>h,loadPacks:()=>c});var s=a(6998),i=a(7304),n=a(4050),o=a(4393);const r="https://api.atomixwap.xyz";async function c(t){let e=await fetch(`${r}/caffeine-card-pack/get-all`);if(200===e.status){let a=await e.json();const s=t.bathers.nfts.map((t=>t.assetId));let i=[];for(const t of a.packs)s.includes(t[0])&&i.push(t);return{claimablePacks:i,escrowAddress:a.escrowAddress}}throw new Error(`Can't load packs. Error ${e.status}`)}class h extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Caffeine Cards Packs</h1>\n    <p id="packs-status" class="dark-text text-center">Loading packs...</p>\n    ',this.claimablePacks,this.escrowAddress,this.fetchPacks()}sleep(t){return new Promise((e=>setTimeout(e,t)))}async fetchPacks(){const t=this.ui.querySelector("#packs-status");try{const e=await c(this.holdings);if(this.claimablePacks=e.claimablePacks,this.escrowAddress=e.escrowAddress,this.claimablePacks.length>0){let e="";this.claimablePacks.length>1&&(e="s"),t.textContent=`${this.claimablePacks.length} pack${e} to claim!`}else t.innerHTML='<img src="assets/pack0-0.png" style="width: 240px; opacity: 0.2;" class="mb-3"><br>\n        No pack to open.<br>\n        Make sure Bathers are not listed on marketplaces to see your packs.<br><br>\n        A Caffeine Card is given for every Bather bought in the <a href="https://instantshuffle.com/shuffle/yUSbzq61ZvqTIsSvLycS" target="_blank">Instant Shuffle.</a>\n        ';const a=document.createElement("div");a.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5 justify-content-center",this.ui.append(a);for(const t of this.claimablePacks){const e=document.createElement("div");e.className="col text-center ps-3 pe-3",a.append(e);const s=document.createElement("canvas");s.className="w-100 mb-0";const i=new l(s,t[1],this.algoIndexer);e.append(s),await i.load();const n=document.createElement("div");n.className="dark-text mt-0 pt-0 mb-2 hidden-pack-name",n.style.opacity="0",n.style["max-height"]="0",n.textContent=i.nft.name,e.append(n);const o=document.createElement("button");o.className="open-pack-button",o.textContent="Open",o.dataset.batherId=t[0],o.dataset.caffeineCardId=t[1],o.addEventListener("click",this.openPack.bind(this,i,n),!1),e.append(o),this.sleep(300)}}catch(e){console.error(e),t.textContent=e.message}}disableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button soft-disabled",e.disabled=!0)}))}enableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button",e.disabled=!1)}))}async openPack(t,e,a){const s=a.currentTarget;this.disableAllButtons(s);const i=s.dataset.batherId,o=s.dataset.caffeineCardId;try{s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',s.disabled=!0;let a=await this.algodClient.getTransactionParams().do(),c=[n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.walletConnect.walletAddress,amount:0,assetIndex:parseInt(o),suggestedParams:a}),n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.escrowAddress,to:this.walletConnect.walletAddress,amount:1,assetIndex:parseInt(o),suggestedParams:a})];n.assignGroupID(c);const h=await this.walletConnect.signTransactions(c),l={batherId:i,txn:btoa(String.fromCharCode.apply(null,h[0])),suggestedParams:a};s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n      Opening...',s.disabled=!0;const d=await fetch(r+"/caffeine-card-pack/claim/",{method:"POST",body:JSON.stringify(l),headers:{Accept:"application/json","Content-Type":"application/json"}});if(200!==d.status){let t;try{t=await d.json()}catch(t){}throw t&&t.error?new Error(t.error):new Error(`Error ${d.status}`)}s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">\n        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n      </svg>\n        Opened',s.disabled=!0,s.dataset.opened=!0,t.animate(),e.style.opacity="1",e.style["max-height"]="500px",this.enableAllButtons(s)}catch(t){console.error(t),alert(t.message),s.textContent="Open",s.disabled=!1,this.enableAllButtons(s)}}}class l{constructor(t,e,a){this.caffeineCardId=e,this.algoIndexer=a,this.width=660,this.height=960,this.imageWidth=960,this.numAnimationImage=4,this.canvas=t,this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.context.translate(-(this.imageWidth-this.width)/2,0),this.nft,this.cardImage,this.cardMask,this.animationImages}async load(){await this.loadAllImage()}static loadImage(t){return new Promise(((e,a)=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{e(s)},s.onerror=a,s.src=t}))}async loadAllImage(){this.animationImages=[];const t=this.caffeineCardId%4,e=await l.loadImage(`assets/pack${t}-0.png`);this.animationImages.push(e),this.drawPack(),this.cardMask=await l.loadImage("assets/card-mask.png");const a=await this.algoIndexer.lookupAssetByID(this.caffeineCardId).do();this.nft=new i.Sm(this.caffeineCardId,a.asset),await this.nft.load(this.algoIndexer);try{this.cardImage=await l.loadImage(this.nft.imageUrl)}catch(t){console.log("Error loading image from primary, trying secondary");try{this.cardImage=await l.loadImage(this.nft.imageUrlAlternate)}catch(t){this.cardImage=await l.loadImage("assets/empty-card.png")}}for(let e=1;e<=this.numAnimationImage;e++){const a=await l.loadImage(`assets/pack${t}-${e}.png`);this.animationImages.push(a)}}async drawPack(){this.context.drawImage(this.animationImages[0],0,0,this.imageWidth,this.height)}static easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}async animate(){let t=.15,e=1;const a=setInterval((()=>{if(this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[e],0,0,this.imageWidth,this.height),e===this.numAnimationImage){clearInterval(a),o.sparkles(this.canvas),t=.05;const e=.8;let s=0;const i=setInterval((()=>{const a=l.easeInOutQuad(s/e)*this.height;this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[this.numAnimationImage],0,a,this.imageWidth,this.height),s+=t,s>=e&&clearInterval(i)}),1e3*t)}e++}),1e3*t)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QmpKLEtBQUt3RyxPQUd2RnhHLEtBQUsyRyxRQUFRbUMsVUFBVSxFQUFHLEVBQUc5SSxLQUFLeUcsV0FBWXpHLEtBQUt3RyxRQUduRHhHLEtBQUsyRyxRQUFRMkIsVUFBVXRJLEtBQUtnSCxTQUFVLEVBQUcsRUFBR2hILEtBQUt5RyxXQUFZekcsS0FBS3dHLFFBRWxFeEcsS0FBSzJHLFFBQVFvQyx5QkFBMkIsWUFHeEMvSSxLQUFLMkcsUUFBUTJCLFVBQVV0SSxLQUFLK0csVUFBVyxFQUFHLEVBQUcvRyxLQUFLeUcsV0FBWXpHLEtBQUt3RyxRQUVuRXhHLEtBQUsyRyxRQUFRb0MseUJBQTJCLGNBR3hDL0ksS0FBSzJHLFFBQVEyQixVQUFVdEksS0FBS2lILGdCQUFnQmpILEtBQUswRyxtQkFBb0IsRUFBRzBDLEVBQVNwSixLQUFLeUcsV0FBWXpHLEtBQUt3RyxRQUV2RzBDLEdBQWVSLEVBRVhRLEdBQWVELEdBQ2pCRCxjQUFjRyxFQUloQixHQUVlLElBQWRULEVBRUwsQ0FFQUMsR0FBYyxHQUVDLElBQWRELEVBSUwsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9iYXNlLmpzIiwid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9wYWNrcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBjbGFzcyBCYXNlUGFnZSB7XG5cbiAgICBjb25zdHJ1Y3Rvcih3YWxsZXRDb25uZWN0LCBob2xkaW5ncywgYWxnb2RDbGllbnQsIGFsZ29JbmRleGVyKXtcblxuICAgICAgICB0aGlzLndhbGxldENvbm5lY3QgPSB3YWxsZXRDb25uZWN0O1xuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50ID0gYWxnb2RDbGllbnQ7XG4gICAgICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcbiAgICAgICAgdGhpcy5ob2xkaW5ncyA9IGhvbGRpbmdzO1xuXG4gICAgICAgIFxuXG4gICAgfVxuXG59IiwiaW1wb3J0IHsgQmFzZVBhZ2UgfSBmcm9tIFwiLi9iYXNlLmpzXCI7XG5pbXBvcnQgeyBORlRDb2xsZWN0aW9uIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgYWxnb3NkayBmcm9tICdhbGdvc2RrJztcbmltcG9ydCB7IE5GVCB9IGZyb20gXCJhbGdvLW5mdC11dGlsc1wiO1xuaW1wb3J0IHBhcnR5IGZyb20gXCJwYXJ0eS1qc1wiO1xuXG5jb25zdCBQQUNLU19BUElfVVJMID0gXCJodHRwczovL2FwaS5hdG9taXh3YXAueHl6XCI7XG4vL2NvbnN0IFBBQ0tTX0FQSV9VUkwgPSBcImh0dHBzOi8vbG9jYWxob3N0XCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkUGFja3MoaG9sZGluZ3MpIHtcbiAgbGV0IHJlc3VsdCA9IGF3YWl0IGZldGNoKGAke1BBQ0tTX0FQSV9VUkx9L2NhZmZlaW5lLWNhcmQtcGFjay9nZXQtYWxsYCk7XG5cbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IDIwMCkge1xuICAgIGxldCBqc29uID0gYXdhaXQgcmVzdWx0Lmpzb24oKTtcblxuICAgIC8vY29tcGFyZSB3aXRoIGhvbGRpbmdzXG4gICAgY29uc3QgYmF0aGVyc0lkcyA9IGhvbGRpbmdzLmJhdGhlcnMubmZ0cy5tYXAoKG5mdCkgPT4gbmZ0LmFzc2V0SWQpO1xuXG4gICAgbGV0IGNsYWltYWJsZVBhY2tzID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHBhY2sgb2YganNvbi5wYWNrcykge1xuICAgICAgaWYgKGJhdGhlcnNJZHMuaW5jbHVkZXMocGFja1swXSkpIHtcbiAgICAgICAgY2xhaW1hYmxlUGFja3MucHVzaChwYWNrKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgY2xhaW1hYmxlUGFja3M6IGNsYWltYWJsZVBhY2tzLFxuICAgICAgZXNjcm93QWRkcmVzczoganNvbi5lc2Nyb3dBZGRyZXNzLFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5cXCd0IGxvYWQgcGFja3MuIEVycm9yICR7cmVzdWx0LnN0YXR1c31gKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGFja3MgZXh0ZW5kcyBCYXNlUGFnZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG5cbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICA8aDE+Q2FmZmVpbmUgQ2FyZHMgUGFja3M8L2gxPlxuICAgIDxwIGlkPVwicGFja3Mtc3RhdHVzXCIgY2xhc3M9XCJkYXJrLXRleHQgdGV4dC1jZW50ZXJcIj5Mb2FkaW5nIHBhY2tzLi4uPC9wPlxuICAgIGA7XG5cbiAgICB0aGlzLmNsYWltYWJsZVBhY2tzO1xuICAgIHRoaXMuZXNjcm93QWRkcmVzcztcblxuICAgIHRoaXMuZmV0Y2hQYWNrcygpO1xuICB9XG5cbiAgc2xlZXAoZGVsYXlUaW1lKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWxheVRpbWUpKTtcbiAgfSBcblxuICBhc3luYyBmZXRjaFBhY2tzKCkge1xuXG4gICAgY29uc3QgcGFja1N0YXR1c1AgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcGFja3Mtc3RhdHVzXCIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxvYWRQYWNrcyh0aGlzLmhvbGRpbmdzKTtcblxuICAgICAgdGhpcy5jbGFpbWFibGVQYWNrcyA9IHJlc3VsdC5jbGFpbWFibGVQYWNrcztcbiAgICAgIHRoaXMuZXNjcm93QWRkcmVzcyA9IHJlc3VsdC5lc2Nyb3dBZGRyZXNzO1xuXG4gICAgICBpZiAodGhpcy5jbGFpbWFibGVQYWNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBwbHVyYWwgPSAnJztcbiAgICAgICAgaWYgKHRoaXMuY2xhaW1hYmxlUGFja3MubGVuZ3RoID4gMSl7XG4gICAgICAgICAgcGx1cmFsID0gJ3MnO1xuICAgICAgICB9XG4gICAgICAgIHBhY2tTdGF0dXNQLnRleHRDb250ZW50ID0gYCR7dGhpcy5jbGFpbWFibGVQYWNrcy5sZW5ndGh9IHBhY2ske3BsdXJhbH0gdG8gY2xhaW0hYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhY2tTdGF0dXNQLmlubmVySFRNTCA9IGA8aW1nIHNyYz1cImFzc2V0cy9wYWNrMC0wLnBuZ1wiIHN0eWxlPVwid2lkdGg6IDI0MHB4OyBvcGFjaXR5OiAwLjI7XCIgY2xhc3M9XCJtYi0zXCI+PGJyPlxuICAgICAgICBObyBwYWNrIHRvIG9wZW4uPGJyPlxuICAgICAgICBNYWtlIHN1cmUgQmF0aGVycyBhcmUgbm90IGxpc3RlZCBvbiBtYXJrZXRwbGFjZXMgdG8gc2VlIHlvdXIgcGFja3MuPGJyPjxicj5cbiAgICAgICAgQSBDYWZmZWluZSBDYXJkIGlzIGdpdmVuIGZvciBldmVyeSBCYXRoZXIgYm91Z2h0IGluIHRoZSA8YSBocmVmPVwiaHR0cHM6Ly9pbnN0YW50c2h1ZmZsZS5jb20vc2h1ZmZsZS95VVNienE2MVp2cVRJc1N2THljU1wiIHRhcmdldD1cIl9ibGFua1wiPkluc3RhbnQgU2h1ZmZsZS48L2E+XG4gICAgICAgIGA7XG4gICAgICB9XG5cbiAgICAgIC8vZGlzcGxheSBwYWNrIGxpc3RcbiAgICAgIGNvbnN0IHBhY2tzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHBhY2tzRGl2LmNsYXNzTmFtZSA9XG4gICAgICAgIFwicm93IHJvdy1jb2xzLTIgcm93LWNvbHMtbWQtMyByb3ctY29scy1sZy00IGd5LTQgbWItNSBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyXCI7XG4gICAgICB0aGlzLnVpLmFwcGVuZChwYWNrc0Rpdik7XG5cbiAgICAgIGZvciAoY29uc3QgcGFjayBvZiB0aGlzLmNsYWltYWJsZVBhY2tzKSB7XG4gICAgICAgIGNvbnN0IHBhY2tEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBwYWNrRGl2LmNsYXNzTmFtZSA9IFwiY29sIHRleHQtY2VudGVyIHBzLTMgcGUtM1wiO1xuICAgICAgICBwYWNrc0Rpdi5hcHBlbmQocGFja0Rpdik7XG5cbiAgICAgICAgLypjb25zdCBncmFwaGljRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZ3JhcGhpY0Rpdi5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgZ3JhcGhpY0Rpdi5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCJhc3NldHMvcGFjazAucG5nXCIgY2xhc3M9XCJ3LTEwMCBtYi0yXCI+YDtcbiAgICAgICAgcGFja0Rpdi5hcHBlbmQoZ3JhcGhpY0Rpdik7Ki9cblxuICAgICAgICBjb25zdCBwYWNrQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgICAgcGFja0NhbnZhcy5jbGFzc05hbWUgPSAndy0xMDAgbWItMCc7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgUGFja0NhbnZhc0NvbnRyb2xsZXIocGFja0NhbnZhcywgcGFja1sxXSwgdGhpcy5hbGdvSW5kZXhlcik7XG4gICAgICAgIHBhY2tEaXYuYXBwZW5kKHBhY2tDYW52YXMpO1xuXG4gICAgICAgIGF3YWl0IGNvbnRyb2xsZXIubG9hZCgpO1xuXG4gICAgICAgICAgY29uc3QgaGlkZGVuTmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgaGlkZGVuTmFtZS5jbGFzc05hbWUgPSBcImRhcmstdGV4dCBtdC0wIHB0LTAgbWItMiBoaWRkZW4tcGFjay1uYW1lXCI7XG4gICAgICAgICAgaGlkZGVuTmFtZS5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuICAgICAgICAgIGhpZGRlbk5hbWUuc3R5bGVbJ21heC1oZWlnaHQnXSA9ICcwJztcbiAgICAgICAgICAvL2hpZGRlbk5hbWUuaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICBoaWRkZW5OYW1lLnRleHRDb250ZW50ID0gY29udHJvbGxlci5uZnQubmFtZTtcbiAgICAgICAgICBwYWNrRGl2LmFwcGVuZChoaWRkZW5OYW1lKTtcblxuICAgICAgICAgIGNvbnN0IG9wZW5CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgICAgIG9wZW5CdXR0b24uY2xhc3NOYW1lID0gXCJvcGVuLXBhY2stYnV0dG9uXCJcbiAgICAgICAgICBvcGVuQnV0dG9uLnRleHRDb250ZW50ID0gXCJPcGVuXCI7XG4gICAgICAgICAgb3BlbkJ1dHRvbi5kYXRhc2V0LmJhdGhlcklkID0gcGFja1swXTtcbiAgICAgICAgICBvcGVuQnV0dG9uLmRhdGFzZXQuY2FmZmVpbmVDYXJkSWQgPSBwYWNrWzFdO1xuICAgICAgICAgIG9wZW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMub3BlblBhY2suYmluZCh0aGlzLCBjb250cm9sbGVyLCBoaWRkZW5OYW1lKSwgZmFsc2UpO1xuICAgICAgICAgIHBhY2tEaXYuYXBwZW5kKG9wZW5CdXR0b24pO1xuXG4gICAgICAgIC8qfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgIH0pOyovXG5cbiAgICAgICAgdGhpcy5zbGVlcCgzMDApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuXG4gICAgICBwYWNrU3RhdHVzUC50ZXh0Q29udGVudCA9IGVyci5tZXNzYWdlO1xuICAgICAgLy9hbGVydChlcnIubWVzc2FnZSk7XG4gICAgfVxuXG4gIH1cblxuICBkaXNhYmxlQWxsQnV0dG9ucyhleGNlcHQpe1xuXG4gICAgY29uc3QgYnV0dG9ucyA9IHRoaXMudWkucXVlcnlTZWxlY3RvckFsbCgnLm9wZW4tcGFjay1idXR0b24nKTtcbiAgICBcbiAgICBidXR0b25zLmZvckVhY2goYiA9PiB7XG5cbiAgICAgIGlmIChiICE9PSBleGNlcHQgJiYgIWIuZGF0YXNldC5vcGVuZWQpe1xuICAgICAgICBiLmNsYXNzTmFtZSA9IFwib3Blbi1wYWNrLWJ1dHRvbiBzb2Z0LWRpc2FibGVkXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgXG4gICAgfSk7XG4gIH1cblxuICBlbmFibGVBbGxCdXR0b25zKGV4Y2VwdCl7XG5cbiAgICBjb25zdCBidXR0b25zID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKCcub3Blbi1wYWNrLWJ1dHRvbicpO1xuICAgIFxuICAgIGJ1dHRvbnMuZm9yRWFjaChiID0+IHtcblxuICAgICAgaWYgKGIgIT09IGV4Y2VwdCAmJiAhYi5kYXRhc2V0Lm9wZW5lZCl7XG4gICAgICAgIGIuY2xhc3NOYW1lID0gXCJvcGVuLXBhY2stYnV0dG9uXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgICAgXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBvcGVuUGFjayhwYWNrQ2FudmFzQ29udHJvbGxlciwgaGlkZGVuTmFtZSwgZXZlbnQpIHtcblxuICAgIGNvbnN0IGNhbGxpbmdCdXR0b24gPSBldmVudC5jdXJyZW50VGFyZ2V0OyBcblxuICAgIHRoaXMuZGlzYWJsZUFsbEJ1dHRvbnMoY2FsbGluZ0J1dHRvbik7XG5cbiAgICBjb25zdCBiYXRoZXJJZCA9IGNhbGxpbmdCdXR0b24uZGF0YXNldC5iYXRoZXJJZDtcbiAgICBjb25zdCBjYWZmZWluZUNhcmRJZCA9IGNhbGxpbmdCdXR0b24uZGF0YXNldC5jYWZmZWluZUNhcmRJZDtcblxuICAgIHRyeSB7XG5cbiAgICAgIGNhbGxpbmdCdXR0b24uaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIiByb2xlPVwic3RhdHVzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9zcGFuPmA7XG4gICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgbGV0IHN1Z2dlc3RlZFBhcmFtcyA9IGF3YWl0IHRoaXMuYWxnb2RDbGllbnQuZ2V0VHJhbnNhY3Rpb25QYXJhbXMoKS5kbygpO1xuXG4gICAgICAvL3ByZXBhcmUgb3B0aW4gdHhuXG4gICAgICBsZXQgb3B0aW5UeG4gPVxuICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgZnJvbTogdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MsXG4gICAgICAgIHRvOiB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcyxcbiAgICAgICAgYW1vdW50OiAwLFxuICAgICAgICBhc3NldEluZGV4OiBwYXJzZUludChjYWZmZWluZUNhcmRJZCksXG4gICAgICAgIHN1Z2dlc3RlZFBhcmFtczogc3VnZ2VzdGVkUGFyYW1zLFxuICAgICAgfSk7XG5cbiAgICAvL3ByZXBhcmUgdHJhbnNmZXIgdHhuXG4gICAgbGV0IHRyYW5zZmVyVHhuID1cbiAgICAgIGFsZ29zZGsubWFrZUFzc2V0VHJhbnNmZXJUeG5XaXRoU3VnZ2VzdGVkUGFyYW1zRnJvbU9iamVjdCh7XG4gICAgICAgIGZyb206IHRoaXMuZXNjcm93QWRkcmVzcyxcbiAgICAgICAgdG86IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICBhbW91bnQ6IDEsXG4gICAgICAgIGFzc2V0SW5kZXg6IHBhcnNlSW50KGNhZmZlaW5lQ2FyZElkKSxcbiAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXMsXG4gICAgICB9KTtcblxuICAgICAgbGV0IGFsbFR4bnMgPSBbb3B0aW5UeG4sIHRyYW5zZmVyVHhuXTtcbiAgICAgIGFsZ29zZGsuYXNzaWduR3JvdXBJRChhbGxUeG5zKTtcblxuICAgICAgY29uc3Qgc2lnbmVkVHhucyA9IGF3YWl0IHRoaXMud2FsbGV0Q29ubmVjdC5zaWduVHJhbnNhY3Rpb25zKGFsbFR4bnMpO1xuXG4gICAgICBjb25zdCBzaWduZWRUeG5Kc29uID0ge1xuICAgICAgICBiYXRoZXJJZDogYmF0aGVySWQsXG4gICAgICAgIHR4bjogYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHNpZ25lZFR4bnNbMF0pKSxcbiAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXNcbiAgICAgIH1cblxuICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgICBPcGVuaW5nLi4uYDtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAvL2NhbGwgYXBpXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFBBQ0tTX0FQSV9VUkwgKyBcIi9jYWZmZWluZS1jYXJkLXBhY2svY2xhaW0vXCIsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc2lnbmVkVHhuSnNvbiksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuXG4gICAgICAgIC8vY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcblxuICAgICAgICBjYWxsaW5nQnV0dG9uLmlubmVySFRNTCA9IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjI0XCIgaGVpZ2h0PVwiMjRcIiBmaWxsPVwiY3VycmVudENvbG9yXCIgY2xhc3M9XCJiaSBiaS1jaGVjay1jaXJjbGUtZmlsbFwiIHZpZXdCb3g9XCIwIDAgMTYgMTZcIj5cbiAgICAgICAgPHBhdGggZD1cIk0xNiA4QTggOCAwIDEgMSAwIDhhOCA4IDAgMCAxIDE2IDB6bS0zLjk3LTMuMDNhLjc1Ljc1IDAgMCAwLTEuMDguMDIyTDcuNDc3IDkuNDE3IDUuMzg0IDcuMzIzYS43NS43NSAwIDAgMC0xLjA2IDEuMDZMNi45NyAxMS4wM2EuNzUuNzUgMCAwIDAgMS4wNzktLjAybDMuOTkyLTQuOTlhLjc1Ljc1IDAgMCAwLS4wMS0xLjA1elwiLz5cbiAgICAgIDwvc3ZnPlxuICAgICAgICBPcGVuZWRgO1xuICAgICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgY2FsbGluZ0J1dHRvbi5kYXRhc2V0Lm9wZW5lZCA9IHRydWU7XG5cbiAgICAgICAgLy9hbmltYXRlIHBhY2sgb3BlbmluZ1xuICAgICAgICBwYWNrQ2FudmFzQ29udHJvbGxlci5hbmltYXRlKCk7XG5cbiAgICAgICAgaGlkZGVuTmFtZS5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuICAgICAgICBoaWRkZW5OYW1lLnN0eWxlWydtYXgtaGVpZ2h0J10gPSAnNTAwcHgnO1xuXG4gICAgICAgIHRoaXMuZW5hYmxlQWxsQnV0dG9ucyhjYWxsaW5nQnV0dG9uKTtcblxuICAgICAgfSBlbHNlIHtcblxuICAgICAgICBsZXQgZGF0YTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH0gY2F0Y2goZXJyKSB7fVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEuZXJyb3Ipe1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLmVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgICB9XG5cbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycikge1xuXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICBhbGVydChlcnIubWVzc2FnZSk7XG5cbiAgICAgIGNhbGxpbmdCdXR0b24udGV4dENvbnRlbnQgPSBcIk9wZW5cIjtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgICAgdGhpcy5lbmFibGVBbGxCdXR0b25zKGNhbGxpbmdCdXR0b24pO1xuXG4gICAgfVxuXG4gIH1cbiAgXG59XG5cblxuY2xhc3MgUGFja0NhbnZhc0NvbnRyb2xsZXJ7XG5cbiAgY29uc3RydWN0b3IoY2FudmFzLCBjYWZmZWluZUNhcmRJZCwgYWxnb0luZGV4ZXIpe1xuXG4gICAgdGhpcy5jYWZmZWluZUNhcmRJZCA9IGNhZmZlaW5lQ2FyZElkO1xuICAgIHRoaXMuYWxnb0luZGV4ZXIgPSBhbGdvSW5kZXhlcjtcblxuICAgIHRoaXMud2lkdGggPSA2NjA7XG4gICAgdGhpcy5oZWlnaHQgPSA5NjBcbiAgICB0aGlzLmltYWdlV2lkdGggPSA5NjA7XG5cbiAgICB0aGlzLm51bUFuaW1hdGlvbkltYWdlID0gNDtcblxuICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcblxuICAgIHRoaXMuY29udGV4dCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdGhpcy5jb250ZXh0LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgLy90aGlzLmNvbnRleHQuZmlsbFN0eWxlID0gJ3JlZCc7XG4gICAgLy90aGlzLmNvbnRleHQuZmlsbFJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgdGhpcy5jb250ZXh0LnRyYW5zbGF0ZSgtKHRoaXMuaW1hZ2VXaWR0aCAtIHRoaXMud2lkdGgpLzIsIDApO1xuXG4gICAgLy9sb2FkIGFuaW1hdGlvbiBpbWFnZXNcbiAgICAvL2xvYWQgY2FmZmVpbmUgY2FyZCBpbWFnZVxuXG4gICAgdGhpcy5uZnQ7XG5cbiAgICB0aGlzLmNhcmRJbWFnZTtcbiAgICB0aGlzLmNhcmRNYXNrO1xuICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzO1xuXG5cbiAgfVxuXG4gIGFzeW5jIGxvYWQoKXtcbiAgICBhd2FpdCB0aGlzLmxvYWRBbGxJbWFnZSgpO1xuICB9XG5cbiAgc3RhdGljIGxvYWRJbWFnZShwYXRoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgY29uc3QgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICAgICAgaW1hZ2UuY3Jvc3NPcmlnaW4gPSAnQW5vbnltb3VzJztcblxuICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICByZXNvbHZlKGltYWdlKTtcbiAgICAgIH1cblxuICAgICAgaW1hZ2Uub25lcnJvciA9IHJlamVjdFxuXG4gICAgICBpbWFnZS5zcmMgPSBwYXRoO1xuXG4gICAgfSlcbiAgfVxuXG4gIGFzeW5jIGxvYWRBbGxJbWFnZSgpe1xuXG4gICAgdGhpcy5hbmltYXRpb25JbWFnZXMgPSBbXTtcblxuICAgIC8vY2hvb3NlIGEgY29sb3IgcmFuZG9tbHkgZGVwZW5kaW5nIG9uIGNhcmQgYXNzZXQgaWRcbiAgICBjb25zdCBjb2xvckluZGV4ID0gdGhpcy5jYWZmZWluZUNhcmRJZCAlIDQ7XG4gICAgLy9jb25zdCBjb2xvckluZGV4ID0gMDtcblxuICAgIC8vbG9hZCBmaXJzdCBpbWFnZSBhbmQgZGlzcGxheSBpdCBhcyBzb29uIGFzIHBvc3NpYmxlXG4gICAgY29uc3QgaW5pdGlhbEltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKGBhc3NldHMvcGFjayR7Y29sb3JJbmRleH0tMC5wbmdgKTtcbiAgICB0aGlzLmFuaW1hdGlvbkltYWdlcy5wdXNoKGluaXRpYWxJbWFnZSlcbiAgICB0aGlzLmRyYXdQYWNrKCk7XG5cbiAgICAvL2xvYWQgbWFza1xuICAgIHRoaXMuY2FyZE1hc2sgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoYGFzc2V0cy9jYXJkLW1hc2sucG5nYCk7XG5cbiAgICAvL2xvYWQgbmZ0IGltYWdlXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hbGdvSW5kZXhlci5sb29rdXBBc3NldEJ5SUQodGhpcy5jYWZmZWluZUNhcmRJZCkuZG8oKTtcbiAgICB0aGlzLm5mdCA9IG5ldyBORlQodGhpcy5jYWZmZWluZUNhcmRJZCwgcmVzdWx0Wydhc3NldCddKTtcbiAgICBhd2FpdCB0aGlzLm5mdC5sb2FkKHRoaXMuYWxnb0luZGV4ZXIpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICB0aGlzLmNhcmRJbWFnZSA9IGF3YWl0IFBhY2tDYW52YXNDb250cm9sbGVyLmxvYWRJbWFnZSh0aGlzLm5mdC5pbWFnZVVybCk7XG4gICAgfSBjYXRjaCAoZXJyKXtcbiAgICAgIGNvbnNvbGUubG9nKGBFcnJvciBsb2FkaW5nIGltYWdlIGZyb20gcHJpbWFyeSwgdHJ5aW5nIHNlY29uZGFyeWApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UodGhpcy5uZnQuaW1hZ2VVcmxBbHRlcm5hdGUpO1xuICAgICAgfSBjYXRjaCAoZXJyKXtcbiAgICAgICAgdGhpcy5jYXJkSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoJ2Fzc2V0cy9lbXB0eS1jYXJkLnBuZycpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vbG9hZCBhbmltYXRpb24gaW1hZ2VzXG4gICAgXG4gICAgXG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSB0aGlzLm51bUFuaW1hdGlvbkltYWdlOyBpKyspe1xuICAgICAgY29uc3QgYW5pbWF0aW9uSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UoYGFzc2V0cy9wYWNrJHtjb2xvckluZGV4fS0ke2l9LnBuZ2ApO1xuICAgICAgdGhpcy5hbmltYXRpb25JbWFnZXMucHVzaChhbmltYXRpb25JbWFnZSk7XG4gICAgfVxuXG4gIH1cblxuICBcblxuICBhc3luYyBkcmF3UGFjaygpe1xuXG4gICAgLy9sb2FkIGltYWdlXG4gICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmFuaW1hdGlvbkltYWdlc1swXSwgMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgfVxuXG4gIHN0YXRpYyBlYXNlSW5PdXRRdWFkKHgpIHtcbiAgICByZXR1cm4geCA8IDAuNSA/IDIgKiB4ICogeCA6IDEgLSBNYXRoLnBvdygtMiAqIHggKyAyLCAyKSAvIDI7XG4gIH1cblxuICBhc3luYyBhbmltYXRlKCl7XG5cbiAgICBsZXQgZnJhbWVEdXJhdGlvbiA9IDAuMTU7XG5cbiAgICBsZXQgY3VycmVudEZyYW1lID0gMTtcblxuICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG5cbiAgICAgIC8vY2xlYXIgY29udGV4dFxuICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgLy9kcmF3IG1hc2tcbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5jYXJkTWFzaywgMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLWluJztcblxuICAgICAgLy9kcmF3IGNhcmRcbiAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5jYXJkSW1hZ2UsIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICB0aGlzLmNvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ3NvdXJjZS1vdmVyJztcblxuICAgICAgLy9kcmF3IHBhY2sgYW5pbWF0aW9uXG4gICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuYW5pbWF0aW9uSW1hZ2VzW2N1cnJlbnRGcmFtZV0sIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICBpZiAoY3VycmVudEZyYW1lID09PSB0aGlzLm51bUFuaW1hdGlvbkltYWdlKXtcblxuICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xuXG4gICAgICAgIHBhcnR5LnNwYXJrbGVzKHRoaXMuY2FudmFzKTtcblxuICAgICAgICAvL3N0YXJ0IHNsaWRlIGFuaW1hdGlvblxuICAgICAgICBmcmFtZUR1cmF0aW9uID0gMC4wNTtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRHVyYXRpb24gPSAwLjg7XG4gICAgICAgIGxldCBjdXJyZW50VGltZSA9IDA7XG5cbiAgICAgICAgY29uc3QgaW50ZXJ2YWxJZDIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG5cbiAgICAgICAgICBjb25zdCB5T2Zmc2V0ID0gUGFja0NhbnZhc0NvbnRyb2xsZXIuZWFzZUluT3V0UXVhZChjdXJyZW50VGltZS9hbmltYXRpb25EdXJhdGlvbikqdGhpcy5oZWlnaHQ7XG5cbiAgICAgICAgICAvL2NsZWFyIGNvbnRleHRcbiAgICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICAgICAgLy9kcmF3IG1hc2tcbiAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuY2FyZE1hc2ssIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICAgICAgdGhpcy5jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2UtaW4nO1xuXG4gICAgICAgICAgLy9kcmF3IGNhcmRcbiAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuY2FyZEltYWdlLCAwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInO1xuXG4gICAgICAgICAgLy9kcmF3IHBhY2sgYW5pbWF0aW9uXG4gICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmFuaW1hdGlvbkltYWdlc1t0aGlzLm51bUFuaW1hdGlvbkltYWdlXSwgMCwgeU9mZnNldCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgICAgICBjdXJyZW50VGltZSArPSBmcmFtZUR1cmF0aW9uO1xuXG4gICAgICAgICAgaWYgKGN1cnJlbnRUaW1lID49IGFuaW1hdGlvbkR1cmF0aW9uKXtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZDIpO1xuXG4gICAgICAgICAgICBcblxuICAgICAgICAgIH1cblxuICAgICAgICB9LCBmcmFtZUR1cmF0aW9uKjEwMDApO1xuXG4gICAgICB9XG5cbiAgICAgIGN1cnJlbnRGcmFtZSsrO1xuXG4gICAgfSwgZnJhbWVEdXJhdGlvbioxMDAwKVxuXG5cblxuICB9XG5cbn1cbiJdLCJuYW1lcyI6WyJCYXNlUGFnZSIsImNvbnN0cnVjdG9yIiwid2FsbGV0Q29ubmVjdCIsImhvbGRpbmdzIiwiYWxnb2RDbGllbnQiLCJhbGdvSW5kZXhlciIsInRoaXMiLCJQQUNLU19BUElfVVJMIiwiYXN5bmMiLCJsb2FkUGFja3MiLCJyZXN1bHQiLCJmZXRjaCIsInN0YXR1cyIsImpzb24iLCJiYXRoZXJzSWRzIiwiYmF0aGVycyIsIm5mdHMiLCJtYXAiLCJuZnQiLCJhc3NldElkIiwiY2xhaW1hYmxlUGFja3MiLCJwYWNrIiwicGFja3MiLCJpbmNsdWRlcyIsInB1c2giLCJlc2Nyb3dBZGRyZXNzIiwiRXJyb3IiLCJQYWNrcyIsInN1cGVyIiwiYXJndW1lbnRzIiwidWkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJmZXRjaFBhY2tzIiwic2xlZXAiLCJkZWxheVRpbWUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJwYWNrU3RhdHVzUCIsInF1ZXJ5U2VsZWN0b3IiLCJsZW5ndGgiLCJwbHVyYWwiLCJ0ZXh0Q29udGVudCIsInBhY2tzRGl2IiwiY2xhc3NOYW1lIiwiYXBwZW5kIiwicGFja0RpdiIsInBhY2tDYW52YXMiLCJjb250cm9sbGVyIiwiUGFja0NhbnZhc0NvbnRyb2xsZXIiLCJsb2FkIiwiaGlkZGVuTmFtZSIsInN0eWxlIiwib3BhY2l0eSIsIm5hbWUiLCJvcGVuQnV0dG9uIiwiZGF0YXNldCIsImJhdGhlcklkIiwiY2FmZmVpbmVDYXJkSWQiLCJhZGRFdmVudExpc3RlbmVyIiwib3BlblBhY2siLCJiaW5kIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwibWVzc2FnZSIsImRpc2FibGVBbGxCdXR0b25zIiwiZXhjZXB0IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJiIiwib3BlbmVkIiwiZGlzYWJsZWQiLCJlbmFibGVBbGxCdXR0b25zIiwicGFja0NhbnZhc0NvbnRyb2xsZXIiLCJldmVudCIsImNhbGxpbmdCdXR0b24iLCJjdXJyZW50VGFyZ2V0Iiwic3VnZ2VzdGVkUGFyYW1zIiwiZ2V0VHJhbnNhY3Rpb25QYXJhbXMiLCJkbyIsImFsbFR4bnMiLCJmcm9tIiwid2FsbGV0QWRkcmVzcyIsInRvIiwiYW1vdW50IiwiYXNzZXRJbmRleCIsInBhcnNlSW50Iiwic2lnbmVkVHhucyIsInNpZ25UcmFuc2FjdGlvbnMiLCJzaWduZWRUeG5Kc29uIiwidHhuIiwiYnRvYSIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImFwcGx5IiwicmVzcG9uc2UiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJBY2NlcHQiLCJkYXRhIiwiYW5pbWF0ZSIsImFsZXJ0IiwiY2FudmFzIiwid2lkdGgiLCJoZWlnaHQiLCJpbWFnZVdpZHRoIiwibnVtQW5pbWF0aW9uSW1hZ2UiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImltYWdlU21vb3RoaW5nRW5hYmxlZCIsInRyYW5zbGF0ZSIsImNhcmRJbWFnZSIsImNhcmRNYXNrIiwiYW5pbWF0aW9uSW1hZ2VzIiwibG9hZEFsbEltYWdlIiwic3RhdGljIiwicGF0aCIsInJlamVjdCIsImltYWdlIiwiSW1hZ2UiLCJjcm9zc09yaWdpbiIsIm9ubG9hZCIsIm9uZXJyb3IiLCJzcmMiLCJjb2xvckluZGV4IiwiaW5pdGlhbEltYWdlIiwibG9hZEltYWdlIiwiZHJhd1BhY2siLCJsb29rdXBBc3NldEJ5SUQiLCJpbWFnZVVybCIsImxvZyIsImltYWdlVXJsQWx0ZXJuYXRlIiwiaSIsImFuaW1hdGlvbkltYWdlIiwiZHJhd0ltYWdlIiwieCIsIk1hdGgiLCJwb3ciLCJmcmFtZUR1cmF0aW9uIiwiY3VycmVudEZyYW1lIiwiaW50ZXJ2YWxJZCIsInNldEludGVydmFsIiwiY2xlYXJSZWN0IiwiZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uIiwiY2xlYXJJbnRlcnZhbCIsImFuaW1hdGlvbkR1cmF0aW9uIiwiY3VycmVudFRpbWUiLCJpbnRlcnZhbElkMiIsInlPZmZzZXQiLCJlYXNlSW5PdXRRdWFkIl0sInNvdXJjZVJvb3QiOiIifQ==