"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[298,998],{6998:(t,e,a)=>{a.r(e),a.d(e,{BasePage:()=>s});class s{constructor(t,e,a,s){this.walletConnect=t,this.algodClient=a,this.algoIndexer=s,this.holdings=e}}},5298:(t,e,a)=>{a.r(e),a.d(e,{Packs:()=>h,loadPacks:()=>c});var s=a(6998),i=a(7304),n=a(4050),o=a(4393);const r="https://api.atomixwap.xyz";async function c(t){let e=await fetch(`${r}/caffeine-card-pack/get-all`);if(200===e.status){let a=await e.json();const s=t.bathers.nfts.map((t=>t.assetId));let i=[];for(const t of a.packs)s.includes(t[0])&&i.push(t);return{claimablePacks:i,escrowAddress:a.escrowAddress}}throw new Error(`Can't load packs. Error ${e.status}`)}class h extends s.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Caffeine Cards Packs</h1>\n    <p id="packs-status" class="dark-text text-center">Loading packs...</p>\n    ',this.claimablePacks,this.escrowAddress,this.fetchPacks()}async fetchPacks(){const t=this.ui.querySelector("#packs-status");try{const e=await c(this.holdings);if(this.claimablePacks=e.claimablePacks,this.escrowAddress=e.escrowAddress,this.claimablePacks.length>0){let e="";this.claimablePacks.length>1&&(e="s"),t.textContent=`${this.claimablePacks.length} pack${e} to claim!`}else t.innerHTML='<img src="assets/pack0-0.png" style="width: 240px; opacity: 0.2;" class="mb-3"><br>\n        No pack to open.<br>\n        Make sure Bathers are not listed on marketplaces to see your packs.<br><br>\n        A Caffeine Card is given for every Bather bought in the <a href="https://instantshuffle.com/shuffle/yUSbzq61ZvqTIsSvLycS" target="_blank">Instant Shuffle.</a>\n        ';const a=document.createElement("div");a.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5 justify-content-center",this.ui.append(a);for(const t of this.claimablePacks){const e=document.createElement("div");e.className="col text-center ps-3 pe-3",a.append(e);const s=document.createElement("canvas");s.className="w-100 mb-0";const i=new l(s,t[1],this.algoIndexer);await i.load(),e.append(s);const n=document.createElement("div");n.className="dark-text mt-0 pt-0 mb-2 hidden-pack-name",n.style.opacity="0",n.style["max-height"]="0",n.textContent=i.nft.name,e.append(n);const o=document.createElement("button");o.className="open-pack-button",o.textContent="Open",o.dataset.batherId=t[0],o.dataset.caffeineCardId=t[1],o.addEventListener("click",this.openPack.bind(this,i,n),!1),e.append(o)}}catch(e){console.error(e),t.textContent=e.message}}disableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button soft-disabled",e.disabled=!0)}))}enableAllButtons(t){this.ui.querySelectorAll(".open-pack-button").forEach((e=>{e===t||e.dataset.opened||(e.className="open-pack-button",e.disabled=!1)}))}async openPack(t,e,a){const s=a.currentTarget;this.disableAllButtons(s);const i=s.dataset.batherId,o=s.dataset.caffeineCardId;try{s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',s.disabled=!0;let a=await this.algodClient.getTransactionParams().do(),c=[n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.walletConnect.walletAddress,amount:0,assetIndex:parseInt(o),suggestedParams:a}),n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.escrowAddress,to:this.walletConnect.walletAddress,amount:1,assetIndex:parseInt(o),suggestedParams:a})];n.assignGroupID(c);const h=await this.walletConnect.signTransactions(c),l={batherId:i,txn:btoa(String.fromCharCode.apply(null,h[0])),suggestedParams:a};s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n      Opening...',s.disabled=!0;const d=await fetch(r+"/caffeine-card-pack/claim",{method:"POST",body:JSON.stringify(l),headers:{Accept:"application/json","Content-Type":"application/json"}});if(200!==d.status){let t;try{t=await d.json()}catch(t){}throw t&&t.error?new Error(t.error):new Error(`Error ${d.status}`)}s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">\n        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n      </svg>\n        Opened',s.disabled=!0,s.dataset.opened=!0,t.animate(),e.style.opacity="1",e.style["max-height"]="500px",this.enableAllButtons(s)}catch(t){console.error(t),alert(t.message),s.textContent="Open",s.disabled=!1,this.enableAllButtons(s)}}}class l{constructor(t,e,a){this.caffeineCardId=e,this.algoIndexer=a,this.width=660,this.height=960,this.imageWidth=960,this.numAnimationImage=4,this.canvas=t,this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.context.translate(-(this.imageWidth-this.width)/2,0),this.nft,this.cardImage,this.cardMask,this.animationImages}async load(){await this.loadAllImage()}static loadImage(t){return new Promise(((e,a)=>{const s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{e(s)},s.onerror=a,s.src=t}))}async loadAllImage(){this.animationImages=[];const t=this.caffeineCardId%4,e=await l.loadImage(`assets/pack${t}-0.png`);this.animationImages.push(e),this.drawPack(),this.cardMask=await l.loadImage("assets/card-mask.png");const a=await this.algoIndexer.lookupAssetByID(this.caffeineCardId).do();this.nft=new i.Sm(this.caffeineCardId,a.asset),await this.nft.load(this.algoIndexer);try{this.cardImage=await l.loadImage(this.nft.imageUrl)}catch(t){console.log("Error loading image from primary, trying secondary");try{this.cardImage=await l.loadImage(this.nft.imageUrlAlternate)}catch(t){this.cardImage=await l.loadImage("assets/empty-card.png")}}for(let e=1;e<=this.numAnimationImage;e++){const a=await l.loadImage(`assets/pack${t}-${e}.png`);this.animationImages.push(a)}}async drawPack(){this.context.drawImage(this.animationImages[0],0,0,this.imageWidth,this.height)}static easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}async animate(){let t=.15,e=1;const a=setInterval((()=>{if(this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[e],0,0,this.imageWidth,this.height),e===this.numAnimationImage){clearInterval(a),o.sparkles(this.canvas),t=.05;const e=.8;let s=0;const i=setInterval((()=>{const a=l.easeInOutQuad(s/e)*this.height;this.context.clearRect(0,0,this.imageWidth,this.height),this.context.drawImage(this.cardMask,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-in",this.context.drawImage(this.cardImage,0,0,this.imageWidth,this.height),this.context.globalCompositeOperation="source-over",this.context.drawImage(this.animationImages[this.numAnimationImage],0,a,this.imageWidth,this.height),s+=t,s>=e&&clearInterval(i)}),1e3*t)}e++}),1e3*t)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFFBQVE2QixVQUFVbkksS0FBSzJHLFNBQVUsRUFBRyxFQUFHM0csS0FBS29HLFdBQVlwRyxLQUFLbUcsUUFFbEVuRyxLQUFLc0csUUFBUXNDLHlCQUEyQixZQUd4QzVJLEtBQUtzRyxRQUFRNkIsVUFBVW5JLEtBQUswRyxVQUFXLEVBQUcsRUFBRzFHLEtBQUtvRyxXQUFZcEcsS0FBS21HLFFBRW5FbkcsS0FBS3NHLFFBQVFzQyx5QkFBMkIsY0FHeEM1SSxLQUFLc0csUUFBUTZCLFVBQVVuSSxLQUFLNEcsZ0JBQWdCNUcsS0FBS3FHLG1CQUFvQixFQUFHNEMsRUFBU2pKLEtBQUtvRyxXQUFZcEcsS0FBS21HLFFBRXZHNEMsR0FBZVIsRUFFWFEsR0FBZUQsR0FDakJELGNBQWNHLEVBSWhCLEdBRWUsSUFBZFQsRUFFTCxDQUVBQyxHQUFjLEdBRUMsSUFBZEQsRUFJTCxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3R1ZGlvLy4vc3JjL3BhZ2VzL2Jhc2UuanMiLCJ3ZWJwYWNrOi8vc3R1ZGlvLy4vc3JjL3BhZ2VzL3BhY2tzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGNsYXNzIEJhc2VQYWdlIHtcblxuICAgIGNvbnN0cnVjdG9yKHdhbGxldENvbm5lY3QsIGhvbGRpbmdzLCBhbGdvZENsaWVudCwgYWxnb0luZGV4ZXIpe1xuXG4gICAgICAgIHRoaXMud2FsbGV0Q29ubmVjdCA9IHdhbGxldENvbm5lY3Q7XG4gICAgICAgIHRoaXMuYWxnb2RDbGllbnQgPSBhbGdvZENsaWVudDtcbiAgICAgICAgdGhpcy5hbGdvSW5kZXhlciA9IGFsZ29JbmRleGVyO1xuICAgICAgICB0aGlzLmhvbGRpbmdzID0gaG9sZGluZ3M7XG5cbiAgICAgICAgXG5cbiAgICB9XG5cbn0iLCJpbXBvcnQgeyBCYXNlUGFnZSB9IGZyb20gXCIuL2Jhc2UuanNcIjtcbmltcG9ydCB7IE5GVENvbGxlY3Rpb24gfSBmcm9tIFwiYWxnby1uZnQtdXRpbHNcIjtcbmltcG9ydCBhbGdvc2RrIGZyb20gJ2FsZ29zZGsnO1xuaW1wb3J0IHsgTkZUIH0gZnJvbSBcImFsZ28tbmZ0LXV0aWxzXCI7XG5pbXBvcnQgcGFydHkgZnJvbSBcInBhcnR5LWpzXCI7XG5cbmNvbnN0IFBBQ0tTX0FQSV9VUkwgPSBcImh0dHBzOi8vYXBpLmF0b21peHdhcC54eXpcIjtcbi8vY29uc3QgUEFDS1NfQVBJX1VSTCA9IFwiaHR0cHM6Ly9sb2NhbGhvc3RcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRQYWNrcyhob2xkaW5ncykge1xuICBsZXQgcmVzdWx0ID0gYXdhaXQgZmV0Y2goYCR7UEFDS1NfQVBJX1VSTH0vY2FmZmVpbmUtY2FyZC1wYWNrL2dldC1hbGxgKTtcblxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgbGV0IGpzb24gPSBhd2FpdCByZXN1bHQuanNvbigpO1xuXG4gICAgLy9jb21wYXJlIHdpdGggaG9sZGluZ3NcbiAgICBjb25zdCBiYXRoZXJzSWRzID0gaG9sZGluZ3MuYmF0aGVycy5uZnRzLm1hcCgobmZ0KSA9PiBuZnQuYXNzZXRJZCk7XG5cbiAgICBsZXQgY2xhaW1hYmxlUGFja3MgPSBbXTtcblxuICAgIGZvciAoY29uc3QgcGFjayBvZiBqc29uLnBhY2tzKSB7XG4gICAgICBpZiAoYmF0aGVyc0lkcy5pbmNsdWRlcyhwYWNrWzBdKSkge1xuICAgICAgICBjbGFpbWFibGVQYWNrcy5wdXNoKHBhY2spO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBjbGFpbWFibGVQYWNrczogY2xhaW1hYmxlUGFja3MsXG4gICAgICBlc2Nyb3dBZGRyZXNzOiBqc29uLmVzY3Jvd0FkZHJlc3MsXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhblxcJ3QgbG9hZCBwYWNrcy4gRXJyb3IgJHtyZXN1bHQuc3RhdHVzfWApO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQYWNrcyBleHRlbmRzIEJhc2VQYWdlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcblxuICAgIHRoaXMudWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMudWkuaW5uZXJIVE1MID0gYFxuICAgIDxoMT5DYWZmZWluZSBDYXJkcyBQYWNrczwvaDE+XG4gICAgPHAgaWQ9XCJwYWNrcy1zdGF0dXNcIiBjbGFzcz1cImRhcmstdGV4dCB0ZXh0LWNlbnRlclwiPkxvYWRpbmcgcGFja3MuLi48L3A+XG4gICAgYDtcblxuICAgIHRoaXMuY2xhaW1hYmxlUGFja3M7XG4gICAgdGhpcy5lc2Nyb3dBZGRyZXNzO1xuXG4gICAgdGhpcy5mZXRjaFBhY2tzKCk7XG4gIH1cblxuICBhc3luYyBmZXRjaFBhY2tzKCkge1xuXG4gICAgY29uc3QgcGFja1N0YXR1c1AgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjcGFja3Mtc3RhdHVzXCIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxvYWRQYWNrcyh0aGlzLmhvbGRpbmdzKTtcblxuICAgICAgdGhpcy5jbGFpbWFibGVQYWNrcyA9IHJlc3VsdC5jbGFpbWFibGVQYWNrcztcbiAgICAgIHRoaXMuZXNjcm93QWRkcmVzcyA9IHJlc3VsdC5lc2Nyb3dBZGRyZXNzO1xuXG4gICAgICBpZiAodGhpcy5jbGFpbWFibGVQYWNrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBwbHVyYWwgPSAnJztcbiAgICAgICAgaWYgKHRoaXMuY2xhaW1hYmxlUGFja3MubGVuZ3RoID4gMSl7XG4gICAgICAgICAgcGx1cmFsID0gJ3MnO1xuICAgICAgICB9XG4gICAgICAgIHBhY2tTdGF0dXNQLnRleHRDb250ZW50ID0gYCR7dGhpcy5jbGFpbWFibGVQYWNrcy5sZW5ndGh9IHBhY2ske3BsdXJhbH0gdG8gY2xhaW0hYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhY2tTdGF0dXNQLmlubmVySFRNTCA9IGA8aW1nIHNyYz1cImFzc2V0cy9wYWNrMC0wLnBuZ1wiIHN0eWxlPVwid2lkdGg6IDI0MHB4OyBvcGFjaXR5OiAwLjI7XCIgY2xhc3M9XCJtYi0zXCI+PGJyPlxuICAgICAgICBObyBwYWNrIHRvIG9wZW4uPGJyPlxuICAgICAgICBNYWtlIHN1cmUgQmF0aGVycyBhcmUgbm90IGxpc3RlZCBvbiBtYXJrZXRwbGFjZXMgdG8gc2VlIHlvdXIgcGFja3MuPGJyPjxicj5cbiAgICAgICAgQSBDYWZmZWluZSBDYXJkIGlzIGdpdmVuIGZvciBldmVyeSBCYXRoZXIgYm91Z2h0IGluIHRoZSA8YSBocmVmPVwiaHR0cHM6Ly9pbnN0YW50c2h1ZmZsZS5jb20vc2h1ZmZsZS95VVNienE2MVp2cVRJc1N2THljU1wiIHRhcmdldD1cIl9ibGFua1wiPkluc3RhbnQgU2h1ZmZsZS48L2E+XG4gICAgICAgIGA7XG4gICAgICB9XG5cbiAgICAgIC8vZGlzcGxheSBwYWNrIGxpc3RcbiAgICAgIGNvbnN0IHBhY2tzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHBhY2tzRGl2LmNsYXNzTmFtZSA9XG4gICAgICAgIFwicm93IHJvdy1jb2xzLTIgcm93LWNvbHMtbWQtMyByb3ctY29scy1sZy00IGd5LTQgbWItNSBqdXN0aWZ5LWNvbnRlbnQtY2VudGVyXCI7XG4gICAgICB0aGlzLnVpLmFwcGVuZChwYWNrc0Rpdik7XG5cbiAgICAgIGZvciAoY29uc3QgcGFjayBvZiB0aGlzLmNsYWltYWJsZVBhY2tzKSB7XG4gICAgICAgIGNvbnN0IHBhY2tEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBwYWNrRGl2LmNsYXNzTmFtZSA9IFwiY29sIHRleHQtY2VudGVyIHBzLTMgcGUtM1wiO1xuICAgICAgICBwYWNrc0Rpdi5hcHBlbmQocGFja0Rpdik7XG5cbiAgICAgICAgLypjb25zdCBncmFwaGljRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgZ3JhcGhpY0Rpdi5jbGFzc05hbWUgPSAnJztcbiAgICAgICAgZ3JhcGhpY0Rpdi5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCJhc3NldHMvcGFjazAucG5nXCIgY2xhc3M9XCJ3LTEwMCBtYi0yXCI+YDtcbiAgICAgICAgcGFja0Rpdi5hcHBlbmQoZ3JhcGhpY0Rpdik7Ki9cblxuICAgICAgICBjb25zdCBwYWNrQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgICAgcGFja0NhbnZhcy5jbGFzc05hbWUgPSAndy0xMDAgbWItMCc7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgUGFja0NhbnZhc0NvbnRyb2xsZXIocGFja0NhbnZhcywgcGFja1sxXSwgdGhpcy5hbGdvSW5kZXhlcik7XG4gICAgICAgIGF3YWl0IGNvbnRyb2xsZXIubG9hZCgpO1xuICAgICAgICBwYWNrRGl2LmFwcGVuZChwYWNrQ2FudmFzKTtcblxuICAgICAgICBjb25zdCBoaWRkZW5OYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgaGlkZGVuTmFtZS5jbGFzc05hbWUgPSBcImRhcmstdGV4dCBtdC0wIHB0LTAgbWItMiBoaWRkZW4tcGFjay1uYW1lXCI7XG4gICAgICAgIGhpZGRlbk5hbWUuc3R5bGUub3BhY2l0eSA9ICcwJztcbiAgICAgICAgaGlkZGVuTmFtZS5zdHlsZVsnbWF4LWhlaWdodCddID0gJzAnO1xuICAgICAgICAvL2hpZGRlbk5hbWUuaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgaGlkZGVuTmFtZS50ZXh0Q29udGVudCA9IGNvbnRyb2xsZXIubmZ0Lm5hbWU7XG4gICAgICAgIHBhY2tEaXYuYXBwZW5kKGhpZGRlbk5hbWUpO1xuXG4gICAgICAgIGNvbnN0IG9wZW5CdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgICBvcGVuQnV0dG9uLmNsYXNzTmFtZSA9IFwib3Blbi1wYWNrLWJ1dHRvblwiXG4gICAgICAgIG9wZW5CdXR0b24udGV4dENvbnRlbnQgPSBcIk9wZW5cIjtcbiAgICAgICAgb3BlbkJ1dHRvbi5kYXRhc2V0LmJhdGhlcklkID0gcGFja1swXTtcbiAgICAgICAgb3BlbkJ1dHRvbi5kYXRhc2V0LmNhZmZlaW5lQ2FyZElkID0gcGFja1sxXTtcbiAgICAgICAgb3BlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5vcGVuUGFjay5iaW5kKHRoaXMsIGNvbnRyb2xsZXIsIGhpZGRlbk5hbWUpLCBmYWxzZSk7XG4gICAgICAgIHBhY2tEaXYuYXBwZW5kKG9wZW5CdXR0b24pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuXG4gICAgICBwYWNrU3RhdHVzUC50ZXh0Q29udGVudCA9IGVyci5tZXNzYWdlO1xuICAgICAgLy9hbGVydChlcnIubWVzc2FnZSk7XG4gICAgfVxuXG4gIH1cblxuICBkaXNhYmxlQWxsQnV0dG9ucyhleGNlcHQpe1xuXG4gICAgY29uc3QgYnV0dG9ucyA9IHRoaXMudWkucXVlcnlTZWxlY3RvckFsbCgnLm9wZW4tcGFjay1idXR0b24nKTtcbiAgICBcbiAgICBidXR0b25zLmZvckVhY2goYiA9PiB7XG5cbiAgICAgIGlmIChiICE9PSBleGNlcHQgJiYgIWIuZGF0YXNldC5vcGVuZWQpe1xuICAgICAgICBiLmNsYXNzTmFtZSA9IFwib3Blbi1wYWNrLWJ1dHRvbiBzb2Z0LWRpc2FibGVkXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgXG4gICAgfSk7XG4gIH1cblxuICBlbmFibGVBbGxCdXR0b25zKGV4Y2VwdCl7XG5cbiAgICBjb25zdCBidXR0b25zID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKCcub3Blbi1wYWNrLWJ1dHRvbicpO1xuICAgIFxuICAgIGJ1dHRvbnMuZm9yRWFjaChiID0+IHtcblxuICAgICAgaWYgKGIgIT09IGV4Y2VwdCAmJiAhYi5kYXRhc2V0Lm9wZW5lZCl7XG4gICAgICAgIGIuY2xhc3NOYW1lID0gXCJvcGVuLXBhY2stYnV0dG9uXCI7XG4gICAgICAgIGIuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgICAgXG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBvcGVuUGFjayhwYWNrQ2FudmFzQ29udHJvbGxlciwgaGlkZGVuTmFtZSwgZXZlbnQpIHtcblxuICAgIGNvbnN0IGNhbGxpbmdCdXR0b24gPSBldmVudC5jdXJyZW50VGFyZ2V0OyBcblxuICAgIHRoaXMuZGlzYWJsZUFsbEJ1dHRvbnMoY2FsbGluZ0J1dHRvbik7XG5cbiAgICBjb25zdCBiYXRoZXJJZCA9IGNhbGxpbmdCdXR0b24uZGF0YXNldC5iYXRoZXJJZDtcbiAgICBjb25zdCBjYWZmZWluZUNhcmRJZCA9IGNhbGxpbmdCdXR0b24uZGF0YXNldC5jYWZmZWluZUNhcmRJZDtcblxuICAgIHRyeSB7XG5cbiAgICAgIGNhbGxpbmdCdXR0b24uaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPVwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIiByb2xlPVwic3RhdHVzXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9zcGFuPmA7XG4gICAgICBjYWxsaW5nQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgbGV0IHN1Z2dlc3RlZFBhcmFtcyA9IGF3YWl0IHRoaXMuYWxnb2RDbGllbnQuZ2V0VHJhbnNhY3Rpb25QYXJhbXMoKS5kbygpO1xuXG4gICAgICAvL3ByZXBhcmUgb3B0aW4gdHhuXG4gICAgICBsZXQgb3B0aW5UeG4gPVxuICAgICAgYWxnb3Nkay5tYWtlQXNzZXRUcmFuc2ZlclR4bldpdGhTdWdnZXN0ZWRQYXJhbXNGcm9tT2JqZWN0KHtcbiAgICAgICAgZnJvbTogdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MsXG4gICAgICAgIHRvOiB0aGlzLndhbGxldENvbm5lY3Qud2FsbGV0QWRkcmVzcyxcbiAgICAgICAgYW1vdW50OiAwLFxuICAgICAgICBhc3NldEluZGV4OiBwYXJzZUludChjYWZmZWluZUNhcmRJZCksXG4gICAgICAgIHN1Z2dlc3RlZFBhcmFtczogc3VnZ2VzdGVkUGFyYW1zLFxuICAgICAgfSk7XG5cbiAgICAvL3ByZXBhcmUgdHJhbnNmZXIgdHhuXG4gICAgbGV0IHRyYW5zZmVyVHhuID1cbiAgICAgIGFsZ29zZGsubWFrZUFzc2V0VHJhbnNmZXJUeG5XaXRoU3VnZ2VzdGVkUGFyYW1zRnJvbU9iamVjdCh7XG4gICAgICAgIGZyb206IHRoaXMuZXNjcm93QWRkcmVzcyxcbiAgICAgICAgdG86IHRoaXMud2FsbGV0Q29ubmVjdC53YWxsZXRBZGRyZXNzLFxuICAgICAgICBhbW91bnQ6IDEsXG4gICAgICAgIGFzc2V0SW5kZXg6IHBhcnNlSW50KGNhZmZlaW5lQ2FyZElkKSxcbiAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXMsXG4gICAgICB9KTtcblxuICAgICAgbGV0IGFsbFR4bnMgPSBbb3B0aW5UeG4sIHRyYW5zZmVyVHhuXTtcbiAgICAgIGFsZ29zZGsuYXNzaWduR3JvdXBJRChhbGxUeG5zKTtcblxuICAgICAgY29uc3Qgc2lnbmVkVHhucyA9IGF3YWl0IHRoaXMud2FsbGV0Q29ubmVjdC5zaWduVHJhbnNhY3Rpb25zKGFsbFR4bnMpO1xuXG4gICAgICBjb25zdCBzaWduZWRUeG5Kc29uID0ge1xuICAgICAgICBiYXRoZXJJZDogYmF0aGVySWQsXG4gICAgICAgIHR4bjogYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHNpZ25lZFR4bnNbMF0pKSxcbiAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXNcbiAgICAgIH1cblxuICAgICAgY2FsbGluZ0J1dHRvbi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9XCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiIHJvbGU9XCJzdGF0dXNcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L3NwYW4+XG4gICAgICBPcGVuaW5nLi4uYDtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAvL2NhbGwgYXBpXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFBBQ0tTX0FQSV9VUkwgKyBcIi9jYWZmZWluZS1jYXJkLXBhY2svY2xhaW1cIiwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShzaWduZWRUeG5Kc29uKSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG5cbiAgICAgICAgLy9jb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICAgIGNhbGxpbmdCdXR0b24uaW5uZXJIVE1MID0gYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMjRcIiBoZWlnaHQ9XCIyNFwiIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBjbGFzcz1cImJpIGJpLWNoZWNrLWNpcmNsZS1maWxsXCIgdmlld0JveD1cIjAgMCAxNiAxNlwiPlxuICAgICAgICA8cGF0aCBkPVwiTTE2IDhBOCA4IDAgMSAxIDAgOGE4IDggMCAwIDEgMTYgMHptLTMuOTctMy4wM2EuNzUuNzUgMCAwIDAtMS4wOC4wMjJMNy40NzcgOS40MTcgNS4zODQgNy4zMjNhLjc1Ljc1IDAgMCAwLTEuMDYgMS4wNkw2Ljk3IDExLjAzYS43NS43NSAwIDAgMCAxLjA3OS0uMDJsMy45OTItNC45OWEuNzUuNzUgMCAwIDAtLjAxLTEuMDV6XCIvPlxuICAgICAgPC9zdmc+XG4gICAgICAgIE9wZW5lZGA7XG4gICAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICBjYWxsaW5nQnV0dG9uLmRhdGFzZXQub3BlbmVkID0gdHJ1ZTtcblxuICAgICAgICAvL2FuaW1hdGUgcGFjayBvcGVuaW5nXG4gICAgICAgIHBhY2tDYW52YXNDb250cm9sbGVyLmFuaW1hdGUoKTtcblxuICAgICAgICBoaWRkZW5OYW1lLnN0eWxlLm9wYWNpdHkgPSAnMSc7XG4gICAgICAgIGhpZGRlbk5hbWUuc3R5bGVbJ21heC1oZWlnaHQnXSA9ICc1MDBweCc7XG5cbiAgICAgICAgdGhpcy5lbmFibGVBbGxCdXR0b25zKGNhbGxpbmdCdXR0b24pO1xuXG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIGxldCBkYXRhO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgfSBjYXRjaChlcnIpIHt9XG4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5lcnJvcil7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEuZXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICAgIH1cblxuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICBhbGVydChlcnIubWVzc2FnZSk7XG5cbiAgICAgIGNhbGxpbmdCdXR0b24udGV4dENvbnRlbnQgPSBcIk9wZW5cIjtcbiAgICAgIGNhbGxpbmdCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgICAgdGhpcy5lbmFibGVBbGxCdXR0b25zKGNhbGxpbmdCdXR0b24pO1xuICAgIH1cblxuICB9XG4gIFxufVxuXG5cbmNsYXNzIFBhY2tDYW52YXNDb250cm9sbGVye1xuXG4gIGNvbnN0cnVjdG9yKGNhbnZhcywgY2FmZmVpbmVDYXJkSWQsIGFsZ29JbmRleGVyKXtcblxuICAgIHRoaXMuY2FmZmVpbmVDYXJkSWQgPSBjYWZmZWluZUNhcmRJZDtcbiAgICB0aGlzLmFsZ29JbmRleGVyID0gYWxnb0luZGV4ZXI7XG5cbiAgICB0aGlzLndpZHRoID0gNjYwO1xuICAgIHRoaXMuaGVpZ2h0ID0gOTYwXG4gICAgdGhpcy5pbWFnZVdpZHRoID0gOTYwO1xuXG4gICAgdGhpcy5udW1BbmltYXRpb25JbWFnZSA9IDQ7XG5cbiAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG5cbiAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMuY29udGV4dC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcblxuICAgIC8vdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9ICdyZWQnO1xuICAgIC8vdGhpcy5jb250ZXh0LmZpbGxSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgIHRoaXMuY29udGV4dC50cmFuc2xhdGUoLSh0aGlzLmltYWdlV2lkdGggLSB0aGlzLndpZHRoKS8yLCAwKTtcblxuICAgIC8vbG9hZCBhbmltYXRpb24gaW1hZ2VzXG4gICAgLy9sb2FkIGNhZmZlaW5lIGNhcmQgaW1hZ2VcblxuICAgIHRoaXMubmZ0O1xuXG4gICAgdGhpcy5jYXJkSW1hZ2U7XG4gICAgdGhpcy5jYXJkTWFzaztcbiAgICB0aGlzLmFuaW1hdGlvbkltYWdlcztcblxuXG4gIH1cblxuICBhc3luYyBsb2FkKCl7XG4gICAgYXdhaXQgdGhpcy5sb2FkQWxsSW1hZ2UoKTtcbiAgfVxuXG4gIHN0YXRpYyBsb2FkSW1hZ2UocGF0aCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG5cbiAgICAgIGltYWdlLmNyb3NzT3JpZ2luID0gJ0Fub255bW91cyc7XG5cbiAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgcmVzb2x2ZShpbWFnZSk7XG4gICAgICB9XG5cbiAgICAgIGltYWdlLm9uZXJyb3IgPSByZWplY3RcblxuICAgICAgaW1hZ2Uuc3JjID0gcGF0aDtcblxuICAgIH0pXG4gIH1cblxuICBhc3luYyBsb2FkQWxsSW1hZ2UoKXtcblxuICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzID0gW107XG5cbiAgICAvL2Nob29zZSBhIGNvbG9yIHJhbmRvbWx5IGRlcGVuZGluZyBvbiBjYXJkIGFzc2V0IGlkXG4gICAgY29uc3QgY29sb3JJbmRleCA9IHRoaXMuY2FmZmVpbmVDYXJkSWQgJSA0O1xuICAgIC8vY29uc3QgY29sb3JJbmRleCA9IDA7XG5cbiAgICAvL2xvYWQgZmlyc3QgaW1hZ2UgYW5kIGRpc3BsYXkgaXQgYXMgc29vbiBhcyBwb3NzaWJsZVxuICAgIGNvbnN0IGluaXRpYWxJbWFnZSA9IGF3YWl0IFBhY2tDYW52YXNDb250cm9sbGVyLmxvYWRJbWFnZShgYXNzZXRzL3BhY2ske2NvbG9ySW5kZXh9LTAucG5nYCk7XG4gICAgdGhpcy5hbmltYXRpb25JbWFnZXMucHVzaChpbml0aWFsSW1hZ2UpXG4gICAgdGhpcy5kcmF3UGFjaygpO1xuXG4gICAgLy9sb2FkIG1hc2tcbiAgICB0aGlzLmNhcmRNYXNrID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKGBhc3NldHMvY2FyZC1tYXNrLnBuZ2ApO1xuXG4gICAgLy9sb2FkIG5mdCBpbWFnZVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYWxnb0luZGV4ZXIubG9va3VwQXNzZXRCeUlEKHRoaXMuY2FmZmVpbmVDYXJkSWQpLmRvKCk7XG4gICAgdGhpcy5uZnQgPSBuZXcgTkZUKHRoaXMuY2FmZmVpbmVDYXJkSWQsIHJlc3VsdFsnYXNzZXQnXSk7XG4gICAgYXdhaXQgdGhpcy5uZnQubG9hZCh0aGlzLmFsZ29JbmRleGVyKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgdGhpcy5jYXJkSW1hZ2UgPSBhd2FpdCBQYWNrQ2FudmFzQ29udHJvbGxlci5sb2FkSW1hZ2UodGhpcy5uZnQuaW1hZ2VVcmwpO1xuICAgIH0gY2F0Y2ggKGVycil7XG4gICAgICBjb25zb2xlLmxvZyhgRXJyb3IgbG9hZGluZyBpbWFnZSBmcm9tIHByaW1hcnksIHRyeWluZyBzZWNvbmRhcnlgKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuY2FyZEltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKHRoaXMubmZ0LmltYWdlVXJsQWx0ZXJuYXRlKTtcbiAgICAgIH0gY2F0Y2ggKGVycil7XG4gICAgICAgIHRoaXMuY2FyZEltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKCdhc3NldHMvZW1wdHktY2FyZC5wbmcnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2xvYWQgYW5pbWF0aW9uIGltYWdlc1xuICAgIFxuICAgIFxuXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGhpcy5udW1BbmltYXRpb25JbWFnZTsgaSsrKXtcbiAgICAgIGNvbnN0IGFuaW1hdGlvbkltYWdlID0gYXdhaXQgUGFja0NhbnZhc0NvbnRyb2xsZXIubG9hZEltYWdlKGBhc3NldHMvcGFjayR7Y29sb3JJbmRleH0tJHtpfS5wbmdgKTtcbiAgICAgIHRoaXMuYW5pbWF0aW9uSW1hZ2VzLnB1c2goYW5pbWF0aW9uSW1hZ2UpO1xuICAgIH1cblxuICB9XG5cbiAgXG5cbiAgYXN5bmMgZHJhd1BhY2soKXtcblxuICAgIC8vbG9hZCBpbWFnZVxuICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5hbmltYXRpb25JbWFnZXNbMF0sIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gIH1cblxuICBzdGF0aWMgZWFzZUluT3V0UXVhZCh4KSB7XG4gICAgcmV0dXJuIHggPCAwLjUgPyAyICogeCAqIHggOiAxIC0gTWF0aC5wb3coLTIgKiB4ICsgMiwgMikgLyAyO1xuICB9XG5cbiAgYXN5bmMgYW5pbWF0ZSgpe1xuXG4gICAgbGV0IGZyYW1lRHVyYXRpb24gPSAwLjE1O1xuXG4gICAgbGV0IGN1cnJlbnRGcmFtZSA9IDE7XG5cbiAgICBjb25zdCBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuXG4gICAgICAvL2NsZWFyIGNvbnRleHRcbiAgICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgIC8vZHJhdyBtYXNrXG4gICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuY2FyZE1hc2ssIDAsIDAsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICB0aGlzLmNvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ3NvdXJjZS1pbic7XG5cbiAgICAgIC8vZHJhdyBjYXJkXG4gICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuY2FyZEltYWdlLCAwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgdGhpcy5jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3Zlcic7XG5cbiAgICAgIC8vZHJhdyBwYWNrIGFuaW1hdGlvblxuICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmFuaW1hdGlvbkltYWdlc1tjdXJyZW50RnJhbWVdLCAwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgaWYgKGN1cnJlbnRGcmFtZSA9PT0gdGhpcy5udW1BbmltYXRpb25JbWFnZSl7XG5cbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcblxuICAgICAgICBwYXJ0eS5zcGFya2xlcyh0aGlzLmNhbnZhcyk7XG5cbiAgICAgICAgLy9zdGFydCBzbGlkZSBhbmltYXRpb25cbiAgICAgICAgZnJhbWVEdXJhdGlvbiA9IDAuMDU7XG4gICAgICAgIGNvbnN0IGFuaW1hdGlvbkR1cmF0aW9uID0gMC44O1xuICAgICAgICBsZXQgY3VycmVudFRpbWUgPSAwO1xuXG4gICAgICAgIGNvbnN0IGludGVydmFsSWQyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuXG4gICAgICAgICAgY29uc3QgeU9mZnNldCA9IFBhY2tDYW52YXNDb250cm9sbGVyLmVhc2VJbk91dFF1YWQoY3VycmVudFRpbWUvYW5pbWF0aW9uRHVyYXRpb24pKnRoaXMuaGVpZ2h0O1xuXG4gICAgICAgICAgLy9jbGVhciBjb250ZXh0XG4gICAgICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgICAgIC8vZHJhdyBtYXNrXG4gICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmNhcmRNYXNrLCAwLCAwLCB0aGlzLmltYWdlV2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgICAgIHRoaXMuY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLWluJztcblxuICAgICAgICAgIC8vZHJhdyBjYXJkXG4gICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmNhcmRJbWFnZSwgMCwgMCwgdGhpcy5pbWFnZVdpZHRoLCB0aGlzLmhlaWdodCk7XG5cbiAgICAgICAgICB0aGlzLmNvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ3NvdXJjZS1vdmVyJztcblxuICAgICAgICAgIC8vZHJhdyBwYWNrIGFuaW1hdGlvblxuICAgICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5hbmltYXRpb25JbWFnZXNbdGhpcy5udW1BbmltYXRpb25JbWFnZV0sIDAsIHlPZmZzZXQsIHRoaXMuaW1hZ2VXaWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICAgICAgY3VycmVudFRpbWUgKz0gZnJhbWVEdXJhdGlvbjtcblxuICAgICAgICAgIGlmIChjdXJyZW50VGltZSA+PSBhbmltYXRpb25EdXJhdGlvbil7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQyKTtcblxuICAgICAgICAgICAgXG5cbiAgICAgICAgICB9XG5cbiAgICAgICAgfSwgZnJhbWVEdXJhdGlvbioxMDAwKTtcblxuICAgICAgfVxuXG4gICAgICBjdXJyZW50RnJhbWUrKztcblxuICAgIH0sIGZyYW1lRHVyYXRpb24qMTAwMClcblxuXG5cbiAgfVxuXG59XG4iXSwibmFtZXMiOlsiQmFzZVBhZ2UiLCJjb25zdHJ1Y3RvciIsIndhbGxldENvbm5lY3QiLCJob2xkaW5ncyIsImFsZ29kQ2xpZW50IiwiYWxnb0luZGV4ZXIiLCJ0aGlzIiwiUEFDS1NfQVBJX1VSTCIsImFzeW5jIiwibG9hZFBhY2tzIiwicmVzdWx0IiwiZmV0Y2giLCJzdGF0dXMiLCJqc29uIiwiYmF0aGVyc0lkcyIsImJhdGhlcnMiLCJuZnRzIiwibWFwIiwibmZ0IiwiYXNzZXRJZCIsImNsYWltYWJsZVBhY2tzIiwicGFjayIsInBhY2tzIiwiaW5jbHVkZXMiLCJwdXNoIiwiZXNjcm93QWRkcmVzcyIsIkVycm9yIiwiUGFja3MiLCJzdXBlciIsImFyZ3VtZW50cyIsInVpIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiZmV0Y2hQYWNrcyIsInBhY2tTdGF0dXNQIiwicXVlcnlTZWxlY3RvciIsImxlbmd0aCIsInBsdXJhbCIsInRleHRDb250ZW50IiwicGFja3NEaXYiLCJjbGFzc05hbWUiLCJhcHBlbmQiLCJwYWNrRGl2IiwicGFja0NhbnZhcyIsImNvbnRyb2xsZXIiLCJQYWNrQ2FudmFzQ29udHJvbGxlciIsImxvYWQiLCJoaWRkZW5OYW1lIiwic3R5bGUiLCJvcGFjaXR5IiwibmFtZSIsIm9wZW5CdXR0b24iLCJkYXRhc2V0IiwiYmF0aGVySWQiLCJjYWZmZWluZUNhcmRJZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvcGVuUGFjayIsImJpbmQiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJtZXNzYWdlIiwiZGlzYWJsZUFsbEJ1dHRvbnMiLCJleGNlcHQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImIiLCJvcGVuZWQiLCJkaXNhYmxlZCIsImVuYWJsZUFsbEJ1dHRvbnMiLCJwYWNrQ2FudmFzQ29udHJvbGxlciIsImV2ZW50IiwiY2FsbGluZ0J1dHRvbiIsImN1cnJlbnRUYXJnZXQiLCJzdWdnZXN0ZWRQYXJhbXMiLCJnZXRUcmFuc2FjdGlvblBhcmFtcyIsImRvIiwiYWxsVHhucyIsImZyb20iLCJ3YWxsZXRBZGRyZXNzIiwidG8iLCJhbW91bnQiLCJhc3NldEluZGV4IiwicGFyc2VJbnQiLCJzaWduZWRUeG5zIiwic2lnblRyYW5zYWN0aW9ucyIsInNpZ25lZFR4bkpzb24iLCJ0eG4iLCJidG9hIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiYXBwbHkiLCJyZXNwb25zZSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsIkFjY2VwdCIsImRhdGEiLCJhbmltYXRlIiwiYWxlcnQiLCJjYW52YXMiLCJ3aWR0aCIsImhlaWdodCIsImltYWdlV2lkdGgiLCJudW1BbmltYXRpb25JbWFnZSIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiaW1hZ2VTbW9vdGhpbmdFbmFibGVkIiwidHJhbnNsYXRlIiwiY2FyZEltYWdlIiwiY2FyZE1hc2siLCJhbmltYXRpb25JbWFnZXMiLCJsb2FkQWxsSW1hZ2UiLCJzdGF0aWMiLCJwYXRoIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJpbWFnZSIsIkltYWdlIiwiY3Jvc3NPcmlnaW4iLCJvbmxvYWQiLCJvbmVycm9yIiwic3JjIiwiY29sb3JJbmRleCIsImluaXRpYWxJbWFnZSIsImxvYWRJbWFnZSIsImRyYXdQYWNrIiwibG9va3VwQXNzZXRCeUlEIiwiaW1hZ2VVcmwiLCJsb2ciLCJpbWFnZVVybEFsdGVybmF0ZSIsImkiLCJhbmltYXRpb25JbWFnZSIsImRyYXdJbWFnZSIsIngiLCJNYXRoIiwicG93IiwiZnJhbWVEdXJhdGlvbiIsImN1cnJlbnRGcmFtZSIsImludGVydmFsSWQiLCJzZXRJbnRlcnZhbCIsImNsZWFyUmVjdCIsImdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiIsImNsZWFySW50ZXJ2YWwiLCJhbmltYXRpb25EdXJhdGlvbiIsImN1cnJlbnRUaW1lIiwiaW50ZXJ2YWxJZDIiLCJ5T2Zmc2V0IiwiZWFzZUluT3V0UXVhZCJdLCJzb3VyY2VSb290IjoiIn0=