"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[538],{6538:(e,t,s)=>{s.r(t),s.d(t,{Grinder:()=>r});var a=s(6998),d=(s(5190),s(7304),s(7644)),n=s(4050),i=s(2871),o=s(4714);class r extends a.BasePage{constructor(){super(...arguments),this.ui=document.createElement("div"),this.ui.innerHTML='\n    <h1>Grinder</h1>\n    <p class="dark-text">Use Caffeine Cards to update your Bathers</p>\n\n    <div class="d-sm-flex flew-row" style="background-color: var(--background-dark);">\n\n        <div class="d-flex flex-column p-3 text-center">\n\n            <img src="assets/default.png" class="mb-2 ms-auto me-auto" id="club-img" style="width: 200px; height: auto">\n\n            <div class="dropdown" id="bath-club-dropdown">\n                <button class="dropdown-toggle button-alt" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false">\n                    Choose Bather\n                </button>\n            </div>\n            <div class="mb-2 mt-4 ms-auto me-auto justify-content-center row row-cols-2" id="cards" style="width: 200px;">\n              <div class="col text-center" id="default-card" style="width: 200px;">\n                <img src="assets/default-card.png" class="img-fluid" style="width: 200px; height: auto;">\n              </div>\n            </div>\n            <div class="dropdown mb-3" id="cards-dropdown">\n                <button class="dropdown-toggle button-alt mb-2" type="button" data-bs-toggle="dropdown"\n                    aria-expanded="false" id="choose-card-button" disabled>\n                    Add Card\n                </button>\n            </div>\n            <button id="button-review" disabled>Review...</button>\n\n        </div>\n\n        <div class="d-flex flex-column flex-fill p-3 text-center">\n            <small class="dark-text">preview</small>\n            <img src="assets/default.png" class="w-100 m-auto img-fluid" style="max-width: 480px;" id="merged-img">\n\n        </div>\n\n    </div>',this.bathersCollection,this.cardsCollection,this.selectedBather,this.selectedCards=[],this.mergedProperties={},this.mergedImgDataURL,this.chooseCardButton=this.ui.querySelector("#choose-card-button"),this.load()}async load(){await this.loadBathers(),this.ui.querySelector("#button-review").addEventListener("click",this.review.bind(this));const e=window.location.search,t=new URLSearchParams(e);if(t.has("bather")){const e=parseInt(t.get("bather")),s=this.bathersCollection.nfts.filter((t=>t.assetId===e))?.[0];s&&await this.displayBather(s)}}async loadBathers(){this.bathersCollection=this.holdings.bathers;const e=this.ui.querySelector("#bath-club-dropdown");let t=e.querySelector(".dropdown-menu");t&&t.remove(),t=new i.Z(this.bathersCollection.nfts,this.didSelectBather.bind(this)),e.append(t.ui)}async didSelectBather(e){this.clearCard();const t=e.currentTarget.dataset.index;if(!t)return;const s=this.bathersCollection.nfts[t];this.mergedProperties=s.metadata.properties,await this.displayBather(s),e.preventDefault()}async displayBather(e){this.selectedBather=e,this.ui.querySelector("#club-img").src=e.imageUrl,this.validate(),await this.loadCards(),this.chooseCardButton.disabled=!1}clearCard(){this.selectedCards=[],this.chooseCardButton.disabled=!0,this.mergedProperties={},this.ui.querySelector("#default-card").hidden=!1;const e=Array.from(this.ui.querySelector("#cards").children);for(const t of e)"default-card"!==t.id&&t.remove()}async loadCards(){this.cardsCollection=this.holdings.caffeineCards;const e=this.ui.querySelector("#cards-dropdown");let t=e.querySelector("#cards-dropdown-nft");t&&t.remove();let s=[];e:for(const e of this.cardsCollection.nfts){if(e.metadata.require)for(const t in e.metadata.require)if(this.mergedProperties[t]!=e.metadata.require[t]){s.push(e.assetId);continue e}for(const t of this.selectedCards)for(const a in t.metadata.properties)if(e.metadata.properties[a]){s.push(e.assetId);continue e}}t=new i.Z(this.cardsCollection.nfts,this.didSelectCard.bind(this),"cards-dropdown-nft",s),e.append(t.ui),new window.bootstrap.Dropdown(this.chooseCardButton)}async didSelectCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];this.selectedCards.push(s);const a=this.ui.querySelector("#default-card");a&&(a.hidden=!0);const d=document.createElement("div");d.className="col text-center",d.id=`card-${t}`,d.innerHTML=`\n    <img style="width: 80px; height: auto" src="${s.imageUrl}">\n    <p><a href="javascript:void(0);" id="rm-${t}" data-index="${t}">Remove</a></p>\n    `,d.querySelector(`#rm-${t}`).addEventListener("click",this.removeCard.bind(this),!1),this.ui.querySelector("#cards").append(d),this.validate(),await this.loadCards(),e.preventDefault()}async removeCard(e){const t=e.currentTarget.dataset.index;if(!t)return;const s=this.cardsCollection.nfts[t];if(console.log(this.selectedCards.map((e=>e.name))),this.selectedCards=this.selectedCards.filter((e=>e.assetId!=s.assetId)),console.log(this.selectedCards.map((e=>e.name))),0===this.selectedCards.length){const e=this.ui.querySelector("#default-card");e&&(e.hidden=!1)}this.validate(),await this.loadCards(),this.ui.querySelector(`#card-${t}`).remove(),e.preventDefault()}validate(){const e=this.ui.querySelector("#button-review");this.selectedBather&&this.selectedCards.length>0?(e.disabled=!1,this.preview()):this.selectedBather?(this.ui.querySelector("#merged-img").src=this.selectedBather.imageUrl,e.disabled=!0):e.disabled=!0}review(e){const t=document.createElement("div");t.className="modal",t.tabIndex="-1";let s,a=[];for(const e of this.selectedCards)for(const t in e.metadata.properties)o.duplicateCriteria.includes(t)&&a.push(t);a.length>0&&(s=`&#9888;&#65039; This request contains a modification that can generate a duplicate (${a.join(",")}). If it's the case, the request will be canceled and the cards returned to your wallet.<br>`),t.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title">Review Bather modification</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div class="text-center mb-3">\n                <img style="width: 320px; height: auto;" id="preview-merged-img">\n            </div>\n\n          <p>\n          Your <strong>${this.selectedBather.name}</strong> will be updated.<br>\n          Your <strong>${this.selectedCards.map((e=>e.name)).join(", ")}</strong> will be burned &#128293;\n          </p>\n            \n          <p>${s||""}&#128337; As the process requires a manual step, update can take up to 24h.<br>\n          &#128236; You will be notified by a zero Algo transaction when the update is complete.</p>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="button-alt" data-bs-dismiss="modal">Close</button>\n          <button type="button" id="send-button">Send request</button>\n        </div>\n      </div>\n    </div>\n    `,t.querySelector("#preview-merged-img").src=this.mergedImgDataURL;const d=t.querySelector("#send-button");d.currentModal=t,d.addEventListener("click",this.send.bind(this),!1),new window.bootstrap.Modal(t,{}).show()}async preview(){const e=this.ui.querySelector("#button-review");e.disabled=!0,e.textContent="Generating...";const t=this.ui.querySelector("#merged-img");this.mergedProperties=Object.assign({},this.selectedBather.metadata.properties);for(const e of this.selectedCards)for(const t in e.metadata.properties)this.mergedProperties[t]=e.metadata.properties[t];const s=await(0,d.i)(this.mergedProperties,o,"layers_images");this.mergedImgDataURL=s.toDataURL("image/png"),t.src=this.mergedImgDataURL,e.disabled=!1,e.textContent="Review..."}async send(e){const t=e.currentTarget;t.disabled=!0,t.textContent="Waiting for signature...";const s=await this.algodClient.getTransactionParams().do(),a={evolve:this.selectedBather.assetId},d=(new TextEncoder).encode(JSON.stringify(a));if(this.selectedCards.length>13)return void alert("No more than 14 cards can be used at once.");let i=[];for(const e of this.selectedCards)i.push(n.makeAssetTransferTxnWithSuggestedParamsFromObject({from:this.walletConnect.walletAddress,to:this.cardsCollection.collections[0].addresses[0],amount:1,assetIndex:e.assetId,suggestedParams:s,note:d}));i.length>1&&n.assignGroupID(i);const o=await this.walletConnect.signTransactions(i),r=t.currentModal;let l;r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body ">\n            <div class="text-center mb-3">\n                <img src="assets/grinder.png" style="width: 128px; height: auto;">\n            </div>\n            <div class="text-center mb-3">\n            Sending Caffeine Card to the Grinder...\n            </div>\n        </div>\n      </div>\n    </div>\n    ';try{l=await this.algodClient.sendRawTransaction(o).do(),await n.waitForConfirmation(this.algodClient,l.txId,4),r.innerHTML='\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <img src="assets/heart-cup.png" width="60"><br><br>\n          We got your card and your evolution request.<br>\n          We\'ll be back to you very soon.\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    ',r.addEventListener("hidden.bs.modal",(e=>{location.reload()}))}catch(e){r.innerHTML=`\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="text-center mb-3">\n          <div class="alert alert-danger" role="alert">${e.message} </div>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n    `,console.error(e)}}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUtDLFVBQVVOLElBRXRELEdBQUl6RyxLQUFLUSxjQUFjdUUsT0FBUyxHQUU5QixZQURBaUMsTUFBTSw4Q0FJUixJQUFJQyxFQUFPLEdBRVgsSUFBSyxNQUFNaEQsS0FBZ0JqRSxLQUFLUSxjQUM5QnlHLEVBQUtqRCxLQUNILG9EQUEwRCxDQUN4RFAsS0FBTXpELEtBQUtrSCxjQUFjQyxjQUN6QkMsR0FBSXBILEtBQUtNLGdCQUFnQitHLFlBQVksR0FBR0MsVUFBVSxHQUNsREMsT0FBUSxFQUNSQyxXQUFZdkQsRUFBYWpDLFFBQ3pCcUUsZ0JBQWlCQSxFQUNqQkksS0FBTUUsS0FNUk0sRUFBS2xDLE9BQVMsR0FDaEIsZ0JBQXNCa0MsR0FHeEIsTUFBTVEsUUFBbUJ6SCxLQUFLa0gsY0FBY1EsaUJBQWlCVCxHQUd2RHZCLEVBQWVELEVBQVdDLGFBcUJoQyxJQUFJaUMsRUFuQkpqQyxFQUFhdEYsVUFBWSxvbEJBb0J6QixJQUNFdUgsUUFBVzNILEtBQUtzRyxZQUFZc0IsbUJBQW1CSCxHQUFZakIsV0FHbEMsc0JBQ3ZCeEcsS0FBS3NHLFlBQ0xxQixFQUFHRSxLQUNILEdBR0ZuQyxFQUFhdEYsVUFBWSx5cUJBb0J6QnNGLEVBQWExRSxpQkFBaUIsbUJBQW9Cd0IsSUFFaERuQixTQUFTeUcsUUFBUSxHQXNCckIsQ0FwQkUsTUFBT0MsR0FDUHJDLEVBQWF0RixVQUFZLDZYQVEwQjJILEVBQUlDLCtNQVV2RHRELFFBQVF1RCxNQUFNRixFQUNoQixDQUNGLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdHVkaW8vLi9zcmMvcGFnZXMvZ3JpbmRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlUGFnZSB9IGZyb20gXCIuL2Jhc2UuanNcIjtcbmltcG9ydCBjb2xsZWN0aW9uIGZyb20gXCIuLi9jb2xsZWN0aW9ucy5qc1wiO1xuaW1wb3J0IHsgTkZUSG9sZGVyQ29sbGVjdGlvbiB9IGZyb20gXCJhbGdvLW5mdC11dGlsc1wiO1xuaW1wb3J0IHsgZHJhdyB9IGZyb20gXCJiYXRoLWNsdWJcIjtcbmltcG9ydCBhbGdvc2RrIGZyb20gXCJhbGdvc2RrXCI7XG5pbXBvcnQgRHJvcGRvd25OZnRzIGZyb20gXCIuLi9jb21tb24vZHJvcGRvd24tbmZ0cy5qc1wiO1xuXG5pbXBvcnQgbGF5ZXJzIGZyb20gXCIuLi8uLi8uLi9iYXRoLWNsdWIvbGF5ZXJzLmpzb25cIjtcblxuZXhwb3J0IGNsYXNzIEdyaW5kZXIgZXh0ZW5kcyBCYXNlUGFnZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG5cbiAgICB0aGlzLnVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICA8aDE+R3JpbmRlcjwvaDE+XG4gICAgPHAgY2xhc3M9XCJkYXJrLXRleHRcIj5Vc2UgQ2FmZmVpbmUgQ2FyZHMgdG8gdXBkYXRlIHlvdXIgQmF0aGVyczwvcD5cblxuICAgIDxkaXYgY2xhc3M9XCJkLXNtLWZsZXggZmxldy1yb3dcIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IHZhcigtLWJhY2tncm91bmQtZGFyayk7XCI+XG5cbiAgICAgICAgPGRpdiBjbGFzcz1cImQtZmxleCBmbGV4LWNvbHVtbiBwLTMgdGV4dC1jZW50ZXJcIj5cblxuICAgICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvZGVmYXVsdC5wbmdcIiBjbGFzcz1cIm1iLTIgbXMtYXV0byBtZS1hdXRvXCIgaWQ9XCJjbHViLWltZ1wiIHN0eWxlPVwid2lkdGg6IDIwMHB4OyBoZWlnaHQ6IGF1dG9cIj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRyb3Bkb3duXCIgaWQ9XCJiYXRoLWNsdWItZHJvcGRvd25cIj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiZHJvcGRvd24tdG9nZ2xlIGJ1dHRvbi1hbHRcIiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1icy10b2dnbGU9XCJkcm9wZG93blwiXG4gICAgICAgICAgICAgICAgICAgIGFyaWEtZXhwYW5kZWQ9XCJmYWxzZVwiPlxuICAgICAgICAgICAgICAgICAgICBDaG9vc2UgQmF0aGVyXG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYi0yIG10LTQgbXMtYXV0byBtZS1hdXRvIGp1c3RpZnktY29udGVudC1jZW50ZXIgcm93IHJvdy1jb2xzLTJcIiBpZD1cImNhcmRzXCIgc3R5bGU9XCJ3aWR0aDogMjAwcHg7XCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wgdGV4dC1jZW50ZXJcIiBpZD1cImRlZmF1bHQtY2FyZFwiIHN0eWxlPVwid2lkdGg6IDIwMHB4O1wiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2RlZmF1bHQtY2FyZC5wbmdcIiBjbGFzcz1cImltZy1mbHVpZFwiIHN0eWxlPVwid2lkdGg6IDIwMHB4OyBoZWlnaHQ6IGF1dG87XCI+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd24gbWItM1wiIGlkPVwiY2FyZHMtZHJvcGRvd25cIj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiZHJvcGRvd24tdG9nZ2xlIGJ1dHRvbi1hbHQgbWItMlwiIHR5cGU9XCJidXR0b25cIiBkYXRhLWJzLXRvZ2dsZT1cImRyb3Bkb3duXCJcbiAgICAgICAgICAgICAgICAgICAgYXJpYS1leHBhbmRlZD1cImZhbHNlXCIgaWQ9XCJjaG9vc2UtY2FyZC1idXR0b25cIiBkaXNhYmxlZD5cbiAgICAgICAgICAgICAgICAgICAgQWRkIENhcmRcbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGJ1dHRvbiBpZD1cImJ1dHRvbi1yZXZpZXdcIiBkaXNhYmxlZD5SZXZpZXcuLi48L2J1dHRvbj5cblxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGZsZXgtY29sdW1uIGZsZXgtZmlsbCBwLTMgdGV4dC1jZW50ZXJcIj5cbiAgICAgICAgICAgIDxzbWFsbCBjbGFzcz1cImRhcmstdGV4dFwiPnByZXZpZXc8L3NtYWxsPlxuICAgICAgICAgICAgPGltZyBzcmM9XCJhc3NldHMvZGVmYXVsdC5wbmdcIiBjbGFzcz1cInctMTAwIG0tYXV0byBpbWctZmx1aWRcIiBzdHlsZT1cIm1heC13aWR0aDogNDgwcHg7XCIgaWQ9XCJtZXJnZWQtaW1nXCI+XG5cbiAgICAgICAgPC9kaXY+XG5cbiAgICA8L2Rpdj5gO1xuXG4gICAgdGhpcy5iYXRoZXJzQ29sbGVjdGlvbjtcbiAgICB0aGlzLmNhcmRzQ29sbGVjdGlvbjtcblxuICAgIHRoaXMuc2VsZWN0ZWRCYXRoZXI7XG4gICAgdGhpcy5zZWxlY3RlZENhcmRzID0gW107XG4gICAgdGhpcy5tZXJnZWRQcm9wZXJ0aWVzID0ge307XG5cbiAgICB0aGlzLm1lcmdlZEltZ0RhdGFVUkw7XG5cbiAgICB0aGlzLmNob29zZUNhcmRCdXR0b24gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2hvb3NlLWNhcmQtYnV0dG9uXCIpO1xuXG4gICAgdGhpcy5sb2FkKCk7XG4gIH1cblxuICBhc3luYyBsb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZEJhdGhlcnMoKTtcblxuICAgIGNvbnN0IHJldmlld0J1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b24tcmV2aWV3XCIpO1xuICAgIHJldmlld0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5yZXZpZXcuYmluZCh0aGlzKSk7XG5cbiAgICAvL2NvbnN0IHNlbmRCdXR0b24gPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjc2VuZC1idG5cIik7XG4gICAgLy9zZW5kQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnNlbmQuYmluZCh0aGlzKSk7XG5cbiAgICAvL2NoZWNrIGlmIGEgYmF0aGVyIHdhcyByZXF1ZXN0ZWRcbiAgICBjb25zdCBxdWVyeVN0cmluZyA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7XG4gICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhxdWVyeVN0cmluZyk7XG5cbiAgICBpZiAodXJsUGFyYW1zLmhhcyhcImJhdGhlclwiKSkge1xuICAgICAgY29uc3QgYmF0aGVyQXNzZXRJZCA9IHBhcnNlSW50KHVybFBhcmFtcy5nZXQoXCJiYXRoZXJcIikpO1xuXG4gICAgICAvL2ZpbmQgYmF0aGVyXG4gICAgICBjb25zdCBuZnQgPSB0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHMuZmlsdGVyKFxuICAgICAgICAobmZ0KSA9PiBuZnQuYXNzZXRJZCA9PT0gYmF0aGVyQXNzZXRJZFxuICAgICAgKT8uWzBdO1xuXG4gICAgICBpZiAobmZ0KSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZGlzcGxheUJhdGhlcihuZnQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGxvYWRCYXRoZXJzKCkge1xuICAgIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24gPSB0aGlzLmhvbGRpbmdzW1wiYmF0aGVyc1wiXTtcblxuICAgIGNvbnN0IGRyb3Bkb3duRGl2ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2JhdGgtY2x1Yi1kcm9wZG93blwiKTtcblxuICAgIGxldCBkcm9wZG93biA9IGRyb3Bkb3duRGl2LnF1ZXJ5U2VsZWN0b3IoXCIuZHJvcGRvd24tbWVudVwiKTtcbiAgICBpZiAoZHJvcGRvd24pIHtcbiAgICAgIGRyb3Bkb3duLnJlbW92ZSgpO1xuICAgIH1cblxuICAgIGRyb3Bkb3duID0gbmV3IERyb3Bkb3duTmZ0cyhcbiAgICAgIHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0cyxcbiAgICAgIHRoaXMuZGlkU2VsZWN0QmF0aGVyLmJpbmQodGhpcylcbiAgICApO1xuICAgIGRyb3Bkb3duRGl2LmFwcGVuZChkcm9wZG93bi51aSk7XG5cbiAgICAvKlxuICAgIGNvbnN0IGJhdGhlcnNEcm9wZG93bkxpc3QgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjYmF0aC1jbHViLWRyb3Bkb3duLWxpc3RcIik7XG4gICAgYmF0aGVyc0Ryb3Bkb3duTGlzdC50ZXh0Q29udGVudCA9IFwiXCI7XG5cbiAgICAvL2FkZCBkZWZhdWx0IHZhbHVlXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuICAgIGJhdGhlcnNEcm9wZG93bkxpc3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcblxuICAgIGlmICh0aGlzLmJhdGhlcnNDb2xsZWN0aW9uLm5mdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBvcHRpb24uaW5uZXJIVE1MID0gJzxhIGNsYXNzPVwiZHJvcGRvd24taXRlbSBkaXNhYmxlZFwiPk5vIGJhdGhlcnM8L2E+JztcbiAgICB9XG5cbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChjb25zdCBuZnQgb2YgdGhpcy5iYXRoZXJzQ29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XG5cbiAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICAgIGEuY2xhc3NOYW1lID0gJ2Ryb3Bkb3duLWl0ZW0nO1xuICAgICAgYS5ocmVmID0gJyMnO1xuICAgICAgYS5kYXRhc2V0LmluZGV4ID0gaTtcblxuICAgICAgYS5pbm5lckhUTUwgPSBgPGltZyBzcmM9XCIke25mdC5pbWFnZVVybH1cIj4gJHtuZnQubmFtZX1gO1xuXG4gICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kaWRTZWxlY3RCYXRoZXIuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgICBvcHRpb24uYXBwZW5kKGEpO1xuICAgICAgYmF0aGVyc0Ryb3Bkb3duTGlzdC5hcHBlbmQob3B0aW9uKTtcblxuICAgICAgaSsrO1xuICAgIH1cbiAgICAqL1xuICB9XG5cbiAgYXN5bmMgZGlkU2VsZWN0QmF0aGVyKGV2ZW50KSB7XG4gICAgdGhpcy5jbGVhckNhcmQoKTtcblxuICAgIGNvbnN0IG5mdEluZGV4ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4O1xuXG4gICAgaWYgKCFuZnRJbmRleCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IG5mdCA9IHRoaXMuYmF0aGVyc0NvbGxlY3Rpb24ubmZ0c1tuZnRJbmRleF07XG5cbiAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXMgPSBuZnQubWV0YWRhdGEucHJvcGVydGllcztcblxuICAgIGF3YWl0IHRoaXMuZGlzcGxheUJhdGhlcihuZnQpO1xuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuXG4gIGFzeW5jIGRpc3BsYXlCYXRoZXIobmZ0KSB7XG4gICAgdGhpcy5zZWxlY3RlZEJhdGhlciA9IG5mdDtcblxuICAgIC8vZGlzcGxheSBpbWFnZVxuICAgIGNvbnN0IGJhdGhlckltZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjbHViLWltZ1wiKTtcbiAgICBiYXRoZXJJbWcuc3JjID0gbmZ0LmltYWdlVXJsO1xuXG4gICAgdGhpcy52YWxpZGF0ZSgpO1xuXG4gICAgYXdhaXQgdGhpcy5sb2FkQ2FyZHMoKTtcbiAgICB0aGlzLmNob29zZUNhcmRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGNsZWFyQ2FyZCgpIHtcbiAgICB0aGlzLnNlbGVjdGVkQ2FyZHMgPSBbXTtcbiAgICB0aGlzLmNob29zZUNhcmRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIHRoaXMubWVyZ2VkUHJvcGVydGllcyA9IHt9O1xuXG4gICAgY29uc3QgZGVmYXVsdENhcmQgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjZGVmYXVsdC1jYXJkXCIpO1xuICAgIGRlZmF1bHRDYXJkLmhpZGRlbiA9IGZhbHNlO1xuXG4gICAgLy9yZW1vdmUgYWxsIGRpc3BsYXllZCBjYXJkc1xuXG4gICAgY29uc3QgY2hpbGRyZW4gPSBBcnJheS5mcm9tKHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjYXJkc1wiKS5jaGlsZHJlbik7XG5cbiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgY2hpbGRyZW4pIHtcbiAgICAgIGlmIChlbGVtZW50LmlkICE9PSBcImRlZmF1bHQtY2FyZFwiKSB7XG4gICAgICAgIGVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9hZENhcmRzKCkge1xuICAgIHRoaXMuY2FyZHNDb2xsZWN0aW9uID0gdGhpcy5ob2xkaW5nc1tcImNhZmZlaW5lQ2FyZHNcIl07XG5cbiAgICBjb25zdCBkcm9wZG93bkRpdiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjYXJkcy1kcm9wZG93blwiKTtcblxuICAgIGxldCBkcm9wZG93biA9IGRyb3Bkb3duRGl2LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZHMtZHJvcGRvd24tbmZ0XCIpO1xuICAgIGlmIChkcm9wZG93bikge1xuICAgICAgZHJvcGRvd24ucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgbGV0IGRpc2FibGVkQXNzZXRJZHMgPSBbXTtcbiAgICBsZXQgaSA9IDA7XG4gICAgbWFpbmxvb3A6IGZvciAoY29uc3QgbmZ0IG9mIHRoaXMuY2FyZHNDb2xsZWN0aW9uLm5mdHMpIHtcbiAgICAgIC8vY2hlY2sgcmVxdWlyZW1lbnRcbiAgICAgIGlmIChuZnQubWV0YWRhdGEucmVxdWlyZSkge1xuICAgICAgICBmb3IgKGNvbnN0IHJlcXVpcmVLZXkgaW4gbmZ0Lm1ldGFkYXRhLnJlcXVpcmUpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXNbcmVxdWlyZUtleV0gIT1cbiAgICAgICAgICAgIG5mdC5tZXRhZGF0YS5yZXF1aXJlW3JlcXVpcmVLZXldXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBkaXNhYmxlZEFzc2V0SWRzLnB1c2gobmZ0LmFzc2V0SWQpO1xuICAgICAgICAgICAgY29udGludWUgbWFpbmxvb3A7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLypmb3IgKGNvbnN0IHNlbGVjdGVkQ2FyZCBvZiB0aGlzLnNlbGVjdGVkQ2FyZHMpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgc2VsZWN0ZWRDYXJkLm1ldGFkYXRhLnByb3BlcnRpZXNbcmVxdWlyZUtleV0gIT1cbiAgICAgICAgICAgICAgbmZ0Lm1ldGFkYXRhLnJlcXVpcmVbcmVxdWlyZUtleV1cbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBkaXNhYmxlZEFzc2V0SWRzLnB1c2gobmZ0LmFzc2V0SWQpO1xuICAgICAgICAgICAgICBjb250aW51ZSBtYWlubG9vcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9Ki9cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvL3JlbW92ZSBjYXJkcyBmcm9tIHRoZSBzYW1lIHR5cGVcbiAgICAgIGZvciAoY29uc3Qgc2VsZWN0ZWRDYXJkIG9mIHRoaXMuc2VsZWN0ZWRDYXJkcykge1xuICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5IGluIHNlbGVjdGVkQ2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgaWYgKG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xuICAgICAgICAgICAgZGlzYWJsZWRBc3NldElkcy5wdXNoKG5mdC5hc3NldElkKTtcbiAgICAgICAgICAgIGNvbnRpbnVlIG1haW5sb29wO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGRyb3Bkb3duID0gbmV3IERyb3Bkb3duTmZ0cyhcbiAgICAgIHRoaXMuY2FyZHNDb2xsZWN0aW9uLm5mdHMsXG4gICAgICB0aGlzLmRpZFNlbGVjdENhcmQuYmluZCh0aGlzKSxcbiAgICAgIFwiY2FyZHMtZHJvcGRvd24tbmZ0XCIsXG4gICAgICBkaXNhYmxlZEFzc2V0SWRzXG4gICAgKTtcbiAgICBkcm9wZG93bkRpdi5hcHBlbmQoZHJvcGRvd24udWkpO1xuXG4gICAgbmV3IHdpbmRvdy5ib290c3RyYXAuRHJvcGRvd24odGhpcy5jaG9vc2VDYXJkQnV0dG9uKTtcbiAgfVxuXG4gIGFzeW5jIGRpZFNlbGVjdENhcmQoZXZlbnQpIHtcbiAgICBjb25zdCBuZnRJbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDtcblxuICAgIGlmICghbmZ0SW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuZnQgPSB0aGlzLmNhcmRzQ29sbGVjdGlvbi5uZnRzW25mdEluZGV4XTtcbiAgICB0aGlzLnNlbGVjdGVkQ2FyZHMucHVzaChuZnQpO1xuXG4gICAgLy9yZW1vdmUgZGVmYXVsdCBjYXJkIGlmIG5lZWRlZFxuICAgIGNvbnN0IGRlZmF1bHRDYXJkID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2RlZmF1bHQtY2FyZFwiKTtcblxuICAgIGlmIChkZWZhdWx0Q2FyZCkge1xuICAgICAgZGVmYXVsdENhcmQuaGlkZGVuID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvL2FkZCBjYXJkXG4gICAgY29uc3QgbmV3Q2FyZERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbmV3Q2FyZERpdi5jbGFzc05hbWUgPSBcImNvbCB0ZXh0LWNlbnRlclwiO1xuICAgIG5ld0NhcmREaXYuaWQgPSBgY2FyZC0ke25mdEluZGV4fWA7XG5cbiAgICBuZXdDYXJkRGl2LmlubmVySFRNTCA9IGBcbiAgICA8aW1nIHN0eWxlPVwid2lkdGg6IDgwcHg7IGhlaWdodDogYXV0b1wiIHNyYz1cIiR7bmZ0LmltYWdlVXJsfVwiPlxuICAgIDxwPjxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMCk7XCIgaWQ9XCJybS0ke25mdEluZGV4fVwiIGRhdGEtaW5kZXg9XCIke25mdEluZGV4fVwiPlJlbW92ZTwvYT48L3A+XG4gICAgYDtcblxuICAgIG5ld0NhcmREaXZcbiAgICAgIC5xdWVyeVNlbGVjdG9yKGAjcm0tJHtuZnRJbmRleH1gKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnJlbW92ZUNhcmQuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgIHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNjYXJkc1wiKS5hcHBlbmQobmV3Q2FyZERpdik7XG5cbiAgICAvL2Rpc3BsYXkgaW1hZ2VcbiAgICAvL2NvbnN0IGNhcmRJbWcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1pbWdcIik7XG4gICAgLy9jYXJkSW1nLnNyYyA9IG5mdC5pbWFnZVVybDtcblxuICAgIHRoaXMudmFsaWRhdGUoKTtcblxuICAgIC8vcmVsb2FkIGNhcmRzXG4gICAgYXdhaXQgdGhpcy5sb2FkQ2FyZHMoKTtcblxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBhc3luYyByZW1vdmVDYXJkKGV2ZW50KSB7XG4gICAgY29uc3QgbmZ0SW5kZXggPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XG5cbiAgICBpZiAoIW5mdEluZGV4KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbmZ0ID0gdGhpcy5jYXJkc0NvbGxlY3Rpb24ubmZ0c1tuZnRJbmRleF07XG5cbiAgICBjb25zb2xlLmxvZyh0aGlzLnNlbGVjdGVkQ2FyZHMubWFwKChjKSA9PiBjLm5hbWUpKTtcbiAgICB0aGlzLnNlbGVjdGVkQ2FyZHMgPSB0aGlzLnNlbGVjdGVkQ2FyZHMuZmlsdGVyKFxuICAgICAgKGMpID0+IGMuYXNzZXRJZCAhPSBuZnQuYXNzZXRJZFxuICAgICk7XG4gICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RlZENhcmRzLm1hcCgoYykgPT4gYy5uYW1lKSk7XG5cbiAgICAvL2Rpc3BsYXkgZGVmYXVsdCBjYXJkIGFnYWluIGlmIG5lZWRlZFxuICAgIGlmICh0aGlzLnNlbGVjdGVkQ2FyZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBkZWZhdWx0Q2FyZCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNkZWZhdWx0LWNhcmRcIik7XG5cbiAgICAgIGlmIChkZWZhdWx0Q2FyZCkge1xuICAgICAgICBkZWZhdWx0Q2FyZC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnZhbGlkYXRlKCk7XG5cbiAgICAvL3JlbG9hZCBjYXJkc1xuICAgIGF3YWl0IHRoaXMubG9hZENhcmRzKCk7XG5cbiAgICB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoYCNjYXJkLSR7bmZ0SW5kZXh9YCkucmVtb3ZlKCk7XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgdmFsaWRhdGUoKSB7XG4gICAgY29uc3QgcmV2aWV3QnV0dG9uID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI2J1dHRvbi1yZXZpZXdcIik7XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZEJhdGhlciAmJiB0aGlzLnNlbGVjdGVkQ2FyZHMubGVuZ3RoID4gMCkge1xuICAgICAgcmV2aWV3QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG5cbiAgICAgIHRoaXMucHJldmlldygpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5zZWxlY3RlZEJhdGhlcikge1xuICAgICAgY29uc3QgbWVyZ2VkSW1nID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKFwiI21lcmdlZC1pbWdcIik7XG4gICAgICBtZXJnZWRJbWcuc3JjID0gdGhpcy5zZWxlY3RlZEJhdGhlci5pbWFnZVVybDtcblxuICAgICAgcmV2aWV3QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV2aWV3QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXZpZXcoZXZlbnQpIHtcbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbW9kYWwuY2xhc3NOYW1lID0gXCJtb2RhbFwiO1xuICAgIG1vZGFsLnRhYkluZGV4ID0gXCItMVwiO1xuXG4gICAgLy9pZiB0aGUgZ3JpbmQgY29udGFpbiBhIGRvdWJsZS1zZW5zaXRpdmUgbW9kaWZpY2F0aW9uIGRpc3BsYXkgYSBtZXNzYWdlXG5cbiAgICBsZXQgZHVwbGljYXRlU2Vuc2l0aXZlTGF5ZXJzID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGNhcmQgb2YgdGhpcy5zZWxlY3RlZENhcmRzKSB7XG4gICAgICBmb3IgKGNvbnN0IGxheWVyTmFtZSBpbiBjYXJkLm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgaWYgKGxheWVycy5kdXBsaWNhdGVDcml0ZXJpYS5pbmNsdWRlcyhsYXllck5hbWUpKSB7XG4gICAgICAgICAgZHVwbGljYXRlU2Vuc2l0aXZlTGF5ZXJzLnB1c2gobGF5ZXJOYW1lKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBkdXBsaWNhdGVNZXNzYWdlO1xuXG4gICAgaWYgKGR1cGxpY2F0ZVNlbnNpdGl2ZUxheWVycy5sZW5ndGggPiAwKXtcbiAgICAgIGR1cGxpY2F0ZU1lc3NhZ2UgPSBgJiM5ODg4OyYjNjUwMzk7IFRoaXMgcmVxdWVzdCBjb250YWlucyBhIG1vZGlmaWNhdGlvbiB0aGF0IGNhbiBnZW5lcmF0ZSBhIGR1cGxpY2F0ZSAoJHtkdXBsaWNhdGVTZW5zaXRpdmVMYXllcnMuam9pbignLCcpfSkuIElmIGl0J3MgdGhlIGNhc2UsIHRoZSByZXF1ZXN0IHdpbGwgYmUgY2FuY2VsZWQgYW5kIHRoZSBjYXJkcyByZXR1cm5lZCB0byB5b3VyIHdhbGxldC48YnI+YFxuICAgIH1cblxuICAgIG1vZGFsLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxuICAgICAgICAgIDxoNSBjbGFzcz1cIm1vZGFsLXRpdGxlXCI+UmV2aWV3IEJhdGhlciBtb2RpZmljYXRpb248L2g1PlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuLWNsb3NlXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbWItM1wiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3R5bGU9XCJ3aWR0aDogMzIwcHg7IGhlaWdodDogYXV0bztcIiBpZD1cInByZXZpZXctbWVyZ2VkLWltZ1wiPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICA8cD5cbiAgICAgICAgICBZb3VyIDxzdHJvbmc+JHt0aGlzLnNlbGVjdGVkQmF0aGVyLm5hbWV9PC9zdHJvbmc+IHdpbGwgYmUgdXBkYXRlZC48YnI+XG4gICAgICAgICAgWW91ciA8c3Ryb25nPiR7dGhpcy5zZWxlY3RlZENhcmRzXG4gICAgICAgICAgICAubWFwKChjKSA9PiBjLm5hbWUpXG4gICAgICAgICAgICAuam9pbihcIiwgXCIpfTwvc3Ryb25nPiB3aWxsIGJlIGJ1cm5lZCAmIzEyODI5MztcbiAgICAgICAgICA8L3A+XG4gICAgICAgICAgICBcbiAgICAgICAgICA8cD4ke2R1cGxpY2F0ZU1lc3NhZ2UgPyBkdXBsaWNhdGVNZXNzYWdlIDogJyd9JiMxMjgzMzc7IEFzIHRoZSBwcm9jZXNzIHJlcXVpcmVzIGEgbWFudWFsIHN0ZXAsIHVwZGF0ZSBjYW4gdGFrZSB1cCB0byAyNGguPGJyPlxuICAgICAgICAgICYjMTI4MjM2OyBZb3Ugd2lsbCBiZSBub3RpZmllZCBieSBhIHplcm8gQWxnbyB0cmFuc2FjdGlvbiB3aGVuIHRoZSB1cGRhdGUgaXMgY29tcGxldGUuPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnV0dG9uLWFsdFwiIGRhdGEtYnMtZGlzbWlzcz1cIm1vZGFsXCI+Q2xvc2U8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cInNlbmQtYnV0dG9uXCI+U2VuZCByZXF1ZXN0PC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgYDtcblxuICAgIGNvbnN0IHByZXZpZXdNZXJnZWRJbWcgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbWVyZ2VkLWltZ1wiKTtcbiAgICBwcmV2aWV3TWVyZ2VkSW1nLnNyYyA9IHRoaXMubWVyZ2VkSW1nRGF0YVVSTDtcblxuICAgIGNvbnN0IHNlbmRCdXR0b24gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3NlbmQtYnV0dG9uXCIpO1xuICAgIHNlbmRCdXR0b24uY3VycmVudE1vZGFsID0gbW9kYWw7XG4gICAgc2VuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5zZW5kLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIGNvbnN0IG15TW9kYWwgPSBuZXcgd2luZG93LmJvb3RzdHJhcC5Nb2RhbChtb2RhbCwge30pO1xuXG4gICAgbXlNb2RhbC5zaG93KCk7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBhc3luYyBwcmV2aWV3KCkge1xuICAgIGNvbnN0IHJldmlld0J1dHRvbiA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihcIiNidXR0b24tcmV2aWV3XCIpO1xuICAgIHJldmlld0J1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgcmV2aWV3QnV0dG9uLnRleHRDb250ZW50ID0gXCJHZW5lcmF0aW5nLi4uXCI7XG5cbiAgICBjb25zdCBtZXJnZWRJbWcgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjbWVyZ2VkLWltZ1wiKTtcblxuICAgIHRoaXMubWVyZ2VkUHJvcGVydGllcyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7fSxcbiAgICAgIHRoaXMuc2VsZWN0ZWRCYXRoZXIubWV0YWRhdGEucHJvcGVydGllc1xuICAgICk7IC8vbWFrZSBhIHNoYWxsb3cgY29weVxuXG4gICAgZm9yIChjb25zdCBzZWxlY3RlZENhcmQgb2YgdGhpcy5zZWxlY3RlZENhcmRzKSB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBzZWxlY3RlZENhcmQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICB0aGlzLm1lcmdlZFByb3BlcnRpZXNba2V5XSA9IHNlbGVjdGVkQ2FyZC5tZXRhZGF0YS5wcm9wZXJ0aWVzW2tleV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9jb25zb2xlLmxvZyhwcm9wZXJ0aWVzKVxuICAgIGNvbnN0IGNhbnZhcyA9IGF3YWl0IGRyYXcodGhpcy5tZXJnZWRQcm9wZXJ0aWVzLCBsYXllcnMsIFwibGF5ZXJzX2ltYWdlc1wiKTtcblxuICAgIHRoaXMubWVyZ2VkSW1nRGF0YVVSTCA9IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIik7XG5cbiAgICBtZXJnZWRJbWcuc3JjID0gdGhpcy5tZXJnZWRJbWdEYXRhVVJMO1xuXG4gICAgcmV2aWV3QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgcmV2aWV3QnV0dG9uLnRleHRDb250ZW50ID0gXCJSZXZpZXcuLi5cIjtcbiAgfVxuXG4gIGFzeW5jIHNlbmQoZXZlbnQpIHtcbiAgICBjb25zdCBzZW5kQnV0dG9uID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICBzZW5kQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICBzZW5kQnV0dG9uLnRleHRDb250ZW50ID0gXCJXYWl0aW5nIGZvciBzaWduYXR1cmUuLi5cIjtcblxuICAgIGNvbnN0IHN1Z2dlc3RlZFBhcmFtcyA9IGF3YWl0IHRoaXMuYWxnb2RDbGllbnQuZ2V0VHJhbnNhY3Rpb25QYXJhbXMoKS5kbygpO1xuXG4gICAgLy9nZW5lcmF0ZSB0eFxuXG4gICAgY29uc3Qgbm90ZSA9IHtcbiAgICAgIGV2b2x2ZTogdGhpcy5zZWxlY3RlZEJhdGhlci5hc3NldElkLFxuICAgIH07XG5cbiAgICBjb25zdCB0ZXh0RW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpO1xuICAgIGNvbnN0IGVuY29kZWROb3RlID0gdGV4dEVuY29kZXIuZW5jb2RlKEpTT04uc3RyaW5naWZ5KG5vdGUpKTtcblxuICAgIGlmICh0aGlzLnNlbGVjdGVkQ2FyZHMubGVuZ3RoID4gMTMpIHtcbiAgICAgIGFsZXJ0KFwiTm8gbW9yZSB0aGFuIDE0IGNhcmRzIGNhbiBiZSB1c2VkIGF0IG9uY2UuXCIpOyAvLzE2IG1pbnVzIGFzc2V0IGNvbmZpZyB0eCwgbWludXMgbm90aWZpY2F0aW9uIHR4LCBtaW51IGFzc2V0IHNlbmRcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgdHhucyA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBzZWxlY3RlZENhcmQgb2YgdGhpcy5zZWxlY3RlZENhcmRzKSB7XG4gICAgICB0eG5zLnB1c2goXG4gICAgICAgIGFsZ29zZGsubWFrZUFzc2V0VHJhbnNmZXJUeG5XaXRoU3VnZ2VzdGVkUGFyYW1zRnJvbU9iamVjdCh7XG4gICAgICAgICAgZnJvbTogdGhpcy53YWxsZXRDb25uZWN0LndhbGxldEFkZHJlc3MsXG4gICAgICAgICAgdG86IHRoaXMuY2FyZHNDb2xsZWN0aW9uLmNvbGxlY3Rpb25zWzBdLmFkZHJlc3Nlc1swXSxcbiAgICAgICAgICBhbW91bnQ6IDEsXG4gICAgICAgICAgYXNzZXRJbmRleDogc2VsZWN0ZWRDYXJkLmFzc2V0SWQsXG4gICAgICAgICAgc3VnZ2VzdGVkUGFyYW1zOiBzdWdnZXN0ZWRQYXJhbXMsXG4gICAgICAgICAgbm90ZTogZW5jb2RlZE5vdGUsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vYXNzaWduIGdyb3VwXG4gICAgaWYgKHR4bnMubGVuZ3RoID4gMSkge1xuICAgICAgYWxnb3Nkay5hc3NpZ25Hcm91cElEKHR4bnMpO1xuICAgIH1cblxuICAgIGNvbnN0IHNpZ25lZFR4bnMgPSBhd2FpdCB0aGlzLndhbGxldENvbm5lY3Quc2lnblRyYW5zYWN0aW9ucyh0eG5zKTtcblxuICAgIC8vZGlzcGxheSB3YWl0IGFuaW1hdGlvblxuICAgIGNvbnN0IGN1cnJlbnRNb2RhbCA9IHNlbmRCdXR0b24uY3VycmVudE1vZGFsO1xuXG4gICAgY3VycmVudE1vZGFsLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuLWNsb3NlXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5IFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9ncmluZGVyLnBuZ1wiIHN0eWxlPVwid2lkdGg6IDEyOHB4OyBoZWlnaHQ6IGF1dG87XCI+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlciBtYi0zXCI+XG4gICAgICAgICAgICBTZW5kaW5nIENhZmZlaW5lIENhcmQgdG8gdGhlIEdyaW5kZXIuLi5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICAvL3NlbmQgdHJhbnNhY3Rpb25cbiAgICBsZXQgdHg7XG4gICAgdHJ5IHtcbiAgICAgIHR4ID0gYXdhaXQgdGhpcy5hbGdvZENsaWVudC5zZW5kUmF3VHJhbnNhY3Rpb24oc2lnbmVkVHhucykuZG8oKTtcblxuICAgICAgLy8gV2FpdCBmb3IgY29uZmlybWF0aW9uXG4gICAgICBsZXQgY29uZmlybWVkVHhuID0gYXdhaXQgYWxnb3Nkay53YWl0Rm9yQ29uZmlybWF0aW9uKFxuICAgICAgICB0aGlzLmFsZ29kQ2xpZW50LFxuICAgICAgICB0eC50eElkLFxuICAgICAgICA0XG4gICAgICApO1xuXG4gICAgICBjdXJyZW50TW9kYWwuaW5uZXJIVE1MID0gYFxuICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1kaWFsb2cgbW9kYWwtZGlhbG9nLWNlbnRlcmVkXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4tY2xvc2VcIiBkYXRhLWJzLWRpc21pc3M9XCJtb2RhbFwiIGFyaWEtbGFiZWw9XCJDbG9zZVwiPjwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbWItM1wiPlxuICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL2hlYXJ0LWN1cC5wbmdcIiB3aWR0aD1cIjYwXCI+PGJyPjxicj5cbiAgICAgICAgICBXZSBnb3QgeW91ciBjYXJkIGFuZCB5b3VyIGV2b2x1dGlvbiByZXF1ZXN0Ljxicj5cbiAgICAgICAgICBXZSdsbCBiZSBiYWNrIHRvIHlvdSB2ZXJ5IHNvb24uXG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIj5DbG9zZTwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICAgIGN1cnJlbnRNb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiaGlkZGVuLmJzLm1vZGFsXCIsIChldmVudCkgPT4ge1xuICAgICAgICAvL3JlbG9hZCB3aG9sZSBwYWdlIHRvIHVwZGF0ZSBob2xkaW5nc1xuICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY3VycmVudE1vZGFsLmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nIG1vZGFsLWRpYWxvZy1jZW50ZXJlZFwiPlxuICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuLWNsb3NlXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtY2VudGVyIG1iLTNcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtZGFuZ2VyXCIgcm9sZT1cImFsZXJ0XCI+JHtlcnIubWVzc2FnZX0gPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+XG4gICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgZGF0YS1icy1kaXNtaXNzPVwibW9kYWxcIj5DbG9zZTwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJHcmluZGVyIiwiQmFzZVBhZ2UiLCJjb25zdHJ1Y3RvciIsInN1cGVyIiwiYXJndW1lbnRzIiwidGhpcyIsInVpIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiYmF0aGVyc0NvbGxlY3Rpb24iLCJjYXJkc0NvbGxlY3Rpb24iLCJzZWxlY3RlZEJhdGhlciIsInNlbGVjdGVkQ2FyZHMiLCJtZXJnZWRQcm9wZXJ0aWVzIiwibWVyZ2VkSW1nRGF0YVVSTCIsImNob29zZUNhcmRCdXR0b24iLCJxdWVyeVNlbGVjdG9yIiwibG9hZCIsImFzeW5jIiwibG9hZEJhdGhlcnMiLCJhZGRFdmVudExpc3RlbmVyIiwicmV2aWV3IiwiYmluZCIsInF1ZXJ5U3RyaW5nIiwid2luZG93IiwibG9jYXRpb24iLCJzZWFyY2giLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJoYXMiLCJiYXRoZXJBc3NldElkIiwicGFyc2VJbnQiLCJnZXQiLCJuZnQiLCJuZnRzIiwiZmlsdGVyIiwiYXNzZXRJZCIsImRpc3BsYXlCYXRoZXIiLCJob2xkaW5ncyIsImRyb3Bkb3duRGl2IiwiZHJvcGRvd24iLCJyZW1vdmUiLCJkaWRTZWxlY3RCYXRoZXIiLCJhcHBlbmQiLCJldmVudCIsImNsZWFyQ2FyZCIsIm5mdEluZGV4IiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJpbmRleCIsIm1ldGFkYXRhIiwicHJvcGVydGllcyIsInByZXZlbnREZWZhdWx0Iiwic3JjIiwiaW1hZ2VVcmwiLCJ2YWxpZGF0ZSIsImxvYWRDYXJkcyIsImRpc2FibGVkIiwiaGlkZGVuIiwiY2hpbGRyZW4iLCJBcnJheSIsImZyb20iLCJlbGVtZW50IiwiaWQiLCJkaXNhYmxlZEFzc2V0SWRzIiwibWFpbmxvb3AiLCJyZXF1aXJlIiwicmVxdWlyZUtleSIsInB1c2giLCJzZWxlY3RlZENhcmQiLCJwcm9wZXJ0eSIsImRpZFNlbGVjdENhcmQiLCJib290c3RyYXAiLCJEcm9wZG93biIsImRlZmF1bHRDYXJkIiwibmV3Q2FyZERpdiIsImNsYXNzTmFtZSIsInJlbW92ZUNhcmQiLCJjb25zb2xlIiwibG9nIiwibWFwIiwiYyIsIm5hbWUiLCJsZW5ndGgiLCJyZXZpZXdCdXR0b24iLCJwcmV2aWV3IiwibW9kYWwiLCJ0YWJJbmRleCIsImR1cGxpY2F0ZU1lc3NhZ2UiLCJkdXBsaWNhdGVTZW5zaXRpdmVMYXllcnMiLCJjYXJkIiwibGF5ZXJOYW1lIiwiam9pbiIsInNlbmRCdXR0b24iLCJjdXJyZW50TW9kYWwiLCJzZW5kIiwiTW9kYWwiLCJzaG93IiwidGV4dENvbnRlbnQiLCJtZXJnZWRJbWciLCJPYmplY3QiLCJhc3NpZ24iLCJrZXkiLCJjYW52YXMiLCJ0b0RhdGFVUkwiLCJzdWdnZXN0ZWRQYXJhbXMiLCJhbGdvZENsaWVudCIsImdldFRyYW5zYWN0aW9uUGFyYW1zIiwiZG8iLCJub3RlIiwiZXZvbHZlIiwiZW5jb2RlZE5vdGUiLCJUZXh0RW5jb2RlciIsImVuY29kZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhbGVydCIsInR4bnMiLCJ3YWxsZXRDb25uZWN0Iiwid2FsbGV0QWRkcmVzcyIsInRvIiwiY29sbGVjdGlvbnMiLCJhZGRyZXNzZXMiLCJhbW91bnQiLCJhc3NldEluZGV4Iiwic2lnbmVkVHhucyIsInNpZ25UcmFuc2FjdGlvbnMiLCJ0eCIsInNlbmRSYXdUcmFuc2FjdGlvbiIsInR4SWQiLCJyZWxvYWQiLCJlcnIiLCJtZXNzYWdlIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9