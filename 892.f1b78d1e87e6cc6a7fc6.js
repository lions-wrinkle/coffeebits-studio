"use strict";(self.webpackChunkstudio=self.webpackChunkstudio||[]).push([[892,998],{6998:(e,t,s)=>{s.r(t),s.d(t,{BasePage:()=>i});class i{constructor(e,t,s,i){this.walletConnect=e,this.algodClient=s,this.algoIndexer=i,this.holdings=t}}},6892:(e,t,s)=>{s.r(t),s.d(t,{Browse:()=>a});var i=s(6998),n=s(7304),o=s(5190);class a extends i.BasePage{constructor(...e){super(...arguments),this.collectionName=e[e.length-1],this.title="","caffeineCards"===this.collectionName?this.title="Caffeine Cards":"bathers"===this.collectionName&&(this.title="Bathers"),this.ui=document.createElement("div"),this.ui.innerHTML=`\n    <h1 class="mb-0">${this.title}</h1>\n    <div class="dark-text mb-4">Browse all ${this.title}</div>\n    <div class="row mb-3" id="filters"></div>\n    `,this.collection,this.bathersWithPacks,this.loadAll()}sleep(e){return new Promise((t=>setTimeout(t,e)))}async loadAll(){const e=document.createElement("p");e.textContent=`Loading ${this.title}...`,this.ui.append(e);const t=o.default.filter((e=>e.name===this.collectionName))[0];if(this.collection=new n.tf([t]),await this.collection.load(this.algoIndexer),"bathers"===this.collectionName){const{loadPacks:e}=await Promise.all([s.e(393),s.e(298)]).then(s.bind(s,5298));try{const t=await e();t&&t.length>0&&(this.bathersWithPacks=t.map((e=>e[0])))}catch(e){console.error(e)}}e.remove(),this.displayList()}displayList(){if(!this.collection.nfts.length){const e=document.createElement("div");return e.innerHTML='<div class="dark-text mb-5">No assets</div>',void this.ui.append(e)}const e=this.ui.querySelector("#filters");let t;"caffeineCards"===this.collectionName&&(t='<div class="col-6 col-md-3">\n        <select class="form-control custom-form-control" id="filter-type">\n          <option value="">Card type</option>\n          <option value="Body">Body</option>\n          <option value="Clothes">Clothes</option>\n          <option value="Cup">Cup</option>\n          <option value="Decoration">Decoration</option>\n          <option value="Mini Cup">Mini Cup</option>\n          <option value="Power">Power</option>\n          <option value="Room">Room</option>\n        </select>\n        <span id="filter-type-loading" hidden>Searching...</span>\n      </div>'),e.innerHTML=`\n    <div class="col-6 col-md-3">\n      <input type="search" class="form-control custom-form-control" placeholder="Name or asset ID" id="filter-search" style="max-width: 16rem;">\n    </div>\n      ${t||""}\n    </div>\n    `,e.querySelector("#filter-search").addEventListener("keypress",this.search.bind(this),!1),t&&e.querySelector("#filter-type").addEventListener("change",this.filterType.bind(this),!1);const s=document.createElement("div");s.className="row row-cols-2 row-cols-md-3 row-cols-lg-4 gy-4 mb-5",this.ui.append(s);let i=new IntersectionObserver(this.loadVisibleNFTs.bind(this),{root:null,rootMargin:"0px",threshold:0}),n=0;for(const e of this.collection.nfts){const t=document.createElement("div");t.id=`nft-${n}`,t.className="col nft-item",t.dataset.i=n;let o="bathers"===this.collectionName?"placeholder-bather":"placeholder-card";if(t.innerHTML=`\n          <div class="list-item h-100 d-flex flex-column">\n              <div class="ratio ratio-1x1 ${o}">\n                <img src="" class="nft-img img-fluid" loading="lazy" hidden>\n              </div>\n              <div class="list-item-text flex-fill d-flex flex-column">\n                  <h4>${e.name}</h4>\n                  <div class="d-flex justify-content-between">\n                      <span class="asset-id">${e.assetId}</span>\n                      ${e.total}\n                  </div>\n                  <div class="mt-3 nft-properties">\n                  </div>\n                  <div class="flex-fill d-flex justify-content-between align-items-end mt-2">\n                        <div class="nft-special"></div>\n                        <div class="dropdown"></div>\n                  </div>\n              </div>\n          </div>\n      `,t.querySelector(".dropdown").innerHTML=`\n          <a href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">\n          <img src="assets/more.png" class="more">\n          </a>\n          <ul class="dropdown-menu">\n              <li><a class="dropdown-item" href="https://www.nftexplorer.app/asset/${e.assetId}" target="_blank">NFTExplorer</a></li>\n              <li><a class="dropdown-item" href="https://www.randgallery.com/algo-collection/?address=${e.assetId}" target="_blank">RandGallery</a></li>\n              <li><a class="dropdown-item" href="https://algoxnft.com/asset/${e.assetId}" target="_blank">ALGOxNFT</a></li>\n              <li><a class="dropdown-item" href="https://shufl.app/detail/${e.assetId}" target="_blank">Shufl</a></li>\n          </ul>\n    `,"bathers"===this.collectionName&&this.bathersWithPacks&&this.bathersWithPacks.includes(e.assetId)){const e=t.querySelector(".nft-special");e.dataset.bsTitle="The pack tied to this Bather has not been opened yet",e.dataset.bsToggle="tooltip",e.dataset.bsCustomClass="custom-tooltip",e.innerHTML='<img src="assets/pack-icon.png">',new window.bootstrap.Tooltip(e)}s.append(t),n++,i.observe(t)}}loadVisibleNFTs(e,t){e.forEach((e=>{if(!e.isIntersecting)return;const t=e.target,s=this.collection.nfts[t.dataset.i];s.loading||(s.load(this.algoIndexer,!1).then((()=>{const e=t.querySelector(".nft-img");if(e.src=s.imageUrl,e.hidden=!1,s.handleImageError(e),"caffeineCards"===this.collectionName){let e="";if(s.metadata.properties){for(const t in s.metadata.properties)e+=`<span class="custom-badge">${t}</span> `;e+="<br>"}let i="";if(s.metadata.require){let e=[];for(const t in s.metadata.require)e.push(`<span class="custom-badge light">${t}: ${s.metadata.require[t]}</span>`);i=`<span class="custom-badge dark">Require:</span> ${e.join(" ")}`}t.querySelector(".nft-properties").innerHTML=`${e} ${i}<br>`;const n=t.querySelector(".nft-special");n.innerHTML='&#128293; <span id="burn-count">...</span>',n.dataset.bsTitle="Number of card definitively burned",n.dataset.bsToggle="tooltip",n.dataset.bsCustomClass="custom-tooltip",new window.bootstrap.Tooltip(n),this.algodClient.accountAssetInformation(s.metadata.burn_address,s.assetId).do().then((e=>{n.innerHTML=`&#128293; <span id="burn-count">${e["asset-holding"].amount}</span>`}))}})),s.loading=!0,this.sleep(100))}))}search(e){if("Enter"!==e.key)return;const t=e.currentTarget.value;if(!t)return void this.ui.querySelectorAll(".nft-item").forEach((e=>{e.hidden=!1}));let s=t.split(" ");s=s.map((e=>e.trim().toLowerCase())),s=s.filter((e=>e));let i=0;for(const e of this.collection.nfts){let t=!1;e:for(const i of s){if(e.name.toLowerCase().includes(i)||e.assetId==i){t=!0;break}if(e.metadata&&e.metadata.properties)for(const s in e.metadata.properties)if(s.toLowerCase().includes(i)||e.metadata.properties[s].toLowerCase().includes(i)){t=!0;break e}}this.ui.querySelector(`#nft-${i}`).hidden=!t,i++}}async filterType(e){const t=this.ui.querySelector("#filter-type-loading");t.hidden=!1;const s=e?.currentTarget?.value;if(this.ui.querySelectorAll(".nft-item").forEach((e=>{e.hidden=!!s})),!s)return void(t.hidden=!0);let i=0;for(const e of this.collection.nfts){let t=!1;e.isLoaded||await e.load(this.algoIndexer),e.metadata?.properties?.[s]&&(t=!0);this.ui.querySelector(`#nft-${i}`).hidden=!t,i++}t.hidden=!0}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJakQsRUFBSTdCLEtBQUtrRixjQUFjOUMsU0FBU2tELElBQVN6RCxFQUFJSyxTQUFXb0QsRUFBTSxDQUNoRUYsR0FBUSxFQUNSLEtBQ0YsQ0FFQSxHQUFJdkQsRUFBSTZCLFVBQVk3QixFQUFJNkIsU0FBU0MsV0FDL0IsSUFBSyxNQUFNYSxLQUFPM0MsRUFBSTZCLFNBQVNDLFdBQzdCLEdBQ0VhLEVBQUlVLGNBQWM5QyxTQUFTa0QsSUFDM0J6RCxFQUFJNkIsU0FBU0MsV0FBV2EsR0FBS1UsY0FBYzlDLFNBQVNrRCxHQUNwRCxDQUNBRixHQUFRLEVBQ1IsTUFBTUMsQ0FDUixDQUdOLENBRW9CL0csS0FBS1EsR0FBR2dDLGNBQWMsUUFBUWMsS0FFcEMyQixRQURWNkIsRUFNSnhELEdBQ0YsQ0FDRixDQUVBbEMsaUJBQWlCNkUsR0FFZixNQUFNckIsRUFBVTVFLEtBQUtRLEdBQUdnQyxjQUFjLHdCQUN0Q29DLEVBQVFLLFFBQVMsRUFFakIsTUFBTWdDLEVBQU9oQixHQUFPRyxlQUFlQyxNQVduQyxHQVRjckcsS0FBS1EsR0FBRzhGLGlCQUFpQixhQUNqQzlCLFNBQVMrQixJQUlYQSxFQUFLdEIsU0FIRmdDLENBSUwsS0FHR0EsRUFFSCxZQURBckMsRUFBUUssUUFBUyxHQUluQixJQUFJM0IsRUFBSSxFQUNSLElBQUssTUFBTUMsS0FBT3ZELEtBQUtZLFdBQVd5QixLQUFNLENBQ3RDLElBQUl5RSxHQUFRLEVBRVB2RCxFQUFJMkQsZ0JBQ0QzRCxFQUFJNUIsS0FBSzNCLEtBQUtELGFBR2xCd0QsRUFBSTZCLFVBQVVDLGFBQWE0QixLQUM3QkgsR0FBUSxHQUdVOUcsS0FBS1EsR0FBR2dDLGNBQWMsUUFBUWMsS0FFcEMyQixRQURWNkIsRUFNSnhELEdBQ0YsQ0FFQXNCLEVBQVFLLFFBQVMsQ0FDbkIsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9iYXNlLmpzIiwid2VicGFjazovL3N0dWRpby8uL3NyYy9wYWdlcy9icm93c2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgY2xhc3MgQmFzZVBhZ2Uge1xuXG4gICAgY29uc3RydWN0b3Iod2FsbGV0Q29ubmVjdCwgaG9sZGluZ3MsIGFsZ29kQ2xpZW50LCBhbGdvSW5kZXhlcil7XG5cbiAgICAgICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcbiAgICAgICAgdGhpcy5hbGdvZENsaWVudCA9IGFsZ29kQ2xpZW50O1xuICAgICAgICB0aGlzLmFsZ29JbmRleGVyID0gYWxnb0luZGV4ZXI7XG4gICAgICAgIHRoaXMuaG9sZGluZ3MgPSBob2xkaW5ncztcblxuICAgICAgICBcblxuICAgIH1cblxufSIsImltcG9ydCB7IEJhc2VQYWdlIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IHsgTkZUQ29sbGVjdGlvbiB9IGZyb20gXCJhbGdvLW5mdC11dGlsc1wiO1xuXG5pbXBvcnQgY29sbGVjdGlvbnMgZnJvbSBcIi4uL2NvbGxlY3Rpb25zLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBCcm93c2UgZXh0ZW5kcyBCYXNlUGFnZSB7XG4gIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuXG4gICAgLy90aGlzLmNvbGxlY3Rpb25OYW1lID0gXCJjYWZmZWluZUNhcmRzXCI7XG4gICAgdGhpcy5jb2xsZWN0aW9uTmFtZSA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcblxuICAgIHRoaXMudGl0bGUgPSBcIlwiO1xuICAgIGlmICh0aGlzLmNvbGxlY3Rpb25OYW1lID09PSBcImNhZmZlaW5lQ2FyZHNcIikge1xuICAgICAgdGhpcy50aXRsZSA9IFwiQ2FmZmVpbmUgQ2FyZHNcIjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiYmF0aGVyc1wiKSB7XG4gICAgICB0aGlzLnRpdGxlID0gXCJCYXRoZXJzXCI7XG4gICAgfVxuXG4gICAgdGhpcy51aSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICB0aGlzLnVpLmlubmVySFRNTCA9IGBcbiAgICA8aDEgY2xhc3M9XCJtYi0wXCI+JHt0aGlzLnRpdGxlfTwvaDE+XG4gICAgPGRpdiBjbGFzcz1cImRhcmstdGV4dCBtYi00XCI+QnJvd3NlIGFsbCAke3RoaXMudGl0bGV9PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cInJvdyBtYi0zXCIgaWQ9XCJmaWx0ZXJzXCI+PC9kaXY+XG4gICAgYDtcblxuICAgIHRoaXMuY29sbGVjdGlvbjtcblxuICAgIHRoaXMuYmF0aGVyc1dpdGhQYWNrcztcblxuICAgIHRoaXMubG9hZEFsbCgpO1xuICB9XG5cbiAgc2xlZXAoZGVsYXlUaW1lKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5VGltZSkpO1xuICB9XG5cbiAgYXN5bmMgbG9hZEFsbCgpIHtcbiAgICBjb25zdCBsb2FkaW5nUCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgIGxvYWRpbmdQLnRleHRDb250ZW50ID0gYExvYWRpbmcgJHt0aGlzLnRpdGxlfS4uLmA7XG4gICAgdGhpcy51aS5hcHBlbmQobG9hZGluZ1ApO1xuXG4gICAgY29uc3QgY2FyZENvbGxlY3Rpb24gPSBjb2xsZWN0aW9ucy5maWx0ZXIoXG4gICAgICAoYykgPT4gYy5uYW1lID09PSB0aGlzLmNvbGxlY3Rpb25OYW1lXG4gICAgKVswXTtcblxuICAgIHRoaXMuY29sbGVjdGlvbiA9IG5ldyBORlRDb2xsZWN0aW9uKFtjYXJkQ29sbGVjdGlvbl0pO1xuICAgIGF3YWl0IHRoaXMuY29sbGVjdGlvbi5sb2FkKHRoaXMuYWxnb0luZGV4ZXIpO1xuXG4gICAgLy9sb2FkIHBhY2tzXG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbk5hbWUgPT09IFwiYmF0aGVyc1wiKSB7XG4gICAgICBjb25zdCB7IGxvYWRQYWNrcyB9ID0gYXdhaXQgaW1wb3J0KFwiLi9wYWNrcy5qc1wiKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFja3MgPSBhd2FpdCBsb2FkUGFja3MoKTtcblxuICAgICAgICBpZiAocGFja3MgJiYgcGFja3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHRoaXMuYmF0aGVyc1dpdGhQYWNrcyA9IHBhY2tzLm1hcCgocCkgPT4gcFswXSk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbG9hZGluZ1AucmVtb3ZlKCk7XG5cbiAgICB0aGlzLmRpc3BsYXlMaXN0KCk7XG4gIH1cblxuICBkaXNwbGF5TGlzdCgpIHtcbiAgICBpZiAoIXRoaXMuY29sbGVjdGlvbi5uZnRzLmxlbmd0aCkge1xuICAgICAgY29uc3QgZW1wdHlEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgZW1wdHlEaXYuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9XCJkYXJrLXRleHQgbWItNVwiPk5vIGFzc2V0czwvZGl2Pic7XG5cbiAgICAgIHRoaXMudWkuYXBwZW5kKGVtcHR5RGl2KTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vZGlzcGxheSBmaWx0ZXJcbiAgICBjb25zdCBmaWx0ZXJEaXYgPSB0aGlzLnVpLnF1ZXJ5U2VsZWN0b3IoXCIjZmlsdGVyc1wiKTtcblxuICAgIGxldCB0eXBlRHJvcGRvd247XG5cbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJjYWZmZWluZUNhcmRzXCIpIHtcbiAgICAgIHR5cGVEcm9wZG93biA9IGA8ZGl2IGNsYXNzPVwiY29sLTYgY29sLW1kLTNcIj5cbiAgICAgICAgPHNlbGVjdCBjbGFzcz1cImZvcm0tY29udHJvbCBjdXN0b20tZm9ybS1jb250cm9sXCIgaWQ9XCJmaWx0ZXItdHlwZVwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj5DYXJkIHR5cGU8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiQm9keVwiPkJvZHk8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiQ2xvdGhlc1wiPkNsb3RoZXM8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiQ3VwXCI+Q3VwPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIkRlY29yYXRpb25cIj5EZWNvcmF0aW9uPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIk1pbmkgQ3VwXCI+TWluaSBDdXA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiUG93ZXJcIj5Qb3dlcjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJSb29tXCI+Um9vbTwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgICAgPHNwYW4gaWQ9XCJmaWx0ZXItdHlwZS1sb2FkaW5nXCIgaGlkZGVuPlNlYXJjaGluZy4uLjwvc3Bhbj5cbiAgICAgIDwvZGl2PmA7XG4gICAgfVxuXG4gICAgZmlsdGVyRGl2LmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwiY29sLTYgY29sLW1kLTNcIj5cbiAgICAgIDxpbnB1dCB0eXBlPVwic2VhcmNoXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2wgY3VzdG9tLWZvcm0tY29udHJvbFwiIHBsYWNlaG9sZGVyPVwiTmFtZSBvciBhc3NldCBJRFwiIGlkPVwiZmlsdGVyLXNlYXJjaFwiIHN0eWxlPVwibWF4LXdpZHRoOiAxNnJlbTtcIj5cbiAgICA8L2Rpdj5cbiAgICAgICR7dHlwZURyb3Bkb3duID8gdHlwZURyb3Bkb3duIDogXCJcIn1cbiAgICA8L2Rpdj5cbiAgICBgO1xuXG4gICAgZmlsdGVyRGl2XG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2ZpbHRlci1zZWFyY2hcIilcbiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlwcmVzc1wiLCB0aGlzLnNlYXJjaC5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgXG5cbiAgICBpZiAodHlwZURyb3Bkb3duKSB7XG4gICAgICBmaWx0ZXJEaXZcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2ZpbHRlci10eXBlXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLmZpbHRlclR5cGUuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgIH1cblxuICAgIGNvbnN0IGxpc3RWaWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBsaXN0Vmlldy5jbGFzc05hbWUgPSBcInJvdyByb3ctY29scy0yIHJvdy1jb2xzLW1kLTMgcm93LWNvbHMtbGctNCBneS00IG1iLTVcIjtcbiAgICB0aGlzLnVpLmFwcGVuZChsaXN0Vmlldyk7XG5cbiAgICAvL2xvYWQgb25seSB3aGVuIGVsZW1lbnQgaXMgdmlzaWJsZVxuICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgcm9vdDogbnVsbCwgLy9icm93c2VyIHZpZXdwb3J0XG4gICAgICByb290TWFyZ2luOiBcIjBweFwiLFxuICAgICAgdGhyZXNob2xkOiAwLjAsXG4gICAgfTtcblxuICAgIGxldCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihcbiAgICAgIHRoaXMubG9hZFZpc2libGVORlRzLmJpbmQodGhpcyksXG4gICAgICBvcHRpb25zXG4gICAgKTtcblxuICAgIC8vZGlzcGxheSBuZnRzXG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoY29uc3QgbmZ0IG9mIHRoaXMuY29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICBjb25zdCBuZnREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgbmZ0RGl2LmlkID0gYG5mdC0ke2l9YDtcbiAgICAgIG5mdERpdi5jbGFzc05hbWUgPSBcImNvbCBuZnQtaXRlbVwiO1xuICAgICAgbmZ0RGl2LmRhdGFzZXQuaSA9IGk7XG5cbiAgICAgIGxldCBwbGFjZUhvbGRlckNsYXNzID1cbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJiYXRoZXJzXCJcbiAgICAgICAgICA/IFwicGxhY2Vob2xkZXItYmF0aGVyXCJcbiAgICAgICAgICA6IFwicGxhY2Vob2xkZXItY2FyZFwiO1xuXG4gICAgICBuZnREaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJsaXN0LWl0ZW0gaC0xMDAgZC1mbGV4IGZsZXgtY29sdW1uXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyYXRpbyByYXRpby0xeDEgJHtwbGFjZUhvbGRlckNsYXNzfVwiPlxuICAgICAgICAgICAgICAgIDxpbWcgc3JjPVwiXCIgY2xhc3M9XCJuZnQtaW1nIGltZy1mbHVpZFwiIGxvYWRpbmc9XCJsYXp5XCIgaGlkZGVuPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxpc3QtaXRlbS10ZXh0IGZsZXgtZmlsbCBkLWZsZXggZmxleC1jb2x1bW5cIj5cbiAgICAgICAgICAgICAgICAgIDxoND4ke25mdC5uYW1lfTwvaDQ+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJhc3NldC1pZFwiPiR7bmZ0LmFzc2V0SWR9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICR7bmZ0LnRvdGFsfVxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibXQtMyBuZnQtcHJvcGVydGllc1wiPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleC1maWxsIGQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiBhbGlnbi1pdGVtcy1lbmQgbXQtMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5mdC1zcGVjaWFsXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd25cIj48L2Rpdj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG5cbiAgICAgIC8vYWRkIGRyb3Bkb3duIHdpdGggb3B0aW9uc1xuICAgICAgY29uc3QgZHJvcGRvd25EaXYgPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIi5kcm9wZG93blwiKTtcblxuICAgICAgZHJvcGRvd25EaXYuaW5uZXJIVE1MID0gYFxuICAgICAgICAgIDxhIGhyZWY9XCIjXCIgcm9sZT1cImJ1dHRvblwiIGRhdGEtYnMtdG9nZ2xlPVwiZHJvcGRvd25cIiBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgICAgICA8aW1nIHNyYz1cImFzc2V0cy9tb3JlLnBuZ1wiIGNsYXNzPVwibW9yZVwiPlxuICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8dWwgY2xhc3M9XCJkcm9wZG93bi1tZW51XCI+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly93d3cubmZ0ZXhwbG9yZXIuYXBwL2Fzc2V0LyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+TkZURXhwbG9yZXI8L2E+PC9saT5cbiAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL3d3dy5yYW5kZ2FsbGVyeS5jb20vYWxnby1jb2xsZWN0aW9uLz9hZGRyZXNzPSR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+UmFuZEdhbGxlcnk8L2E+PC9saT5cbiAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL2FsZ294bmZ0LmNvbS9hc3NldC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPkFMR094TkZUPC9hPjwvbGk+XG4gICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly9zaHVmbC5hcHAvZGV0YWlsLyR7bmZ0LmFzc2V0SWR9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+U2h1Zmw8L2E+PC9saT5cbiAgICAgICAgICA8L3VsPlxuICAgIGA7XG5cbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJiYXRoZXJzXCIgJiZcbiAgICAgICAgdGhpcy5iYXRoZXJzV2l0aFBhY2tzICYmXG4gICAgICAgIHRoaXMuYmF0aGVyc1dpdGhQYWNrcy5pbmNsdWRlcyhuZnQuYXNzZXRJZClcbiAgICAgICkge1xuICAgICAgICBjb25zdCBuZnRTcGVjaWFsRGl2ID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIubmZ0LXNwZWNpYWxcIik7XG4gICAgICAgIG5mdFNwZWNpYWxEaXYuZGF0YXNldC5ic1RpdGxlID1cbiAgICAgICAgICBcIlRoZSBwYWNrIHRpZWQgdG8gdGhpcyBCYXRoZXIgaGFzIG5vdCBiZWVuIG9wZW5lZCB5ZXRcIjtcbiAgICAgICAgbmZ0U3BlY2lhbERpdi5kYXRhc2V0LmJzVG9nZ2xlID0gXCJ0b29sdGlwXCI7XG4gICAgICAgIG5mdFNwZWNpYWxEaXYuZGF0YXNldC5ic0N1c3RvbUNsYXNzID0gXCJjdXN0b20tdG9vbHRpcFwiO1xuICAgICAgICBuZnRTcGVjaWFsRGl2LmlubmVySFRNTCA9ICc8aW1nIHNyYz1cImFzc2V0cy9wYWNrLWljb24ucG5nXCI+JztcblxuICAgICAgICBuZXcgd2luZG93LmJvb3RzdHJhcC5Ub29sdGlwKG5mdFNwZWNpYWxEaXYpO1xuICAgICAgfVxuXG4gICAgICBsaXN0Vmlldy5hcHBlbmQobmZ0RGl2KTtcblxuICAgICAgaSsrO1xuXG4gICAgICBvYnNlcnZlci5vYnNlcnZlKG5mdERpdik7XG5cbiAgICAgIC8qbmZ0LmxvYWQodGhpcy5hbGdvSW5kZXhlcikudGhlbigoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKG5mdERpdik7XG5cbiAgICAgICAgbGV0IHByb3BlcnRpZXNOYW1lcyA9IFwiXCI7XG5cbiAgICAgICAgaWYgKG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eU5hbWUgaW4gbmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIHByb3BlcnRpZXNOYW1lcyArPSBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2VcIj4ke3Byb3BlcnR5TmFtZX08L3NwYW4+IGA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJvcGVydGllc05hbWVzICs9IFwiPGJyPlwiO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlcXVpcmUgPSBcIlwiO1xuXG4gICAgICAgIGlmIChuZnQubWV0YWRhdGEucmVxdWlyZSkge1xuICAgICAgICAgIGxldCByZXF1aXJlTGlzdCA9IFtdO1xuXG4gICAgICAgICAgZm9yIChjb25zdCByZXF1aXJlS2V5IGluIG5mdC5tZXRhZGF0YS5yZXF1aXJlKSB7XG4gICAgICAgICAgICByZXF1aXJlTGlzdC5wdXNoKFxuICAgICAgICAgICAgICBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2UgbGlnaHRcIj4ke3JlcXVpcmVLZXl9OiAke25mdC5tZXRhZGF0YS5yZXF1aXJlW3JlcXVpcmVLZXldfTwvc3Bhbj5gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcXVpcmUgPSBgPHNwYW4gY2xhc3M9XCJjdXN0b20tYmFkZ2UgZGFya1wiPlJlcXVpcmU6PC9zcGFuPiAke3JlcXVpcmVMaXN0LmpvaW4oXG4gICAgICAgICAgICBcIiBcIlxuICAgICAgICAgICl9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIG5mdERpdi5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIFwiLm5mdC1wcm9wZXJ0aWVzXCJcbiAgICAgICAgKS5pbm5lckhUTUwgPSBgJHtwcm9wZXJ0aWVzTmFtZXN9ICR7cmVxdWlyZX08YnI+YDtcblxuICAgICAgICAvL2xvYWQgaW1hZ2VcbiAgICAgICAgY29uc3QgaW1hZ2UgPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIi5uZnQtaW1nXCIpO1xuICAgICAgICBpbWFnZS5zcmMgPSBuZnQuaW1hZ2VVcmw7XG4gICAgICAgIG5mdC5oYW5kbGVJbWFnZUVycm9yKGltYWdlKTtcblxuICAgICAgICAvL2xvYWQgYmFsYW5jZSBmcm9tIGJ1cm5pbmcgYWRkcmVzc1xuICAgICAgICBjb25zdCBidXJuQ291bnRTcGFuID0gbmZ0RGl2LnF1ZXJ5U2VsZWN0b3IoXCIjYnVybi1jb3VudFwiKTtcbiAgICAgICAgYnVybkNvdW50U3Bhbi50ZXh0Q29udGVudCA9IFwiLi4uXCI7XG5cbiAgICAgICAgdGhpcy5hbGdvZENsaWVudFxuICAgICAgICAgIC5hY2NvdW50QXNzZXRJbmZvcm1hdGlvbihuZnQubWV0YWRhdGEuYnVybl9hZGRyZXNzLCBuZnQuYXNzZXRJZClcbiAgICAgICAgICAuZG8oKVxuICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGJ1cm5Db3VudFNwYW4udGV4dENvbnRlbnQgPSBgJHtyZXN1bHRbXCJhc3NldC1ob2xkaW5nXCJdLmFtb3VudH1gO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vYWRkIGRyb3Bkb3duIHdpdGggb3B0aW9uc1xuICAgICAgICBjb25zdCBkcm9wZG93bkRpdiA9IG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLmRyb3Bkb3duXCIpO1xuXG4gICAgICAgIGRyb3Bkb3duRGl2LmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgIDxhIGhyZWY9XCIjXCIgcm9sZT1cImJ1dHRvblwiIGRhdGEtYnMtdG9nZ2xlPVwiZHJvcGRvd25cIiBhcmlhLWV4cGFuZGVkPVwiZmFsc2VcIj5cbiAgICAgICAgICAgIDxpbWcgc3JjPVwiYXNzZXRzL21vcmUucG5nXCIgY2xhc3M9XCJtb3JlXCI+XG4gICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICA8dWwgY2xhc3M9XCJkcm9wZG93bi1tZW51XCI+XG4gICAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL3d3dy5uZnRleHBsb3Jlci5hcHAvYXNzZXQvJHtuZnQuYXNzZXRJZH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj5ORlRFeHBsb3JlcjwvYT48L2xpPlxuICAgICAgICAgICAgICAgIDxsaT48YSBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiBocmVmPVwiaHR0cHM6Ly93d3cucmFuZGdhbGxlcnkuY29tL2FsZ28tY29sbGVjdGlvbi8/YWRkcmVzcz0ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPlJhbmRHYWxsZXJ5PC9hPjwvbGk+XG4gICAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPVwiZHJvcGRvd24taXRlbVwiIGhyZWY9XCJodHRwczovL2FsZ294bmZ0LmNvbS9hc3NldC8ke25mdC5hc3NldElkfVwiIHRhcmdldD1cIl9ibGFua1wiPkFMR094TkZUPC9hPjwvbGk+XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgYDtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnNsZWVwKDEwMCk7Ki9cbiAgICB9XG4gIH1cblxuICBsb2FkVmlzaWJsZU5GVHMoZW50cmllcywgb2JzZXJ2ZXIpIHtcbiAgICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgICBpZiAoIWVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbmZ0RGl2ID0gZW50cnkudGFyZ2V0O1xuICAgICAgY29uc3QgbmZ0ID0gdGhpcy5jb2xsZWN0aW9uLm5mdHNbbmZ0RGl2LmRhdGFzZXQuaV07XG5cbiAgICAgIGlmIChuZnQubG9hZGluZykge1xuICAgICAgICAvL2xvYWRpbmcgaGF2ZSBhbHJlYWR5IHN0YXJ0ZWRcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvL2NvbnN0IHVzZVBlcmEgPSB0aGlzLmNvbGxlY3Rpb25OYW1lID09PSBcImJhdGhlcnNcIiA/IHRydWUgOiBmYWxzZTtcbiAgICAgIGNvbnN0IHVzZVBlcmEgPSBmYWxzZTtcblxuICAgICAgbmZ0LmxvYWQodGhpcy5hbGdvSW5kZXhlciwgdXNlUGVyYSkudGhlbigoKSA9PiB7XG4gICAgICAgIC8vbG9hZCBpbWFnZVxuICAgICAgICBjb25zdCBpbWFnZSA9IG5mdERpdi5xdWVyeVNlbGVjdG9yKFwiLm5mdC1pbWdcIik7XG4gICAgICAgIGltYWdlLnNyYyA9IG5mdC5pbWFnZVVybDtcbiAgICAgICAgaW1hZ2UuaGlkZGVuID0gZmFsc2U7XG4gICAgICAgIG5mdC5oYW5kbGVJbWFnZUVycm9yKGltYWdlKTtcblxuICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uTmFtZSA9PT0gXCJjYWZmZWluZUNhcmRzXCIpIHtcbiAgICAgICAgICAvL2Rpc3BsYXkgcHJvcGVydGllc1xuICAgICAgICAgIGxldCBwcm9wZXJ0aWVzTmFtZXMgPSBcIlwiO1xuXG4gICAgICAgICAgaWYgKG5mdC5tZXRhZGF0YS5wcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5TmFtZSBpbiBuZnQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICAgICAgICBwcm9wZXJ0aWVzTmFtZXMgKz0gYDxzcGFuIGNsYXNzPVwiY3VzdG9tLWJhZGdlXCI+JHtwcm9wZXJ0eU5hbWV9PC9zcGFuPiBgO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwcm9wZXJ0aWVzTmFtZXMgKz0gXCI8YnI+XCI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IHJlcXVpcmUgPSBcIlwiO1xuXG4gICAgICAgICAgaWYgKG5mdC5tZXRhZGF0YS5yZXF1aXJlKSB7XG4gICAgICAgICAgICBsZXQgcmVxdWlyZUxpc3QgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChjb25zdCByZXF1aXJlS2V5IGluIG5mdC5tZXRhZGF0YS5yZXF1aXJlKSB7XG4gICAgICAgICAgICAgIHJlcXVpcmVMaXN0LnB1c2goXG4gICAgICAgICAgICAgICAgYDxzcGFuIGNsYXNzPVwiY3VzdG9tLWJhZGdlIGxpZ2h0XCI+JHtyZXF1aXJlS2V5fTogJHtuZnQubWV0YWRhdGEucmVxdWlyZVtyZXF1aXJlS2V5XX08L3NwYW4+YFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXF1aXJlID0gYDxzcGFuIGNsYXNzPVwiY3VzdG9tLWJhZGdlIGRhcmtcIj5SZXF1aXJlOjwvc3Bhbj4gJHtyZXF1aXJlTGlzdC5qb2luKFxuICAgICAgICAgICAgICBcIiBcIlxuICAgICAgICAgICAgKX1gO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG5mdERpdi5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgXCIubmZ0LXByb3BlcnRpZXNcIlxuICAgICAgICAgICkuaW5uZXJIVE1MID0gYCR7cHJvcGVydGllc05hbWVzfSAke3JlcXVpcmV9PGJyPmA7XG5cbiAgICAgICAgICAvL2xvYWQgYmFsYW5jZSBmcm9tIGJ1cm5pbmcgYWRkcmVzc1xuICAgICAgICAgIGNvbnN0IG5mdFNwZWNpYWxEaXYgPSBuZnREaXYucXVlcnlTZWxlY3RvcihcIi5uZnQtc3BlY2lhbFwiKTtcbiAgICAgICAgICBuZnRTcGVjaWFsRGl2LmlubmVySFRNTCA9XG4gICAgICAgICAgICAnJiMxMjgyOTM7IDxzcGFuIGlkPVwiYnVybi1jb3VudFwiPi4uLjwvc3Bhbj4nO1xuXG4gICAgICAgICAgLy9hZGQgdG9vbHRpcFxuICAgICAgICAgIG5mdFNwZWNpYWxEaXYuZGF0YXNldC5ic1RpdGxlID0gXCJOdW1iZXIgb2YgY2FyZCBkZWZpbml0aXZlbHkgYnVybmVkXCI7XG4gICAgICAgICAgbmZ0U3BlY2lhbERpdi5kYXRhc2V0LmJzVG9nZ2xlID0gXCJ0b29sdGlwXCI7XG4gICAgICAgICAgbmZ0U3BlY2lhbERpdi5kYXRhc2V0LmJzQ3VzdG9tQ2xhc3MgPSBcImN1c3RvbS10b29sdGlwXCI7XG4gICAgICAgICAgbmV3IHdpbmRvdy5ib290c3RyYXAuVG9vbHRpcChuZnRTcGVjaWFsRGl2KTtcblxuICAgICAgICAgIHRoaXMuYWxnb2RDbGllbnRcbiAgICAgICAgICAgIC5hY2NvdW50QXNzZXRJbmZvcm1hdGlvbihuZnQubWV0YWRhdGEuYnVybl9hZGRyZXNzLCBuZnQuYXNzZXRJZClcbiAgICAgICAgICAgIC5kbygpXG4gICAgICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgIG5mdFNwZWNpYWxEaXYuaW5uZXJIVE1MID0gYCYjMTI4MjkzOyA8c3BhbiBpZD1cImJ1cm4tY291bnRcIj4ke3Jlc3VsdFtcImFzc2V0LWhvbGRpbmdcIl0uYW1vdW50fTwvc3Bhbj5gO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBuZnQubG9hZGluZyA9IHRydWU7XG5cbiAgICAgIHRoaXMuc2xlZXAoMTAwKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNlYXJjaChldmVudCkge1xuICAgIGlmIChldmVudC5rZXkgIT09IFwiRW50ZXJcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHNlYXJjaFNlbnRlbmNlID0gZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTtcblxuICAgIGlmICghc2VhcmNoU2VudGVuY2UpIHtcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKFwiLm5mdC1pdGVtXCIpO1xuICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBpdGVtLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgc2VhcmNoVGVybXMgPSBzZWFyY2hTZW50ZW5jZS5zcGxpdChcIiBcIik7XG4gICAgc2VhcmNoVGVybXMgPSBzZWFyY2hUZXJtcy5tYXAoKHcpID0+IHcudHJpbSgpLnRvTG93ZXJDYXNlKCkpO1xuICAgIHNlYXJjaFRlcm1zID0gc2VhcmNoVGVybXMuZmlsdGVyKCh3KSA9PiB3KTtcblxuICAgIGxldCBpID0gMDtcbiAgICBmb3IgKGNvbnN0IG5mdCBvZiB0aGlzLmNvbGxlY3Rpb24ubmZ0cykge1xuICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG5cbiAgICAgIHRlcm1Mb29wOiBmb3IgKGNvbnN0IHRlcm0gb2Ygc2VhcmNoVGVybXMpIHtcbiAgICAgICAgaWYgKG5mdC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSkgfHwgbmZ0LmFzc2V0SWQgPT0gdGVybSkge1xuICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZnQubWV0YWRhdGEgJiYgbmZ0Lm1ldGFkYXRhLnByb3BlcnRpZXMpIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBuZnQubWV0YWRhdGEucHJvcGVydGllcykge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBrZXkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fFxuICAgICAgICAgICAgICBuZnQubWV0YWRhdGEucHJvcGVydGllc1trZXldLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrIHRlcm1Mb29wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBpdGVtRWxlbWVudCA9IHRoaXMudWkucXVlcnlTZWxlY3RvcihgI25mdC0ke2l9YCk7XG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgaXRlbUVsZW1lbnQuaGlkZGVuID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtRWxlbWVudC5oaWRkZW4gPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpKys7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmlsdGVyVHlwZShldmVudCkge1xuXG4gICAgY29uc3QgbG9hZGluZyA9IHRoaXMudWkucXVlcnlTZWxlY3RvcignI2ZpbHRlci10eXBlLWxvYWRpbmcnKTtcbiAgICBsb2FkaW5nLmhpZGRlbiA9IGZhbHNlO1xuXG4gICAgY29uc3QgdHlwZSA9IGV2ZW50Py5jdXJyZW50VGFyZ2V0Py52YWx1ZTtcblxuICAgIGNvbnN0IGl0ZW1zID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yQWxsKFwiLm5mdC1pdGVtXCIpO1xuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGlmICghdHlwZSkge1xuICAgICAgICBpdGVtLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbS5oaWRkZW4gPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKCF0eXBlKSB7XG4gICAgICBsb2FkaW5nLmhpZGRlbiA9IHRydWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoY29uc3QgbmZ0IG9mIHRoaXMuY29sbGVjdGlvbi5uZnRzKSB7XG4gICAgICBsZXQgZm91bmQgPSBmYWxzZTtcblxuICAgICAgaWYgKCFuZnQuaXNMb2FkZWQpIHtcbiAgICAgICAgYXdhaXQgbmZ0LmxvYWQodGhpcy5hbGdvSW5kZXhlcik7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZnQubWV0YWRhdGE/LnByb3BlcnRpZXM/Llt0eXBlXSkge1xuICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGl0ZW1FbGVtZW50ID0gdGhpcy51aS5xdWVyeVNlbGVjdG9yKGAjbmZ0LSR7aX1gKTtcbiAgICAgIGlmIChmb3VuZCkge1xuICAgICAgICBpdGVtRWxlbWVudC5oaWRkZW4gPSBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW1FbGVtZW50LmhpZGRlbiA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGkrKztcbiAgICB9XG5cbiAgICBsb2FkaW5nLmhpZGRlbiA9IHRydWU7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJCYXNlUGFnZSIsImNvbnN0cnVjdG9yIiwid2FsbGV0Q29ubmVjdCIsImhvbGRpbmdzIiwiYWxnb2RDbGllbnQiLCJhbGdvSW5kZXhlciIsInRoaXMiLCJCcm93c2UiLCJhcmdzIiwic3VwZXIiLCJhcmd1bWVudHMiLCJjb2xsZWN0aW9uTmFtZSIsImxlbmd0aCIsInRpdGxlIiwidWkiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJjb2xsZWN0aW9uIiwiYmF0aGVyc1dpdGhQYWNrcyIsImxvYWRBbGwiLCJzbGVlcCIsImRlbGF5VGltZSIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsImFzeW5jIiwibG9hZGluZ1AiLCJ0ZXh0Q29udGVudCIsImFwcGVuZCIsImNhcmRDb2xsZWN0aW9uIiwiYyIsIm5hbWUiLCJsb2FkIiwibG9hZFBhY2tzIiwicGFja3MiLCJtYXAiLCJwIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwicmVtb3ZlIiwiZGlzcGxheUxpc3QiLCJuZnRzIiwiZW1wdHlEaXYiLCJmaWx0ZXJEaXYiLCJxdWVyeVNlbGVjdG9yIiwidHlwZURyb3Bkb3duIiwiYWRkRXZlbnRMaXN0ZW5lciIsInNlYXJjaCIsImJpbmQiLCJmaWx0ZXJUeXBlIiwibGlzdFZpZXciLCJjbGFzc05hbWUiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwibG9hZFZpc2libGVORlRzIiwicm9vdCIsInJvb3RNYXJnaW4iLCJ0aHJlc2hvbGQiLCJpIiwibmZ0IiwibmZ0RGl2IiwiaWQiLCJkYXRhc2V0IiwicGxhY2VIb2xkZXJDbGFzcyIsImFzc2V0SWQiLCJ0b3RhbCIsImluY2x1ZGVzIiwibmZ0U3BlY2lhbERpdiIsImJzVGl0bGUiLCJic1RvZ2dsZSIsImJzQ3VzdG9tQ2xhc3MiLCJ3aW5kb3ciLCJib290c3RyYXAiLCJUb29sdGlwIiwib2JzZXJ2ZSIsImVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInRhcmdldCIsImxvYWRpbmciLCJ0aGVuIiwiaW1hZ2UiLCJzcmMiLCJpbWFnZVVybCIsImhpZGRlbiIsImhhbmRsZUltYWdlRXJyb3IiLCJwcm9wZXJ0aWVzTmFtZXMiLCJtZXRhZGF0YSIsInByb3BlcnRpZXMiLCJwcm9wZXJ0eU5hbWUiLCJyZXF1aXJlIiwicmVxdWlyZUxpc3QiLCJyZXF1aXJlS2V5IiwicHVzaCIsImpvaW4iLCJhY2NvdW50QXNzZXRJbmZvcm1hdGlvbiIsImJ1cm5fYWRkcmVzcyIsImRvIiwicmVzdWx0IiwiYW1vdW50IiwiZXZlbnQiLCJrZXkiLCJzZWFyY2hTZW50ZW5jZSIsImN1cnJlbnRUYXJnZXQiLCJ2YWx1ZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpdGVtIiwic2VhcmNoVGVybXMiLCJzcGxpdCIsInciLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJmaWx0ZXIiLCJmb3VuZCIsInRlcm1Mb29wIiwidGVybSIsInR5cGUiLCJpc0xvYWRlZCJdLCJzb3VyY2VSb290IjoiIn0=